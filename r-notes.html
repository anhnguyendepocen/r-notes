<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Beginning Computer Science with R</title>
  <meta name="description" content="Notes for Computer Science 115 and 215 at Georgetown College, Kentucky. The language of instruction is R.">
  <meta name="generator" content="bookdown <!--bookdown:version--> and GitBook 2.6.7">

  <meta property="og:title" content="Beginning Computer Science with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Notes for Computer Science 115 and 215 at Georgetown College, Kentucky. The language of instruction is R." />
  <meta name="github-repo" content="homerhanumat/r-notes" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Beginning Computer Science with R" />
  
  <meta name="twitter:description" content="Notes for Computer Science 115 and 215 at Georgetown College, Kentucky. The language of instruction is R." />
  

<meta name="author" content="Homer White">


<meta name="date" content="2018-09-12">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



<!--bookdown:title:start-->
<div id="header">
<h1 class="title">Beginning Computer Science with R</h1>
<h4 class="author"><em>Homer White</em></h4>
<h4 class="date"><em>2018-09-12</em></h4>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a href="#preface">Preface</a><ul>
<li><a href="#the-why-of-these-notes-remarks-for-colleagues"><span class="toc-section-number">0.1</span> The Why of These Notes: Remarks for Colleagues</a></li>
<li><a href="#history-of-r"><span class="toc-section-number">0.2</span> History of R</a></li>
<li><a href="#acknowledgements"><span class="toc-section-number">0.3</span> Acknowledgements</a></li>
<li><a href="#miscellaneous-information"><span class="toc-section-number">0.4</span> Miscellaneous Information</a><ul>
<li><a href="#r-packages"><span class="toc-section-number">0.4.1</span> R Packages</a></li>
<li><a href="#typographical-conventions"><span class="toc-section-number">0.4.2</span> Typographical Conventions</a></li>
<li><a href="#license"><span class="toc-section-number">0.4.3</span> License</a></li>
</ul></li>
</ul></li>
<li><a href="#part-csc-115">(PART) CSC 115</a></li>
<li><a href="#idea"><span class="toc-section-number">1</span> Our First Computer Programs</a><ul>
<li><a href="#hello-world"><span class="toc-section-number">1.1</span> Hello, World!</a></li>
<li><a href="#idea-tour"><span class="toc-section-number">1.2</span> A Quick Tour</a><ul>
<li><a href="#idea-arithmetic"><span class="toc-section-number">1.2.1</span> Basic Arithmetic</a></li>
<li><a href="#read-evaluate-print-loop"><span class="toc-section-number">1.2.2</span> Read-Evaluate-Print-Loop</a></li>
<li><a href="#idea-variables"><span class="toc-section-number">1.2.3</span> Variables</a></li>
<li><a href="#idea-functions"><span class="toc-section-number">1.2.4</span> Functions</a></li>
<li><a href="#idea-data"><span class="toc-section-number">1.2.5</span> Data and Graphics</a></li>
</ul></li>
<li><a href="#idea-debugging"><span class="toc-section-number">1.3</span> Debugging</a></li>
<li><a href="#idea-glossary">Glossary</a></li>
<li><a href="#idea-exercises">Exercises</a></li>
</ul></li>
<li><a href="#vectors"><span class="toc-section-number">2</span> Vectors</a><ul>
<li><a href="#what-is-a-vector"><span class="toc-section-number">2.1</span> What is a Vector?</a><ul>
<li><a href="#types-of-atomic-vectors"><span class="toc-section-number">2.1.1</span> Types of Atomic Vectors</a></li>
<li><a href="#coercion"><span class="toc-section-number">2.1.2</span> Coercion</a></li>
<li><a href="#combining-vectors"><span class="toc-section-number">2.1.3</span> Combining Vectors</a></li>
<li><a href="#na-values"><span class="toc-section-number">2.1.4</span> NA Values </a></li>
<li><a href="#everything-in-r-is-a-vector"><span class="toc-section-number">2.1.5</span> “Everything in R is a Vector”</a></li>
<li><a href="#named-vectors"><span class="toc-section-number">2.1.6</span> Named Vectors</a></li>
<li><a href="#special-character-vectors"><span class="toc-section-number">2.1.7</span> Special Character Vectors</a></li>
<li><a href="#length-of-vectors"><span class="toc-section-number">2.1.8</span> Length of Vectors</a></li>
<li><a href="#practice-exercises"><span class="toc-section-number">2.1.9</span> Practice Exercises</a></li>
<li><a href="#solutions-to-practice-exercises"><span class="toc-section-number">2.1.10</span> Solutions to Practice Exercises</a></li>
</ul></li>
<li><a href="#constructing-patterned-vectors"><span class="toc-section-number">2.2</span> Constructing Patterned Vectors</a><ul>
<li><a href="#sequencing"><span class="toc-section-number">2.2.1</span> Sequencing</a></li>
<li><a href="#repeating"><span class="toc-section-number">2.2.2</span> Repeating</a></li>
<li><a href="#practice-exercises-1"><span class="toc-section-number">2.2.3</span> Practice Exercises</a></li>
<li><a href="#solutions-to-practice-exercises-1"><span class="toc-section-number">2.2.4</span> Solutions to Practice Exercises</a></li>
</ul></li>
<li><a href="#subsetting-vectors"><span class="toc-section-number">2.3</span> Subsetting Vectors</a><ul>
<li><a href="#practice-exercises-2"><span class="toc-section-number">2.3.1</span> Practice Exercises</a></li>
<li><a href="#solutions-to-practice-exercises-2"><span class="toc-section-number">2.3.2</span> Solutions to Practice Exercises</a></li>
</ul></li>
<li><a href="#more-on-logical-vectors"><span class="toc-section-number">2.4</span> More on Logical Vectors</a><ul>
<li><a href="#boolean-operators"><span class="toc-section-number">2.4.1</span> Boolean Operators</a></li>
</ul></li>
<li><a href="#vector-recycling"><span class="toc-section-number">2.5</span> Vector Recycling </a><ul>
<li><a href="#practice-exercises-3"><span class="toc-section-number">2.5.1</span> Practice Exercises</a></li>
<li><a href="#solutions-to-practice-exercises-3"><span class="toc-section-number">2.5.2</span> Solutions to Practice Exercises</a></li>
</ul></li>
<li><a href="#subsetting-with-logical-vectors"><span class="toc-section-number">2.6</span> Subsetting with Logical Vectors</a><ul>
<li><a href="#counting"><span class="toc-section-number">2.6.1</span> Counting</a></li>
<li><a href="#cautions-about-na"><span class="toc-section-number">2.6.2</span> Cautions about NA</a></li>
<li><a href="#which-any-all"><span class="toc-section-number">2.6.3</span> Which, Any, All</a></li>
<li><a href="#invisible-returns"><span class="toc-section-number">2.6.4</span> Application: Invisible Returns</a></li>
<li><a href="#ifelse"><span class="toc-section-number">2.6.5</span> Ifelse</a></li>
<li><a href="#switch"><span class="toc-section-number">2.6.6</span> Switch</a></li>
<li><a href="#practice-exercises-4"><span class="toc-section-number">2.6.7</span> Practice Exercises</a></li>
<li><a href="#solutions-to-practice-exercises-4"><span class="toc-section-number">2.6.8</span> Solutions to Practice Exercises</a></li>
</ul></li>
<li><a href="#repeating-things-looping"><span class="toc-section-number">2.7</span> Repeating Things: Looping</a><ul>
<li><a href="#for-loops"><span class="toc-section-number">2.7.1</span> For Loops</a></li>
<li><a href="#for-loop-caution"><span class="toc-section-number">2.7.2</span> For-Loop Caution</a></li>
<li><a href="#breaking-out-of-a-loop"><span class="toc-section-number">2.7.3</span> Breaking Out of a Loop</a></li>
<li><a href="#solving-the-empty-vector-problem-in-for-loops-with-seq_along"><span class="toc-section-number">2.7.4</span> Solving the Empty-Vector Problem in <code>for</code>-Loops with <code>seq_along()</code></a></li>
<li><a href="#skipping-ahead-in-a-loop"><span class="toc-section-number">2.7.5</span> Skipping Ahead in a Loop</a></li>
<li><a href="#repeat"><span class="toc-section-number">2.7.6</span> Repeat</a></li>
<li><a href="#while"><span class="toc-section-number">2.7.7</span> While</a></li>
<li><a href="#practice-problems"><span class="toc-section-number">2.7.8</span> Practice Problems</a></li>
<li><a href="#solutions-to-the-practice-exercises"><span class="toc-section-number">2.7.9</span> Solutions to the Practice Exercises</a></li>
</ul></li>
<li><a href="#collatz-conjecture"><span class="toc-section-number">2.8</span> Application: The Collatz Conjecture</a></li>
<li><a href="#glossary">Glossary</a></li>
<li><a href="#exercises">Exercises</a></li>
</ul></li>
<li><a href="#turtle"><span class="toc-section-number">3</span> Turtle Graphics</a><ul>
<li><a href="#basic-movements"><span class="toc-section-number">3.1</span> Basic Movements</a></li>
<li><a href="#making-many-movements-an-introduction-to-looping"><span class="toc-section-number">3.2</span> Making Many Movements: An Introduction to Looping</a><ul>
<li><a href="#practice-exercises-5"><span class="toc-section-number">3.2.1</span> Practice Exercises</a></li>
<li><a href="#solutions-to-the-practice-exercises-1"><span class="toc-section-number">3.2.2</span> Solutions to the Practice Exercises</a></li>
</ul></li>
<li><a href="#writing-turtle-functions"><span class="toc-section-number">3.3</span> Writing Turtle Functions</a><ul>
<li><a href="#practice-exercises-6"><span class="toc-section-number">3.3.1</span> Practice Exercises</a></li>
<li><a href="#solutions-to-the-practice-exercises-2"><span class="toc-section-number">3.3.2</span> Solutions to the Practice Exercises</a></li>
</ul></li>
<li><a href="#random-moves"><span class="toc-section-number">3.4</span> Random Moves</a><ul>
<li><a href="#sampling-from-a-vector"><span class="toc-section-number">3.4.1</span> Sampling from a Vector</a></li>
<li><a href="#application-a-bouncing-turtle"><span class="toc-section-number">3.4.2</span> Application: a Bouncing Turtle</a></li>
<li><a href="#uniform-random-numbers"><span class="toc-section-number">3.4.3</span> Uniform Random Numbers</a></li>
<li><a href="#pseudo-randomness-and-setting-a-seed"><span class="toc-section-number">3.4.4</span> Pseudo-Randomness and Setting a Seed</a></li>
<li><a href="#drunken-turtle-intro"><span class="toc-section-number">3.4.5</span> Application: a Drunken Turtle</a></li>
<li><a href="#turtle-practice"><span class="toc-section-number">3.4.6</span> Practice Exercises</a></li>
<li><a href="#solutions-to-the-practice-exercises-3"><span class="toc-section-number">3.4.7</span> Solutions to the Practice Exercises</a></li>
</ul></li>
<li><a href="#more-complex-turtle-graphs"><span class="toc-section-number">3.5</span> More Complex Turtle Graphs</a></li>
<li><a href="#artistic-turtles"><span class="toc-section-number">3.6</span> Artistic Turtles</a></li>
<li><a href="#glossary-1">Glossary</a></li>
<li><a href="#exercises-1">Exercises</a></li>
</ul></li>
<li><a href="#simulation"><span class="toc-section-number">4</span> Simulation</a><ul>
<li><a href="#probability-and-random-variables"><span class="toc-section-number">4.1</span> Probability and Random Variables</a></li>
<li><a href="#monte-carlo-simulation"><span class="toc-section-number">4.2</span> Monte Carlo Simulation</a><ul>
<li><a href="#estimating-a-probability"><span class="toc-section-number">4.2.1</span> Estimating a Probability</a></li>
<li><a href="#estimating-an-expected-value"><span class="toc-section-number">4.2.2</span> Estimating an Expected Value</a></li>
<li><a href="#the-law-of-large-numbers"><span class="toc-section-number">4.2.3</span> The Law of Large Numbers</a></li>
<li><a href="#practice-exercises-7"><span class="toc-section-number">4.2.4</span> Practice Exercises</a></li>
<li><a href="#solutions-to-the-practice-exercises-4"><span class="toc-section-number">4.2.5</span> Solutions to the Practice Exercises</a></li>
</ul></li>
<li><a href="#triangle-chance"><span class="toc-section-number">4.3</span> Example: Chance of a Triangle</a><ul>
<li><a href="#setting-a-seed"><span class="toc-section-number">4.3.1</span> Setting a Seed</a></li>
<li><a href="#program-development"><span class="toc-section-number">4.3.2</span> Program Development</a></li>
<li><a href="#number-of-repetitions"><span class="toc-section-number">4.3.3</span> Number of Repetitions</a></li>
<li><a href="#basic-simulations"><span class="toc-section-number">4.3.4</span> Practice Exercises</a></li>
<li><a href="#solutions-to-practice-exercises-5"><span class="toc-section-number">4.3.5</span> Solutions to Practice Exercises</a></li>
</ul></li>
<li><a href="#simulation-connect"><span class="toc-section-number">4.4</span> Example: Will They Connect?</a><ul>
<li><a href="#vectorization-vs.looping"><span class="toc-section-number">4.4.1</span> Vectorization vs. Looping</a></li>
</ul></li>
<li><a href="#appeals-court-paradox"><span class="toc-section-number">4.5</span> Example: the Appeals Court Paradox</a><ul>
<li><a href="#practice-exercises-8"><span class="toc-section-number">4.5.1</span> Practice Exercises</a></li>
<li><a href="#solutions-to-the-practice-exercises-5"><span class="toc-section-number">4.5.2</span> Solutions to the Practice Exercises</a></li>
</ul></li>
<li><a href="#simulation-number-needed"><span class="toc-section-number">4.6</span> Example: How Many Numbers Needed?</a></li>
<li><a href="#example-dental-floss"><span class="toc-section-number">4.7</span> Example: Dental Floss</a></li>
<li><a href="#drunken-turtle-sim"><span class="toc-section-number">4.8</span> Example: The Drunken Turtle</a></li>
<li><a href="#glossary-2">Glossary</a></li>
<li><a href="#exercises-2">Exercises</a></li>
</ul></li>
<li><a href="#frames"><span class="toc-section-number">5</span> Data Frames</a><ul>
<li><a href="#introduction-to-matrices"><span class="toc-section-number">5.1</span> Introduction to Matrices</a><ul>
<li><a href="#practice-exercises-9"><span class="toc-section-number">5.1.1</span> Practice Exercises</a></li>
<li><a href="#solutions-to-practice-exercises-6"><span class="toc-section-number">5.1.2</span> Solutions to Practice Exercises</a></li>
</ul></li>
<li><a href="#matrix-indexing"><span class="toc-section-number">5.2</span> Matrix Indexing</a><ul>
<li><a href="#to-drop-or-not"><span class="toc-section-number">5.2.1</span> To Drop or Not?</a></li>
<li><a href="#practice-exercises-10"><span class="toc-section-number">5.2.2</span> Practice Exercises</a></li>
<li><a href="#solutions-to-practice-exercises-7"><span class="toc-section-number">5.2.3</span> Solutions to Practice Exercises</a></li>
</ul></li>
<li><a href="#operations-on-matrices"><span class="toc-section-number">5.3</span> Operations on Matrices</a><ul>
<li><a href="#arithmetical-operations"><span class="toc-section-number">5.3.1</span> Arithmetical Operations</a></li>
<li><a href="#matrix-multiplication"><span class="toc-section-number">5.3.2</span> Matrix Multiplication</a></li>
<li><a href="#logical-operations"><span class="toc-section-number">5.3.3</span> Logical Operations</a></li>
<li><a href="#practice-exercises-11"><span class="toc-section-number">5.3.4</span> Practice Exercises</a></li>
<li><a href="#solutions-to-practice-exercises-8"><span class="toc-section-number">5.3.5</span> Solutions to Practice Exercises</a></li>
</ul></li>
<li><a href="#introduction-to-data-frames"><span class="toc-section-number">5.4</span> Introduction to Data Frames</a><ul>
<li><a href="#viewing-a-data-frame"><span class="toc-section-number">5.4.1</span> Viewing a Data Frame</a></li>
<li><a href="#the-stucture-of-a-data-frame"><span class="toc-section-number">5.4.2</span> The Stucture of a Data Frame</a></li>
<li><a href="#factor-variables"><span class="toc-section-number">5.4.3</span> Factors</a></li>
<li><a href="#practice-exercises-12"><span class="toc-section-number">5.4.4</span> Practice Exercises</a></li>
<li><a href="#solutions-to-the-practice-exercises-6"><span class="toc-section-number">5.4.5</span> Solutions to the Practice Exercises</a></li>
</ul></li>
<li><a href="#creating-data-frames"><span class="toc-section-number">5.5</span> Creating Data Frames</a><ul>
<li><a href="#creation-from-vectors"><span class="toc-section-number">5.5.1</span> Creation from Vectors</a></li>
<li><a href="#creation-from-other-frames"><span class="toc-section-number">5.5.2</span> Creation From Other Frames</a></li>
</ul></li>
<li><a href="#subsetting-data-frames"><span class="toc-section-number">5.6</span> Subsetting Data Frames</a><ul>
<li><a href="#boolean-expressions"><span class="toc-section-number">5.6.1</span> Boolean Expressions</a></li>
<li><a href="#practice-exercises-13"><span class="toc-section-number">5.6.2</span> Practice Exercises</a></li>
<li><a href="#solutions-to-practice-exercises-9"><span class="toc-section-number">5.6.3</span> Solutions to Practice Exercises</a></li>
</ul></li>
<li><a href="#ordering-data-frames"><span class="toc-section-number">5.7</span> Ordering Data Frames</a><ul>
<li><a href="#practice-exercises-14"><span class="toc-section-number">5.7.1</span> Practice Exercises</a></li>
<li><a href="#solutions-to-practice-exercises-10"><span class="toc-section-number">5.7.2</span> Solutions to Practice Exercises</a></li>
</ul></li>
<li><a href="#new-variables-from-old"><span class="toc-section-number">5.8</span> New Variables from Old</a><ul>
<li><a href="#getting-rid-of-variables"><span class="toc-section-number">5.8.1</span> Getting Rid of Variables</a></li>
<li><a href="#practice-exercises-15"><span class="toc-section-number">5.8.2</span> Practice Exercises</a></li>
<li><a href="#solutions-to-practice-exercises-11"><span class="toc-section-number">5.8.3</span> Solutions to Practice Exercises</a></li>
</ul></li>
<li><a href="#glossary-3">Glossary</a></li>
<li><a href="#frames-exercises">Exercises</a></li>
</ul></li>
<li><a href="#graphics"><span class="toc-section-number">6</span> Graphics</a><ul>
<li><a href="#the-grammar-of-graphics"><span class="toc-section-number">6.1</span> The Grammar of Graphics</a><ul>
<li><a href="#example-a-scatterplot"><span class="toc-section-number">6.1.1</span> Example: a Scatterplot</a></li>
<li><a href="#example-two-bar-graphs"><span class="toc-section-number">6.1.2</span> Example: Two Bar Graphs</a></li>
<li><a href="#examples-histograms-density-plots-and-box-plots"><span class="toc-section-number">6.1.3</span> Examples: Histograms, Density Plots and Box Plots</a></li>
<li><a href="#example-choropleth-maps"><span class="toc-section-number">6.1.4</span> Example: Choropleth Maps</a></li>
<li><a href="#practice-exercises-16"><span class="toc-section-number">6.1.5</span> Practice Exercises</a></li>
<li><a href="#solutions-to-practice-exercises-12"><span class="toc-section-number">6.1.6</span> Solutions to Practice Exercises</a></li>
</ul></li>
<li><a href="#implementation-in-ggplot2"><span class="toc-section-number">6.2</span> Implementation in <strong>ggplot2</strong></a><ul>
<li><a href="#basic-setup-the-data-frame"><span class="toc-section-number">6.2.1</span> Basic Setup: the Data Frame</a></li>
<li><a href="#more-setup-establishing-the-frame"><span class="toc-section-number">6.2.2</span> More Setup: Establishing the Frame</a></li>
<li><a href="#labels"><span class="toc-section-number">6.2.3</span> Labels</a></li>
<li><a href="#adding-a-type-of-glyph"><span class="toc-section-number">6.2.4</span> Adding a Type of Glyph</a></li>
<li><a href="#layering-adding-another-glyph-type"><span class="toc-section-number">6.2.5</span> Layering: Adding Another Glyph Type</a></li>
<li><a href="#facets"><span class="toc-section-number">6.2.6</span> Facets</a></li>
<li><a href="#practice-exercises-17"><span class="toc-section-number">6.2.7</span> Practice Exercises</a></li>
<li><a href="#solutions-to-practice-exercises-13"><span class="toc-section-number">6.2.8</span> Solutions to Practice Exercises</a></li>
</ul></li>
<li><a href="#a-case-study-us-births"><span class="toc-section-number">6.3</span> A Case Study: US Births</a></li>
<li><a href="#factors-in-plotting"><span class="toc-section-number">6.4</span> Factor Variables in Plotting</a><ul>
<li><a href="#practice-exercises-18"><span class="toc-section-number">6.4.1</span> Practice Exercises</a></li>
<li><a href="#solutions-to-practice-exercises-14"><span class="toc-section-number">6.4.2</span> Solutions to Practice Exercises</a></li>
</ul></li>
<li><a href="#learn-more"><span class="toc-section-number">6.5</span> Learn More</a></li>
<li><a href="#glossary-4">Glossary</a></li>
<li><a href="#graphics-exercises">Exercises</a></li>
</ul></li>
<li><a href="#lists"><span class="toc-section-number">7</span> Lists</a><ul>
<li><a href="#introduction-to-lists"><span class="toc-section-number">7.1</span> Introduction to Lists</a><ul>
<li><a href="#practice-exercises-19"><span class="toc-section-number">7.1.1</span> Practice Exercises</a></li>
<li><a href="#solutions-to-the-practice-exercises-7"><span class="toc-section-number">7.1.2</span> Solutions to the Practice Exercises</a></li>
</ul></li>
<li><a href="#subsetting-and-accessing"><span class="toc-section-number">7.2</span> Subsetting and Accessing</a><ul>
<li><a href="#practice-exercises-20"><span class="toc-section-number">7.2.1</span> Practice Exercises</a></li>
<li><a href="#solutions-to-the-practice-exercises-8"><span class="toc-section-number">7.2.2</span> Solutions to the Practice Exercises</a></li>
</ul></li>
<li><a href="#lists-splitting"><span class="toc-section-number">7.3</span> Splitting</a></li>
<li><a href="#returning-multiple-values"><span class="toc-section-number">7.4</span> Returning Multiple Values</a></li>
<li><a href="#iterating-over-a-list"><span class="toc-section-number">7.5</span> Iterating Over a List</a></li>
<li><a href="#a-note-on-ellipses"><span class="toc-section-number">7.6</span> A Note on Ellipses</a><ul>
<li><a href="#use-1-passing-additional-arguments-to-functions-inside"><span class="toc-section-number">7.6.1</span> Use #1: Passing Additional Arguments to Functions “Inside”</a></li>
<li><a href="#use-2-permitting-any-number-of-arguments"><span class="toc-section-number">7.6.2</span> Use #2: Permitting Any Number of Arguments</a></li>
</ul></li>
<li><a href="#investigate-your-object-str-and-lists"><span class="toc-section-number">7.7</span> Investigate Your Object: <code>str()</code> and Lists</a><ul>
<li><a href="#practice-exercises-21"><span class="toc-section-number">7.7.1</span> Practice Exercises</a></li>
<li><a href="#solutions-to-practice-exercises-15"><span class="toc-section-number">7.7.2</span> Solutions to Practice Exercises</a></li>
</ul></li>
<li><a href="#glossary-5">Glossary</a></li>
<li><a href="#exercises-3">Exercises</a></li>
</ul></li>
<li><a href="#part-csc-215">(PART) CSC 215</a></li>
<li><a href="#tidyverse-concepts"><span class="toc-section-number">8</span> Basic Tidyverse Concepts</a><ul>
<li><a href="#tidyverse"><span class="toc-section-number">8.1</span> The Tidyverse</a></li>
<li><a href="#the-pipe-operator"><span class="toc-section-number">8.2</span> The Pipe Operator</a><ul>
<li><a href="#practice-exercises-22"><span class="toc-section-number">8.2.1</span> Practice Exercises</a></li>
<li><a href="#solutions-to-the-practice-exercises-9"><span class="toc-section-number">8.2.2</span> Solutions to the Practice Exercises</a></li>
</ul></li>
<li><a href="#tibbles"><span class="toc-section-number">8.3</span> Tibbles</a></li>
<li><a href="#subsetting-with-dplyr"><span class="toc-section-number">8.4</span> Subsetting with dplyr</a><ul>
<li><a href="#practice-exercises-23"><span class="toc-section-number">8.4.1</span> Practice Exercises</a></li>
<li><a href="#solutions-to-practice-exercises-16"><span class="toc-section-number">8.4.2</span> Solutions to Practice Exercises</a></li>
</ul></li>
<li><a href="#transforming-variables-with-dplyr"><span class="toc-section-number">8.5</span> Transforming Variables with dplyr</a><ul>
<li><a href="#practice-exercises-24"><span class="toc-section-number">8.5.1</span> Practice Exercises</a></li>
<li><a href="#solutions-to-practice-exercises-17"><span class="toc-section-number">8.5.2</span> Solutions to Practice Exercises</a></li>
</ul></li>
<li><a href="#grouping-and-summaries"><span class="toc-section-number">8.6</span> Grouping and Summaries</a><ul>
<li><a href="#note-on-binding"><span class="toc-section-number">8.6.1</span> Note on Binding</a></li>
<li><a href="#practice-exercises-25"><span class="toc-section-number">8.6.2</span> Practice Exercises</a></li>
<li><a href="#solutions-to-practice-exercises-18"><span class="toc-section-number">8.6.3</span> Solutions to Practice Exercises</a></li>
</ul></li>
<li><a href="#exercises-4">Exercises</a></li>
</ul></li>
<li><a href="#strings"><span class="toc-section-number">9</span> Strings</a><ul>
<li><a href="#character-vectors-strings"><span class="toc-section-number">9.1</span> Character Vectors: Strings</a></li>
<li><a href="#characters-and-special-characters"><span class="toc-section-number">9.2</span> Characters and Special Characters</a></li>
<li><a href="#basic-string-operations"><span class="toc-section-number">9.3</span> Basic String Operations</a><ul>
<li><a href="#is-and-as"><span class="toc-section-number">9.3.1</span> Is and As</a></li>
<li><a href="#number-of-characters"><span class="toc-section-number">9.3.2</span> Number of Characters</a></li>
<li><a href="#substrings-and-trimming"><span class="toc-section-number">9.3.3</span> Substrings and Trimming</a></li>
<li><a href="#changing-cases"><span class="toc-section-number">9.3.4</span> Changing Cases</a></li>
<li><a href="#splitting-strings"><span class="toc-section-number">9.3.5</span> Splitting Strings</a></li>
<li><a href="#pasting-and-joining-strings"><span class="toc-section-number">9.3.6</span> Pasting and Joining Strings</a></li>
</ul></li>
<li><a href="#formatted-printing"><span class="toc-section-number">9.4</span> Formatted Printing</a></li>
<li><a href="#glossary-6">Glossary</a></li>
<li><a href="#exercises-5">Exercises</a></li>
</ul></li>
<li><a href="#regex"><span class="toc-section-number">10</span> Regular Expressions</a><ul>
<li><a href="#motivation"><span class="toc-section-number">10.1</span> Motivation</a></li>
<li><a href="#regex-practice-sites"><span class="toc-section-number">10.2</span> Regex Practice Sites</a></li>
<li><a href="#regex-syntax"><span class="toc-section-number">10.3</span> Regex Syntax</a><ul>
<li><a href="#matching-a-specific-sequence"><span class="toc-section-number">10.3.1</span> Matching a Specific Sequence</a></li>
<li><a href="#character-classes"><span class="toc-section-number">10.3.2</span> Character Classes</a></li>
<li><a href="#quantification"><span class="toc-section-number">10.3.3</span> Quantification</a></li>
<li><a href="#greedy-vs.lazy"><span class="toc-section-number">10.3.4</span> Greedy vs. Lazy</a></li>
<li><a href="#grouping"><span class="toc-section-number">10.3.5</span> Grouping</a></li>
<li><a href="#alternation"><span class="toc-section-number">10.3.6</span> Alternation</a></li>
<li><a href="#anchors"><span class="toc-section-number">10.3.7</span> Anchors</a></li>
<li><a href="#regex-captures"><span class="toc-section-number">10.3.8</span> Captures</a></li>
<li><a href="#looking-around"><span class="toc-section-number">10.3.9</span> Looking Around</a></li>
<li><a href="#more-to-learn"><span class="toc-section-number">10.3.10</span> More to Learn</a></li>
</ul></li>
<li><a href="#entering-a-regex-in-r"><span class="toc-section-number">10.4</span> Entering a Regex in R</a><ul>
<li><a href="#string-to-regex"><span class="toc-section-number">10.4.1</span> String to Regex</a></li>
<li><a href="#regex-substitution"><span class="toc-section-number">10.4.2</span> Substitution</a></li>
<li><a href="#patterned-replacement"><span class="toc-section-number">10.4.3</span> Patterned Replacement</a></li>
<li><a href="#detecting-matches"><span class="toc-section-number">10.4.4</span> Detecting Matches</a></li>
<li><a href="#extracting-matches"><span class="toc-section-number">10.4.5</span> Extracting Matches</a></li>
<li><a href="#extraction-in-data-frames"><span class="toc-section-number">10.4.6</span> Extraction in Data Frames</a></li>
<li><a href="#counting-matches"><span class="toc-section-number">10.4.7</span> Counting Matches</a></li>
<li><a href="#regex-modes"><span class="toc-section-number">10.4.8</span> Regex Modes</a></li>
<li><a href="#practice-exercises-26"><span class="toc-section-number">10.4.9</span> Practice Exercises</a></li>
<li><a href="#solutions-to-the-practice-exercises-10"><span class="toc-section-number">10.4.10</span> Solutions to the Practice Exercises</a></li>
</ul></li>
<li><a href="#application-amazon-book-reviews"><span class="toc-section-number">10.5</span> Application: Amazon Book Reviews</a><ul>
<li><a href="#practice-exercises-27"><span class="toc-section-number">10.5.1</span> Practice Exercises</a></li>
<li><a href="#solutions-to-the-practice-exercises-11"><span class="toc-section-number">10.5.2</span> Solutions to the Practice Exercises</a></li>
</ul></li>
<li><a href="#glossary-7">Glossary</a></li>
<li><a href="#exercises-6">Exercises</a></li>
</ul></li>
<li><a href="#files"><span class="toc-section-number">11</span> Files</a><ul>
<li><a href="#downloading-files"><span class="toc-section-number">11.1</span> Downloading Files</a></li>
<li><a href="#reading-text-files-with-readlines"><span class="toc-section-number">11.2</span> Reading Text Files with <code>readLines()</code></a></li>
<li><a href="#reading-text-files-with-readr"><span class="toc-section-number">11.3</span> Reading Text Files with <strong>readr</strong></a></li>
<li><a href="#writing-to-files"><span class="toc-section-number">11.4</span> Writing to Files</a></li>
<li><a href="#application-making-a-lexicon"><span class="toc-section-number">11.5</span> Application: Making a Lexicon</a></li>
<li><a href="#glossary-8">Glossary</a></li>
<li><a href="#exercises-7">Exercises</a></li>
</ul></li>
<li><a href="#functional"><span class="toc-section-number">12</span> Functional Programming in R</a><ul>
<li><a href="#programming-paradigms"><span class="toc-section-number">12.1</span> Programming Paradigms</a><ul>
<li><a href="#procedural-programming"><span class="toc-section-number">12.1.1</span> Procedural Programming</a></li>
</ul></li>
<li><a href="#the-functional-programming-paradigm"><span class="toc-section-number">12.2</span> The Functional Programming Paradigm</a><ul>
<li><a href="#the-ubiquity-of-functions-in-r"><span class="toc-section-number">12.2.1</span> The Ubiquity of Functions in R</a></li>
<li><a href="#functions-as-first-class-citizens"><span class="toc-section-number">12.2.2</span> Functions as First-Class Citizens</a></li>
<li><a href="#minimize-side-effects"><span class="toc-section-number">12.2.3</span> Minimize Side Effects</a></li>
<li><a href="#procedures-as-higher-order-function-calls"><span class="toc-section-number">12.2.4</span> Procedures as Higher-Order Function Calls</a></li>
<li><a href="#functional-programming-a-summary"><span class="toc-section-number">12.2.5</span> Functional Programming: A Summary</a></li>
</ul></li>
<li><a href="#purrr-higher-order-functions-for-iteration"><span class="toc-section-number">12.3</span> <strong>purrr</strong> Higher-Order Functions for Iteration</a><ul>
<li><a href="#map-and-variations"><span class="toc-section-number">12.3.1</span> <code>map()</code> and Variations</a></li>
<li><a href="#walk-and-variations"><span class="toc-section-number">12.3.2</span> <code>walk()</code> and Variations</a></li>
<li><a href="#practice-exercises-28"><span class="toc-section-number">12.3.3</span> Practice Exercises</a></li>
<li><a href="#solutions-to-the-practice-exercises-12"><span class="toc-section-number">12.3.4</span> Solutions to the Practice Exercises</a></li>
</ul></li>
<li><a href="#other-purr-higher-order-functions"><span class="toc-section-number">12.4</span> Other <strong>purr</strong> Higher-Order Functions</a><ul>
<li><a href="#keep-and-discard"><span class="toc-section-number">12.4.1</span> <code>keep()</code> and <code>discard()</code></a></li>
<li><a href="#reduce"><span class="toc-section-number">12.4.2</span> <code>reduce()</code></a></li>
<li><a href="#practice-exercises-29"><span class="toc-section-number">12.4.3</span> Practice Exercises</a></li>
<li><a href="#solutions-to-the-practice-exercises-13"><span class="toc-section-number">12.4.4</span> Solutions to the Practice Exercises</a></li>
</ul></li>
<li><a href="#functionals-vs.loops"><span class="toc-section-number">12.5</span> Functionals vs. Loops</a></li>
<li><a href="#conclusion"><span class="toc-section-number">12.6</span> Conclusion</a></li>
<li><a href="#glossary-9">Glossary</a></li>
<li><a href="#exercises-8">Exercises</a></li>
</ul></li>
<li><a href="#oo"><span class="toc-section-number">13</span> Object-Oriented Programming in R</a><ul>
<li><a href="#the-object-oriented-programming-paradigm"><span class="toc-section-number">13.1</span> The Object-Oriented Programming Paradigm</a></li>
<li><a href="#reference-classes-with-package-r6"><span class="toc-section-number">13.2</span> Reference Classes with Package R6</a><ul>
<li><a href="#defining-a-class"><span class="toc-section-number">13.2.1</span> Defining a Class</a></li>
<li><a href="#instantiation-initializing-objects"><span class="toc-section-number">13.2.2</span> Instantiation: Initializing Objects</a></li>
<li><a href="#getting-and-setting-attributes"><span class="toc-section-number">13.2.3</span> Getting and Setting Attributes</a></li>
<li><a href="#calling-methods"><span class="toc-section-number">13.2.4</span> Calling Methods</a></li>
<li><a href="#holding-a-reference-not-a-value"><span class="toc-section-number">13.2.5</span> Holding a Reference, not a Value</a></li>
<li><a href="#cloning-an-object"><span class="toc-section-number">13.2.6</span> Cloning an Object</a></li>
</ul></li>
<li><a href="#inheritance"><span class="toc-section-number">13.3</span> Inheritance</a></li>
<li><a href="#adding-members-to-a-class"><span class="toc-section-number">13.4</span> Adding Members to a Class</a></li>
<li><a href="#method-chaining"><span class="toc-section-number">13.5</span> Method Chaining</a></li>
<li><a href="#application-whales-in-an-ocean"><span class="toc-section-number">13.6</span> Application: Whales in an Ocean</a></li>
<li><a href="#generic-function-oo"><span class="toc-section-number">13.7</span> Generic-Function OO</a><ul>
<li><a href="#motivating-examples"><span class="toc-section-number">13.7.1</span> Motivating Examples</a></li>
<li><a href="#terminology"><span class="toc-section-number">13.7.2</span> Terminology</a></li>
<li><a href="#common-generic-functions"><span class="toc-section-number">13.7.3</span> Common Generic Functions</a></li>
<li><a href="#writing-your-own-methods"><span class="toc-section-number">13.7.4</span> Writing Your Own Methods</a></li>
<li><a href="#writing-a-generic-function"><span class="toc-section-number">13.7.5</span> Writing a Generic Function</a></li>
</ul></li>
<li><a href="#glossary-10">Glossary</a></li>
<li><a href="#exercises-9">Exercises</a></li>
</ul></li>
<li><a href="#references">References</a></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Beginning Computer Science with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="preface" class="section level1 unnumbered">
<h1>Preface</h1>
<p>Welcome to <em>Beginning Computer Science with R</em>! These notes will be your primary source for CSC 115: Computer Science I, offered at Georgetown College. They will also carry you most of the way through CSC 215.</p>
<p>For the first semester you won’t need a computer of your own: you can do all of your work on the R Studio Server, which you will access with your College network username and password. Eventually, though, you will need to learn how to install and maintain professional software development tools on your own machine, so at some point early on in CSC 215 you will install R, R Studio and various other tools on a laptop of your own. Then you will bring the laptop to class for your daily work.</p>
<p>These Notes are available not only on the web but also as a PDF document that can be downloaded from the website (click the PDF icon, found among the icons at the top of the page). The PDF is useful when you are working offline, and it also has an index.</p>
<p>Instructional videos on selected topics will be published from time to time on this YouTube Channel: <a href="https://www.youtube.com/user/GCstats" class="uri">https://www.youtube.com/user/GCstats</a>, in the CSC playlist.</p>
<p>These notes are about the R programming language as such, so although in the class we will work within the R Studio Integrated Development Environment right from the start, R Studio is not directly covered here. Eventually we will begin to write documents in R Markdown, which is also not treated in these Notes. For a resource on these topics in written form that will supplement class instruction and the videos on our YouTube Channel, you might want to consult the excellent little book <a href="https://bookdown.org/chesterismay/rbasics/"><em>Getting used to R, RStudio, and R Markdown</em></a> <span class="citation">(Ismay <a href="#ref-Ismay2016">2016</a>)</span>.</p>
<div id="the-why-of-these-notes-remarks-for-colleagues" class="section level2">
<h2><span class="header-section-number">0.1</span> The Why of These Notes: Remarks for Colleagues</h2>
<p>There is a plethora of books on R, covering pretty much every domain of application of the language, from ecology to spatial statistics to machine learning and data science. There are even some books—among the very finest of R-books, in my view—on R as a programming language.</p>
<p>These Notes are not intended to supersede or to compete with any of the existing literature on R. Instead they are intended to serve the curricular needs of the Computer Science minor at the College where I teach—a minor that emphasizes data analysis primarily, but with a strong focus also on web design and on the increasingly important interfaces between these two areas (e.g., interactive graphics and web apps for working with data and/or reporting the results of data analysis). Students will undertake a serious study of two major scripting languages: R for data analysis and JavaScript for web programming, both from a fairly systematic programming point of view, with due attention to procedural, functional and (to a lesser extent) object-oriented programming paradigms.</p>
<p>The question is: which language to use in the freshman year? Some institutions are moving toward JavaScript: in fact Stanford University piloted JavaScript in several sections of its introductory CS course in the Fall of 2017. There are certainly considerations in favor of a JavaScript-first approach: it’s a popular language, with Node available as an interactive run-time environment and the browser as a environment in which exciting applications can be built quickly. And whereas R is less widely-used and is still considered a domain-specific language, JavaScript can rightly be said to have made the leap into the ranks of general-purpose programming languages. R also has the reputation of being a prickly language with a somewhat inconsistent syntax and with documentation that is “expert-friendly” at best.</p>
<p>On the other hand R is designed for one-line interactivity at the console, so it’s possible for a beginner to get simple programs working quickly. The R-ecosystem has also become a lot more user-friendly in recent years. The <a href="https://www.rstudio.com/products/rstudio/">RStudio</a> IDE is comparable to top-flight integrated development environments for many other major languages and yet is still relatively lightweight and accessible to beginners. The Server version of R Studio is especially useful for new programmers, as it saves them from having to deal with installation and other IT issues on their own machines, permitting them to focus on coding. It’s also quite convenient, in a server setting, to make class materials available and to collect and return assignments. R Markdown is fine platform for producing course notes (this book is written in R Markdown with the excellent <strong>bookdown</strong> package <span class="citation">(Xie <a href="#ref-R-bookdown">2018</a><a href="#ref-R-bookdown">b</a>)</span>) and slides as well. Students, too, can use R Markdown to both write and discuss their programs in a single document. The <strong>blogdown</strong> package <span class="citation">(Xie <a href="#ref-R-blogdown">2018</a><a href="#ref-R-blogdown">a</a>)</span> permits students to begin writing for the public about technical programming issues—or about anything at all, really, as more than a few of them are taking majors in the Humanities—thus building up a professional resume of online work. When it’s time to learn about databases, students can leverage a body of recent work (see <a href="https://db.rstudio.com/">Databases Using R</a>) that renders the R Studio environment nearly as friendly for interaction with databases as dedicated tools such as MySQL Workbench. Finally, the <strong>shiny</strong> package <span class="citation">(Chang et al. <a href="#ref-R-shiny">2018</a>)</span> permits students to build simple interactive web apps for data analysis that can be used by non-coders. Both <strong>blogdown</strong> and <strong>shiny</strong> prompt students to consider early on—even in the first year, if the pacing is right—concepts of web design, the other focus of the minor.</p>
<p>Hence the choice was made to teach a first-year computer science course, to beginning programmers, with R. As I pointed out earlier, there do exist some excellent books on R as a programming language that do not presume previous experience with R. One example is Norman Matloff’s <em>The Art of R Programming</em> <span class="citation">(Matloff <a href="#ref-Matloff2011">2011</a>)</span>. Matloff, however, presumes that the reader either has prior programming experience in some other language or else possesses sufficient computational maturity, acquired perhaps through extensive prior training in the mathematical sciences. Another great text is Garrett Grolemund’s <em>Hands-on Programming with R</em> <span class="citation">(Grolemund <a href="#ref-Grolemund2014">2014</a>)</span>. Grolemund’s book is lively and to-the-point, and starts off with excellent motivating examples. Grolemund is also a master explainer, and he has put considerable effort into visual representation of programming concepts such as element-wise operations on vectors and the enclosure-relationships between environments. On the other hand, even though he doesn’t assume that the reader has prior coding experience, Grolemund does assume some prior background in data analysis and a strong motivation, on the reader’s part, to persevere with nontrivial R-programming issues such as lexical scoping in the hopes of eventual payoffs in programming for data science. In short, Grolemund also assumes more computational maturity than will be usually be found among beginning programmers at many small liberal arts colleges.</p>
<p>Hence the niche for the Notes offered here. I aim to be more copious and slower-paced than Grolemund and less sophisticated than Matloff. These notes will also contain a more extensive set of problems, ranging in difficulty from practice exercises to fairly extended projects that students might write up in R Markdown documents.</p>
<p>Experienced programmers and R enthusiasts will be struck by the absence of certain topics. Programmers will observe that there is no real attention to algorithms (sorting is just <code>sort()</code> or <code>order()</code>), and although functions receive lots of attention there is no mention of recursion. In future editions I might cover recursion, as I believe that it is wonderful for the development of thinking skills, but it’s not likely that a web developer or data analyst would have the need to write a recursive function. Time spent on recursion and on various efficient algorithms for sorting and searching may be better spent, in my view, on extended programming projects, Shiny apps and blogging, and the introduction of programmer’s trade-tools such as version control and GitHub. I hope by the end of the first year to have made time for all of these out-of-book topics.</p>
<p>The Notes give more attention to base R functions than other introductory texts directed to data analysts, but we do introduce elements of the <strong>tidyverse</strong> as appropriate. The pipe operator is introduced in connection with data frames, <strong>ggplot2</strong> and graphing are treated in some detail, string operations and regular expressions are managed primarily with <strong>stringr</strong>, and the approach to higher-order functions is through <strong>purrr</strong>. Full treatment of the data wrangling is deferred, however, to later courses.</p>
<p>The first-semester course is required for mathematics and physics majors and for students in our pre-engineering program, so a central application of the early material is simulation of random processes. I believe that this makes the Notes relevant for students in other disciplines—e.g., biology and finance—in a way that complements their use of R for data analysis.</p>
<p>Two of the most fundamental topics in any comprehensive discussion of the R language—lexical scoping and computing on the language—are absent from this book. Lexical scoping and its implications are mentioned only in a brief footnote. Partly this is due the fact that most of the elementary applications of lexical scoping mentioned in the literature are related to scientific computing, which won’t be a concern for most of my students. Certainly lexical scoping is important for understanding how R-packages work, but elementary students don’t author packages. As for computing on the language it is true that users are affected by it all the time (e.g., whenever they use functions with a formula interface), but generally one need not perform any computation on the language until one begins writing formula-interface functions for the benefit of casual R-users.</p>
<p>On the other hand I have made some effort to explore programming paradigms other than procedural programming, perhaps in a bit more depth than in other elementary texts that teach with a scripting language. There is a chapter on functional programming that, although it admittedly does not get far into the functional paradigm, at least does treat extensively of R’s support for higher-order functions. A chapter on object-oriented programming covers not only the generic-function OO that has been with R from the start but also an implementation of message-passing OO (Winston Chang’s <strong>R6</strong> package <span class="citation">(Chang <a href="#ref-R-R6">2017</a>)</span>). My hope is that these topics will not only sharpen my students’ R-programming skills but also prepare them for encounters with the OO-methods and higher-order functions that are ubiquitous in JavaScript. Finally, there is a pretty serious chapter on regular expressions, because:</p>
<ul>
<li>they are useful in data analysis;</li>
<li>I have not found a treatment of regular expressions in R that a person without significant prior exposure to them in other languages has a prayer of following;</li>
<li>and because if you master regular expressions then you feel like a wizard.</li>
</ul>
<p>As for the numerous Wizard of Oz-themed examples, I can offer no defense other than haste in composition and the fact that the Wizard of Oz is now in the public domain.</p>
</div>
<div id="history-of-r" class="section level2">
<h2><span class="header-section-number">0.2</span> History of R</h2>
<p>The story of R begins at <a href="https://en.wikipedia.org/wiki/Bell_Labs">Bell Labs</a> in 1975, with the development, by John Chambers and several other colleagues, of the S language for statistical computing. The language became well-known among statisticians and data analysts, especially in the academic community.</p>
<p>In the early 1990’s Ross Ihaka of the University of Auckland in New Zealand was making a study of the Scheme language as described in the classic MIT textbook <em>Structure and Interpretation of Computer Programs</em> <span class="citation">(Harold Abelson and Sussman <a href="#ref-AbelsonSussman">1996</a>)</span>, and was impressed with the possibilities of the language for data analysis applications. Desiring to build a free analysis tool for his graduate students, Ihaka recruited his Auckland colleague Robert Gentleman in the project of developing a language with an external syntax similar to S but with an underlying engine based heavily upon Scheme. Because of the similarity with the better-known S—or, by some accounts, because of the initial letter in the first names of both men—they named their new language “R”.</p>
<p>Initially the Ihaka and Gentleman assumed that their work on the new language was scarcely more than “playing games” and that it would not be used outside of the University of Auckland. Eventually, though, the two placed a small announcement of their project on the <em>s-news</em> email list and began to draw the interest of other statisticians, including Martin Machler of the Swiss Federal Institute of Technology in Zurich, Switzerland. Machler saw great potential for R, and in 1995 persuaded Ihaka and Gentleman to release it as “free software” under a <a href="https://www.gnu.org/licenses/gpl-faq.html#WhatDoesGPLStandFor">GNU Public License</a>. The decision to make R free stimulated further interest in the language and encouraged many experts in statistical computation to become involved in its further development.</p>
<p>The first official public release of R (version 1.0.0) occurred on February 29, 2000. Since that time R has grown in popularity at an increasing rate, to the point where it is by now one of the world’s most widely-used domain-specific computer languages, ranking among the top dozen computer languages overall.</p>
<p>Many people have contributed to the development of R. As of the composition of this History, the Comprehensive R Archive Network (CRAN) hosted 10,633 contributed packages, each of which aims to extend the capabilities of R in a specific way. R is usually the platform in which new statistical techniques are first implemented by the researchers who develop them. It is widely used in the sciences, business and finance.</p>
</div>
<div id="acknowledgements" class="section level2">
<h2><span class="header-section-number">0.3</span> Acknowledgements</h2>
<p>I am greatly indebted to:</p>
<p><em>Norman Matloff</em> and <em>Hadley Wickham</em> for their excellent foundational books (<span class="citation">(Matloff <a href="#ref-Matloff2011">2011</a>)</span>, <span class="citation">(Wickham <a href="#ref-Wickham2014">2014</a>)</span>) on the R language. <em>Garrett Grolemund</em>, for his informal but precise expository style, as exemplified in numerous R Studio webinars and in <span class="citation">(Grolemund <a href="#ref-Grolemund2014">2014</a>)</span>.</p>
<p><em>Allen Downey</em>, for <em>Think Python</em> <span class="citation">(Downey <a href="#ref-Downey2015">2015</a>)</span>. This book formed my ideas about ordering and selection of topics for computer science at an elementary level, and helped me think about teaching computer science in a way that was as independent as possible from the specific language of instruction.</p>
<p><em>Everyone</em> at R Studio, including Hadley, <em>Yihui Xie</em> for R Markdown and the family of R Markdown-related packages, <em>Joe Cheng</em> for conceiving and pioneering <strong>shiny</strong>, <em>Winston Chang</em> for <strong>shiny</strong> and <strong>R6</strong>, and of course <em>JJ Allaire</em> for developing the IDE and calling together the remarkable constellation of developers and evangelists who have contributed so much to the R community and ecosystem.</p>
<p><em>Danny Kaplan</em>, <em>Nick Horton</em> and <em>Randall Pruim</em> for pioneering the Mosaic Project that has enabled so many faculty to teach undergraduate statistics with R. I am especially indebted to Danny for curricular inspiration and to Randall for R-programming advice in the incipient stages of my journey as an R-developer. Nick has been a great encourager of everyone associated with the Mosaic community.</p>
<p>My former colleague <em>Rebekah Robinson</em> who, upon learning of Mosaic and R Markdown, insisted that at Georgetown College we take up the challenge of teaching elementary statistics with R.</p>
<p>My colleagues <em>William Harris</em> and <em>Christine Leverenz</em>, who patiently learned to teach in the R way.</p>
<p>My students, especially <em>Woody Burchett</em>, <em>Luke Garnett</em>, <em>Shawn Marcom</em>, <em>Jacob Townsend</em> and <em>Andrew Giles</em>, for work with me on various R-related research projects. Luke has gone on to become a valued colleague at Georgetown.</p>
<p><em>Georgetown College</em>, for granting me the sabbatical time in Spring 2017 to work on these Notes, and on other programming topics prerequisite to teaching Computer Science.</p>
<p>My wife <em>Mary Lou</em> and daughters <em>Clare</em>, <em>Catherine</em> and <em>Agnes</em>, for patience and support. By now they have heard quite enough about programming.</p>
</div>
<div id="miscellaneous-information" class="section level2">
<h2><span class="header-section-number">0.4</span> Miscellaneous Information</h2>
<div id="r-packages" class="section level3">
<h3><span class="header-section-number">0.4.1</span> R Packages</h3>
<p>This book uses the following contributed R packages that are currently available from CRAN, the Comprehensive R Archive Network:</p>
<ul>
<li><strong>devtools</strong></li>
<li><strong>ggplot2</strong></li>
<li><strong>mosaicData</strong></li>
<li><strong>R6</strong></li>
<li><strong>tidyverse</strong></li>
</ul>
<p>If you are working on the Georgetown College R Studio Server then they are already installed for you. If you have your own installation then you can get them via the <code>install.packages()</code> function, e.g.,</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)</a></code></pre></div>
<p>In addition we use two packages from the author’s Github repositories:</p>
<ul>
<li><strong>bcscr</strong> (functions and data sets to accompany the text)</li>
<li><strong>tigerData</strong> (data sets used in examples and exercises)</li>
</ul>
<p>If you aren’t working on the R Studio Server at Georgetown College then you may have to install them yourself, as follows:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;homerhanumat/bcscr&quot;</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;homerhanumat/tigerData&quot;</span>)</a></code></pre></div>
</div>
<div id="typographical-conventions" class="section level3">
<h3><span class="header-section-number">0.4.2</span> Typographical Conventions</h3>
<p>Computer code, whether within a line of text or as displayed text, appears like this: <code>code snippet</code>.</p>
<p>Identifiers and are represented as is (e.g., <code>variableName</code>, <code>if</code>, <code>else</code>, <code>while</code>, etc.) except for the names of functions, which are followed by a pair of parentheses in order to stress their status as functions. Thus we write <code>length()</code> for the <code>length</code>-function.</p>
<p>Displayed text representing output to the console appears with double hash-tags at the beginning of each line, thus:</p>
<pre><code>## R is free software and comes with ABSOLUTELY NO WARRANTY.
## You are welcome to redistribute it under certain conditions.
## Type &#39;license()&#39; or &#39;licence()&#39; for distribution details.</code></pre>
<p>The hash-tags themselves are not present in the output itself.</p>
<p>Names of R-package are in boldface, thus: package <strong>devtools</strong>.</p>
<p>Terms are italicized when they are first introduced, e.g.: “R follows a set of internal rules to <em>coerce</em> some of the values to a new type in such a way that all resulting values are of the same type.” Italicization can also indicate emphasis.</p>
</div>
<div id="license" class="section level3">
<h3><span class="header-section-number">0.4.3</span> License</h3>
<p>These Notes are licensed under the Creative Commons Attribution-ShareAlike 4.0 International Public License:</p>
<blockquote>
<p><a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode" class="uri">https://creativecommons.org/licenses/by-sa/4.0/legalcode</a>.</p>
</blockquote>
<!--chapter:end:index.Rmd-->
</div>
</div>
</div>
<div id="part-csc-115" class="section level1 unnumbered">
<h1>(PART) CSC 115</h1>
</div>
<div id="idea" class="section level1">
<h1><span class="header-section-number">1</span> Our First Computer Programs</h1>
<div class="figure" style="text-align: center">
<img src="images/yellow_brick_road.png" alt="The Yellow Brick Road, by Jorge Cruz.  [clipartfest.com](https://clipartfest.com/)." width="70%" />
<p class="caption">
(#fig:beginning-journey)The Yellow Brick Road, by Jorge Cruz. <a href="https://clipartfest.com/">clipartfest.com</a>.
</p>
</div>

<div id="hello-world" class="section level2">
<h2><span class="header-section-number">1.1</span> Hello, World!</h2>
<p>Let’s write our very first computer program.  Type the following code into the console and press <strong>Enter</strong>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">cat</span>(<span class="st">&quot;Hello, World!&quot;</span>)</a></code></pre></div>
<p>In the console you should see the following output:</p>
<pre><code>## Hello, World!</code></pre>
<p>That’s it—you just wrote a <em>computer program</em>. A computer program is simply a sequence of instructions that perform a specific task when they are <em>executed</em> (carried out) by the computer. In the above example, there was only one instruction in the sequence: it was the command to reproduce the <em>string</em>  “Hello, World” in the console exactly as it is. The name of that command is <code>cat()</code>.</p>
<p>Let’s try another small program.</p>
<p>Type the following code into the console and press <strong>Enter</strong>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">cat</span>(<span class="dv">2</span><span class="op">+</span><span class="dv">2</span>)</a></code></pre></div>
<p>In the console you should see the following output:</p>
<pre><code>## 4</code></pre>
<p>We have been using the <code>cat()</code> function so far. Actually you can get output without it. For example, suppose you type:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="st">&quot;Hello, World!&quot;</span></a></code></pre></div>
<p>Then in the console you see:</p>
<pre><code>## [1] &quot;Hello World&quot;</code></pre>
<p>There are quote-marks around the text: that’s not so pretty, but we still get the basic output.</p>
<p>Similarly, you can try:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span></a></code></pre></div>
<pre><code>## [1] 4</code></pre>
<p>Notice that when we don’t use <code>cat()</code> the output begins with a strange <code>[1]</code>. In the next chapter we’ll learn why this happens; for now, just ignore it.</p>
</div>
<div id="idea-tour" class="section level2">
<h2><span class="header-section-number">1.2</span> A Quick Tour</h2>
<p>We now embark on a tour of some of R’s basic capabilities. In later chapters we will examine in detail the programming concepts that underlie the features we explore now.</p>
<div id="idea-arithmetic" class="section level3">
<h3><span class="header-section-number">1.2.1</span> Basic Arithmetic</h3>
<p>R can be treated like a calculator. You can:</p>
<ul>
<li>add numbers (<code>+</code>)</li>
<li>subtract numbers (<code>-</code>)</li>
<li>multiply numbers (<code>*</code>)</li>
<li>divide numbers (<code>/</code>)</li>
<li>raise a number to a power (<code>^</code>)</li>
</ul>
<p>Just as on a graphing calculator, parentheses can be used to clarify the order of operations.</p>
<p>Here are some examples:</p>
<p>To get <span class="math inline">\(\frac{27-3}{10}\)</span>, use:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">(<span class="dv">27-3</span>)<span class="op">/</span><span class="dv">10</span></a></code></pre></div>
<pre><code>## [1] 2.4</code></pre>
<p>To get <span class="math inline">\(3^2 + 4^2\)</span> try:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="dv">3</span><span class="op">^</span><span class="dv">2</span><span class="op">+</span><span class="dv">4</span><span class="op">^</span><span class="dv">2</span></a></code></pre></div>
<pre><code>## [1] 25</code></pre>
<p>Sometimes you’ll want to take roots. As with a calculator, you can accomplish this by raising your number to a fractional power. So if you want <span class="math inline">\(\sqrt[3]{64}\)</span> then you could try:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="dv">64</span><span class="op">^</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>)</a></code></pre></div>
<pre><code>## [1] 4</code></pre>
<p>If you would like square roots then you can either raise your number to the <span class="math inline">\(1/2\)</span>-power or you could use R’s special square-root function:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">sqrt</span>(<span class="dv">64</span>)</a></code></pre></div>
<pre><code>## [1] 8</code></pre>
<p>One way or another, you can evaluate quite complex mathematical expressions. For example, to get <span class="math inline">\(\sqrt{3^2 + 4^2}\)</span> simply type:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">sqrt</span>(<span class="dv">3</span><span class="op">^</span><span class="dv">2</span><span class="op">+</span><span class="dv">4</span><span class="op">^</span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] 5</code></pre>
</div>
<div id="read-evaluate-print-loop" class="section level3">
<h3><span class="header-section-number">1.2.2</span> Read-Evaluate-Print-Loop</h3>
<p>So far you have been using R in what computer scientists call <em>interactive mode</em>. This means that you type something in at the console; R immedidately reads what you type and evaluates it, and prints the resulting value to the console for you to see. Then you type something else, and so on. This back-and-forth process is often called the <em>Read-Evaluate-Print-Loop</em>, or REPL  for short. R is one of several computer languages that make it easy for you to see the results of its computations in the console. That’s because it was originally designed for use by statisticians and data analysts, who often want to run a small procedure, check on the results and then try a new or related procedure and check on the results … until their analysis is complete. From our point of view as beginning programmers, though, the REPL makes it easy to see what R is doing and to get immediate feedback on the very simple programs that we are now writing.</p>
</div>
<div id="idea-variables" class="section level3">
<h3><span class="header-section-number">1.2.3</span> Variables</h3>
<p>Quite often you will want to use the same value several different times. You can so this by creating a <em>variable</em>  with the <em>assignment operator</em> <code>&lt;-</code>. </p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">a &lt;-<span class="st"> </span><span class="dv">10</span></a></code></pre></div>
<p>The previous statement puts the value 10 in the computer’s memory and causes the name <code>a</code> to be <em>bound</em> to it. This means that if you ask R to show you <code>a</code>, you’ll get that value:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">a</a></code></pre></div>
<pre><code>## [1] 10</code></pre>
<p>Now you can use <code>a</code> as much as you like. Whenever you use it, R will know that it stands for the value 10:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">a <span class="op">+</span><span class="st"> </span><span class="dv">23</span></a></code></pre></div>
<pre><code>## [1] 33</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw">sqrt</span>(a)</a></code></pre></div>
<pre><code>## [1] 3.162278</code></pre>
<p>Later on if you want to bind the name <code>a</code> to a different value, you can do so, with another assignment-statement:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1">a &lt;-<span class="st"> </span><span class="dv">4</span></a>
<a class="sourceLine" id="cb29-2" data-line-number="2">a <span class="op">+</span><span class="st"> </span><span class="dv">23</span></a></code></pre></div>
<pre><code>## [1] 27</code></pre>
<p>Let’s write some code to introduce creatures of various types. A creature should give his or her name, say what type of creature he or she is, and name a favorite food.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1">creatureType &lt;-<span class="st">&quot;Munchkin&quot;</span></a>
<a class="sourceLine" id="cb31-2" data-line-number="2">creatureName &lt;-<span class="st"> &quot;Boq&quot;</span></a>
<a class="sourceLine" id="cb31-3" data-line-number="3">creatureFood &lt;-<span class="st"> &quot;corn&quot;</span></a></code></pre></div>
<p>Notice that I chose variable-names that are descriptive of the values to which they are bound. That’s often a good practice.</p>
<p>Next, let’s combine our items into a greeting:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw">paste</span>(<span class="st">&quot;Hello, I am a &quot;</span>,</a>
<a class="sourceLine" id="cb32-2" data-line-number="2">      creatureType,</a>
<a class="sourceLine" id="cb32-3" data-line-number="3">      <span class="st">&quot;. My name is &quot;</span>,</a>
<a class="sourceLine" id="cb32-4" data-line-number="4">      creatureName,</a>
<a class="sourceLine" id="cb32-5" data-line-number="5">      <span class="st">&quot;.  I like to eat &quot;</span>,</a>
<a class="sourceLine" id="cb32-6" data-line-number="6">      creatureFood,</a>
<a class="sourceLine" id="cb32-7" data-line-number="7">      <span class="st">&quot;.&quot;</span>,</a>
<a class="sourceLine" id="cb32-8" data-line-number="8">      <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Hello, I am a Munchkin. My name is Boq.  I like to eat corn.&quot;</code></pre>
<p>We see that <code>paste()</code> function puts strings together. The <code>sep = &quot;&quot;</code> argument at the end specifies that no space is to be inserted between the strings when they combined.</p>
<p>Another thing we notice in the previous code is that R can ignore white space: we were able to place the parts of the command on different lines. This helps prevent our lines from being too long, and allows us to arrange the code so that it’s easy to read.</p>
<p>Spaces do matter inside a string, though:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">kalidah &lt;-<span class="st"> &quot;Teddy&quot;</span></a>
<a class="sourceLine" id="cb34-2" data-line-number="2">kalidah</a></code></pre></div>
<pre><code>## [1] &quot;Teddy&quot;</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">kalidah2 &lt;-<span class="st"> &quot;Ted  dy&quot;</span></a>
<a class="sourceLine" id="cb36-2" data-line-number="2">kalidah2</a></code></pre></div>
<pre><code>## [1] &quot;Ted  dy&quot;</code></pre>
<p>You must also be careful not to insert spaces within the name of any object:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">kali dah2</a></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">## Error: unexpected symbol in &quot;kali dah2&quot;</a></code></pre></div>
<p>R got confused by the unexpected space: it knows about the name <code>kalidah2</code>, but <code>kali dah2</code> means nothing to R.</p>
<p>Getting back to the Oz-creatures: it would be nice if a creatures’s greeting could be split over several lines. This is possible if you use the special string “\n”, which produces a newline. Just incorporate it into your message, as follows:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1"><span class="kw">paste</span>(<span class="st">&quot;Hello, I am a &quot;</span>,</a>
<a class="sourceLine" id="cb40-2" data-line-number="2">      creatureType,</a>
<a class="sourceLine" id="cb40-3" data-line-number="3">      <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">My name is &quot;</span>,</a>
<a class="sourceLine" id="cb40-4" data-line-number="4">      creatureName,</a>
<a class="sourceLine" id="cb40-5" data-line-number="5">      <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">I like to eat &quot;</span>,</a>
<a class="sourceLine" id="cb40-6" data-line-number="6">      creatureFood,</a>
<a class="sourceLine" id="cb40-7" data-line-number="7">      <span class="st">&quot;.&quot;</span>,</a>
<a class="sourceLine" id="cb40-8" data-line-number="8">      <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Hello, I am a Munchkin.\nMy name is Boq.\nI like to eat corn.&quot;</code></pre>
<p>That doesn’t look like an improvement at all! But what if we were to <code>cat()</code> it?</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1">message &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;Hello, I am a &quot;</span>,</a>
<a class="sourceLine" id="cb42-2" data-line-number="2">                 creatureType,</a>
<a class="sourceLine" id="cb42-3" data-line-number="3">                 <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">My name is &quot;</span>,</a>
<a class="sourceLine" id="cb42-4" data-line-number="4">                 creatureName,</a>
<a class="sourceLine" id="cb42-5" data-line-number="5">                 <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">I like to eat &quot;</span>,</a>
<a class="sourceLine" id="cb42-6" data-line-number="6">                 creatureFood,</a>
<a class="sourceLine" id="cb42-7" data-line-number="7">                 <span class="st">&quot;.&quot;</span>,</a>
<a class="sourceLine" id="cb42-8" data-line-number="8">                 <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb42-9" data-line-number="9"><span class="kw">cat</span>(message)</a></code></pre></div>
<pre><code>## Hello, I am a Munchkin.
## My name is Boq.
## I like to eat corn.</code></pre>
<p>That’s much nicer.</p>
<p>That last example showed that you can use variables together with functions to create new variables. Here is another example:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1">a &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb44-2" data-line-number="2">b &lt;-<span class="st"> </span><span class="dv">27</span></a>
<a class="sourceLine" id="cb44-3" data-line-number="3">mySum &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span>b</a>
<a class="sourceLine" id="cb44-4" data-line-number="4">mySum</a></code></pre></div>
<pre><code>## [1] 37</code></pre>
</div>
<div id="idea-functions" class="section level3">
<h3><span class="header-section-number">1.2.4</span> Functions</h3>
<p>Let’s say that we want to introduce George the Quadling. We might try:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1">creatureName &lt;-<span class="st"> &quot;George&quot;</span></a>
<a class="sourceLine" id="cb46-2" data-line-number="2">creatureType &lt;-<span class="st"> &quot;Quadling&quot;</span></a>
<a class="sourceLine" id="cb46-3" data-line-number="3">creatureFood &lt;-<span class="st"> &quot;cookies&quot;</span></a>
<a class="sourceLine" id="cb46-4" data-line-number="4"><span class="kw">cat</span>(message)</a></code></pre></div>
<pre><code>## Hello, I am a Munchkin.
## My name is Boq.
## I like to eat corn.</code></pre>
<p>Hmm, that didn’t go so well: we got Boq instead. The problem is that the variable<code>message</code> was created using the original values of <code>creatureName</code>, <code>creatureType</code> and <code>creatureFood</code>, not the new values that we are interested in. To do it right we should have re-made <code>message</code>, as follows:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1">creatureName &lt;-<span class="st"> &quot;George&quot;</span></a>
<a class="sourceLine" id="cb48-2" data-line-number="2">creatureType &lt;-<span class="st"> &quot;Quadling&quot;</span></a>
<a class="sourceLine" id="cb48-3" data-line-number="3">creatureFood &lt;-<span class="st"> &quot;cookies&quot;</span></a>
<a class="sourceLine" id="cb48-4" data-line-number="4">message &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;Hello, I am a &quot;</span>,</a>
<a class="sourceLine" id="cb48-5" data-line-number="5">                 creatureType,</a>
<a class="sourceLine" id="cb48-6" data-line-number="6">                 <span class="st">&quot;.  </span><span class="ch">\n</span><span class="st">My name is &quot;</span>,</a>
<a class="sourceLine" id="cb48-7" data-line-number="7">                 creatureName,</a>
<a class="sourceLine" id="cb48-8" data-line-number="8">                 <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">I like to eat &quot;</span>,</a>
<a class="sourceLine" id="cb48-9" data-line-number="9">                 creatureFood,</a>
<a class="sourceLine" id="cb48-10" data-line-number="10">                 <span class="st">&quot;.&quot;</span>,</a>
<a class="sourceLine" id="cb48-11" data-line-number="11">                 <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb48-12" data-line-number="12"><span class="kw">cat</span>(message)</a></code></pre></div>
<pre><code>## Hello, I am a Quadling.  
## My name is George.
## I like to eat cookies.</code></pre>
<p>That’s great, but it seems that every time we introduce a new creature we have to type a lot of code. It would be much better if we could find a way to re-use code, rather than repeating it.</p>
<p><em>Functions</em> allow us to re-use code. Let’s define a function to do introductions:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1">intro &lt;-<span class="st"> </span><span class="cf">function</span>(name, type, food) {</a>
<a class="sourceLine" id="cb50-2" data-line-number="2">  message &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;Hello, I am a &quot;</span>,</a>
<a class="sourceLine" id="cb50-3" data-line-number="3">                 type,</a>
<a class="sourceLine" id="cb50-4" data-line-number="4">                 <span class="st">&quot;.  </span><span class="ch">\n</span><span class="st">My name is &quot;</span>,</a>
<a class="sourceLine" id="cb50-5" data-line-number="5">                 name,</a>
<a class="sourceLine" id="cb50-6" data-line-number="6">                 <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">I like to eat &quot;</span>,</a>
<a class="sourceLine" id="cb50-7" data-line-number="7">                 food,</a>
<a class="sourceLine" id="cb50-8" data-line-number="8">                 <span class="st">&quot;.&quot;</span>,</a>
<a class="sourceLine" id="cb50-9" data-line-number="9">                 <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)</a>
<a class="sourceLine" id="cb50-10" data-line-number="10">  <span class="kw">cat</span>(message)</a>
<a class="sourceLine" id="cb50-11" data-line-number="11">}</a></code></pre></div>
<p>In the console nothing happens. We only created the function <code>intro()</code>, we haven’t <em>called</em> it yet. Let’s call <code>intro</code>:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1"><span class="kw">intro</span>(<span class="dt">name =</span> <span class="st">&quot;Frederick&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;Winkie&quot;</span>, <span class="dt">food =</span> <span class="st">&quot;macaroni&quot;</span>)</a></code></pre></div>
<pre><code>## Hello, I am a Winkie.  
## My name is Frederick.
## I like to eat macaroni.</code></pre>
<p>R allows you to be lazy: you can omit the <em>parameters</em> <code>name</code>, <code>type</code> and <code>food</code>, so long as you indicate what their values should be, in the correct order:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1"><span class="kw">intro</span>(<span class="st">&quot;Frederick&quot;</span>, <span class="st">&quot;Winkie&quot;</span>, <span class="st">&quot;macaroni&quot;</span>)</a></code></pre></div>
<pre><code>## Hello, I am a Winkie.  
## My name is Frederick.
## I like to eat macaroni.</code></pre>
</div>
<div id="idea-data" class="section level3">
<h3><span class="header-section-number">1.2.5</span> Data and Graphics</h3>
<p>Anyone can use R, but it was created for statisticians, so it has many features that are helpful in data analysis. Let’s take a quick look at a data set from a <em>contributed R package</em>, the package <strong>mosaicData</strong> <span class="citation">(Pruim, Kaplan, and Horton <a href="#ref-R-mosaicData">2018</a>)</span>.</p>
<p>First, we’ll <em>attach</em> the package,  so R can find all of the goodies it contains:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1"><span class="kw">library</span>(mosaicData)</a></code></pre></div>
<p>Package <strong>mosaicData</strong> contains a number of interesting datasets that are useful in the teaching of statistics. Let’s look into one of them—<code>Births78</code>—using R’s <code>help()</code> function:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1"><span class="kw">help</span>(<span class="st">&quot;Births78&quot;</span>)</a></code></pre></div>
<p>We learn that <code>Births78</code> is a <em>data frame</em> containing information on the number of births each day, during the year 1978. (A data frame is one of R’s most important <em>data structures</em>. We’ll learn more about them in Chapter @ref(frames).) The frame has 365 rows, one for each day in the year, and four columns. Each column contains the values of a variable recorded for each day:</p>
<ul>
<li>the calendar <code>date</code> of that day;</li>
<li><code>births</code>: the number of children born in the United States on that day;</li>
<li><code>dayofyear</code>: the number of the day within the year 1978 (1 being January 1, 2 being January 2, and so on);</li>
<li><code>wday</code>: the day of week for that day (Sunday, Monday, etc.).</li>
</ul>
<p>We can view the first few row of the data frame using R’s <code>head()</code> function:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1"><span class="kw">head</span>(Births78, <span class="dt">n =</span> <span class="dv">10</span>)</a></code></pre></div>
<pre><code>##          date births wday year month day_of_year day_of_month day_of_week
## 1  1978-01-01   7701  Sun 1978     1           1            1           1
## 2  1978-01-02   7527  Mon 1978     1           2            2           2
## 3  1978-01-03   8825  Tue 1978     1           3            3           3
## 4  1978-01-04   8859  Wed 1978     1           4            4           4
## 5  1978-01-05   9043  Thu 1978     1           5            5           5
## 6  1978-01-06   9208  Fri 1978     1           6            6           6
## 7  1978-01-07   8084  Sat 1978     1           7            7           7
## 8  1978-01-08   7611  Sun 1978     1           8            8           1
## 9  1978-01-09   9172  Mon 1978     1           9            9           2
## 10 1978-01-10   9089  Tue 1978     1          10           10           3</code></pre>
<p>We might wonder whether the number of births varies with the time of year. One way to investigate this question is to make a <em>scatterplot</em>, where the days of the year (numbered 1 through 365) are on the horizontal axis and the number of births for each day are on the vertical axis. Figure @ref(fig:birthsplot) shows such a plot.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/birthsplot-1.png" alt="A simple scatterplot with R's ggplot2 graphics system." width="60%" />
<p class="caption">
(#fig:birthsplot)A simple scatterplot with R’s ggplot2 graphics system.
</p>
</div>
<p>Clearly the number of births varies seasonally: more babies are born in late summer and early fall, whereas spring births are not as frequent. But there is something mysterious about the plot: Why do there are appear to be two clearly separated groups of days, one with considerably more births than the other? What is going on here? As we learn to program in R, we will gradually acquire the skills needed to answer this and many other intriguing questions.</p>
</div>
</div>
<div id="idea-debugging" class="section level2">
<h2><span class="header-section-number">1.3</span> Debugging</h2>
<p>It’s easy to make mistakes when you program—even when you are very experienced! Incorrect computer code is said to have a <em>bug</em>, and the art of finding bugs and correcting them is called <em>debugging</em>. </p>
<p>Consider the following code:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1">scarecrowQuote &lt;-<span class="st"> &quot;It is such an uncomfortable feeling to know one is a fool.&quot;</span></a>
<a class="sourceLine" id="cb59-2" data-line-number="2"><span class="kw">paste</span>(<span class="st">&quot;The Scarecrow says: &quot;</span>, scarecrowquote)</a></code></pre></div>
<p>When we run it we get the following error message in the console:</p>
<pre><code>## Error in paste(&quot;The Scarecrow says: &quot;, scarecrowquote) : 
##  object &#39;scarecrowquote&#39; not found</code></pre>
<p>R’s error messages are often quite mysterious—they are intended to be maximally useful to experienced R programmers—but it’s always a good idea to read them anyway. In this case the message clearly tells us the problem: R cannot find the object <code>scarecrowquote</code> on its search path. This prompt us to look more closely at the name <code>scarecrow</code>, and sooner or later we will realize that we have a misspelling: the variable that was actually defined was <code>scarecrowQuote</code>, with a capital Q.</p>
<p>The correct code is:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" data-line-number="1">scarecrowQuote &lt;-<span class="st"> &quot;It is such an uncomfortable feeling to know one is a fool.&quot;</span></a>
<a class="sourceLine" id="cb61-2" data-line-number="2"><span class="kw">paste</span>(<span class="st">&quot;The Scarecrow says: &quot;</span>, scarecrowQuote)</a></code></pre></div>
<pre><code>## [1] &quot;The Scarecrow says:  It is such an uncomfortable feeling to know one is a fool.&quot;</code></pre>

<div class="rmdimportant">
Always bear in mind that R is case-sensitive!
</div>

<p>Here’s another buggy bit of code:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" data-line-number="1">SermonMountComment &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;Oh, it&#39;s &quot;</span>blessed are the meek.<span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb63-2" data-line-number="2">                     <span class="st">&quot;</span><span class="ch">\n</span><span class="st">I&#39;m glad they are getting something:</span><span class="ch">\n</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb63-3" data-line-number="3">                     <span class="st">&quot;they have a hell of a time.&quot;</span>)</a>
<a class="sourceLine" id="cb63-4" data-line-number="4"><span class="kw">cat</span>(SermonMountComment)</a></code></pre></div>
<p>The idea is to produce:</p>
<pre><code>## Oh, it&#39;s &quot;blessed are the meek.
## I&#39;m glad they are getting something:
##  they have a hell of a time.</code></pre>
<p>But when we run the code we get the following result instead:</p>
<pre><code>&gt; rm(SermonMountComment)
&gt; SermonMountComment &lt;- paste(&quot;Oh, it&#39;s &quot;blessed are the meek.&quot;&quot;,
Error: unexpected symbol in &quot;SermonMountComment &lt;- paste(&quot;Oh, it&#39;s &quot;blessed&quot;
&gt;                             &quot;\nI&#39;m glad they are getting something: &quot;,
Error: unexpected &#39;,&#39; in &quot;                            &quot;\nI&#39;m glad they are getting something: &quot;,&quot;
&gt;                             &quot;they have a hell of a time.&quot;)
Error: unexpected &#39;)&#39; in &quot;                            &quot;they have a hell of a time.&quot;)&quot;
&gt; cat(SermonMountComment)
Error in cat(SermonMountComment) : object &#39;SermonMountComment&#39; not found</code></pre>
<p>This can be a bit more difficult to read. The problems appear to start near the beginning of the construction of the string <code>SermonMountComment</code>.</p>
<p>After looking at it a while we focus on the first string argument to the <code>paste()</code> function:</p>
<blockquote>
<p><code>&quot;Oh, it's &quot;blessed are the meek.&quot;&quot;</code></p>
</blockquote>
<p>We see that this string has quotes within quotes. Now R uses quotes as <em>delimiters</em>  for strings: that is, quote-marks indicate where a string begins and where it ends. Hence from R’s point of view, the first string consists of just: <code>&quot;Oh, it's &quot;</code>. But then there is no comma to separate this string from the next string argument that the <code>paste()</code> functions expects. Instead R sees the <code>b</code> in <code>blessed</code>; that’s an <em>unexpected symbol</em>. Things go downhill from there.</p>
<p>There are a couple of ways to correct the problem. One approach is to use single quotes inside any string that is delimited with double quotes, thus:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1">SermonMountComment &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;Oh, it&#39;s &#39;blessed are the meek.&#39;&quot;</span>,</a>
<a class="sourceLine" id="cb66-2" data-line-number="2">                     <span class="st">&quot;</span><span class="ch">\n</span><span class="st">I&#39;m glad they are getting something:</span><span class="ch">\n</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb66-3" data-line-number="3">                     <span class="st">&quot;they have a hell of a time.&quot;</span>)</a>
<a class="sourceLine" id="cb66-4" data-line-number="4"><span class="kw">cat</span>(SermonMountComment)</a></code></pre></div>
<pre><code>## Oh, it&#39;s &#39;blessed are the meek.&#39; 
## I&#39;m glad they are getting something:
##  they have a hell of a time.</code></pre>
<p>On the other hand if you really want those double-quotes inside the string, you can <em>escape</em> their special meaning as string-delimiter by prepending a backslash (<code>\</code>) to them, thus:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" data-line-number="1">SermonMountComment &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;Oh, it&#39;s </span><span class="ch">\&quot;</span><span class="st">blessed are the meek.</span><span class="ch">\&quot;</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb68-2" data-line-number="2">                     <span class="st">&quot;</span><span class="ch">\n</span><span class="st">I&#39;m glad they are getting something:</span><span class="ch">\n</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb68-3" data-line-number="3">                     <span class="st">&quot;they have a hell of a time.&quot;</span>)</a>
<a class="sourceLine" id="cb68-4" data-line-number="4"><span class="kw">cat</span>(SermonMountComment)</a></code></pre></div>
<pre><code>## Oh, it&#39;s &quot;blessed are the meek.&quot; 
## I&#39;m glad they are getting something:
##  they have a hell of a time.</code></pre>
<p>There are a number of special characters that are formed by “escaping” the usual meaning of some other character. Some common examples are:</p>
<ul>
<li><code>\n</code>: produces a newline instead of <code>n</code></li>
<li><code>\t</code>: produces a tab-space instead of <code>t</code></li>
<li><code>\&quot;</code>: produces an actual quote-mark, instead of beginning or ending a string.</li>
</ul>
<p>Strings are a tricky topic in any computer programming language: in fact we will devote all of Chapter @ref(strings) to them.</p>

</div>
<div id="idea-glossary" class="section level2 unnumbered">
<h2>Glossary</h2>
<dl>
<dt>Computer Program </dt>
<dd><p>A sequence of instructions that performs a specific task when executed by a computer.</p>
</dd>
<dt>String</dt>
<dd><p>A value in a computer program that constitutes text (as opposed to numbers of some other type of data).</p>
</dd>
<dt>Interactive Mode </dt>
<dd><p>A type of engagement between a human and a computer in which the computer prompts the humand for data and/or commands and may respond with output that the human can read and/or interpret.</p>
</dd>
<dt>Read-Evaluate-Print Loop </dt>
<dd><p>An interactive cycle in which the R-interpreter reads an expression from the console, evaluates it, and prints out the value to the console.</p>
</dd>
<dt>Data Structure </dt>
<dd><p>A particular way of organizing information in an computer program so that it can be used efficiently.</p>
</dd>
<dt>Delimiter</dt>
<dd><p>A character in a programing languages that is used to mark the beginning and/or end of a value.</p>
</dd>
</dl>

</div>
<div id="idea-exercises" class="section level2 unnumbered">
<h2>Exercises</h2>
<p><img src="images/thinking.png" width="50%" style="display: block; margin: auto;" /></p>
<ol style="list-style-type: decimal">
<li><p>Write a program that modifies the function <code>intro()</code> (see Section @ref(idea-functions)) so that the person who introduces him or herself states a favorite sport. For example, the result of the following function call:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" data-line-number="1"><span class="kw">intro</span>(<span class="dt">name =</span> <span class="st">&quot;Bettina&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;human&quot;</span>, <span class="dt">sport =</span> <span class="st">&quot;lacrosse&quot;</span>)</a></code></pre></div>
<p>should be:</p>
<pre><code>## Hello, I am a human.  
## My name is Bettina.
## My favorite sport is lacrosse.</code></pre></li>
<li><p>Write a program that modifies the function <code>intro()</code> (see Section @ref(idea-functions)) so that the person who introduces him or herself says what planet he or she is from. For example, the result of the following function call:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1"> <span class="kw">intro</span>(<span class="dt">name =</span> <span class="st">&quot;Zarg&quot;</span>, <span class="dt">planet =</span> <span class="st">&quot;Jupiter&quot;</span>, <span class="dt">food =</span> <span class="st">&quot;rubber bands&quot;</span>)</a></code></pre></div>
<p>should be:</p>
<pre><code>## Hello, my name is Zarg!
## My home planet is Jupiter.
## I like to eat rubber bands.</code></pre></li>
<li><p>Write a program to produce the following output to the console:</p>
<pre><code>## *
## **
## ***
## **
## *</code></pre></li>
<li><p>Write a program to produce the following output to the console:</p>
<pre><code>## meow!
## hiss!  hiss!
## meow!
## hiss! hiss! hiss!
## meow</code></pre></li>
<li><p>Suppose we want to <code>cat</code> “Hello, World” to the console, and we enter:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" data-line-number="1"><span class="kw">cat</span>(Hello, World<span class="op">!</span>)</a></code></pre></div>
<p>What does R say? What did we do wrong?</p></li>
<li><p>Suppose we want to <code>cat</code> “Hello, World” to the console, and we enter:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" data-line-number="1">cat[<span class="st">&quot;Hello, World!&quot;</span>]</a></code></pre></div>
<p>What does R say? What did we do wrong?</p></li>
</ol>
<!--chapter:end:010-idea.Rmd-->
</div>
</div>
<div id="vectors" class="section level1">
<h1><span class="header-section-number">2</span> Vectors</h1>
<div class="figure" style="text-align: center">
<img src="images/yarn.png" alt="`rep(yarn, times = 4)`." width="24%" /><img src="images/yarn.png" alt="`rep(yarn, times = 4)`." width="24%" /><img src="images/yarn.png" alt="`rep(yarn, times = 4)`." width="24%" /><img src="images/yarn.png" alt="`rep(yarn, times = 4)`." width="24%" />
<p class="caption">
(#fig:vector-of-strings)<code>rep(yarn, times = 4)</code>.
</p>
</div>
<p>This Chapter gets you started officially with R. While the theme is <em>vectors</em>, the most important data structure in R, we’ll learn also about variables and variable names, vector types, reserved words, assignment and many of R’s basic operators.</p>

<div id="what-is-a-vector" class="section level2">
<h2><span class="header-section-number">2.1</span> What is a Vector?</h2>
<p>If you have heard of vectors before in mathematics, you might think of a vector as something that has a magnitude and a direction, and that can be represented by a sequence of numbers. In its notion of a vector, R keeps the idea of a sequence but discards magnitude and direction. The notion of “numbers” isn’t even necessary.</p>
<p>For R, a vector is simply a sequence of elements. There are two general sort of vectors:</p>
<ul>
<li><em>atomic</em> vectors that come in one of six forms called <em>vector types</em>;</li>
<li>non-atomic vectors, called <em>lists</em>, whose elements can be any sort of R-object at all.</li>
</ul>
<p>For now we’ll just study atomic vectors. Let’s make a few vectors, as examples.</p>
<p>We can make a vector of numbers using the <code>c()</code> function:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" data-line-number="1">numVec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">23.2</span>, <span class="dv">45</span>, <span class="dv">631</span>, <span class="dv">-273</span>, <span class="dv">0</span>, <span class="fl">48.371</span>, <span class="dv">100000</span>,</a>
<a class="sourceLine" id="cb78-2" data-line-number="2">            <span class="dv">85</span>, <span class="dv">92</span>, <span class="dv">-236</span>, <span class="dv">8546</span>, <span class="dv">98774</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb78-3" data-line-number="3">numVec</a></code></pre></div>
<pre><code>##  [1]     23.200     45.000    631.000   -273.000      0.000     48.371
##  [7] 100000.000     85.000     92.000   -236.000   8546.000  98774.000
## [13]      0.000      0.000      1.000      3.000</code></pre>
<p>You can think of <code>c</code> as standing for “combine.” <code>c()</code> takes its arguments, all of which are separated by commas, and combines them to make a vector.</p>
<p>If you closely examine the above output, you’ll notice that R printed out all of the numerical values in the vector to three decimal places, which happened to be the largest number of decimal places we assigned to any of the numbers that made up <code>numVec</code>. You’ll also notice the numbers in brackets at the beginning of the lines. Each number represents the position within the vector occupied by the first element of the vector that is printed on the line. The position of an element in a vector is called its <em>index</em>. Reporting the indices of leading elements helps you locate particular elements in the output.</p>
<div id="types-of-atomic-vectors" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Types of Atomic Vectors</h3>
<p>The numbers in <code>numVec</code> are what programmers call <em>double-precision</em> numbers. You can verify this for yourself with the <code>typeof()</code> function:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" data-line-number="1"><span class="kw">typeof</span>(numVec)</a></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<p>The <code>typeof()</code> function returns the type of any object in R. As far as vectors are concerned, there are six possible types, of which we will deal with only four:</p>
<ul>
<li><code>double</code></li>
<li><code>integer</code></li>
<li><code>character</code></li>
<li><code>logical</code></li>
</ul>
<p>Let’s look at examples of the other types. Here is a vector of type <code>integer</code>:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" data-line-number="1">intVec &lt;-<span class="st"> </span><span class="kw">c</span>(3L, 17L, <span class="op">-</span>22L, 45L)</a>
<a class="sourceLine" id="cb82-2" data-line-number="2">intVec</a></code></pre></div>
<pre><code>## [1]   3  17 -22  45</code></pre>
<p>The <code>L</code> after each number signifies to R that the number should be stored in memory as an integer, rather than in double-precision format. Officially, the type is <code>integer</code>:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" data-line-number="1"><span class="kw">typeof</span>(intVec)</a></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<p>You should know that if you left off one or more of the <code>L</code>’s, then R would create a vector of type <code>double</code>:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" data-line-number="1">numVec2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">17</span>, <span class="dv">-22</span>, <span class="dv">45</span>)</a>
<a class="sourceLine" id="cb86-2" data-line-number="2"><span class="kw">typeof</span>(numVec2)</a></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<p>We won’t work much with integer-type vectors, but you’ll see them out in the wild.</p>
<p>We can also make vectors out of pieces of text called <em>strings</em>: these are called <em>character</em> vectors. As noted in the previous chapter, we use quotes to delimit strings:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" data-line-number="1">strVec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Brains&quot;</span>, <span class="st">&quot;are&quot;</span>, <span class="st">&quot;not&quot;</span>, <span class="st">&quot;the&quot;</span>, <span class="st">&quot;best&quot;</span>, </a>
<a class="sourceLine" id="cb88-2" data-line-number="2">            <span class="st">&quot;things&quot;</span>, <span class="st">&quot;in&quot;</span>, <span class="st">&quot;the&quot;</span>, <span class="st">&quot;world&quot;</span>, <span class="st">&quot;93.2&quot;</span>)</a>
<a class="sourceLine" id="cb88-3" data-line-number="3">strVec</a></code></pre></div>
<pre><code>##  [1] &quot;Brains&quot; &quot;are&quot;    &quot;not&quot;    &quot;the&quot;    &quot;best&quot;   &quot;things&quot; &quot;in&quot;    
##  [8] &quot;the&quot;    &quot;world&quot;  &quot;93.2&quot;</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" data-line-number="1"><span class="kw">typeof</span>(strVec)</a></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>Notice that <code>&quot;93.2&quot;</code> makes a string, not a number.</p>
<p>The last type of vectors to consider are the <code>logical</code> vectors. Here is an example:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" data-line-number="1">logVec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, T, T, F, F, <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb92-2" data-line-number="2">logVec</a></code></pre></div>
<pre><code>## [1]  TRUE FALSE  TRUE  TRUE FALSE FALSE FALSE</code></pre>
<p>In order to represent a logical value you can use:</p>
<ul>
<li><code>TRUE</code> or <code>T</code> to represent truth;</li>
<li><code>FALSE</code> or <code>F</code> to represent falsity.</li>
</ul>
<p>You can’t represent truth or falsity any other way. If you try anything else—like the following—you get an error:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" data-line-number="1">badVec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, false)</a></code></pre></div>
<pre><code>## Error: object &#39;false&#39; not found</code></pre>
<p><strong>Note</strong>: Although R allows <code>T</code> to be interpreted as <code>TRUE</code> and <code>F</code> as <code>FALSE</code>, it can be dangerous to use them in some circumstances. Best to get into the habit of always using <code>TRUE</code> and <code>FALSE</code>, rather than the permitted abbreviations.</p>
</div>
<div id="coercion" class="section level3">
<h3><span class="header-section-number">2.1.2</span> Coercion</h3>
<p>What would happen if you tried to represent falsity with the string <code>&quot;false&quot;</code>?</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" data-line-number="1">newVector &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="st">&quot;false&quot;</span>)</a>
<a class="sourceLine" id="cb96-2" data-line-number="2">newVector</a></code></pre></div>
<pre><code>## [1] &quot;TRUE&quot;  &quot;false&quot;</code></pre>
<p><code>newVector</code> is not a logical vector. Check it out:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" data-line-number="1"><span class="kw">typeof</span>(newVector)</a></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>In order to understand what just happened here, you must recall that all of the elements of an atomic vector have to be of the same type. If the <code>c()</code> function is presented with values of different types, then R follows a set of internal rules to <em>coerce</em> some of the values to a new type in such a way that all resulting values are of the same type. You don’t need to know all of the coercion rules, but it’s worth noting that</p>
<ul>
<li><code>character</code> beats <code>double</code>,</li>
<li>which in turn beats <code>integer</code>,</li>
<li>which in in turn beats <code>logical</code>.</li>
</ul>
<p>The following examples show this:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" data-line-number="1"><span class="kw">typeof</span>(<span class="kw">c</span>(<span class="st">&quot;one&quot;</span>, <span class="dv">1</span>, 1L, <span class="ot">TRUE</span>))</a></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" data-line-number="1"><span class="kw">typeof</span>(<span class="kw">c</span>(<span class="dv">1</span>, 1L, <span class="ot">TRUE</span>))</a></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" data-line-number="1"><span class="kw">typeof</span>(<span class="kw">c</span>(1L, <span class="ot">TRUE</span>))</a></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<p>Automatic coercion can be convenient in some circumstances, but in others it can give unexpected results. It’s best to keep track of what types you are dealing with and to exercise caution when combining values to make new vectors.</p>
<p>You can also coerce vectors “manually” with the functions:</p>
<ul>
<li><code>as.numeric()</code> ;</li>
<li><code>as.integer()</code> ;</li>
<li><code>as.character()</code> ;</li>
<li><code>as.logical()</code> .</li>
</ul>
<p>Here are some examples:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" data-line-number="1">numVec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="fl">2.5</span>, <span class="fl">-7.32</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb106-2" data-line-number="2"><span class="kw">as.character</span>(numVec)</a></code></pre></div>
<pre><code>## [1] &quot;3&quot;     &quot;2.5&quot;   &quot;-7.32&quot; &quot;0&quot;</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" data-line-number="1"><span class="kw">as.integer</span>(numVec)</a></code></pre></div>
<pre><code>## [1]  3  2 -7  0</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" data-line-number="1"><span class="kw">as.logical</span>(numVec)</a></code></pre></div>
<pre><code>## [1]  TRUE  TRUE  TRUE FALSE</code></pre>
<p>Note that in coercion from numerical to logical, the number 0 becomes <code>FALSE</code> and all non-zero numbers become <code>TRUE</code>.</p>
</div>
<div id="combining-vectors" class="section level3">
<h3><span class="header-section-number">2.1.3</span> Combining Vectors</h3>
<p>You can combine vectors you have already created to make new, bigger ones:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" data-line-number="1">numVec1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb112-2" data-line-number="2">numVec2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb112-3" data-line-number="3">numCombined &lt;-<span class="st"> </span><span class="kw">c</span>(numVec1, numVec2)</a>
<a class="sourceLine" id="cb112-4" data-line-number="4">numCombined</a></code></pre></div>
<pre><code>## [1]  5  3 10  1  2  3  4  5  6</code></pre>
<p>You can see here that vectors are different from sets: they are allowed to repeat the same value in different indices, as we see in the case of the 3’s above.</p>
</div>
<div id="na-values" class="section level3">
<h3><span class="header-section-number">2.1.4</span> NA Values </h3>
<p>Consider the following vector, which we may think of as recording the heights of people, in inches:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" data-line-number="1">heights &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">72</span>, <span class="dv">70</span>, <span class="dv">69</span>, <span class="dv">58</span>, <span class="ot">NA</span>, <span class="dv">45</span>)</a></code></pre></div>
<p>The <code>NA</code> in the fifth position of the vector is a special value that may be considered to mean “Not Assigned.” It’s R’s way of letting us indicate that a value was not recorded or has gone missing for some reason.</p>
</div>
<div id="everything-in-r-is-a-vector" class="section level3">
<h3><span class="header-section-number">2.1.5</span> “Everything in R is a Vector”</h3>
<p>Some folks say that everything in R is a vector. That’s a bit of an exaggeration but it’s remarkably close to the truth.</p>
<p>And yet it seems implausible. What about the elements of an atomic vector, for instance? A single element doesn’t look at all like a vector: it’s a value, not a <em>sequence</em> of values.</p>
<p>Or so we might think. But really, in R there are no “single values” that can exist by themselves. Consider, for instance, what we think of as the number 17:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" data-line-number="1"><span class="dv">17</span></a></code></pre></div>
<pre><code>## [1] 17</code></pre>
<p>See the <code>[1]</code> in front, in the output above? It indicates that the line begins with the <em>first element</em> of a vector. So 17 doesn’t exist on its own: it exists a vector of type <code>double</code>—a vector of length 1.</p>
<p>Even <code>NA</code> is, all along, a vector of length 1</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" data-line-number="1"><span class="ot">NA</span></a></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>It is of type <code>logical</code>:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" data-line-number="1"><span class="kw">typeof</span>(<span class="ot">NA</span>)</a></code></pre></div>
<pre><code>## [1] &quot;logical&quot;</code></pre>
<p>Note that even the type of <code>NA</code> evaluates, in R, to a vector: a character vector of length 1 whose only element is the string “logical”!</p>
</div>
<div id="named-vectors" class="section level3">
<h3><span class="header-section-number">2.1.6</span> Named Vectors</h3>
<p>The elements of a vector can have names, if we like:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" data-line-number="1">ages &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">Bettina =</span> <span class="dv">32</span>, <span class="dt">Chris =</span> <span class="dv">64</span>, <span class="dt">Ramesh =</span> <span class="dv">101</span>)</a>
<a class="sourceLine" id="cb121-2" data-line-number="2">ages</a></code></pre></div>
<pre><code>## Bettina   Chris  Ramesh 
##      32      64     101</code></pre>
<p>Having names doesn’t keep the vector from being a vector of type <code>double</code>: it has to be <code>double</code> because its elements are <code>double</code>.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1"><span class="kw">typeof</span>(ages)</a></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<p>We can names the elements of a vector when we create it with <code>c()</code>, or we can name them later on. One way to do this is with the <code>names()</code> function:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" data-line-number="1"><span class="kw">names</span>(heights) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Scarecrow&quot;</span>, <span class="st">&quot;Tinman&quot;</span>, <span class="st">&quot;Lion&quot;</span>, <span class="st">&quot;Dorothy&quot;</span>, <span class="st">&quot;Toto&quot;</span>, <span class="st">&quot;Boq&quot;</span>)</a>
<a class="sourceLine" id="cb125-2" data-line-number="2">heights</a></code></pre></div>
<pre><code>## Scarecrow    Tinman      Lion   Dorothy      Toto       Boq 
##        72        70        69        58        NA        45</code></pre>
</div>
<div id="special-character-vectors" class="section level3">
<h3><span class="header-section-number">2.1.7</span> Special Character Vectors</h3>
<p>R comes with two handy, predefined character vectors:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" data-line-number="1">letters</a></code></pre></div>
<pre><code>##  [1] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot; &quot;e&quot; &quot;f&quot; &quot;g&quot; &quot;h&quot; &quot;i&quot; &quot;j&quot; &quot;k&quot; &quot;l&quot; &quot;m&quot; &quot;n&quot; &quot;o&quot; &quot;p&quot; &quot;q&quot;
## [18] &quot;r&quot; &quot;s&quot; &quot;t&quot; &quot;u&quot; &quot;v&quot; &quot;w&quot; &quot;x&quot; &quot;y&quot; &quot;z&quot;</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" data-line-number="1">LETTERS</a></code></pre></div>
<pre><code>##  [1] &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot; &quot;E&quot; &quot;F&quot; &quot;G&quot; &quot;H&quot; &quot;I&quot; &quot;J&quot; &quot;K&quot; &quot;L&quot; &quot;M&quot; &quot;N&quot; &quot;O&quot; &quot;P&quot; &quot;Q&quot;
## [18] &quot;R&quot; &quot;S&quot; &quot;T&quot; &quot;U&quot; &quot;V&quot; &quot;W&quot; &quot;X&quot; &quot;Y&quot; &quot;Z&quot;</code></pre>
<p>We will make use of them from time to time.</p>
</div>
<div id="length-of-vectors" class="section level3">
<h3><span class="header-section-number">2.1.8</span> Length of Vectors</h3>
<p>The <code>length()</code> function tells us how many elements a vector has:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" data-line-number="1"><span class="kw">length</span>(heights)</a></code></pre></div>
<pre><code>## [1] 6</code></pre>
</div>
<div id="practice-exercises" class="section level3">
<h3><span class="header-section-number">2.1.9</span> Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Consider the following vector:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" data-line-number="1">upperLower &lt;-<span class="st"> </span><span class="kw">c</span>(LETTERS, letters)</a></code></pre></div>
<p>What should the length of <code>upperLower</code> be? Check you answer using the <code>length()</code> function.</p></li>
<li><p>True or False: <code>c(&quot;a&quot;, 2, TRUE)</code> yields a vector of length three consisting of the string <code>&quot;a&quot;</code>, the number 2 and the logical value <code>TRUE</code>.</p></li>
<li><p>The function <code>as.numeric()</code> tries to coerce its input into numbers. How well can it pick out the “numbers” in strings. Try the following calls. When did <code>as.numeric()</code> find the numbers that was probably intended?</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" data-line-number="1"><span class="kw">as.numeric</span>(<span class="st">&quot;3.214&quot;</span>)</a>
<a class="sourceLine" id="cb134-2" data-line-number="2"><span class="kw">as.numeric</span>(<span class="st">&quot;3L&quot;</span>)</a>
<a class="sourceLine" id="cb134-3" data-line-number="3"><span class="kw">as.numeric</span>(<span class="st">&quot;fifty&quot;</span>)</a>
<a class="sourceLine" id="cb134-4" data-line-number="4"><span class="kw">as.numeric</span>(<span class="st">&quot;10 + 3&quot;</span>)</a>
<a class="sourceLine" id="cb134-5" data-line-number="5"><span class="kw">as.numeric</span>(<span class="st">&quot;3.25e-3&quot;</span>)  <span class="co"># scientific notation:  3.25 times 10^(-2)</span></a>
<a class="sourceLine" id="cb134-6" data-line-number="6"><span class="kw">as.numeric</span>(<span class="st">&quot;31,245&quot;</span>)</a></code></pre></div></li>
</ol>
</div>
<div id="solutions-to-practice-exercises" class="section level3">
<h3><span class="header-section-number">2.1.10</span> Solutions to Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>There are 26 letters, so the length of <code>upperlower</code> should be <span class="math inline">\(2 \times 26 = 52\)</span>. Let’s check:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" data-line-number="1"><span class="kw">length</span>(upperLower)</a></code></pre></div>
<pre><code>## [1] 52</code></pre></li>
<li><p><strong>False!</strong> The resulting vector will be atomic—all of its elements will be the same data type. The non-strings will be coerced to strings, yielding:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" data-line-number="1"><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="dv">2</span>, <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] &quot;a&quot;    &quot;2&quot;    &quot;TRUE&quot;</code></pre></li>
<li><p><code>as.numeric()</code> isn’t very smart: it picked out the number in <code>&quot;3.214&quot;</code> and <code>3.25e-3</code>, but in the other cases it returned <code>NA</code>.</p></li>
</ol>
</div>
</div>
<div id="constructing-patterned-vectors" class="section level2">
<h2><span class="header-section-number">2.2</span> Constructing Patterned Vectors</h2>
<p>Quite often we need to make lengthy vectors that follow simple patterns. R has a few functions to assist us in these tasks.</p>
<div id="sequencing" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Sequencing</h3>
<p>Consider the <code>seq()</code> function:</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" data-line-number="1"><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">5</span>, <span class="dt">to =</span> <span class="dv">15</span>, <span class="dt">by =</span> <span class="dv">1</span>)</a></code></pre></div>
<pre><code>##  [1]  5  6  7  8  9 10 11 12 13 14 15</code></pre>
<p>The default value of the parameter <code>by</code> is 1, so we could get the same thing with:</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" data-line-number="1"><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">5</span>, <span class="dt">to =</span> <span class="dv">15</span>)</a></code></pre></div>
<pre><code>##  [1]  5  6  7  8  9 10 11 12 13 14 15</code></pre>
<p>Further reduction in typing may be achieved as long as we remember the order in which R expects the parameters (<code>from</code> before <code>to</code>, then <code>by</code> if supplied):</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" data-line-number="1"><span class="kw">seq</span>(<span class="dv">5</span>, <span class="dv">15</span>)</a></code></pre></div>
<pre><code>##  [1]  5  6  7  8  9 10 11 12 13 14 15</code></pre>
<p>Some more complex examples:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" data-line-number="1"><span class="kw">seq</span>(<span class="dv">3</span>, <span class="dv">15</span>, <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1]  3  5  7  9 11 13 15</code></pre>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb147-1" data-line-number="1"><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>)</a></code></pre></div>
<pre><code>##  [1] 0.0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1.0</code></pre>
<p>R will go up to the <code>to</code> value, but not past it:</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb149-1" data-line-number="1"><span class="kw">seq</span>(<span class="dv">3</span>, <span class="dv">16</span>, <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1]  3  5  7  9 11 13 15</code></pre>
<p>Negative steps are fine:</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb151-1" data-line-number="1"><span class="kw">seq</span>(<span class="dv">5</span>, <span class="dv">-4</span>, <span class="dv">-1</span>)</a></code></pre></div>
<pre><code>##  [1]  5  4  3  2  1  0 -1 -2 -3 -4</code></pre>
<p>The <em>colon operator</em> <code>:</code> is a convenient abbreviation for <code>seq</code>:</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb153-1" data-line-number="1"><span class="dv">1</span><span class="op">:</span><span class="dv">5</span> <span class="co"># 1 is from, 5 is to</span></a></code></pre></div>
<pre><code>## [1] 1 2 3 4 5</code></pre>
<p>If the <code>from</code> number is greater than the <code>to</code> number the step for the colon operator is -1:</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb155-1" data-line-number="1"><span class="dv">5</span><span class="op">:</span><span class="dv">1</span></a></code></pre></div>
<pre><code>## [1] 5 4 3 2 1</code></pre>
</div>
<div id="repeating" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Repeating</h3>
<p>With <code>rep()</code> we may repeat a given vector as many times as we like:</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb157-1" data-line-number="1"><span class="kw">rep</span>(<span class="dv">3</span>, <span class="dt">times =</span> <span class="dv">5</span>)</a></code></pre></div>
<pre><code>## [1] 3 3 3 3 3</code></pre>
<p>We can apply <code>rep()</code> to a vector of length greater than 1:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb159-1" data-line-number="1">vec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">3</span>, <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb159-2" data-line-number="2"><span class="kw">rep</span>(vec, <span class="dt">times =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## [1] 7 3 4 7 3 4 7 3 4</code></pre>
<p><code>rep()</code> applies perfectly well to character-vectors:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb161-1" data-line-number="1"><span class="kw">rep</span>(<span class="st">&quot;Toto&quot;</span>, <span class="dv">4</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Toto&quot; &quot;Toto&quot; &quot;Toto&quot; &quot;Toto&quot;</code></pre>
<p><code>rep()</code> also takes an <code>each</code> parameter that determines how many times each element of the given vector will be repeated before the <code>times</code> parameter is applied. This is best illustrated with an example:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb163-1" data-line-number="1">vec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">3</span>, <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb163-2" data-line-number="2"><span class="kw">rep</span>(vec, <span class="dt">each =</span> <span class="dv">2</span>, <span class="dt">times =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##  [1] 7 7 3 3 4 4 7 7 3 3 4 4 7 7 3 3 4 4</code></pre>
<p>If we combine <code>seq()</code> and <code>rep()</code> we can create fairly complex patterns concisely:</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb165-1" data-line-number="1">vec &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">5</span>, <span class="dv">-3</span>, <span class="dv">-2</span>)</a>
<a class="sourceLine" id="cb165-2" data-line-number="2"><span class="kw">rep</span>(vec, <span class="dt">each =</span> <span class="dv">2</span>, <span class="dt">times =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##  [1]  5  5  3  3  1  1 -1 -1 -3 -3  5  5  3  3  1  1 -1 -1 -3 -3</code></pre>
<p>In order to create fifty 10’s followed by fifty 30’s followed by fifty 50’s I would write:</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb167-1" data-line-number="1"><span class="kw">rep</span>(<span class="kw">seq</span>(<span class="dv">10</span>, <span class="dv">50</span>, <span class="dv">20</span>), <span class="dt">each =</span> <span class="dv">50</span>)</a></code></pre></div>
</div>
<div id="practice-exercises-1" class="section level3">
<h3><span class="header-section-number">2.2.3</span> Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Use <code>rep()</code> to make the following vector:</p>
<pre><code>## [1] &quot;Kansas&quot; &quot;Kansas&quot; &quot;Kansas&quot; &quot;Kansas&quot; &quot;Kansas&quot;</code></pre></li>
<li><p>Use <code>rep()</code> to make the following vector:</p>
<pre><code>## [1]  TRUE FALSE  TRUE FALSE  TRUE FALSE  TRUE FALSE</code></pre></li>
<li><p>Use <code>seq()</code> to make the following vector:</p>
<pre><code>## [1]  5  8 11 14 17 20 23 26</code></pre></li>
<li><p>Use <code>seq()</code> to make all of the multiples of 4, beginning with 8 and going down to -32.</p></li>
<li><p>Use the colon operator to make all of the whole numbers from 10 to 20.</p></li>
<li><p>Use the colon operator to make all of the whole numbers from 10 to -30.</p></li>
<li><p>You have a vector named <code>myVec</code>. Use the colon operator and the <code>length()</code> function to make all of the whole numbers from 1 to the length of <code>myVec</code>.</p></li>
<li><p>Use <code>rep()</code> and <code>seq()</code> together to make the following vector:</p>
<pre><code>##  [1]  2  3  4  5  6  7  8  9 10  2  3  4  5  6  7  8  9 10  2  3  4  5  6
## [24]  7  8  9 10</code></pre></li>
<li><p>Use <code>rep()</code> and <code>seq()</code> together to make the following vector:</p>
<pre><code>##  [1]  2  2  2  3  3  3  4  4  4  5  5  5  6  6  6  7  7  7  8  8  8  9  9
## [24]  9 10 10 10</code></pre></li>
<li><p>Read the Help for <code>rep()</code></p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb173-1" data-line-number="1">?rep</a></code></pre></div>
<p>It tells you that the first argument of <code>rep()</code> is the vector that you want to repeat, and that it’s called <code>x</code>. It goes on to say that <code>times</code> is:</p>
<blockquote>
<p>“an integer-valued vector giving the (non-negative) number of times to repeat each element if of length <code>length(x)</code>, or to repeat the whole vector if of length 1.”</p>
</blockquote>
<p>Use this information to describe in words what will be the output of:</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb174-1" data-line-number="1"><span class="kw">rep</span>(<span class="kw">seq</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dt">by =</span> <span class="dv">10</span>), <span class="dt">times =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</a></code></pre></div></li>
</ol>
</div>
<div id="solutions-to-practice-exercises-1" class="section level3">
<h3><span class="header-section-number">2.2.4</span> Solutions to Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Here’s how:</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb175-1" data-line-number="1"><span class="kw">rep</span>(<span class="st">&quot;Kansas&quot;</span>, <span class="dt">times =</span> <span class="dv">5</span>)</a></code></pre></div></li>
<li><p>Here’s how:</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb176-1" data-line-number="1"><span class="kw">rep</span>(<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>), <span class="dt">times =</span> <span class="dv">4</span>)</a></code></pre></div></li>
<li><p>Here’s how:</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb177-1" data-line-number="1"><span class="kw">seq</span>(<span class="dv">5</span>, <span class="dv">26</span>, <span class="dt">by =</span> <span class="dv">3</span>)</a></code></pre></div></li>
<li><p>Here’s how:</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb178-1" data-line-number="1"><span class="kw">seq</span>(<span class="dv">8</span>, <span class="dv">-32</span>, <span class="dt">by =</span> <span class="dv">-4</span>)</a></code></pre></div></li>
<li><p>Here’s how:</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb179-1" data-line-number="1"><span class="dv">10</span><span class="op">:</span><span class="dv">20</span></a></code></pre></div></li>
<li><p>Here’s how:</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb180-1" data-line-number="1"><span class="dv">10</span><span class="op">:-</span><span class="dv">30</span></a></code></pre></div></li>
<li><p>All you need is this:</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb181-1" data-line-number="1"><span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(myVec)</a></code></pre></div></li>
<li><p>Here’s how:</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb182-1" data-line-number="1"><span class="kw">rep</span>(<span class="kw">seq</span>(<span class="dv">2</span>, <span class="dv">10</span>), <span class="dt">times =</span> <span class="dv">3</span>)</a></code></pre></div></li>
<li><p>Here’s how:</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb183-1" data-line-number="1"><span class="kw">rep</span>(<span class="kw">seq</span>(<span class="dv">2</span>, <span class="dv">10</span>), <span class="dt">each =</span> <span class="dv">3</span>)</a></code></pre></div></li>
<li><p>You’ll get one 10, two 20s, three 30s, …, all the way up to ten 100s.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb184-1" data-line-number="1"><span class="kw">rep</span>(<span class="kw">seq</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dt">by =</span> <span class="dv">10</span>), <span class="dt">times =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</a></code></pre></div>
<pre><code>##  [1]  10  20  20  30  30  30  40  40  40  40  50  50  50  50  50  60  60
## [18]  60  60  60  60  70  70  70  70  70  70  70  80  80  80  80  80  80
## [35]  80  80  90  90  90  90  90  90  90  90  90 100 100 100 100 100 100
## [52] 100 100 100 100</code></pre></li>
</ol>
</div>
</div>
<div id="subsetting-vectors" class="section level2">
<h2><span class="header-section-number">2.3</span> Subsetting Vectors</h2>
<p>Quite often we need to select one or more elements from a vector. The <em>subsetting operator</em> <code>[</code>  allows us to do this.</p>
<p>Recall the vector <code>heights</code>:</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb186-1" data-line-number="1">heights</a></code></pre></div>
<pre><code>## Scarecrow    Tinman      Lion   Dorothy      Toto       Boq 
##        72        70        69        58        NA        45</code></pre>
<p>If we want the fourth element, we ask for it with the subsetting operator like this:</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb188-1" data-line-number="1">heights[<span class="dv">4</span>]</a></code></pre></div>
<pre><code>## Dorothy 
##      58</code></pre>
<p>If we want two or more elements, then we specify their indices in a vector. Thus, to get the first and fifth elements, we might do this:</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb190-1" data-line-number="1">desired &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb190-2" data-line-number="2">heights[desired]</a></code></pre></div>
<pre><code>## Scarecrow      Toto 
##        72        NA</code></pre>
<p>We could also ask for them directly:</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb192-1" data-line-number="1">heights[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">5</span>)]</a></code></pre></div>
<pre><code>## Scarecrow      Toto 
##        72        NA</code></pre>
<p>Negative numbers are significant in subsetting:</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb194-1" data-line-number="1">heights[<span class="op">-</span><span class="dv">2</span>] <span class="co">#select all but second element</span></a></code></pre></div>
<pre><code>## Scarecrow      Lion   Dorothy      Toto       Boq 
##        72        69        58        NA        45</code></pre>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb196-1" data-line-number="1">heights[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)]  <span class="co"># all but first and third</span></a></code></pre></div>
<pre><code>##  Tinman Dorothy    Toto     Boq 
##      70      58      NA      45</code></pre>
<p>If you specify a nonexistent index, you get <code>NA</code>, the reasonable result:</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb198-1" data-line-number="1">heights[<span class="dv">7</span>]</a></code></pre></div>
<pre><code>## &lt;NA&gt; 
##   NA</code></pre>
<p>Patterned vectors are quite useful for subsetting. If you want the first three elements of <code>heights</code>, you don’t have to type <code>heights[c(1,2,3)]</code>. Instead you can just say:</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb200-1" data-line-number="1">heights[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</a></code></pre></div>
<pre><code>## Scarecrow    Tinman      Lion 
##        72        70        69</code></pre>
<p>The following gives the same as <code>heights</code>:</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb202-1" data-line-number="1">heights[<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(heights)]</a></code></pre></div>
<pre><code>## Scarecrow    Tinman      Lion   Dorothy      Toto       Boq 
##        72        70        69        58        NA        45</code></pre>
<p>If you desire to quickly provide names for a vector, subsetting can help:</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb204-1" data-line-number="1">vec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">23</span>, <span class="dv">14</span>, <span class="dv">82</span>, <span class="dv">33</span>, <span class="dv">33</span>, <span class="dv">45</span>)</a>
<a class="sourceLine" id="cb204-2" data-line-number="2"><span class="kw">names</span>(vec) &lt;-<span class="st"> </span>LETTERS[<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(vec)]</a>
<a class="sourceLine" id="cb204-3" data-line-number="3">vec</a></code></pre></div>
<pre><code>##  A  B  C  D  E  F 
## 23 14 82 33 33 45</code></pre>
<p>If a vector has names we can refer to its elements using the subsetting operator and those names:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb206-1" data-line-number="1">heights[<span class="st">&quot;Tinman&quot;</span>]</a></code></pre></div>
<pre><code>## Tinman 
##     70</code></pre>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb208-1" data-line-number="1">heights[<span class="kw">c</span>(<span class="st">&quot;Scarecrow&quot;</span>, <span class="st">&quot;Boq&quot;</span>)]</a></code></pre></div>
<pre><code>## Scarecrow       Boq 
##        72        45</code></pre>
<p>Finally, we can use subsetting to modify parts of a vector. For example, Dorothy’s height is reported as:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb210-1" data-line-number="1">heights[<span class="st">&quot;Dorothy&quot;</span>]</a></code></pre></div>
<pre><code>## Dorothy 
##      58</code></pre>
<p>If Dorothy grows two inches, then we can modify her height as follows:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb212-1" data-line-number="1">heights[<span class="st">&quot;Dorothy&quot;</span>] &lt;-<span class="st"> </span><span class="dv">60</span></a></code></pre></div>
<p>We can replace more than one element, of course. Thus:</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb213-1" data-line-number="1">heights[<span class="kw">c</span>(<span class="st">&quot;Scarecrow&quot;</span>, <span class="st">&quot;Boq&quot;</span>)] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">73</span>, <span class="dv">46</span>)</a></code></pre></div>
<p>The subset of indices may be as complex as you like:</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb214-1" data-line-number="1">vec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>)</a>
<a class="sourceLine" id="cb214-2" data-line-number="2">vec[<span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">2</span>, <span class="dt">to =</span> <span class="dv">6</span>, <span class="dt">by =</span> <span class="dv">2</span>)] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>)</a>
<a class="sourceLine" id="cb214-3" data-line-number="3">vec</a></code></pre></div>
<pre><code>## [1]   3 100   5 200   7 300</code></pre>
<p>In the above example, <code>seq(2,6,2)</code> identified 2, 4 and 6 as the indices of elements of <code>vec</code> that were to be replaced by the corresponding elements of <code>c(100, 200, 300)</code>.</p>
<p>We can even use subsetting to rearrange the elements of a vector. Consider the example below:</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb216-1" data-line-number="1">inhabitants &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Oz&quot;</span>, <span class="st">&quot;Toto&quot;</span>, <span class="st">&quot;Boq&quot;</span>, <span class="st">&quot;Glinda&quot;</span>)</a>
<a class="sourceLine" id="cb216-2" data-line-number="2">permuted &lt;-<span class="st"> </span>inhabitants[<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>)]</a>
<a class="sourceLine" id="cb216-3" data-line-number="3">permuted</a></code></pre></div>
<pre><code>## [1] &quot;Boq&quot;    &quot;Glinda&quot; &quot;Oz&quot;     &quot;Toto&quot;</code></pre>
<div id="practice-exercises-2" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Practice Exercises</h3>
<p>We’ll work with the following vector:</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb218-1" data-line-number="1">practiceVec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">8</span>)</a></code></pre></div>
<ol style="list-style-type: decimal">
<li><p>Select the fifth element of <code>practiceVec</code>.</p></li>
<li><p>Select the third and sixth elements of <code>practiceVec</code>.</p></li>
<li><p>Select the first, second, third and fourth elements of <code>practiceVec</code>.</p></li>
<li><p>How would you select the last element of the vector <code>mysteryVec</code> if you did not know how many elements it had?</p></li>
<li><p>Select all but the fourth element of <code>practiceVec</code>.</p></li>
<li><p>Select all but the fourth and sixth elements of <code>practiceVec</code>.</p></li>
<li><p>Select the even-numbered elements of <code>practiceVec</code>.</p></li>
<li><p>Replace the third element of <code>practiceVec</code> with the number 5.</p></li>
<li><p>Replace the even-numbered elements of <code>practiceVec</code> with zeroes.</p></li>
<li><p>Replace the second, third and fifth elements of <code>practiceVec</code> with 3, 10, and 20 respectively.</p></li>
<li><p>Reverse the order of the elements of <code>practiceVec</code>.</p></li>
</ol>
</div>
<div id="solutions-to-practice-exercises-2" class="section level3">
<h3><span class="header-section-number">2.3.2</span> Solutions to Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p><code>practiceVec[5]</code></p></li>
<li><p><code>practiceVec[3,6]</code></p></li>
<li><p><code>practiceVec[1:4]</code></p></li>
<li><p><code>mysteryVec[length(mysteryVec)]</code></p></li>
<li><p><code>practiceVec[-4]</code></p></li>
<li><p><code>practiceVec[-c(4,5)]</code></p></li>
<li><p><code>practiceVec[seq(2, length(practiceVec), by = 2)]</code></p></li>
<li><p><code>practiceVec[3] &lt;- 5</code></p></li>
<li><p>Here is one way:</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb219-1" data-line-number="1">zeroes &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, <span class="dt">times =</span> <span class="kw">length</span>(<span class="kw">seq</span>(<span class="dv">2</span> <span class="kw">length</span>(practiceVec))))</a>
<a class="sourceLine" id="cb219-2" data-line-number="2">practiceVec[<span class="kw">seq</span>(<span class="dv">2</span>, <span class="kw">length</span>(practiceVec), <span class="dt">by =</span> <span class="dv">2</span>)] &lt;-<span class="st"> </span>zeroes</a></code></pre></div>
<p>Here’s a quicker way:</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb220-1" data-line-number="1">practiceVec[<span class="kw">seq</span>(<span class="dv">2</span>, <span class="kw">length</span>(practiceVec), <span class="dt">by =</span> <span class="dv">2</span>)] &lt;-<span class="st"> </span><span class="dv">0</span></a></code></pre></div>
<p>The latter approach involves “recycling” the zero. We’ll discuss recycling soon.</p></li>
<li><p><code>practiceVec[c(2, 3, 5)] &lt;- c(3, 10, 20)</code></p></li>
<li><p><code>practiceVec[length(practiceVec):1]</code></p></li>
</ol>
</div>
</div>
<div id="more-on-logical-vectors" class="section level2">
<h2><span class="header-section-number">2.4</span> More on Logical Vectors</h2>
<p>Consider the following expression:</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb221-1" data-line-number="1"><span class="dv">13</span> <span class="op">&lt;</span><span class="st"> </span><span class="dv">20</span></a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>We constructed it with the “less-than” operator <code>&lt;</code>. You can think of it as saying that 13 is less than 20, which is a true statement, and sure enough, R <em>evaluates</em> the expression <code>13 &lt; 20</code> as <code>TRUE</code>.</p>
<p>When you think about it, we’ve seen lots of expressions so far. Here are just a few of them:</p>
<ul>
<li><code>sqrt(64)</code></li>
<li><code>heights</code></li>
<li><code>heights[1:3]</code></li>
<li><code>13 &lt; 20</code></li>
</ul>
<p>When we type any one of them into the console, it <em>evaluates</em> to a particular value. In the examples above, the value was always a vector.</p>
<p>Expressions like <code>13 &lt; 20</code> that evaluate to a logical vector are often called <em>Boolean</em> expressions.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<div id="boolean-operators" class="section level3">
<h3><span class="header-section-number">2.4.1</span> Boolean Operators</h3>
<p>Let’s look further into Boolean expressions. Define the following two vectors:</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb223-1" data-line-number="1">a &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">17</span>)</a>
<a class="sourceLine" id="cb223-2" data-line-number="2">b &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">15</span>, <span class="dv">12</span>)</a></code></pre></div>
<p>Now let’s evaluate the expression <code>a &lt; b</code>:</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb224-1" data-line-number="1">a <span class="op">&lt;</span><span class="st"> </span>b</a></code></pre></div>
<pre><code>## [1] FALSE  TRUE FALSE</code></pre>
<p>The <code>&lt;</code> operator, when applied to vectors, always works <em>element-wise</em>; that is, it is applied to corresponding elements of the vectors on either side of it. R’s evaluation of <code>a &lt; b</code> involves evaluation of the following three expressions:</p>
<ul>
<li><code>10 &lt; 8</code> (evaluates to <code>FALSE</code>)</li>
<li><code>13 &lt; 15</code>(evaluates to <code>TRUE</code>)</li>
<li><code>17 &lt; 12</code>(evaluates to <code>FALSE</code>)</li>
</ul>
<p>The result is a logical vector of length 3.</p>
<p>The <code>&lt;</code> operator is an example of a <em>Boolean operator</em> in R. Table @ref(boolean-operators) shows the available Boolean operators.








</p>
<table>
<caption>(#tab:unnamed-chunk-131)The Boolean Operators</caption>
<thead>
<tr class="header">
<th align="left">Operation</th>
<th align="left">What It Means</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">&lt;</td>
<td align="left">less than</td>
</tr>
<tr class="even">
<td align="left">&gt;</td>
<td align="left">greater than</td>
</tr>
<tr class="odd">
<td align="left">&lt;=</td>
<td align="left">less than or equal to</td>
</tr>
<tr class="even">
<td align="left">&gt;=</td>
<td align="left">greater than or equal to</td>
</tr>
<tr class="odd">
<td align="left">==</td>
<td align="left">equal to</td>
</tr>
<tr class="even">
<td align="left">&amp;</td>
<td align="left">and</td>
</tr>
<tr class="odd">
<td align="left">|</td>
<td align="left">or</td>
</tr>
<tr class="even">
<td align="left">&amp;&amp;</td>
<td align="left">and (scalar version)</td>
</tr>
<tr class="odd">
<td align="left">||</td>
<td align="left">or (scalar version)</td>
</tr>
<tr class="even">
<td align="left">!</td>
<td align="left">not</td>
</tr>
</tbody>
</table>
<div id="inequalities" class="section level4">
<h4><span class="header-section-number">2.4.1.1</span> Inequalities</h4>
<p>The “numerical-looking operators” (<code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>) have their usual meanings when one is working with numerical vectors<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> When applied to character vectors they evaluate according to an alphabetical order:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb226-1" data-line-number="1">a&lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Dorothy&quot;</span>, <span class="st">&quot;toto&quot;</span>, <span class="st">&quot;Boq&quot;</span>)</a>
<a class="sourceLine" id="cb226-2" data-line-number="2">b &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;tinman&quot;</span>, <span class="st">&quot;Toto&quot;</span>, <span class="st">&quot;2017&quot;</span>)</a>
<a class="sourceLine" id="cb226-3" data-line-number="3">a <span class="op">&lt;</span><span class="st"> </span>b</a></code></pre></div>
<pre><code>## [1]  TRUE  TRUE FALSE</code></pre>
<p>The reasons for the evaluation above are as follows:</p>
<ul>
<li>D comes before t in the alphabet;</li>
<li>lowercase t comes before uppercase T, according to R;</li>
<li>characters for numbers come before letter-characters, according to R.</li>
</ul>
</div>
<div id="equality" class="section level4">
<h4><span class="header-section-number">2.4.1.2</span> Equality</h4>
<p>The equality (<code>==</code>) operator indicates whether the expressions being compared evaluate to the same value. Note that it’s made with <em>two</em> equal-signs, not one! It’s all about evaluation to the same value, not strict identity. The following examples will help to clarify this.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb228-1" data-line-number="1">a &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">Dorothy =</span> <span class="dv">1</span>,<span class="dt">Toto =</span> <span class="dv">2</span>) <span class="co"># a named vector</span></a>
<a class="sourceLine" id="cb228-2" data-line-number="2">b &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">Glinda =</span> <span class="dv">1</span>, <span class="dt">Tinman =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb228-3" data-line-number="3">a <span class="op">==</span><span class="st"> </span>b</a></code></pre></div>
<pre><code>## Dorothy    Toto 
##    TRUE    TRUE</code></pre>
<p>(Note that the resulting logical vector inherits the names of <code>a</code>, the vector on the left.).</p>
<p>But <code>a</code> and <code>b</code> aren’t <em>identical</em>. We can see this because R has the function <code>identical()</code> to test for identity:</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb230-1" data-line-number="1"><span class="kw">identical</span>(a, b)</a></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>Corresponding elements of <code>a</code> and <code>b</code> have the same values, but the two vectors don’t have the same set of names, so they aren’t considered identical.</p>
<p>Here’s another way to see that “evaluating to the same value” is not the same as “identity”:</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb232-1" data-line-number="1"><span class="ot">TRUE</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span></a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>When <code>TRUE (itself of</code>type <code>logical</code>) is being compared with something numerical (type <code>integer</code> or <code>double</code>) it is <em>coerced</em> into the numerical vector 1. (In the same situation <code>FALSE</code> would be coerced to 0.) But clearly <code>TRUE</code> and 1 are not identical:</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb234-1" data-line-number="1"><span class="kw">identical</span>(<span class="ot">TRUE</span>, <span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
</div>
<div id="and-or-not" class="section level4">
<h4><span class="header-section-number">2.4.1.3</span> And, Or, Not</h4>
<p>We consider an “and” statement to be true when both of its component statements are true; otherwise it is counted as false. The <code>&amp;</code> Boolean operator accords with our thinking:</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb236-1" data-line-number="1">a &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb236-2" data-line-number="2">b &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb236-3" data-line-number="3">a <span class="op">&amp;</span><span class="st"> </span>b</a></code></pre></div>
<pre><code>## [1]  TRUE FALSE FALSE FALSE</code></pre>
<p>In logic and mathematics, an “or” statement is considered to be true when <em>at least one</em> of its component statements are true. (This is sometimes called the “inclusive” use of the term “or.”) R accords with this line of thinking:</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb238-1" data-line-number="1">a &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb238-2" data-line-number="2">b &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb238-3" data-line-number="3">a <span class="op">|</span><span class="st"> </span>b</a></code></pre></div>
<pre><code>## [1]  TRUE  TRUE  TRUE FALSE</code></pre>
<p>The <code>&amp;&amp;</code> and <code>||</code> operators follow the “and” and “or” logic respectively, but are applied only to the first elements of the vectors being compared:</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb240-1" data-line-number="1">a &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb240-2" data-line-number="2">b &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb240-3" data-line-number="3">a <span class="op">&amp;&amp;</span><span class="st"> </span>b</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb242-1" data-line-number="1">a &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb242-2" data-line-number="2">b &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">FALSE</span>, <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb242-3" data-line-number="3">a <span class="op">||</span><span class="st"> </span>b</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>These operators will come in handy later on, when we study <em>conditionals</em>.</p>
<p>The final Boolean operator is <code>!</code>, which works like “not”:</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb244-1" data-line-number="1">a &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb244-2" data-line-number="2"><span class="op">!</span>a</a></code></pre></div>
<pre><code>## [1] FALSE  TRUE</code></pre>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb246-1" data-line-number="1">e &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb246-2" data-line-number="2">f &lt;-<span class="st">  </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb246-3" data-line-number="3">e <span class="op">&gt;</span><span class="st"> </span>f</a></code></pre></div>
<pre><code>## [1] FALSE  TRUE  TRUE</code></pre>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb248-1" data-line-number="1"><span class="op">!</span>(e <span class="op">&gt;</span><span class="st"> </span>f)</a></code></pre></div>
<pre><code>## [1]  TRUE FALSE FALSE</code></pre>
</div>
</div>
</div>
<div id="vector-recycling" class="section level2">
<h2><span class="header-section-number">2.5</span> Vector Recycling </h2>
<p>Consider the vector</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb250-1" data-line-number="1">vec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">3</span>)</a></code></pre></div>
<p>Look at what happens when we evaluate the expression:</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb251-1" data-line-number="1">vec <span class="op">&gt;</span><span class="st"> </span><span class="dv">4</span></a></code></pre></div>
<pre><code>## [1] FALSE  TRUE FALSE  TRUE FALSE</code></pre>
<p>At first blush this doesn’t make any sense: <code>vec</code> has length 5, whereas <code>4</code> is a vector of length 1. How can the two of them be compared?</p>
<p>They cannot, in fact, be compared. Instead the shorter of the two vectors—the <code>4</code>—is <em>recycled</em> into the <code>c(4,4,4,4,4)</code> a vector of length five, which may then be compared element-wise with <code>vec</code>. Recycling is a great convenience as it allows us to express an idea clearly and concisely.</p>
<p>Recycling is always performed on the shorter of two vectors. Consider the example below:</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb253-1" data-line-number="1">vec2 &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">6</span></a>
<a class="sourceLine" id="cb253-2" data-line-number="2">vec2 <span class="op">&gt;</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] FALSE  TRUE FALSE  TRUE  TRUE  TRUE</code></pre>
<p>Here, <code>c(3,1)</code> was recycled into <code>c(3,1,3,1,3,1)</code> prior to being compared with <code>vec2</code>.</p>
<p>What happens if the length of the longer vector is not a multiple of the shorter one? We should look into this:</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb255-1" data-line-number="1">vec2 &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">7</span></a>
<a class="sourceLine" id="cb255-2" data-line-number="2">vec2 <span class="op">&gt;</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">8</span>)</a></code></pre></div>
<pre><code>## longer object length is not a multiple of shorter object length
## [1] FALSE FALSE FALSE FALSE  TRUE FALSE  TRUE</code></pre>
<p>We get a warning, but R tries to do the job for us anyway, recycling the shorter vector to <code>c(3,8,3,8,3,8,3)</code> and then performing the comparison.</p>
<p>By the way, if you don’t want to see the warning you can put the expression into the <code>suppressWarnings()</code> function:</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb257-1" data-line-number="1"><span class="kw">suppressWarnings</span>(vec2 <span class="op">&gt;</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">8</span>))</a></code></pre></div>
<pre><code>## [1] FALSE FALSE FALSE FALSE  TRUE FALSE</code></pre>
<div id="practice-exercises-3" class="section level3">
<h3><span class="header-section-number">2.5.1</span> Practice Exercises</h3>
<p>We’ll work with the following vectors:</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb259-1" data-line-number="1">person &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Dorothy&quot;</span>, <span class="st">&quot;Scarecrow&quot;</span>, <span class="st">&quot;Tin Man&quot;</span>, <span class="st">&quot;Lion&quot;</span>, <span class="st">&quot;Toto&quot;</span>)</a>
<a class="sourceLine" id="cb259-2" data-line-number="2">age &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">12</span>, <span class="fl">0.04</span>, <span class="dv">15</span>, <span class="dv">18</span>, <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb259-3" data-line-number="3">likesDogs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Think of the vectors as having corresponding elements. Thus, there is a person named Dorothy who is 12 years old and likes dogs, a person named Tin Man who is 0.04 years old and doesn’t like dogs, etc.</p>
<ol style="list-style-type: decimal">
<li><p>Write a Boolean expression that is <code>TRUE</code> when a person is less than 14 years old and <code>FALSE</code> otherwise.</p></li>
<li><p>Write a Boolean expression that is <code>TRUE</code> when a person is between 10 and 15 years old (not including 10 but not 15) and <code>FALSE</code> otherwise.</p></li>
<li><p>Write a Boolean expression that is <code>TRUE</code> when a person is more than 12 years old and likes dogs, and <code>FALSE</code> otherwise.</p></li>
<li><p>Write a Boolean expression that is <code>TRUE</code> when a person is more than 12 years old and does not like dogs, and <code>FALSE</code> otherwise.</p></li>
<li><p>Write a Boolean expression that is <code>TRUE</code> when a person is more than 12 years old and or likes dogs, and <code>FALSE</code> otherwise.</p></li>
<li><p>Write a Boolean expression that is <code>TRUE</code> when the person is Dorothy, and <code>FALSE</code> otherwise.</p></li>
<li><p>Write a Boolean expression that is <code>TRUE</code> when the person is Dorothy or Tin Man, and <code>FALSE</code> otherwise.</p></li>
<li><p>Write a Boolean expression that is <code>TRUE</code> when the person’s name comes after the letter “M” in the alphabet, and <code>FALSE</code> otherwise.</p></li>
<li><p>Write a Boolean expression that is <code>FALSE</code> when the person is Dorothy, and <code>TRUE</code> otherwise.</p></li>
</ol>
</div>
<div id="solutions-to-practice-exercises-3" class="section level3">
<h3><span class="header-section-number">2.5.2</span> Solutions to Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Here’s the code:</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb260-1" data-line-number="1">age <span class="op">&lt;</span><span class="st"> </span><span class="dv">14</span></a></code></pre></div>
<pre><code>## [1]  TRUE  TRUE FALSE FALSE  TRUE</code></pre></li>
<li><p>Here’s the code:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb262-1" data-line-number="1">age <span class="op">&gt;=</span><span class="st"> </span><span class="dv">10</span> <span class="op">&amp;</span><span class="st"> </span>age <span class="op">&lt;</span><span class="st"> </span><span class="dv">15</span></a></code></pre></div>
<pre><code>## [1]  TRUE FALSE FALSE FALSE FALSE</code></pre></li>
<li><p>Here’s the code:</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb264-1" data-line-number="1">age <span class="op">&gt;</span><span class="st"> </span><span class="dv">12</span> <span class="op">&amp;</span><span class="st"> </span>likesDogs</a></code></pre></div>
<pre><code>## [1] FALSE FALSE  TRUE FALSE FALSE</code></pre></li>
<li><p>Here’s the code:</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb266-1" data-line-number="1">age <span class="op">&gt;</span><span class="st"> </span><span class="dv">12</span> <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span>likesDogs</a></code></pre></div>
<pre><code>## [1] FALSE FALSE FALSE  TRUE FALSE</code></pre></li>
<li><p>Here’s the code:</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb268-1" data-line-number="1">age <span class="op">&gt;</span><span class="st"> </span><span class="dv">12</span> <span class="op">|</span><span class="st"> </span>likesDogs</a></code></pre></div>
<pre><code>## [1]  TRUE FALSE  TRUE  TRUE  TRUE</code></pre></li>
<li><p>Here’s the code:</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb270-1" data-line-number="1">person <span class="op">==</span><span class="st"> &quot;Dorothy&quot;</span></a></code></pre></div>
<pre><code>## [1]  TRUE FALSE FALSE FALSE FALSE</code></pre></li>
<li><p>Here’s the code:</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb272-1" data-line-number="1">person <span class="op">==</span><span class="st"> &quot;Dorothy&quot;</span> <span class="op">|</span><span class="st"> </span>person <span class="op">==</span><span class="st"> &quot;Tin Man&quot;</span></a></code></pre></div>
<pre><code>## [1]  TRUE FALSE  TRUE FALSE FALSE</code></pre></li>
<li><p>Here’s the code:</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb274-1" data-line-number="1">person <span class="op">&gt;</span><span class="st"> &quot;M&quot;</span></a></code></pre></div>
<pre><code>## [1] FALSE  TRUE  TRUE FALSE  TRUE</code></pre></li>
<li><p>Here’s the code:</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb276-1" data-line-number="1">person <span class="op">!=</span><span class="st"> &quot;Dorothy&quot;</span></a></code></pre></div>
<pre><code>## [1] FALSE  TRUE  TRUE  TRUE  TRUE</code></pre></li>
</ol>
</div>
</div>
<div id="subsetting-with-logical-vectors" class="section level2">
<h2><span class="header-section-number">2.6</span> Subsetting with Logical Vectors</h2>
<p>The subsetting we have seen up to now involves specifying the <em>indices</em> of the elements we would like to select from the original vector. It is also possible to say, for each element, <em>whether or not it is to be included</em> in our selection. This is accomplished by means of logical vectors.</p>
<p>Recall our <code>heights</code> vector:</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb278-1" data-line-number="1">heights</a></code></pre></div>
<pre><code>## Scarecrow    Tinman      Lion   Dorothy      Toto       Boq 
##        73        70        69        60        NA        46</code></pre>
<p>Let’s say that we want the heights of Scarecrow, Tinman and Dorothy. We can use a logical vector to do this:</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb280-1" data-line-number="1">wanted &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb280-2" data-line-number="2">heights[wanted]</a></code></pre></div>
<pre><code>## Scarecrow    Tinman   Dorothy 
##        73        70        60</code></pre>
<p>The <code>TRUE</code>’s at indices 1, 2, and 4 in <code>wanted</code> inform R that we want the heights vector at indices 1, 2 and 4. The <code>FALSE</code>’s say: “don’t include this element!”</p>
<p>Subsetting can be used powerfully along with logical vectors and Boolean operators.</p>
<p>For example, in order to select those persons whose heights exceed a certain amount, we might say something like this:</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb282-1" data-line-number="1"><span class="co">#heights of some people:</span></a>
<a class="sourceLine" id="cb282-2" data-line-number="2">people &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">55</span>, <span class="dv">64</span>, <span class="dv">67</span>, <span class="dv">70</span>, <span class="dv">63</span>, <span class="dv">72</span>)</a>
<a class="sourceLine" id="cb282-3" data-line-number="3">tall &lt;-<span class="st"> </span>(people <span class="op">&gt;=</span><span class="st"> </span><span class="dv">70</span>)</a>
<a class="sourceLine" id="cb282-4" data-line-number="4">tall</a></code></pre></div>
<pre><code>## [1] FALSE FALSE FALSE  TRUE FALSE  TRUE</code></pre>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb284-1" data-line-number="1">people[tall]</a></code></pre></div>
<pre><code>## [1] 70 72</code></pre>
<p>As you can see, the <code>tall</code> vector specifies which elements we would like to select from the <code>people</code> vector.</p>
<p>We need not define the <code>tall</code> vector along the way. It is quite common to see something like the following:</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb286-1" data-line-number="1">people[people <span class="op">&gt;=</span><span class="st"> </span><span class="dv">70</span>]</a></code></pre></div>
<pre><code>## [1] 70 72</code></pre>
<p>I like to pronounce the above as:</p>
<blockquote>
<p><em><code>people</code>, where <code>people</code> is at least 70</em></p>
</blockquote>
<p>The word “where” in the above phrase corresponds to the subsetting operator.</p>
<p>Your subsetting logical vector need not have been constructed with the original vector in mind. Consider the following example:</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb288-1" data-line-number="1">age &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">23</span>, <span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">25</span>, <span class="dv">63</span>)</a>
<a class="sourceLine" id="cb288-2" data-line-number="2">height &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">68</span>, <span class="dv">67</span>, <span class="dv">71</span>, <span class="dv">70</span>, <span class="dv">69</span>)</a>
<a class="sourceLine" id="cb288-3" data-line-number="3">age[height <span class="op">&lt;</span><span class="st"> </span><span class="dv">70</span>]</a></code></pre></div>
<pre><code>## [1] 23 21 63</code></pre>
<p>Here the selection is done from the <code>age</code> vector, using a logical vector that was constructed from <code>height</code>—another vector altogether. It concisely expresses the idea:</p>
<blockquote>
<p><em>the ages of people whose height is less than 70</em></p>
</blockquote>
<p>There is no limit to the complexity of selection. Consider the following:</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb290-1" data-line-number="1">age &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">23</span>, <span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">25</span>, <span class="dv">63</span>)</a>
<a class="sourceLine" id="cb290-2" data-line-number="2">height &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">68</span>, <span class="dv">67</span>, <span class="dv">71</span>, <span class="dv">70</span>, <span class="dv">69</span>)</a>
<a class="sourceLine" id="cb290-3" data-line-number="3">likesToto &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb290-4" data-line-number="4">height[age <span class="op">&lt;</span><span class="st"> </span><span class="dv">60</span> <span class="op">&amp;</span><span class="st"> </span>likesToto]</a></code></pre></div>
<pre><code>## [1] 68 67</code></pre>
<div id="counting" class="section level3">
<h3><span class="header-section-number">2.6.1</span> Counting</h3>
<p>Logical subsetting provides a convenient way to <em>count</em> the elements of a vector that possess a given property. For example, to find out how many elements of <code>people</code> are less than 70 we could say:</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb292-1" data-line-number="1"><span class="kw">length</span>(people[people <span class="op">&lt;</span><span class="st"> </span><span class="dv">70</span>])</a></code></pre></div>
<pre><code>## [1] 4</code></pre>
</div>
<div id="cautions-about-na" class="section level3">
<h3><span class="header-section-number">2.6.2</span> Cautions about NA</h3>
<p>You should be aware of the effect of <code>NA</code>-values on subsetting.</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb294-1" data-line-number="1">heights</a></code></pre></div>
<pre><code>## Scarecrow    Tinman      Lion   Dorothy      Toto       Boq 
##        73        70        69        60        NA        46</code></pre>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb296-1" data-line-number="1">tall &lt;-<span class="st"> </span>(heights <span class="op">&gt;</span><span class="st"> </span><span class="dv">65</span>)</a>
<a class="sourceLine" id="cb296-2" data-line-number="2">tall</a></code></pre></div>
<pre><code>## Scarecrow    Tinman      Lion   Dorothy      Toto       Boq 
##      TRUE      TRUE      TRUE     FALSE        NA     FALSE</code></pre>
<p>Since Toto’s height was missing, R can’t say whether or not he was more than 65 inches tall. Hence it assigns <code>NA</code> to the Toto-element of the <code>tall</code> vector.</p>
<p>When we subset using this vector we get an odd result:</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb298-1" data-line-number="1">heights[tall]</a></code></pre></div>
<pre><code>## Scarecrow    Tinman      Lion      &lt;NA&gt; 
##        73        70        69        NA</code></pre>
<p>Since R doesn’t know whether or not to select Toto, it records its indecision by including an <code>NA</code> in the result. That <code>NA</code>, however, is not the <code>NA</code> for Toto’s height in the vector <code>heights</code>, so it can’t inherit the “Toto” name. Since it has no name, R presents its name as <code>&lt;NA&gt;</code>.</p>
<p>If we try to count the number of tall persons, we get a misleading result:</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb300-1" data-line-number="1"><span class="kw">length</span>(heights[tall])</a></code></pre></div>
<pre><code>## [1] 4</code></pre>
<p>We would have preferred something like:</p>
<blockquote>
<p>“Three, with another one undecided.”</p>
</blockquote>
<p>Counting is one those situations in which we might wish to remove <code>NA</code> values at the start. If the vector is small we could remove them by hand, e.g.:</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb302-1" data-line-number="1">knownHeights &lt;-<span class="st"> </span>heights[<span class="op">-</span><span class="dv">5</span>]  <span class="co"># remove Toto</span></a>
<a class="sourceLine" id="cb302-2" data-line-number="2">tall &lt;-<span class="st"> </span>(knownHeights <span class="op">&gt;</span><span class="st"> </span><span class="dv">65</span>)</a>
<a class="sourceLine" id="cb302-3" data-line-number="3"><span class="kw">length</span>(knownHeights[tall])</a></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>For longer vectors the above approach won’t be practical. Instead we may use the <code>is.na()</code> function.</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb304-1" data-line-number="1"><span class="kw">is.na</span>(heights)</a></code></pre></div>
<pre><code>## Scarecrow    Tinman      Lion   Dorothy      Toto       Boq 
##     FALSE     FALSE     FALSE     FALSE      TRUE     FALSE</code></pre>
<p>Then we may select those elements that are <em>not</em> <code>NA</code>:</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb306-1" data-line-number="1">knownHeights &lt;-<span class="st"> </span>heights[<span class="op">!</span><span class="kw">is.na</span>(heights)]</a>
<a class="sourceLine" id="cb306-2" data-line-number="2">knownHeights</a></code></pre></div>
<pre><code>## Scarecrow    Tinman      Lion   Dorothy       Boq 
##        73        70        69        60        46</code></pre>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb308-1" data-line-number="1"><span class="kw">length</span>(knownHeights[knownHeights <span class="op">&gt;</span><span class="st"> </span><span class="dv">65</span>])</a></code></pre></div>
<pre><code>## [1] 3</code></pre>
</div>
<div id="which-any-all" class="section level3">
<h3><span class="header-section-number">2.6.3</span> Which, Any, All</h3>
<p>There are several functions on logical vectors that are worth keeping in your back pocket:</p>
<ul>
<li><code>which()</code></li>
<li><code>any()</code></li>
<li><code>all()</code></li>
</ul>
<div id="which" class="section level4">
<h4><span class="header-section-number">2.6.3.1</span> <code>which()</code> </h4>
<p>Applied to a logical vector, the <code>which()</code> function returns the <em>indices</em> of the vector that have the value <code>TRUE</code>:</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb310-1" data-line-number="1">boolVec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>,<span class="ot">TRUE</span>,<span class="ot">FALSE</span>,<span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb310-2" data-line-number="2"><span class="kw">which</span>(boolVec)</a></code></pre></div>
<pre><code>## [1] 1 2 4</code></pre>
<p>Thus if we want to know the indices of <code>heights</code> where the heights are at least 65, then we write:</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb312-1" data-line-number="1"><span class="kw">which</span>(heights <span class="op">&gt;</span><span class="st"> </span><span class="dv">65</span>)</a></code></pre></div>
<pre><code>## Scarecrow    Tinman      Lion 
##         1         2         3</code></pre>
<p>(Recall that height was a named vector. The logical vector <code>heights &gt; 65</code> inherited these names and passed them on to the result of <code>whihc()</code>.)</p>
<p>Note also that Toto’s <code>NA</code> height was ignored by <code>which()</code>.</p>
</div>
<div id="any" class="section level4">
<h4><span class="header-section-number">2.6.3.2</span> <code>any()</code></h4>
<p>Is anyone more than 71 inches tall? <code>any()</code> will tell us:</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb314-1" data-line-number="1">heights</a></code></pre></div>
<pre><code>## Scarecrow    Tinman      Lion   Dorothy      Toto       Boq 
##        73        70        69        60        NA        46</code></pre>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb316-1" data-line-number="1"><span class="kw">any</span>(heights <span class="op">&gt;</span><span class="st"> </span><span class="dv">71</span>)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Yes: the Scarecrow is more than 71 inches tall.</p>
<p>We can use <code>any()</code> along with the equality Boolean operator <code>==</code> to determine whether or not a given value appears a a given vector:</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb318-1" data-line-number="1">vec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Dorothy&quot;</span>, <span class="st">&quot;Tin Man&quot;</span>, <span class="st">&quot;Scarecrow&quot;</span>, <span class="st">&quot;Glinda&quot;</span>)</a>
<a class="sourceLine" id="cb318-2" data-line-number="2"><span class="kw">any</span>(vec <span class="op">==</span><span class="st"> &quot;Tin Man&quot;</span>)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb320-1" data-line-number="1"><span class="kw">any</span>(vec <span class="op">==</span><span class="st"> &quot;Wizard&quot;</span>)</a></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>The above question occurs so frequently that R provides the <code>%in%</code> else if ( conditionN ) {
# code to run if conditionN evaluates to TRUE
}
```</p>
</div>
</div>
<div id="invisible-returns" class="section level3">
<h3><span class="header-section-number">2.6.4</span> Application: Invisible Returns</h3>
<p>Let’s think again about the <span class="math inline">\(\pi\)</span>-computing function from Section @ref(default-arguments):</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb322-1" data-line-number="1">madhavaPI &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">n =</span> <span class="dv">1000000</span>) {</a>
<a class="sourceLine" id="cb322-2" data-line-number="2">  k &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span>n</a>
<a class="sourceLine" id="cb322-3" data-line-number="3">  terms &lt;-<span class="st"> </span>(<span class="op">-</span><span class="dv">1</span>)<span class="op">^</span>(k<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span><span class="dv">4</span><span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>k<span class="dv">-1</span>)</a>
<a class="sourceLine" id="cb322-4" data-line-number="4">  <span class="kw">sum</span>(terms)</a>
<a class="sourceLine" id="cb322-5" data-line-number="5">}</a></code></pre></div>
<p>We could use <code>if</code> to write in a “talky” option:</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb323-1" data-line-number="1">madhavaPI &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">n =</span> <span class="dv">1000000</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb323-2" data-line-number="2">  k &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span>n</a>
<a class="sourceLine" id="cb323-3" data-line-number="3">  terms &lt;-<span class="st"> </span>(<span class="op">-</span><span class="dv">1</span>)<span class="op">^</span>(k<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span><span class="dv">4</span><span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>k<span class="dv">-1</span>)</a>
<a class="sourceLine" id="cb323-4" data-line-number="4">  approx &lt;-<span class="st"> </span><span class="kw">sum</span>(terms)</a>
<a class="sourceLine" id="cb323-5" data-line-number="5">  <span class="cf">if</span> ( verbose) {</a>
<a class="sourceLine" id="cb323-6" data-line-number="6">    <span class="kw">cat</span>(<span class="st">&quot;Madhava&#39;s approximation is:  &quot;</span>, approx, <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb323-7" data-line-number="7">    <span class="kw">cat</span>(<span class="st">&quot;This is based on &quot;</span>, n, <span class="st">&quot; terms.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb323-8" data-line-number="8">  }</a>
<a class="sourceLine" id="cb323-9" data-line-number="9">  approx</a>
<a class="sourceLine" id="cb323-10" data-line-number="10">}</a></code></pre></div>
<p>Try it out:</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb324-1" data-line-number="1"><span class="kw">madhavaPI</span>(<span class="dt">n =</span> <span class="dv">1000</span>, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## Madhava&#39;s approximation is:  3.140593.
## This is based on 1000 terms.</code></pre>
<pre><code>## [1] 3.140593</code></pre>
<p>It’s a bit awkward that the approximation gets printed out at the end: after the message on the console, the user doesn’t need to see it. But if we were to remove the final <code>approx</code> expression, then the function would not return an approximation that could be used for further computations.</p>
<p>The solution to this dilemma is R’s <code>invisible()</code> function. </p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb327-1" data-line-number="1">madhavaPI &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">n =</span> <span class="dv">1000000</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb327-2" data-line-number="2">  k &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span>n</a>
<a class="sourceLine" id="cb327-3" data-line-number="3">  terms &lt;-<span class="st"> </span>(<span class="op">-</span><span class="dv">1</span>)<span class="op">^</span>(k<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span><span class="dv">4</span><span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>k<span class="dv">-1</span>)</a>
<a class="sourceLine" id="cb327-4" data-line-number="4">  approx &lt;-<span class="st"> </span><span class="kw">sum</span>(terms)</a>
<a class="sourceLine" id="cb327-5" data-line-number="5">  <span class="cf">if</span> ( verbose) {</a>
<a class="sourceLine" id="cb327-6" data-line-number="6">    <span class="kw">cat</span>(<span class="st">&quot;Madhava&#39;s approximation is:  &quot;</span>, approx, <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb327-7" data-line-number="7">    <span class="kw">cat</span>(<span class="st">&quot;This is based on &quot;</span>, n, <span class="st">&quot; terms.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb327-8" data-line-number="8">  }</a>
<a class="sourceLine" id="cb327-9" data-line-number="9">  <span class="kw">invisible</span>(approx)</a>
<a class="sourceLine" id="cb327-10" data-line-number="10">}</a></code></pre></div>
<p>If you wrap an expression in <code>invisible()</code>, then it won’t be printed out to the console:</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb328-1" data-line-number="1"><span class="kw">madhavaPI</span>(<span class="dt">n =</span> <span class="dv">1000</span>, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## Madhava&#39;s approximation is:  3.140593.
## This is based on 1000 terms.</code></pre>
<p>Nevertheless it is still returned, as we can see from the following code, in which the approximation is computed without any output to the console and stored in the variable <code>p</code> for use later on in a <code>cat()</code> statement.</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb330-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="kw">madhavaPI</span>() <span class="co"># verbose is FALSE by default</span></a>
<a class="sourceLine" id="cb330-2" data-line-number="2"><span class="kw">cat</span>(<span class="st">&quot;Pi plus 10 is about &quot;</span>, p <span class="op">+</span><span class="st"> </span><span class="dv">10</span>, <span class="st">&quot;.&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## Pi plus 10 is about 13.14159.</code></pre>
</div>
<div id="ifelse" class="section level3">
<h3><span class="header-section-number">2.6.5</span> Ifelse</h3>
<p>The <code>ifelse()</code> function is a special form of the if-else construct that is used to make assignments, and is especially handy in the context of vectorization.</p>
<p>Suppose that you have a lot of heights:</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb332-1" data-line-number="1">height &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">69</span>, <span class="dv">67</span>, <span class="dv">70</span>, <span class="dv">72</span>, <span class="dv">65</span>, <span class="dv">63</span>, <span class="dv">75</span>, <span class="dv">70</span>)</a></code></pre></div>
<p>You would like to classify each person as either “tall” or “short”, depending on whether they are respectively more or less than 71 inches in height. <code>ifelse()</code> makes quick work of it:</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb333-1" data-line-number="1">heightClass &lt;-<span class="st"> </span><span class="kw">ifelse</span>(<span class="dt">test =</span> height <span class="op">&gt;</span><span class="st"> </span><span class="dv">70</span>, </a>
<a class="sourceLine" id="cb333-2" data-line-number="2">                      <span class="dt">yes =</span> <span class="st">&quot;tall&quot;</span>, <span class="dt">no =</span> <span class="st">&quot;short&quot;</span>)</a>
<a class="sourceLine" id="cb333-3" data-line-number="3">heightClass</a></code></pre></div>
<pre><code>## [1] &quot;short&quot; &quot;short&quot; &quot;short&quot; &quot;tall&quot;  &quot;short&quot; &quot;short&quot; &quot;tall&quot;  &quot;short&quot;</code></pre>
<p>Note that <code>ifelse()</code> takes three parameters:</p>
<ul>
<li><code>test</code>: the condition you want to evaluate;</li>
<li><code>yes</code>: the value that gets assigned when <code>test</code> is true;</li>
<li><code>no</code>: the value assigned when <code>test</code> is false;</li>
</ul>
<p>Most programmers don’t name the parameters. This is fine—just remember to keep the test-yes-no order:</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb335-1" data-line-number="1"><span class="kw">ifelse</span>(height <span class="op">&gt;</span><span class="st"> </span><span class="dv">70</span>, <span class="st">&quot;tall&quot;</span>, <span class="st">&quot;short&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;short&quot; &quot;short&quot; &quot;short&quot; &quot;tall&quot;  &quot;short&quot; &quot;short&quot; &quot;tall&quot;  &quot;short&quot;</code></pre>
<p>Here’s another example of the power of <code>ifelese()</code>. If a triangle has three sides of length <span class="math inline">\(x\)</span>, <span class="math inline">\(y\)</span> and <span class="math inline">\(z\)</span>, then the sum of any two sides must be greater than the remaining side:</p>
<p><span class="math display">\[\begin{aligned}
x + y &amp;&gt; z, \\
x + z &amp;&gt; y, \\
y + z &amp;&gt; x.
\end{aligned}\]</span>
This fact is known as the <em>Triangle Inequality</em>. It works the other way around, too: if three positive numbers are such that the sum of any two exceeds the third, then three line segments having those numbers as lengths could be arranged into a triangle.</p>
<p>We can write a function that, when given three lengths, determines whether or not they can make a triangle:</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb337-1" data-line-number="1">isTriangle &lt;-<span class="st"> </span><span class="cf">function</span>(x, y, z) {</a>
<a class="sourceLine" id="cb337-2" data-line-number="2">  (x <span class="op">+</span><span class="st"> </span>y <span class="op">&gt;</span><span class="st"> </span>z) <span class="op">&amp;</span><span class="st"> </span>(x <span class="op">+</span>z <span class="op">&gt;</span><span class="st"> </span>y) <span class="op">&amp;</span><span class="st"> </span>(y <span class="op">+</span><span class="st"> </span>z <span class="op">&gt;</span><span class="st"> </span>x)</a>
<a class="sourceLine" id="cb337-3" data-line-number="3">}</a></code></pre></div>
<p><code>isTriangle()</code> simply evaluates a Boolean expression involving <code>x</code>, <code>y</code> and <code>z</code>. It will return <code>TRUE</code> when the three quantities satisfy the Triangle Inequality; otherwise, it returns <code>FALSE</code>. Let’s try it out:</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb338-1" data-line-number="1"><span class="kw">isTriangle</span>(<span class="dt">x =</span> <span class="dv">3</span>, <span class="dt">y =</span> <span class="dv">4</span>, <span class="dt">z =</span> <span class="dv">5</span>)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Recall that Boolean expressions can involve vectors of any length. So suppose that we are would like to know which of the following six triples of numbers could be the side-lengths of a triangle:</p>
<p><span class="math display">\[(2,4,5),(4.7,1,3.8),(5.2,8,12),\\
(6, 6, 13), (6, 6, 11), (9, 3.5, 6.2)\]</span>
We could enter the triples one at a time into <code>isTriangle()</code>. On the other hand we could arrange the sides into three vectors of length six each:</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb340-1" data-line-number="1">a &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="fl">4.7</span>, <span class="fl">5.2</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">9</span>)</a>
<a class="sourceLine" id="cb340-2" data-line-number="2">b &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">1</span>, <span class="fl">2.8</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="fl">3.5</span>)</a>
<a class="sourceLine" id="cb340-3" data-line-number="3">c &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>, <span class="fl">3.8</span>, <span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">11</span>, <span class="fl">6.2</span>)</a></code></pre></div>
<p>Then we can decide about all six triples at once:</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb341-1" data-line-number="1"><span class="kw">isTriangle</span>(<span class="dt">x =</span> a, <span class="dt">y =</span> b, <span class="dt">z =</span> c)</a></code></pre></div>
<pre><code>## [1]  TRUE  TRUE FALSE FALSE  TRUE  TRUE</code></pre>
<p>We could also use <code>ifelse()</code> to create a new character-vector that expresses our results verbally:</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb343-1" data-line-number="1">triangle &lt;-<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">isTriangle</span>(a, b, c), <span class="st">&quot;triangle&quot;</span>, <span class="st">&quot;not&quot;</span>)</a>
<a class="sourceLine" id="cb343-2" data-line-number="2">triangle</a></code></pre></div>
<pre><code>## [1] &quot;triangle&quot; &quot;triangle&quot; &quot;not&quot;      &quot;not&quot;      &quot;triangle&quot; &quot;triangle&quot;</code></pre>
</div>
<div id="switch" class="section level3">
<h3><span class="header-section-number">2.6.6</span> Switch</h3>
<p>If you have to make a decision involving two or more alternatives you can use a chain of <code>if ... else</code> constructions. When the alternatives involve no more than the assignment of a value to a variable, you might also consider using the <code>switch()</code> function.</p>
<p>For example, suppose that you have days of the week expressed as numbers. Maybe it’s like this:</p>
<ul>
<li>1 stands for Sunday</li>
<li>2 for Monday</li>
<li>3 for Wednesday</li>
<li>and so on.</li>
</ul>
<p>If you would like to convert a day-number to the right day name, then you could write a function like this:</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb345-1" data-line-number="1">dayWord &lt;-<span class="st"> </span><span class="cf">function</span>(dayNumber) {</a>
<a class="sourceLine" id="cb345-2" data-line-number="2">  <span class="cf">switch</span>(dayNumber,</a>
<a class="sourceLine" id="cb345-3" data-line-number="3">         <span class="st">&quot;Sunday&quot;</span>,</a>
<a class="sourceLine" id="cb345-4" data-line-number="4">         <span class="st">&quot;Monday&quot;</span>,</a>
<a class="sourceLine" id="cb345-5" data-line-number="5">         <span class="st">&quot;Tuesday&quot;</span>,</a>
<a class="sourceLine" id="cb345-6" data-line-number="6">         <span class="st">&quot;Wednesday&quot;</span>,</a>
<a class="sourceLine" id="cb345-7" data-line-number="7">         <span class="st">&quot;Thursday&quot;</span>,</a>
<a class="sourceLine" id="cb345-8" data-line-number="8">         <span class="st">&quot;Friday&quot;</span>,</a>
<a class="sourceLine" id="cb345-9" data-line-number="9">         <span class="st">&quot;Saturday&quot;</span>)</a>
<a class="sourceLine" id="cb345-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb345-11" data-line-number="11"><span class="kw">dayWord</span>(<span class="dv">3</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Tuesday&quot;</code></pre>
<p>In <code>switch()</code> above, the first argument after <code>dayNumber</code> is what goes with 1, the second argument is what goes with 2, and so on.</p>
<p>When the item you want to convert is a string rather than a number, then the <code>switch()</code> function works a little bit differently. Suppose, for instance, that you want to <em>abbreviate</em> the names of the weekdays. You might write an abbreviation-function as follows:</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb347-1" data-line-number="1">abbrDay &lt;-<span class="st"> </span><span class="cf">function</span>(day) {</a>
<a class="sourceLine" id="cb347-2" data-line-number="2">  <span class="cf">switch</span>(day,</a>
<a class="sourceLine" id="cb347-3" data-line-number="3">         <span class="dt">Monday =</span> <span class="st">&quot;Mon&quot;</span>,</a>
<a class="sourceLine" id="cb347-4" data-line-number="4">         <span class="dt">Tuesday =</span> <span class="st">&quot;Tue&quot;</span>,</a>
<a class="sourceLine" id="cb347-5" data-line-number="5">         <span class="dt">Wednesday =</span> <span class="st">&quot;Wed&quot;</span>,</a>
<a class="sourceLine" id="cb347-6" data-line-number="6">         <span class="dt">Thursday =</span> <span class="st">&quot;Th&quot;</span>,</a>
<a class="sourceLine" id="cb347-7" data-line-number="7">         <span class="dt">Friday =</span> <span class="st">&quot;Fri&quot;</span>,</a>
<a class="sourceLine" id="cb347-8" data-line-number="8">         <span class="dt">Saturday =</span> <span class="st">&quot;Sat&quot;</span>)</a>
<a class="sourceLine" id="cb347-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb347-10" data-line-number="10"><span class="kw">abbrDay</span>(<span class="st">&quot;Wednesday&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Wed&quot;</code></pre>
<p>In the above call to <code>switch()</code>, the weekday names you want to abbreviate appear as the names of named character-vectors, each of length one. The value of each vector is what the its name will be converted to.</p>
<p>When you are converting strings you have the option to provide a default conversion for values that don’t fit into the pattern you have in mind. All you have to do is to provide the default value as an additional argument. (It should NOT have a name.) Thus:</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb349-1" data-line-number="1">abbrDay &lt;-<span class="st"> </span><span class="cf">function</span>(day) {</a>
<a class="sourceLine" id="cb349-2" data-line-number="2">  <span class="cf">switch</span>(day,</a>
<a class="sourceLine" id="cb349-3" data-line-number="3">         <span class="dt">Monday =</span> <span class="st">&quot;Mon&quot;</span>,</a>
<a class="sourceLine" id="cb349-4" data-line-number="4">         <span class="dt">Tuesday =</span> <span class="st">&quot;Tue&quot;</span>,</a>
<a class="sourceLine" id="cb349-5" data-line-number="5">         <span class="dt">Wednesday =</span> <span class="st">&quot;Wed&quot;</span>,</a>
<a class="sourceLine" id="cb349-6" data-line-number="6">         <span class="dt">Thursday =</span> <span class="st">&quot;Th&quot;</span>,</a>
<a class="sourceLine" id="cb349-7" data-line-number="7">         <span class="dt">Friday =</span> <span class="st">&quot;Fri&quot;</span>,</a>
<a class="sourceLine" id="cb349-8" data-line-number="8">         <span class="dt">Saturday =</span> <span class="st">&quot;Sat&quot;</span>,</a>
<a class="sourceLine" id="cb349-9" data-line-number="9">         <span class="st">&quot;not a weekday!&quot;</span>)</a>
<a class="sourceLine" id="cb349-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb349-11" data-line-number="11"><span class="kw">abbrDay</span>(<span class="st">&quot;Wednesday&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Wed&quot;</code></pre>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb351-1" data-line-number="1"><span class="kw">abbrDay</span>(<span class="st">&quot;Neptune&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;not a weekday!&quot;</code></pre>
</div>
<div id="practice-exercises-4" class="section level3">
<h3><span class="header-section-number">2.6.7</span> Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Consider the following function:</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb353-1" data-line-number="1">computeSquare &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb353-2" data-line-number="2">  x<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb353-3" data-line-number="3">}</a></code></pre></div>
<p>Write a “talky” version of the above function that returns the square invisibly.. It should be called <code>computeSquare2()</code> and should take two parameters:</p>
<ul>
<li><code>x</code>: the number to be squared</li>
<li><code>verbose</code>: whether or not to <code>cat()</code> out a report to the Console.</li>
</ul>
<p>Typical examples of use would be:</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb354-1" data-line-number="1"><span class="kw">computeSquare2</span>(<span class="dv">4</span>)</a></code></pre></div>
<pre><code>## The square of 4 is 16.</code></pre>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb356-1" data-line-number="1">mySquare &lt;-<span class="st"> </span><span class="kw">computeSquare2</span>(<span class="dv">6</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb356-2" data-line-number="2">mySquare</a></code></pre></div>
<pre><code>## [1] 36</code></pre></li>
<li><p>Write a function called <code>findKarl()</code> that takes a character vector and returns a character vector that reports whether or not each element of the given vector was equal to the string <code>&quot;Karl&quot;</code>. It should work like this:</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb358-1" data-line-number="1">vec1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;three&quot;</span>, <span class="st">&quot;blowfish&quot;</span>, <span class="st">&quot;Karl&quot;</span>, <span class="st">&quot;Grindel&quot;</span>)</a>
<a class="sourceLine" id="cb358-2" data-line-number="2"><span class="kw">findKarl</span>(vec1)</a></code></pre></div>
<pre><code>## [1] &quot;Sorry, not our guy.&quot; &quot;Sorry, not our guy.&quot; &quot;Yep, that&#39;s Karl!&quot;  
## [4] &quot;Sorry, not our guy.&quot;</code></pre></li>
<li><p>Here’s a function that is supposed to return <code>&quot;small!&quot;</code> when given a number less than 100, and return <code>&quot;big!&quot;</code> when the number if at least 100:</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb360-1" data-line-number="1">sizeComment &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb360-2" data-line-number="2">  <span class="cf">if</span> ( x <span class="op">&lt;</span><span class="st"> </span><span class="dv">100</span> ) {</a>
<a class="sourceLine" id="cb360-3" data-line-number="3">    <span class="st">&quot;small!&quot;</span></a>
<a class="sourceLine" id="cb360-4" data-line-number="4">  }</a>
<a class="sourceLine" id="cb360-5" data-line-number="5">  <span class="st">&quot;big!&quot;</span></a>
<a class="sourceLine" id="cb360-6" data-line-number="6">}</a></code></pre></div>
<p>But it doesn’t work:</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb361-1" data-line-number="1"><span class="kw">sizeComment</span>(<span class="dv">200</span>)  <span class="co"># this will be OK</span></a></code></pre></div>
<pre><code>## [1] &quot;big!&quot;</code></pre>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb363-1" data-line-number="1"><span class="kw">sizeComment</span>(<span class="dv">50</span>)   <span class="co"># this won&#39;t be OK</span></a></code></pre></div>
<pre><code>## [1] &quot;big!&quot;</code></pre>
<p>Fix the code.</p></li>
</ol>
</div>
<div id="solutions-to-practice-exercises-4" class="section level3">
<h3><span class="header-section-number">2.6.8</span> Solutions to Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Here’s the desired function:</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb365-1" data-line-number="1">computeSquare2 &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">verbose =</span> <span class="ot">TRUE</span>) {</a>
<a class="sourceLine" id="cb365-2" data-line-number="2">  <span class="cf">if</span> ( verbose ) {</a>
<a class="sourceLine" id="cb365-3" data-line-number="3">    <span class="kw">cat</span>(<span class="st">&quot;The square of &quot;</span>, x, <span class="st">&quot; is &quot;</span>, x<span class="op">^</span><span class="dv">2</span>, <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb365-4" data-line-number="4">  }</a>
<a class="sourceLine" id="cb365-5" data-line-number="5">  <span class="kw">invisible</span>(x<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb365-6" data-line-number="6">}</a></code></pre></div></li>
<li><p>Here’s one way to write it:</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb366-1" data-line-number="1">findKarl &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb366-2" data-line-number="2">  <span class="kw">ifelse</span>(x <span class="op">==</span><span class="st"> &quot;Karl&quot;</span>,</a>
<a class="sourceLine" id="cb366-3" data-line-number="3">         <span class="st">&quot;Yep, that&#39;s Karl!&quot;</span>,</a>
<a class="sourceLine" id="cb366-4" data-line-number="4">         <span class="st">&quot;Sorry, not our guy.&quot;</span>)</a>
<a class="sourceLine" id="cb366-5" data-line-number="5">}</a></code></pre></div></li>
<li><p>A function always returns the value of the last expression that it evaluates. As it stands, the function will always end at the line <code>&quot;big!&quot;</code>, so <code>&quot;big&quot;</code> will always be returned. One way to get the desired behavior is to force the function to stop executing once it prints out <code>&quot;small!&quot;</code>. You can do this with the <code>return()</code> function:</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb367-1" data-line-number="1">sizeComment &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb367-2" data-line-number="2">  <span class="cf">if</span> ( x <span class="op">&lt;</span><span class="st"> </span><span class="dv">100</span> ) {</a>
<a class="sourceLine" id="cb367-3" data-line-number="3">    <span class="kw">return</span>(<span class="st">&quot;small!&quot;</span>)</a>
<a class="sourceLine" id="cb367-4" data-line-number="4">  }</a>
<a class="sourceLine" id="cb367-5" data-line-number="5">  <span class="st">&quot;big!&quot;</span></a>
<a class="sourceLine" id="cb367-6" data-line-number="6">}</a></code></pre></div>
<p>Another way is to use the <code>if ... else</code> construction:</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb368-1" data-line-number="1">sizeComment &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb368-2" data-line-number="2">  <span class="cf">if</span> ( x <span class="op">&lt;</span><span class="st"> </span><span class="dv">100</span> ) {</a>
<a class="sourceLine" id="cb368-3" data-line-number="3">    <span class="st">&quot;small!&quot;</span></a>
<a class="sourceLine" id="cb368-4" data-line-number="4">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb368-5" data-line-number="5">    <span class="st">&quot;big!&quot;</span></a>
<a class="sourceLine" id="cb368-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb368-7" data-line-number="7">}</a></code></pre></div></li>
</ol>
</div>
</div>
<div id="repeating-things-looping" class="section level2">
<h2><span class="header-section-number">2.7</span> Repeating Things: Looping</h2>
<p>We have looked a bit into the aspect of flow control that pertains to making decisions. Let us now turn to the R-constructs that make the computer repeat actions.</p>
<div id="for-loops" class="section level3">
<h3><span class="header-section-number">2.7.1</span> For Loops</h3>
<p></p>
<p>The reserved word <code>for</code> is used to make R repeat an action a specified number of times.</p>
<p>We begin with an very simple example:</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb369-1" data-line-number="1"><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span> ) {</a>
<a class="sourceLine" id="cb369-2" data-line-number="2">  <span class="kw">cat</span>(<span class="st">&quot;Hello, Dorothy!</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb369-3" data-line-number="3">}</a></code></pre></div>
<pre><code>## Hello, Dorothy!
## Hello, Dorothy!
## Hello, Dorothy!
## Hello, Dorothy!</code></pre>
<p>Here’s how the loop works. Recall that the vector <code>1:4</code> is simply the sequence of integers from 1 to 4:</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb371-1" data-line-number="1"><span class="dv">1</span><span class="op">:</span><span class="dv">4</span></a></code></pre></div>
<pre><code>## [1] 1 2 3 4</code></pre>
<p>When R sees the code <code>(i in 1:4)</code> it knows that it will have to go four times through the body of the loop.</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb373-1" data-line-number="1"><span class="kw">cat</span>(<span class="st">&quot;Hello, Dorothy!</span><span class="ch">\n</span><span class="st">&quot;</span>)</a></code></pre></div>
<p>(The <em>body</em> of a loop is what’s contained in the brackets after <code>for(i in 1:4)</code>). At the start of the loop, the <em>index variable</em> <code>i</code> is set to 1. After the body is executed the first time, R sets <code>i</code> to 2, then executes the body again. Then R sets <code>i</code> to 3 and executes the body yet again. Then R sets <code>i</code> to 4, and executes the body for the final time. The result is four lines printed out to the console.</p>
<p>The more you need to repeat a particular pattern, the more it makes sense to write your code with a loop.</p>
<p>The general form of a loop is:</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb374-1" data-line-number="1"><span class="cf">for</span> ( var <span class="cf">in</span> seq ) {</a>
<a class="sourceLine" id="cb374-2" data-line-number="2">  <span class="co"># code involving var</span></a>
<a class="sourceLine" id="cb374-3" data-line-number="3">}</a></code></pre></div>
<p><code>var</code> is the index variable, and it can be any permitted name for a variable, and <code>seq</code> can be any vector. As R traverses the loop, the value of the index variable <code>var</code> becomes each element of the vector <code>seq</code> in turn. With every change in the value of <code>var</code>, the code in the brackets is executed.</p>
<p>To <em>iterate</em> is to do a thing again and again. The vector <code>seq</code> is sometimes called an <em>iterable</em>, since it is “iterated over.” It contains the values that the index variable will assume, one by one, as the loop is repeated. </p>
<p>It’s important to realize that the index variable can have <em>any</em> valid name, and the sequence can be any type of vector at all—not just a sequence of consecutive whole numbers beginning with 1. This level of generality permits a for-loop to automate a wide variety of tasks, and for its code to be written in a way that evokes the operations being performed.</p>
<p>For example, here is a loop to print out some greetings;</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb375-1" data-line-number="1">people &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Dorothy&quot;</span>, <span class="st">&quot;Tin Man&quot;</span>, <span class="st">&quot;Scarecrow&quot;</span>, <span class="st">&quot;Lion&quot;</span>)</a>
<a class="sourceLine" id="cb375-2" data-line-number="2"><span class="cf">for</span> ( person <span class="cf">in</span> people ) {</a>
<a class="sourceLine" id="cb375-3" data-line-number="3">  <span class="kw">cat</span>(<span class="st">&quot;Hello, &quot;</span>, person, <span class="st">&quot;!</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb375-4" data-line-number="4">}</a></code></pre></div>
<pre><code>## Hello, Dorothy!
## Hello, Tin Man!
## Hello, Scarecrow!
## Hello, Lion!</code></pre>
<p>Or perhaps you want to abbreviate a vector-ful of weekday-names:</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb377-1" data-line-number="1">weekdays &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Saturday&quot;</span>, <span class="st">&quot;Monday&quot;</span>, <span class="st">&quot;Friday&quot;</span>, <span class="st">&quot;Saturday&quot;</span>)</a>
<a class="sourceLine" id="cb377-2" data-line-number="2"><span class="cf">for</span> ( day <span class="cf">in</span> weekdays ) {</a>
<a class="sourceLine" id="cb377-3" data-line-number="3">  <span class="kw">print</span>(<span class="kw">abbrDay</span>(day))</a>
<a class="sourceLine" id="cb377-4" data-line-number="4">}</a></code></pre></div>
<pre><code>## [1] &quot;Sat&quot;
## [1] &quot;Mon&quot;
## [1] &quot;Fri&quot;
## [1] &quot;Sat&quot;</code></pre>
<p>Quite often you will want to store the results of your trips through the loop. Let’s do this for our abbreviated weekdays:</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb379-1" data-line-number="1">weekdays &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Saturday&quot;</span>, <span class="st">&quot;Monday&quot;</span>, <span class="st">&quot;Friday&quot;</span>, <span class="st">&quot;Saturday&quot;</span>)</a>
<a class="sourceLine" id="cb379-2" data-line-number="2">abbrDays &lt;-<span class="st"> </span><span class="kw">character</span>(<span class="kw">length</span>(weekdays))</a></code></pre></div>
<p>We used the <code>character()</code> function  to create the character vector <code>abbrDays</code>. We specified that the number of elements in <code>abbrDays</code> shall be the same as the number of elements in <code>weekdays</code>. Right now <code>abbrDays</code> isn’t very interesting, as all of its elements are empty strings:</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb380-1" data-line-number="1">abbrDays</a></code></pre></div>
<pre><code>## [1] &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot;</code></pre>
<p>We will now write a for-loop to fill it up with abbreviations:</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb382-1" data-line-number="1"><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(weekdays) ) {</a>
<a class="sourceLine" id="cb382-2" data-line-number="2">  abbrDays[i] &lt;-<span class="st"> </span><span class="kw">abbrDay</span>(weekdays[i])</a>
<a class="sourceLine" id="cb382-3" data-line-number="3">}</a></code></pre></div>
<p>Now each of the four elements of <code>abbrDays</code> contains the abbreviation for the corresponding element of <code>weekdays</code>:</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb383-1" data-line-number="1">abbrDays</a></code></pre></div>
<pre><code>## [1] &quot;Sat&quot; &quot;Mon&quot; &quot;Fri&quot; &quot;Sat&quot;</code></pre>
<p>You will often have reason to set up an empty vector of a definite length and use a loop to store information in it. The general format looks like this:</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb385-1" data-line-number="1">results &lt;-<span class="st"> </span><span class="kw">numeric</span>(someLength) <span class="co"># empty numerical vector</span></a>
<a class="sourceLine" id="cb385-2" data-line-number="2"></a>
<a class="sourceLine" id="cb385-3" data-line-number="3"><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>someLength ) {</a>
<a class="sourceLine" id="cb385-4" data-line-number="4">  <span class="co"># computations involving i, and then:</span></a>
<a class="sourceLine" id="cb385-5" data-line-number="5">  results[i] &lt;-<span class="st"> </span>some_result_depending_on_i</a>
<a class="sourceLine" id="cb385-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb385-7" data-line-number="7"></a>
<a class="sourceLine" id="cb385-8" data-line-number="8"><span class="co"># then do something with results, such as:</span></a>
<a class="sourceLine" id="cb385-9" data-line-number="9"><span class="kw">print</span>(results)</a></code></pre></div>
</div>
<div id="for-loop-caution" class="section level3">
<h3><span class="header-section-number">2.7.2</span> For-Loop Caution</h3>
<p>You might need to exercise some caution in your choice name for the index variable. If you are already using it as the name for a variable in the same environment, then you will overwrite that variable, as demonstrated by the following code:</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb386-1" data-line-number="1">day &lt;-<span class="st"> &quot;Thursday&quot;</span></a>
<a class="sourceLine" id="cb386-2" data-line-number="2"><span class="kw">cat</span>(<span class="st">&quot;Today is &quot;</span>, day, <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## Today is Thursday.</code></pre>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb388-1" data-line-number="1">weekdays &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Saturday&quot;</span>, <span class="st">&quot;Monday&quot;</span>, <span class="st">&quot;Friday&quot;</span>, <span class="st">&quot;Saturday&quot;</span>)</a>
<a class="sourceLine" id="cb388-2" data-line-number="2">abbrDays &lt;-<span class="st"> </span><span class="kw">character</span>(<span class="kw">length</span>(weekdays))</a>
<a class="sourceLine" id="cb388-3" data-line-number="3"><span class="cf">for</span> ( day <span class="cf">in</span> weekdays ) {</a>
<a class="sourceLine" id="cb388-4" data-line-number="4">  <span class="kw">print</span>(day)</a>
<a class="sourceLine" id="cb388-5" data-line-number="5">}</a></code></pre></div>
<pre><code>## [1] &quot;Saturday&quot;
## [1] &quot;Monday&quot;
## [1] &quot;Friday&quot;
## [1] &quot;Saturday&quot;</code></pre>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb390-1" data-line-number="1"><span class="kw">cat</span>(<span class="st">&quot;Today is &quot;</span>, day, <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## Today is Saturday.</code></pre>
<p>Of course, that won’t happen if the for-loop is inside of a function and your variable is outside of it.</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb392-1" data-line-number="1">day &lt;-<span class="st"> &quot;Thursday&quot;</span></a>
<a class="sourceLine" id="cb392-2" data-line-number="2"><span class="kw">cat</span>(<span class="st">&quot;Today is &quot;</span>, day, <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## Today is Thursday.</code></pre>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb394-1" data-line-number="1">weekdays &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Saturday&quot;</span>, <span class="st">&quot;Monday&quot;</span>, <span class="st">&quot;Friday&quot;</span>, <span class="st">&quot;Saturday&quot;</span>)</a>
<a class="sourceLine" id="cb394-2" data-line-number="2">listDays &lt;-<span class="st"> </span><span class="cf">function</span>(days) {</a>
<a class="sourceLine" id="cb394-3" data-line-number="3">  <span class="cf">for</span> ( day <span class="cf">in</span> days )    {</a>
<a class="sourceLine" id="cb394-4" data-line-number="4">    <span class="kw">print</span>(day)</a>
<a class="sourceLine" id="cb394-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb394-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb394-7" data-line-number="7"><span class="kw">listDays</span>(weekdays)</a></code></pre></div>
<pre><code>## [1] &quot;Saturday&quot;
## [1] &quot;Monday&quot;
## [1] &quot;Friday&quot;
## [1] &quot;Saturday&quot;</code></pre>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb396-1" data-line-number="1"><span class="kw">cat</span>(<span class="st">&quot;Today is still &quot;</span>, day, <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## Today is still Thursday.</code></pre>
</div>
<div id="breaking-out-of-a-loop" class="section level3">
<h3><span class="header-section-number">2.7.3</span> Breaking Out of a Loop</h3>
<p>Sometimes you finish the task at hand before you are done with the loop. If this is a possibility for you then you may arrange to break out of the loop with the <code>break</code> reserved-word.</p>
<p>Suppose for example that you want a function that searches through a vector for a given element, updating the user along the way as to the progress of the search. You can try something like this:</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb398-1" data-line-number="1"><span class="co"># function to find index of element in vector.</span></a>
<a class="sourceLine" id="cb398-2" data-line-number="2"><span class="co"># returns -1 if elem is not in vector</span></a>
<a class="sourceLine" id="cb398-3" data-line-number="3">verboseSearch &lt;-<span class="st"> </span><span class="cf">function</span>(elem, vec) {</a>
<a class="sourceLine" id="cb398-4" data-line-number="4">  </a>
<a class="sourceLine" id="cb398-5" data-line-number="5">  <span class="co"># The following logical keeps track of whether</span></a>
<a class="sourceLine" id="cb398-6" data-line-number="6">  <span class="co"># we have found the element.</span></a>
<a class="sourceLine" id="cb398-7" data-line-number="7">  <span class="co"># We have not yet begun the search so start it</span></a>
<a class="sourceLine" id="cb398-8" data-line-number="8">  <span class="co"># at FALSE.</span></a>
<a class="sourceLine" id="cb398-9" data-line-number="9">  found &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb398-10" data-line-number="10">  </a>
<a class="sourceLine" id="cb398-11" data-line-number="11">  <span class="co"># validate input:</span></a>
<a class="sourceLine" id="cb398-12" data-line-number="12">  <span class="cf">if</span> ( <span class="kw">length</span>(vec) <span class="op">==</span><span class="st"> </span><span class="dv">0</span> ) {</a>
<a class="sourceLine" id="cb398-13" data-line-number="13">    <span class="kw">cat</span>(<span class="st">&quot;The vector empty.  No way does it contain &quot;</span>, </a>
<a class="sourceLine" id="cb398-14" data-line-number="14">        elem, <span class="st">&quot;.&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb398-15" data-line-number="15">    <span class="kw">return</span>(<span class="op">-</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb398-16" data-line-number="16">  }</a>
<a class="sourceLine" id="cb398-17" data-line-number="17">  </a>
<a class="sourceLine" id="cb398-18" data-line-number="18">  <span class="co"># check the elements of vector:</span></a>
<a class="sourceLine" id="cb398-19" data-line-number="19">  <span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="st"> </span><span class="kw">length</span>(vec) ) {</a>
<a class="sourceLine" id="cb398-20" data-line-number="20">    <span class="cf">if</span> ( vec[i] <span class="op">==</span><span class="st"> </span>elem ) {</a>
<a class="sourceLine" id="cb398-21" data-line-number="21">      <span class="co"># record that we found the element:</span></a>
<a class="sourceLine" id="cb398-22" data-line-number="22">      found &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb398-23" data-line-number="23">      <span class="cf">break</span></a>
<a class="sourceLine" id="cb398-24" data-line-number="24">    } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb398-25" data-line-number="25">      <span class="co"># report no match at this index:</span></a>
<a class="sourceLine" id="cb398-26" data-line-number="26">      <span class="kw">cat</span>(<span class="st">&quot;Checked index &quot;</span>, i, </a>
<a class="sourceLine" id="cb398-27" data-line-number="27">          <span class="st">&quot; in the vector.  No match there ...</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb398-28" data-line-number="28">    }</a>
<a class="sourceLine" id="cb398-29" data-line-number="29">  }</a>
<a class="sourceLine" id="cb398-30" data-line-number="30">  </a>
<a class="sourceLine" id="cb398-31" data-line-number="31">  <span class="cf">if</span> ( found ) {</a>
<a class="sourceLine" id="cb398-32" data-line-number="32">    <span class="co"># report success:</span></a>
<a class="sourceLine" id="cb398-33" data-line-number="33">    <span class="kw">cat</span>(<span class="st">&quot;Found &quot;</span>, elem, <span class="st">&quot; at index &quot;</span>, i, <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb398-34" data-line-number="34">    <span class="kw">return</span>(i)</a>
<a class="sourceLine" id="cb398-35" data-line-number="35">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb398-36" data-line-number="36">    <span class="co"># report failure:</span></a>
<a class="sourceLine" id="cb398-37" data-line-number="37">    <span class="kw">cat</span>(elem, <span class="st">&quot; is not in the vector.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb398-38" data-line-number="38">    <span class="kw">return</span>(<span class="op">-</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb398-39" data-line-number="39">  }</a>
<a class="sourceLine" id="cb398-40" data-line-number="40">}</a></code></pre></div>
<p>Let’s see our function in action:</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb399-1" data-line-number="1">people &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Dorothy&quot;</span>, <span class="st">&quot;Tin Man&quot;</span>, <span class="st">&quot;Scarecrow&quot;</span>, <span class="st">&quot;Lion&quot;</span>)</a>
<a class="sourceLine" id="cb399-2" data-line-number="2">scarecrowPlace &lt;-<span class="st"> </span><span class="kw">verboseSearch</span>(<span class="st">&quot;Scarecrow&quot;</span>, people)</a></code></pre></div>
<pre><code>## Checked index 1 in the vector.  No match there ...
## Checked index 2 in the vector.  No match there ...
## Found Scarecrow at index 3.</code></pre>
<p>In the code for <code>verboseSearch()</code> you will notice that there is an initial check on the length of the vector. This is actually important. If a user were to enter an empty vector, then its length would be 0. Then in the loop the sequence would be <code>1:0</code>, which is the vector with elements 1 and 0. But look at what happens when you ask for any element of a zero-length vector:</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb401-1" data-line-number="1">emptyVec &lt;-<span class="st"> </span><span class="kw">character</span>(<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb401-2" data-line-number="2">emptyVec[<span class="dv">1</span>]  <span class="co"># You get NA</span></a></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>Then check out what happens if you compare an <code>NA</code> to a string:</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb403-1" data-line-number="1"><span class="ot">NA</span> <span class="op">==</span><span class="st"> &quot;Scarecrow&quot;</span></a></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>Now look at what happens in an <code>if</code> statement where the condition is <code>NA</code>:</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb405-1" data-line-number="1"><span class="cf">if</span> ( <span class="ot">NA</span> ) {</a>
<a class="sourceLine" id="cb405-2" data-line-number="2">  <span class="kw">cat</span>(<span class="st">&quot;We are in the bracket!</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb405-3" data-line-number="3">}</a></code></pre></div>
<pre><code>## Error in if (NA) { : missing value where TRUE/FALSE needed</code></pre>
<p>Checking that the input vector has positive length is an example of <em>validating</em>  input. When you write functions for other people to use you will find that it’s important to validate their input instead of allowing R to throw obscure error messages at them.</p>
</div>
<div id="solving-the-empty-vector-problem-in-for-loops-with-seq_along" class="section level3">
<h3><span class="header-section-number">2.7.4</span> Solving the Empty-Vector Problem in <code>for</code>-Loops with <code>seq_along()</code></h3>
<p>In the previous section we considered a possible problem with <code>for</code>-loops of the following form:</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb407-1" data-line-number="1"><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(vec) ) {</a>
<a class="sourceLine" id="cb407-2" data-line-number="2">  ## do something ...</a>
<a class="sourceLine" id="cb407-3" data-line-number="3">}</a></code></pre></div>
<p>In the above loop <code>vec</code> could be thought of as a “loop-defining” vector: its length determines the sequence of values 1, 2, 3 … for the index <code>i</code>. This sequence of values is supposed to end at the length of <code>vec</code>.</p>
<p>The problem is that if <code>vec</code> happens to be an empty vector then we probably don’t want to enter the loop at all. However, the length of an empty vector is 0, and so the vector <code>1:length(vec)</code> actually works out to be a vector with two elements:</p>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb408-1" data-line-number="1"><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>)</a></code></pre></div>
<p>Hence R will go through the loop twice: once when <code>i</code> is 1, and again when <code>i</code> is 0. Depending on what the loop does, very unexpected results could be produced.</p>
<p>In the previous section we dealt with the problem by writing an <code>if</code>-statement that provides the proper response when <code>vec</code> is empty. In many circumstances however, all we need to do is to make sure that the loop is skipped when the vector is empty.</p>
<p>A handy way to ensure skipping is to use the function <code>seq_along()</code> . Given any non-empty vector, <code>seq_along()</code> produces a sequence-vector that begins with 1 and ends with the length of the vector, thus:</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb409-1" data-line-number="1">vec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;f&quot;</span>)</a>
<a class="sourceLine" id="cb409-2" data-line-number="2"><span class="kw">seq_along</span>(vec)</a></code></pre></div>
<pre><code>## [1] 1 2 3</code></pre>
<p>On the other hand, if the vector is empty, then <code>seq_long()</code> returns an empty numeric vector:</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb411-1" data-line-number="1">vec &lt;-<span class="st"> </span><span class="kw">character</span>()</a>
<a class="sourceLine" id="cb411-2" data-line-number="2"><span class="kw">seq_along</span>(vec)</a></code></pre></div>
<pre><code>## integer(0)</code></pre>
<p>Now consider the loop inside the following function:</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb413-1" data-line-number="1">loopy &lt;-<span class="st"> </span><span class="cf">function</span>(vec) {</a>
<a class="sourceLine" id="cb413-2" data-line-number="2">  <span class="cf">for</span> ( i <span class="cf">in</span> <span class="kw">seq_along</span>(vec) ) {</a>
<a class="sourceLine" id="cb413-3" data-line-number="3">    <span class="kw">cat</span>(<span class="st">&quot;This time i is &quot;</span>, i, <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb413-4" data-line-number="4">  }</a>
<a class="sourceLine" id="cb413-5" data-line-number="5">}</a></code></pre></div>
<p>Given a non-empty vector, it goes through the loop a number of times equal to the length of the vector:</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb414-1" data-line-number="1"><span class="kw">loopy</span>(<span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;f&quot;</span>))</a></code></pre></div>
<pre><code>## This time i is 1.
## This time i is 2.
## This time i is 3.</code></pre>
<p>On the other hand, when given an empty vector the function does not enter the loop at all:</p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb416-1" data-line-number="1"><span class="kw">loopy</span>(<span class="kw">character</span>())  <span class="co"># no output to console!</span></a></code></pre></div>
<p>When you are writing a program that is complex enough that you don’t know whether the loop-defining vector might be empty, it is good practice to use <code>seq_along()</code> as a safeguard.</p>
</div>
<div id="skipping-ahead-in-a-loop" class="section level3">
<h3><span class="header-section-number">2.7.5</span> Skipping Ahead in a Loop</h3>
<p>Depending on what happens within a loop, you might sometimes wish to skip the remaining code within the loop and proceed to the next iteration. R provides the reserved-word <code>next</code>  for this purpose. Here is a simple example:</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb417-1" data-line-number="1">vec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;e&quot;</span>, <span class="st">&quot;e&quot;</span>, <span class="st">&quot;i&quot;</span>, <span class="st">&quot;o&quot;</span>, <span class="st">&quot;u&quot;</span>, <span class="st">&quot;e&quot;</span>, <span class="st">&quot;z&quot;</span>)</a>
<a class="sourceLine" id="cb417-2" data-line-number="2"><span class="co"># shout ahoy when you see the specified element</span></a>
<a class="sourceLine" id="cb417-3" data-line-number="3">verboseAhoy &lt;-<span class="st"> </span><span class="cf">function</span>(elem, vec) {</a>
<a class="sourceLine" id="cb417-4" data-line-number="4">  <span class="cf">if</span> (<span class="kw">length</span>(vec) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb417-5" data-line-number="5">    <span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="st"> </span><span class="kw">length</span>(vec) ) {</a>
<a class="sourceLine" id="cb417-6" data-line-number="6">      <span class="cf">if</span> ( vec[i] <span class="op">!=</span><span class="st"> </span>elem) <span class="cf">next</span></a>
<a class="sourceLine" id="cb417-7" data-line-number="7">      <span class="kw">cat</span>(<span class="st">&quot;Ahoy! &quot;</span>, elem, <span class="st">&quot; at index &quot;</span>, i, <span class="st">&quot;!</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb417-8" data-line-number="8">    }</a>
<a class="sourceLine" id="cb417-9" data-line-number="9">  }</a>
<a class="sourceLine" id="cb417-10" data-line-number="10">  </a>
<a class="sourceLine" id="cb417-11" data-line-number="11">}</a>
<a class="sourceLine" id="cb417-12" data-line-number="12"><span class="kw">verboseAhoy</span>(<span class="st">&quot;e&quot;</span>, vec)</a></code></pre></div>
<pre><code>## Ahoy! e at index 2!
## Ahoy! e at index 3!
## Ahoy! e at index 7!</code></pre>
<p>When the <code>vec[i] !== elem</code> condition is true, R immediately skips the rest of the loop, increments the value of the index variable <code>i</code>, and runs through the loop again.</p>
<p>You can always accomplish the skipping without using <code>next</code> explicitly, but it’s nice to have on hand.</p>
</div>
<div id="repeat" class="section level3">
<h3><span class="header-section-number">2.7.6</span> Repeat</h3>
<p>For-loops are pretty wonderful, but they are best used in circumstances when you know how many times you will need to loop. When you need to repeat a block of code until a certain condition occurs, then the <code>repeat</code> reserved-word might be a good choice.</p>
<p>For example, suppose you want to play the number-guessing game with the user, but let her keep guessing until either she gives up or gets the correct answer. Here’s an implementation using <code>repeat</code>:</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb419-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb419-2" data-line-number="2">number &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span>n, <span class="dt">size =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb419-3" data-line-number="3"><span class="kw">cat</span>(<span class="st">&quot;I&#39;m thinking of a whole number from 1 to &quot;</span>, n, <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb419-4" data-line-number="4"><span class="cf">repeat</span> {</a>
<a class="sourceLine" id="cb419-5" data-line-number="5">  guess &lt;-<span class="st"> </span><span class="kw">readline</span>(<span class="st">&quot;What&#39;s your guess? (Enter q to quit.)  &quot;</span>)</a>
<a class="sourceLine" id="cb419-6" data-line-number="6">  <span class="cf">if</span> ( guess <span class="op">==</span><span class="st"> &quot;q&quot;</span>  ) {</a>
<a class="sourceLine" id="cb419-7" data-line-number="7">    <span class="kw">cat</span>(<span class="st">&quot;Bye!</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb419-8" data-line-number="8">    <span class="cf">break</span></a>
<a class="sourceLine" id="cb419-9" data-line-number="9">  } <span class="cf">else</span> <span class="cf">if</span> ( <span class="kw">as.numeric</span>(guess) <span class="op">==</span><span class="st"> </span>number ) {</a>
<a class="sourceLine" id="cb419-10" data-line-number="10">    <span class="kw">cat</span>(<span class="st">&quot;You are correct!  Thanks for playing!&quot;</span>)</a>
<a class="sourceLine" id="cb419-11" data-line-number="11">    <span class="cf">break</span></a>
<a class="sourceLine" id="cb419-12" data-line-number="12">  }</a>
<a class="sourceLine" id="cb419-13" data-line-number="13">  <span class="co"># If we get here, the guess was not correct:</span></a>
<a class="sourceLine" id="cb419-14" data-line-number="14">  <span class="co"># loop will repeat!</span></a>
<a class="sourceLine" id="cb419-15" data-line-number="15">}</a></code></pre></div>
<p>The game works well enough, but if you give it a try, you are sure to find it a bit fatiguing. It wold be nice to give the user a hint after an incorrect guess. Let’s revise the game to tell the reader whether her guess was high or low. While we are at it, let’s cast the game into the form of a function.</p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb420-1" data-line-number="1">numberGuess &lt;-<span class="st"> </span><span class="cf">function</span>(n) {</a>
<a class="sourceLine" id="cb420-2" data-line-number="2">  number &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span>n, <span class="dt">size =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb420-3" data-line-number="3">  <span class="kw">cat</span>(<span class="st">&quot;I&#39;m thinking of a whole number from 1 to &quot;</span>, n, <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb420-4" data-line-number="4">  <span class="cf">repeat</span> {</a>
<a class="sourceLine" id="cb420-5" data-line-number="5">    guess &lt;-<span class="st"> </span><span class="kw">readline</span>(<span class="st">&quot;What&#39;s your guess? (Enter q to quit.)  &quot;</span>)</a>
<a class="sourceLine" id="cb420-6" data-line-number="6">    <span class="cf">if</span> (guess <span class="op">==</span><span class="st"> &quot;q&quot;</span>) {</a>
<a class="sourceLine" id="cb420-7" data-line-number="7">      <span class="kw">cat</span>(<span class="st">&quot;Bye!</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb420-8" data-line-number="8">      <span class="cf">break</span></a>
<a class="sourceLine" id="cb420-9" data-line-number="9">    } <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">as.numeric</span>(guess) <span class="op">==</span><span class="st"> </span>number) {</a>
<a class="sourceLine" id="cb420-10" data-line-number="10">      <span class="kw">cat</span>(<span class="st">&quot;You are correct!  Thanks for playing!&quot;</span>)</a>
<a class="sourceLine" id="cb420-11" data-line-number="11">      <span class="cf">break</span></a>
<a class="sourceLine" id="cb420-12" data-line-number="12">    }</a>
<a class="sourceLine" id="cb420-13" data-line-number="13">    <span class="co"># If we get to this point the guess was not correct.</span></a>
<a class="sourceLine" id="cb420-14" data-line-number="14">    <span class="co"># Issue hint:</span></a>
<a class="sourceLine" id="cb420-15" data-line-number="15">    hint &lt;-<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">as.numeric</span>(guess) <span class="op">&gt;</span><span class="st"> </span>number, <span class="st">&quot;high&quot;</span>, <span class="st">&quot;low&quot;</span>)</a>
<a class="sourceLine" id="cb420-16" data-line-number="16">    <span class="kw">cat</span>(<span class="st">&quot;Your guess was &quot;</span>, hint, <span class="st">&quot;.  Keep at it!</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb420-17" data-line-number="17">    <span class="co"># Repeat loop</span></a>
<a class="sourceLine" id="cb420-18" data-line-number="18">  }</a>
<a class="sourceLine" id="cb420-19" data-line-number="19">}</a></code></pre></div>
<p>A typical game:</p>
<pre><code>&gt; numberGuess(100)
I&#39;m thinking of a whole number from 1 to 100.
What&#39;s your guess? (Enter q to quit.)  50
Your guess was high.  Keep at it!
What&#39;s your guess? (Enter q to quit.)  25
Your guess was high.  Keep at it!
What&#39;s your guess? (Enter q to quit.)  12
Your guess was low.  Keep at it!
What&#39;s your guess? (Enter q to quit.)  18
Your guess was low.  Keep at it!
What&#39;s your guess? (Enter q to quit.)  22
Your guess was high.  Keep at it!
What&#39;s your guess? (Enter q to quit.)  20
You are correct!  Thanks for playing!</code></pre>
</div>
<div id="while" class="section level3">
<h3><span class="header-section-number">2.7.7</span> While</h3>
<p>The reserved word <code>while</code> constructs a loop that runs as long as a specified condition is true. Unlike <code>repeat</code>, which launches directly into the loop, the condition for <code>while</code> is evaluated prior to the body of the loop. If the condition is false at the beginning, the code in the body of the loop is never executed.</p>
<p><code>verboseSearch()</code> could be re-written with <code>while</code>:</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb422-1" data-line-number="1">verboseSearch &lt;-<span class="st"> </span><span class="cf">function</span>(elem, vec) {</a>
<a class="sourceLine" id="cb422-2" data-line-number="2">  found &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb422-3" data-line-number="3">  <span class="cf">if</span> ( <span class="kw">length</span>(vec) <span class="op">==</span><span class="st"> </span><span class="dv">0</span> ) {</a>
<a class="sourceLine" id="cb422-4" data-line-number="4">    <span class="kw">cat</span>(<span class="st">&quot;The vector is empty.  No way does it contain &quot;</span>, </a>
<a class="sourceLine" id="cb422-5" data-line-number="5">        elem, <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb422-6" data-line-number="6">    <span class="kw">return</span>(<span class="op">-</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb422-7" data-line-number="7">  }</a>
<a class="sourceLine" id="cb422-8" data-line-number="8">  <span class="co"># index of vec (start looking at 1):</span></a>
<a class="sourceLine" id="cb422-9" data-line-number="9">  i &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb422-10" data-line-number="10">  <span class="cf">while</span> ( <span class="op">!</span>found <span class="op">&amp;</span><span class="st"> </span>i <span class="op">&lt;=</span><span class="st"> </span><span class="kw">length</span>(vec) ) {</a>
<a class="sourceLine" id="cb422-11" data-line-number="11">    <span class="cf">if</span> ( vec[i] <span class="op">==</span><span class="st"> </span>elem ) {</a>
<a class="sourceLine" id="cb422-12" data-line-number="12">      found &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb422-13" data-line-number="13">      <span class="cf">break</span></a>
<a class="sourceLine" id="cb422-14" data-line-number="14">    }</a>
<a class="sourceLine" id="cb422-15" data-line-number="15">    <span class="kw">cat</span>(<span class="st">&quot;No match at position &quot;</span>, i, <span class="st">&quot; ...</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb422-16" data-line-number="16">    i &lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb422-17" data-line-number="17">  }</a>
<a class="sourceLine" id="cb422-18" data-line-number="18"></a>
<a class="sourceLine" id="cb422-19" data-line-number="19">  <span class="cf">if</span> ( found ) {</a>
<a class="sourceLine" id="cb422-20" data-line-number="20">    <span class="co"># report success:</span></a>
<a class="sourceLine" id="cb422-21" data-line-number="21">    <span class="kw">cat</span>(<span class="st">&quot;Found &quot;</span>, elem, <span class="st">&quot; at index &quot;</span>, i, <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb422-22" data-line-number="22">    <span class="kw">return</span>(i)</a>
<a class="sourceLine" id="cb422-23" data-line-number="23">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb422-24" data-line-number="24">    <span class="co"># report failure:</span></a>
<a class="sourceLine" id="cb422-25" data-line-number="25">    <span class="kw">cat</span>(elem, <span class="st">&quot; is not in the vector.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb422-26" data-line-number="26">    <span class="kw">return</span>(<span class="op">-</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb422-27" data-line-number="27">  }</a>
<a class="sourceLine" id="cb422-28" data-line-number="28">}</a>
<a class="sourceLine" id="cb422-29" data-line-number="29"></a>
<a class="sourceLine" id="cb422-30" data-line-number="30">cheerleader &lt;-<span class="st"> </span><span class="cf">function</span>(cheer) {</a>
<a class="sourceLine" id="cb422-31" data-line-number="31">  <span class="cf">for</span> ( letter <span class="cf">in</span> cheer ) {</a>
<a class="sourceLine" id="cb422-32" data-line-number="32">    <span class="cf">repeat</span> {</a>
<a class="sourceLine" id="cb422-33" data-line-number="33">      call &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;Gimme a &quot;</span>, letter, <span class="st">&quot;!  &quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb422-34" data-line-number="34">      response &lt;-<span class="st"> </span><span class="kw">readline</span>(call)</a>
<a class="sourceLine" id="cb422-35" data-line-number="35">      <span class="cf">if</span> ( response <span class="op">==</span><span class="st"> </span>letter ) <span class="cf">break</span></a>
<a class="sourceLine" id="cb422-36" data-line-number="36">    }</a>
<a class="sourceLine" id="cb422-37" data-line-number="37">  }</a>
<a class="sourceLine" id="cb422-38" data-line-number="38">}</a></code></pre></div>
</div>
<div id="practice-problems" class="section level3">
<h3><span class="header-section-number">2.7.8</span> Practice Problems</h3>
<ol style="list-style-type: decimal">
<li><p>You want to compute the square roots of the whole numbers from 1 to 10. You could do this quite easily as follows:</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb423-1" data-line-number="1"><span class="kw">sqrt</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</a></code></pre></div>
<pre><code>##  [1] 1.000000 1.414214 1.732051 2.000000 2.236068 2.449490 2.645751
##  [8] 2.828427 3.000000 3.162278</code></pre>
<p>However, you want to practice using <code>for</code>-loops. Write a small program that uses a loop to compute the square roots of the whole numbers from 1 to 10.</p></li>
<li><p>Think about the practice problem <code>findKarl()</code> from the previous section. Write a new version that uses a loop.</p></li>
<li><p>You want to append <code>&quot;the Dog&quot;</code> to the end of each element of a character vector of dog-names. Sadly, you have not yet realized that the <code>paste()</code> function is very much up to the task:</p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb425-1" data-line-number="1">doggies &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Bo&quot;</span>, <span class="st">&quot;Gracie&quot;</span>, <span class="st">&quot;Rover&quot;</span>, <span class="st">&quot;Anya&quot;</span>)</a>
<a class="sourceLine" id="cb425-2" data-line-number="2"><span class="kw">paste</span>(doggies, <span class="st">&quot;the Dog&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Bo the Dog&quot;     &quot;Gracie the Dog&quot; &quot;Rover the Dog&quot;  &quot;Anya the Dog&quot;</code></pre>
<p>You decide to use a <code>for</code>-loop. Write the code.</p></li>
<li><p>Write a function called <code>triangleOfStars()</code> that produces patterns liks this:</p>
<pre><code>****
***
**
*</code></pre>
<p>It should take a single parameter <code>n</code>, the number of asterisks in the first “line” of the triangle. Use a <code>for</code>-loop in the body of the function.</p></li>
<li>Write a function called <code>trianglePattern()</code> that produces patterns like the ones from the previous problem, but using any character that the user specifies. The function should take two parameters:
<ul>
<li><code>char</code>, a string giving the character to use. The default value should be <code>&quot;*&quot;</code>.</li>
<li><code>n</code>, the number of asterisks in the first “line” of the output.</li>
</ul>
<p>Typical examples of use should be as follows:</p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb428-1" data-line-number="1"><span class="kw">trianglePattern</span>(<span class="dt">char =</span> <span class="st">&quot;x&quot;</span>, <span class="dv">5</span>)</a></code></pre></div>
<pre><code>## xxxxx
## xxxx
## xxx
## xx
## x</code></pre>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb430-1" data-line-number="1"><span class="kw">trianglePattern</span>(<span class="dt">n =</span> <span class="dv">6</span>)</a></code></pre></div>
<pre><code>## ******
## *****
## ****
## ***
## **
## *</code></pre></li>
<li><p>Rewrite <code>triangleOfStars()</code> so that it uses a <code>while</code>-loop in its body.</p></li>
<li><p>Rewrite <code>triangleOfStars()</code> so that it still uses a <code>while</code>-loop in its body, but produces output like this:</p>
<pre><code>*
**
***
****</code></pre></li>
<li><p>Write a function called <code>cheerleader()</code> that badgers you for each of the letters in a word until you give it all of the letters, one by one. It should work like this:</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb433-1" data-line-number="1">schoolMascot &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;T&quot;</span>, <span class="st">&quot;I&quot;</span>, <span class="st">&quot;G&quot;</span>, <span class="st">&quot;E&quot;</span>, <span class="st">&quot;R&quot;</span>, <span class="st">&quot;S&quot;</span>)</a>
<a class="sourceLine" id="cb433-2" data-line-number="2"><span class="kw">cheerleader</span>(<span class="dt">cheer =</span> schoolMascot)</a></code></pre></div>
<pre><code>&gt; cheerleader(cheer = schoolMascot)
Gimme a T!  T
Gimme a I!  i
Gimme a I!  I
Gimme a G!  gee
Gimme a G!  I said gee!!
Gimme a G!  G
Gimme a E!  E
Gimme a R!  Are you going to do this all day?
Gimme a R!  R
Gimme a S!  Stop it, please!
Gimme a S!  S
&gt; </code></pre></li>
</ol>
</div>
<div id="solutions-to-the-practice-exercises" class="section level3">
<h3><span class="header-section-number">2.7.9</span> Solutions to the Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Here’s a suitable program:</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb435-1" data-line-number="1">roots &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb435-2" data-line-number="2"><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span> ) {</a>
<a class="sourceLine" id="cb435-3" data-line-number="3">  roots[i] &lt;-<span class="st"> </span><span class="kw">sqrt</span>(i)</a>
<a class="sourceLine" id="cb435-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb435-5" data-line-number="5">roots</a></code></pre></div>
<pre><code>##  [1] 1.000000 1.414214 1.732051 2.000000 2.236068 2.449490 2.645751
##  [8] 2.828427 3.000000 3.162278</code></pre></li>
<li><p>You could do this:</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb437-1" data-line-number="1">findKarl &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb437-2" data-line-number="2">  results &lt;-<span class="st"> </span><span class="kw">character</span>(<span class="kw">length</span>(x))</a>
<a class="sourceLine" id="cb437-3" data-line-number="3">  <span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="st"> </span><span class="kw">length</span>(x) ) {</a>
<a class="sourceLine" id="cb437-4" data-line-number="4">    <span class="cf">if</span> ( x[i] <span class="op">==</span><span class="st"> &quot;Karl&quot;</span> ) {</a>
<a class="sourceLine" id="cb437-5" data-line-number="5">      results[i] &lt;-<span class="st"> &quot;Yep, that&#39;s Karl!&quot;</span></a>
<a class="sourceLine" id="cb437-6" data-line-number="6">    } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb437-7" data-line-number="7">      results[i] &lt;-<span class="st">  &quot;Sorry, not our guy.&quot;</span></a>
<a class="sourceLine" id="cb437-8" data-line-number="8">    }</a>
<a class="sourceLine" id="cb437-9" data-line-number="9">  }</a>
<a class="sourceLine" id="cb437-10" data-line-number="10">  results</a>
<a class="sourceLine" id="cb437-11" data-line-number="11">}</a></code></pre></div></li>
<li><p>Here you go:</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb438-1" data-line-number="1">doggies &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Bo&quot;</span>, <span class="st">&quot;Gracie&quot;</span>, <span class="st">&quot;Rover&quot;</span>, <span class="st">&quot;Anya&quot;</span>)</a>
<a class="sourceLine" id="cb438-2" data-line-number="2">titledDoggies &lt;-<span class="st"> </span><span class="kw">character</span>(<span class="kw">length</span>(doggies))</a>
<a class="sourceLine" id="cb438-3" data-line-number="3"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(doggies) ) {</a>
<a class="sourceLine" id="cb438-4" data-line-number="4">  titledDoggies[i] &lt;-<span class="st"> </span><span class="kw">paste</span>(doggies[i], <span class="st">&quot;the Dog&quot;</span>)</a>
<a class="sourceLine" id="cb438-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb438-6" data-line-number="6">titledDoggies</a></code></pre></div>
<pre><code>## [1] &quot;Bo the Dog&quot;     &quot;Gracie the Dog&quot; &quot;Rover the Dog&quot;  &quot;Anya the Dog&quot;</code></pre></li>
<li><p>Here’s the code:</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb440-1" data-line-number="1">triangleOfStars &lt;-<span class="st"> </span><span class="cf">function</span>(n) {</a>
<a class="sourceLine" id="cb440-2" data-line-number="2">  <span class="cf">for</span> ( i <span class="cf">in</span> n<span class="op">:</span><span class="dv">1</span> ) {</a>
<a class="sourceLine" id="cb440-3" data-line-number="3">    line &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;*&quot;</span>, <span class="dt">times =</span> i)</a>
<a class="sourceLine" id="cb440-4" data-line-number="4">    <span class="kw">cat</span>(line, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb440-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb440-6" data-line-number="6">}</a></code></pre></div>
<p>Try it out:</p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb441-1" data-line-number="1"><span class="kw">triangleOfStars</span>(<span class="dv">5</span>)</a></code></pre></div>
<pre><code>## *****
## ****
## ***
## **
## *</code></pre></li>
<li><p>Here’s the code:</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb443-1" data-line-number="1">trianglePattern &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">char =</span> <span class="st">&quot;*&quot;</span>, n) {</a>
<a class="sourceLine" id="cb443-2" data-line-number="2">  <span class="cf">for</span> (i <span class="cf">in</span> n<span class="op">:</span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb443-3" data-line-number="3">    line &lt;-<span class="st"> </span><span class="kw">rep</span>(char, <span class="dt">times =</span> i)</a>
<a class="sourceLine" id="cb443-4" data-line-number="4">    <span class="kw">cat</span>(line, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb443-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb443-6" data-line-number="6">}</a></code></pre></div></li>
<li><p>Here’s the code:</p>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb444-1" data-line-number="1">triangleOfStars &lt;-<span class="st"> </span><span class="cf">function</span>(n) {</a>
<a class="sourceLine" id="cb444-2" data-line-number="2">  <span class="cf">while</span> ( n <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1</span> ) {</a>
<a class="sourceLine" id="cb444-3" data-line-number="3">    line &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;*&quot;</span>, <span class="dt">times =</span> n)</a>
<a class="sourceLine" id="cb444-4" data-line-number="4">    <span class="kw">cat</span>(line, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb444-5" data-line-number="5">    n &lt;-<span class="st"> </span>n <span class="op">-</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb444-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb444-7" data-line-number="7">}</a></code></pre></div>
<p>Try it out:</p>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb445-1" data-line-number="1"><span class="kw">triangleOfStars</span>(<span class="dv">5</span>)</a></code></pre></div>
<pre><code>## *****
## ****
## ***
## **
## *</code></pre></li>
<li><p>Here’s the code:</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb447-1" data-line-number="1">triangleOfStars &lt;-<span class="st"> </span><span class="cf">function</span>(n) {</a>
<a class="sourceLine" id="cb447-2" data-line-number="2">  m &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb447-3" data-line-number="3">  <span class="cf">while</span> ( m <span class="op">&lt;=</span><span class="st"> </span>n ) {</a>
<a class="sourceLine" id="cb447-4" data-line-number="4">    line &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;*&quot;</span>, <span class="dt">times =</span> m)</a>
<a class="sourceLine" id="cb447-5" data-line-number="5">    <span class="kw">cat</span>(line, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb447-6" data-line-number="6">    m &lt;-<span class="st"> </span>m <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb447-7" data-line-number="7">  }</a>
<a class="sourceLine" id="cb447-8" data-line-number="8">}</a></code></pre></div>
<p>Try it out:</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb448-1" data-line-number="1"><span class="kw">triangleOfStars</span>(<span class="dv">5</span>)</a></code></pre></div>
<pre><code>## *
## **
## ***
## ****
## *****</code></pre></li>
<li><p>Here is the requested annoying function, using a <code>repeat</code>-loop with <code>break</code> inside a <code>for</code>-loop:</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb450-1" data-line-number="1">cheerleader &lt;-<span class="st"> </span><span class="cf">function</span>(cheer) {</a>
<a class="sourceLine" id="cb450-2" data-line-number="2">  <span class="cf">for</span> ( letter <span class="cf">in</span> cheer ) {</a>
<a class="sourceLine" id="cb450-3" data-line-number="3">    <span class="cf">repeat</span> {</a>
<a class="sourceLine" id="cb450-4" data-line-number="4">      call &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;Gimme a &quot;</span>, letter, <span class="st">&quot;!  &quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb450-5" data-line-number="5">      response &lt;-<span class="st"> </span><span class="kw">readline</span>(call)</a>
<a class="sourceLine" id="cb450-6" data-line-number="6">      <span class="cf">if</span> ( response <span class="op">==</span><span class="st"> </span>letter ) <span class="cf">break</span></a>
<a class="sourceLine" id="cb450-7" data-line-number="7">   }</a>
<a class="sourceLine" id="cb450-8" data-line-number="8">  }</a>
<a class="sourceLine" id="cb450-9" data-line-number="9">}</a></code></pre></div></li>
</ol>
</div>
</div>
<div id="collatz-conjecture" class="section level2">
<h2><span class="header-section-number">2.8</span> Application: The Collatz Conjecture</h2>
<p>Take any positive integer greater than 1. Apply the following rule, which we will call the Collatz Rule:</p>
<ul>
<li>If the integer is even, divide it by 2;</li>
<li>if the integer is odd, multiply it by 3 and add 1.</li>
</ul>
<p>Now apply the rule to the resulting number, then apply the rule again to the number you get from that, and so on.</p>
<p>For example, start with 13. We proceed as follows:</p>
<ul>
<li>13 is odd, so compute <span class="math inline">\(3 \times 13 + 1 = 40\)</span>.</li>
<li>40 is even, so compute <span class="math inline">\(40/2 = 20\)</span>.</li>
<li>20 is even, so compute <span class="math inline">\(20/2 = 10\)</span>.</li>
<li>10 is even, so compute <span class="math inline">\(10/2 = 5\)</span>.</li>
<li>5 is odd, so compute <span class="math inline">\(3 \times 5+ 1 = 16\)</span></li>
<li>16 is even, so compute <span class="math inline">\(16/2 = 8\)</span>.</li>
<li>8 is even, so compute <span class="math inline">\(8/2 = 4\)</span>.</li>
<li>4 is even, so compute <span class="math inline">\(4/2 = 2\)</span>.</li>
<li>2 is even, so compute <span class="math inline">\(2/2 = 1\)</span>.</li>
<li>1 is odd, so compute <span class="math inline">\(3 \times 1 + 1 = 4\)</span>.</li>
<li>4 is even, so compute <span class="math inline">\(4/2 = 2\)</span>.</li>
<li>2 is even, so compute <span class="math inline">\(2/2 = 1\)</span>.</li>
</ul>
<p>If we keep going, then we will cycle forever:</p>
<p><span class="math display">\[4, 2, 1, 4, 2, 1, \ldots\]</span>
In mathematics the <em>Collatz Conjecture</em> is the conjecture that for <em>any</em> initial positive number, every Collatz Sequence (the sequence formed by repeated application of the Collatz Rule) eventually contains a 1, after which it must cycle forever. No matter how large a number we begin with, we have always found that it returns to 1, but mathematicians do not know if this will be so for <em>any</em> initial number.</p>
<p>A sequence of Collatz numbers can bounce around quite remarkably before descending to 1. Our goal in this section is to write a function called <code>collatz()</code> that will compute the Collatz sequence for any given initial number and draw a graph of the sequence as well.</p>
<p>First, let’s make a function just for the Collatz Rule itself:</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb451-1" data-line-number="1">collatzRule &lt;-<span class="st"> </span><span class="cf">function</span>(m) {</a>
<a class="sourceLine" id="cb451-2" data-line-number="2">  <span class="cf">if</span> ( m <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb451-3" data-line-number="3">    <span class="kw">return</span>(m<span class="op">/</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb451-4" data-line-number="4">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb451-5" data-line-number="5">    <span class="kw">return</span>(<span class="dv">3</span><span class="op">*</span>m <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb451-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb451-7" data-line-number="7">}</a></code></pre></div>
<p>(Recall that <code>m %% 2</code> is the remainder of <code>m</code> after it is divided by 2. If this is 0, then <code>m</code> is even.)</p>
<p>Next let’s try to get a function going that will print out Collatz numbers:</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb452-1" data-line-number="1">collatz &lt;-<span class="st"> </span><span class="cf">function</span>(n) {</a>
<a class="sourceLine" id="cb452-2" data-line-number="2">  <span class="co"># n is the initial number</span></a>
<a class="sourceLine" id="cb452-3" data-line-number="3">  <span class="cf">while</span> ( n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span> ) {</a>
<a class="sourceLine" id="cb452-4" data-line-number="4">    <span class="kw">cat</span>(n, <span class="st">&quot; &quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb452-5" data-line-number="5">    <span class="co"># get the next number and call it n:</span></a>
<a class="sourceLine" id="cb452-6" data-line-number="6">    n &lt;-<span class="st"> </span><span class="kw">collatzRule</span>(n)</a>
<a class="sourceLine" id="cb452-7" data-line-number="7">  }</a>
<a class="sourceLine" id="cb452-8" data-line-number="8">}</a></code></pre></div>
<p>Let’s try it out:</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb453-1" data-line-number="1"><span class="kw">collatz</span>(<span class="dv">13</span>)</a></code></pre></div>
<pre><code>## 13 40 20 10 5 16 8 4 2</code></pre>
<p>So far, so good, but if we are going to graph the numbers, then we should store them in a vector. The problem is that we don’t know how long the vector needs to be.</p>
<p>One possible solution is to add to the vector as we go, like this:</p>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb455-1" data-line-number="1">collatz &lt;-<span class="st"> </span><span class="cf">function</span>(n) {</a>
<a class="sourceLine" id="cb455-2" data-line-number="2">  numbers &lt;-<span class="st"> </span><span class="kw">numeric</span>()</a>
<a class="sourceLine" id="cb455-3" data-line-number="3">  <span class="cf">while</span> ( n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span> ) {</a>
<a class="sourceLine" id="cb455-4" data-line-number="4">    <span class="co"># stick n onto the end of numbers:</span></a>
<a class="sourceLine" id="cb455-5" data-line-number="5">    numbers &lt;-<span class="st"> </span><span class="kw">c</span>(numbers, n)</a>
<a class="sourceLine" id="cb455-6" data-line-number="6">    n &lt;-<span class="st"> </span><span class="kw">collatzRule</span>(n)</a>
<a class="sourceLine" id="cb455-7" data-line-number="7">  }</a>
<a class="sourceLine" id="cb455-8" data-line-number="8">  <span class="kw">print</span>(numbers)</a>
<a class="sourceLine" id="cb455-9" data-line-number="9">}</a></code></pre></div>
<p>Try it out:</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb456-1" data-line-number="1"><span class="kw">collatz</span>(<span class="dv">13</span>)</a></code></pre></div>
<pre><code>## [1] 13 40 20 10  5 16  8  4  2</code></pre>
<p>This looks good. There are two problems, though, if the Collatz sequence happens to go on for a very long time.</p>
<ul>
<li><p><strong>Computation Time</strong>: the user doesn’t know when the sequence will end—if ever!—so she won’t know whether a delay in production of the output is due to a long sequence or a problem with the program itself. as the sequence gets longer, the computation-time is made even longer by the way the following line of code works:</p>
<pre><code>numbers &lt;- c(numbers, n)</code></pre>
<p>R cannot actually “stick” a new element onto the end of a vector. What it actually does is to move to a new place in memory and create an entirely new vector consisting of all the elements of <code>numbers</code> followed by the number <code>n</code>. R then assigns the name <code>numbers</code> to this value, freeing up the old place in memory where the previous <code>numbers</code> vector lived, but when a vector is very long copying can take a long time.</p></li>
<li><p><strong>Memory Problems</strong> Once the <code>numbers</code> vector gets long enough it will use all of the memory in the computer that is available to R. R will crash.</p></li>
</ul>
<p>In order to get around this problem, we should impose a limit on the number of Collatz numbers that we will compute. We’ll set the limit at 10,000. The user can change the limit, but should exercise caution in doing so. Also, we’ll initialize our <code>numbers</code> vector to have a length set to this limit. We can then assign values to elements of an <em>already existing</em> vector: this is much faster than copying entire vectors from scratch.</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb459-1" data-line-number="1">collatz &lt;-<span class="st"> </span><span class="cf">function</span>(n, <span class="dt">limit =</span> <span class="dv">10000</span>) {</a>
<a class="sourceLine" id="cb459-2" data-line-number="2">  <span class="co"># collatz numbers will go in this vector</span></a>
<a class="sourceLine" id="cb459-3" data-line-number="3">  numbers &lt;-<span class="st"> </span><span class="kw">numeric</span>(limit)</a>
<a class="sourceLine" id="cb459-4" data-line-number="4">  <span class="co"># keep count of how many numbers we have made:</span></a>
<a class="sourceLine" id="cb459-5" data-line-number="5">  counter &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb459-6" data-line-number="6">  <span class="cf">while</span> ( n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>counter <span class="op">&lt;</span><span class="st"> </span>limit) {</a>
<a class="sourceLine" id="cb459-7" data-line-number="7">    <span class="co"># need to make a new number</span></a>
<a class="sourceLine" id="cb459-8" data-line-number="8">    counter &lt;-<span class="st"> </span>counter <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb459-9" data-line-number="9">    <span class="co"># put the current number into the vector</span></a>
<a class="sourceLine" id="cb459-10" data-line-number="10">    numbers[counter] &lt;-<span class="st"> </span>n</a>
<a class="sourceLine" id="cb459-11" data-line-number="11">    <span class="co"># make next Collatz number</span></a>
<a class="sourceLine" id="cb459-12" data-line-number="12">    n &lt;-<span class="st"> </span><span class="kw">collatzRule</span>(n)</a>
<a class="sourceLine" id="cb459-13" data-line-number="13">  }</a>
<a class="sourceLine" id="cb459-14" data-line-number="14">  <span class="co"># find how many Collatz numbers we made:</span></a>
<a class="sourceLine" id="cb459-15" data-line-number="15">  howMany &lt;-<span class="st"> </span><span class="kw">min</span>(counter, limit)</a>
<a class="sourceLine" id="cb459-16" data-line-number="16">  <span class="co"># print them out:</span></a>
<a class="sourceLine" id="cb459-17" data-line-number="17">  <span class="kw">print</span>(numbers[<span class="dv">1</span><span class="op">:</span>howMany])</a>
<a class="sourceLine" id="cb459-18" data-line-number="18">}</a></code></pre></div>
<p>Again let’s try it:</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb460-1" data-line-number="1"><span class="kw">collatz</span>(<span class="dv">257</span>)</a></code></pre></div>
<pre><code>##   [1]  257  772  386  193  580  290  145  436  218  109  328  164   82   41
##  [15]  124   62   31   94   47  142   71  214  107  322  161  484  242  121
##  [29]  364  182   91  274  137  412  206  103  310  155  466  233  700  350
##  [43]  175  526  263  790  395 1186  593 1780  890  445 1336  668  334  167
##  [57]  502  251  754  377 1132  566  283  850  425 1276  638  319  958  479
##  [71] 1438  719 2158 1079 3238 1619 4858 2429 7288 3644 1822  911 2734 1367
##  [85] 4102 2051 6154 3077 9232 4616 2308 1154  577 1732  866  433 1300  650
##  [99]  325  976  488  244  122   61  184   92   46   23   70   35  106   53
## [113]  160   80   40   20   10    5   16    8    4    2</code></pre>
<p>Things are working pretty well, but since the sequence of numbers might get pretty long, perhaps we should only print out the length of the sequence, and leave it to the reader to say whether the sequence itself should be shown.</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb462-1" data-line-number="1">collatz &lt;-<span class="st"> </span><span class="cf">function</span>(n, <span class="dt">limit =</span> <span class="dv">10000</span>) {</a>
<a class="sourceLine" id="cb462-2" data-line-number="2">  numbers &lt;-<span class="st"> </span><span class="kw">numeric</span>(limit)</a>
<a class="sourceLine" id="cb462-3" data-line-number="3">  counter &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb462-4" data-line-number="4">  <span class="cf">while</span> ( n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>counter <span class="op">&lt;</span><span class="st"> </span>limit) {</a>
<a class="sourceLine" id="cb462-5" data-line-number="5">    counter &lt;-<span class="st"> </span>counter <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb462-6" data-line-number="6">    numbers[counter] &lt;-<span class="st"> </span>n</a>
<a class="sourceLine" id="cb462-7" data-line-number="7">    n &lt;-<span class="st"> </span><span class="kw">collatzRule</span>(n)</a>
<a class="sourceLine" id="cb462-8" data-line-number="8">  }</a>
<a class="sourceLine" id="cb462-9" data-line-number="9">  howMany &lt;-<span class="st"> </span><span class="kw">min</span>(counter, limit)</a>
<a class="sourceLine" id="cb462-10" data-line-number="10">  <span class="kw">cat</span>(<span class="st">&quot;The Collatz sequence has &quot;</span>, howMany, <span class="st">&quot; elements.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb462-11" data-line-number="11">  show &lt;-<span class="st"> </span><span class="kw">readline</span>(<span class="st">&quot;Do you want to see it (y/n)?  &quot;</span>)</a>
<a class="sourceLine" id="cb462-12" data-line-number="12">  <span class="cf">if</span> ( show <span class="op">==</span><span class="st"> &quot;y&quot;</span> ) {</a>
<a class="sourceLine" id="cb462-13" data-line-number="13">    <span class="kw">print</span>(numbers[<span class="dv">1</span><span class="op">:</span>howMany])</a>
<a class="sourceLine" id="cb462-14" data-line-number="14">  }</a>
<a class="sourceLine" id="cb462-15" data-line-number="15">}</a></code></pre></div>
<p>Next let’s think about the plot. We’ll use the plotting system in the <strong>ggplot2</strong> package <span class="citation">(Wickham et al. <a href="#ref-R-ggplot2">2018</a>)</span>.</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb463-1" data-line-number="1"><span class="kw">library</span>(ggplot2)</a></code></pre></div>
<p>Later on we will make a serious study of plotting with <strong>ggplot2</strong>, but for now let’s just get the basic idea of plotting a set of points. First, let’s get a small set of points to plot:</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb464-1" data-line-number="1">xvals &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb464-2" data-line-number="2">yvals &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">3</span>)</a></code></pre></div>
<p><code>xvals</code> contains the x-coordinates of our points, and <code>yvals</code> contains the corresponding y-coordinates.</p>
<p>We set up a plot as follows:</p>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb465-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> xvals, <span class="dt">y =</span> yvals))</a></code></pre></div>
<p>The <code>ggplot()</code> function sets up a basic two-dimensional grid. The <code>mapping</code> parameter explains how data will be “mapped” to particular positions on the plot. In this case it has been set to:</p>
<pre><code>aes(x = xvals, y = yvals)</code></pre>
<p><code>aes</code> is short for “aesthetics”, which has to do with how somethings <em>looks</em>. The expression means that <code>xvals</code> will be located on the x-axis and <code>yvals</code> will be located on the y-axis of the plot.</p>
<p>Now let’s see what we get if we actually run the call to the <code>ggplot()</code> function (see Figure @ref(fig:blank-ggplot)):</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb467-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> xvals, <span class="dt">y =</span> yvals))</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/blank-ggplot-1.png" alt="A ggplot2 plot without geoms." width="50%" />
<p class="caption">
(#fig:blank-ggplot)A ggplot2 plot without geoms.
</p>
</div>
<p>The plot is blank! Why is this? Well, although <code>ggplot()</code> has been told what values are to be represented on the plot and where they might go, it has not yet been told how they should be shaped: it has not been told their <em>geometry</em>, you might say. We can add a geometry to the plot to get a picture (see Figure @ref(fig:pointsggplot):</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb468-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> xvals, <span class="dt">y =</span> yvals)) <span class="op">+</span></a>
<a class="sourceLine" id="cb468-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/pointsggplot-1.png" alt="A ggplot2 plot with the point geom." width="50%" />
<p class="caption">
(#fig:pointsggplot)A ggplot2 plot with the point geom.
</p>
</div>
<p>The geometry determines a lot about the look of the plot. In order to have the points connected by lines we could add <code>geom_line()</code> (see Figure @ref(fig:pointslinesggplot):</p>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb469-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> xvals, <span class="dt">y =</span> yvals)) <span class="op">+</span></a>
<a class="sourceLine" id="cb469-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb469-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_line</span>()</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/pointslinesggplot-1.png" alt="A ggplot2 plot with point and line geoms." width="50%" />
<p class="caption">
(#fig:pointslinesggplot)A ggplot2 plot with point and line geoms.
</p>
</div>
<p>We’ll choose a scatterplot with connecting lines for our graph of the sequence. With a little more work we can get nice labels for the x and y-axes, and a title for the graph. Our <code>collatz()</code> function now looks like:</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb470-1" data-line-number="1">collatz &lt;-<span class="st"> </span><span class="cf">function</span>(n, <span class="dt">limit =</span> <span class="dv">10000</span>) {</a>
<a class="sourceLine" id="cb470-2" data-line-number="2">  <span class="co"># record initial numer because will change n</span></a>
<a class="sourceLine" id="cb470-3" data-line-number="3">  initial &lt;-<span class="st"> </span>n  </a>
<a class="sourceLine" id="cb470-4" data-line-number="4">  numbers &lt;-<span class="st"> </span><span class="kw">numeric</span>(limit)</a>
<a class="sourceLine" id="cb470-5" data-line-number="5">  counter &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb470-6" data-line-number="6">  <span class="cf">while</span> ( n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>counter <span class="op">&lt;</span><span class="st"> </span>limit) {</a>
<a class="sourceLine" id="cb470-7" data-line-number="7">    counter &lt;-<span class="st"> </span>counter <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb470-8" data-line-number="8">    numbers[counter] &lt;-<span class="st"> </span>n</a>
<a class="sourceLine" id="cb470-9" data-line-number="9">    n &lt;-<span class="st"> </span><span class="kw">collatzRule</span>(n)</a>
<a class="sourceLine" id="cb470-10" data-line-number="10">  }</a>
<a class="sourceLine" id="cb470-11" data-line-number="11">  howMany &lt;-<span class="st"> </span><span class="kw">min</span>(counter, limit)</a>
<a class="sourceLine" id="cb470-12" data-line-number="12">  steps &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span>howMany</a>
<a class="sourceLine" id="cb470-13" data-line-number="13">  <span class="kw">cat</span>(<span class="st">&quot;The Collatz sequence has &quot;</span>, howMany, <span class="st">&quot; elements.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb470-14" data-line-number="14">  show &lt;-<span class="st"> </span><span class="kw">readline</span>(<span class="st">&quot;Do you want to see it (y/n)?  &quot;</span>)</a>
<a class="sourceLine" id="cb470-15" data-line-number="15">  <span class="cf">if</span> ( show <span class="op">==</span><span class="st"> &quot;y&quot;</span> ) {</a>
<a class="sourceLine" id="cb470-16" data-line-number="16">    <span class="kw">print</span>(numbers[steps])</a>
<a class="sourceLine" id="cb470-17" data-line-number="17">  }</a>
<a class="sourceLine" id="cb470-18" data-line-number="18">  <span class="co"># use initial value to make plot title:</span></a>
<a class="sourceLine" id="cb470-19" data-line-number="19">  plotTitle &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;Collatz Sequence for n = &quot;</span>, initial)</a>
<a class="sourceLine" id="cb470-20" data-line-number="20">  <span class="co"># make the plot</span></a>
<a class="sourceLine" id="cb470-21" data-line-number="21">  <span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> steps, <span class="dt">y =</span> numbers[steps])) <span class="op">+</span></a>
<a class="sourceLine" id="cb470-22" data-line-number="22"><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb470-23" data-line-number="23"><span class="st">    </span><span class="kw">labs</span>( <span class="dt">x =</span> <span class="st">&quot;Step&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Collatz Value at Step&quot;</span>,</a>
<a class="sourceLine" id="cb470-24" data-line-number="24">          <span class="dt">title =</span> plotTitle)</a>
<a class="sourceLine" id="cb470-25" data-line-number="25">}</a></code></pre></div>
<p>Try this version a few times, like so:</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb471-1" data-line-number="1"><span class="kw">collatz</span>(<span class="dv">257</span>)</a></code></pre></div>
<p>It’s quite remarkable how much the sequence can rise and fall before hitting 1.</p>
<p>One final consideration is validation of user-input. we don’t want the user to get strange errors if she fails to enter a number worth looking at—a whole number that is greater than 1.</p>
<p>One possible approach is to attempt to coerce the user’s input into an integer, using the <code>as.integer()</code> function:</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb472-1" data-line-number="1"><span class="kw">as.integer</span>(<span class="fl">3.6</span>) <span class="co"># will round to nearest integer</span></a></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb474-1" data-line-number="1"><span class="kw">as.integer</span>(<span class="st">&quot;4&quot;</span>) <span class="co"># will convert string to number 4</span></a></code></pre></div>
<pre><code>## [1] 4</code></pre>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb476-1" data-line-number="1"><span class="kw">as.integer</span>(<span class="st">&quot;4.3&quot;</span>) <span class="co"># will convert AND round</span></a></code></pre></div>
<pre><code>## [1] 4</code></pre>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb478-1" data-line-number="1"><span class="kw">as.integer</span>(<span class="st">&quot;hello&quot;</span>) <span class="co"># cannot convert to integer</span></a></code></pre></div>
<pre><code>## Warning: NAs introduced by coercion</code></pre>
<pre><code>## [1] NA</code></pre>
<p>In the last example, the result is <code>NA</code>, and a cryptic warning was issued. In order to keep the warning from the user, we should wrap any call to <code>as.integer()</code> in the suppressWarnings()` function.</p>
<p>Let’s try out a piece of code that implements validation:</p>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb481-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="dv">-2</span></a>
<a class="sourceLine" id="cb481-2" data-line-number="2">n &lt;-<span class="st"> </span><span class="kw">suppressWarnings</span>(<span class="kw">as.integer</span>(n))</a>
<a class="sourceLine" id="cb481-3" data-line-number="3">isValid &lt;-<span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(n) <span class="op">&amp;&amp;</span><span class="st"> </span>n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb481-4" data-line-number="4">  <span class="cf">if</span> (<span class="op">!</span>isValid ) {</a>
<a class="sourceLine" id="cb481-5" data-line-number="5">    <span class="kw">stop</span>(<span class="st">&quot;Need an integer bigger than 1.  Try again.&quot;</span>)</a>
<a class="sourceLine" id="cb481-6" data-line-number="6">  }</a></code></pre></div>
<pre><code>## Error: Need an integer bigger than 1.  Try again.</code></pre>
<p>The <code>stop()</code> function throws a true error that prevents any further code from being executed, but allows us to write a custom, friendly error-message. The goal of validation is for the user to receive clear and helpful error messages, rather than obscure, technical messages from the depths of R.</p>
<p>Another issue worth considering is that our collatz() function depends on the previously-defined function <code>collatzRule()</code>. In order for it to work correctly, R would need to be able to find the name <code>collatzRule</code> somewhere on the search path. If the user hasn’t already defined the <code>collatzRule()</code> function, then a call to `collatz() will fail.</p>
<p>One solution is simply to remind users of the need to define both <code>collatzRule()</code> and <code>collatz()</code> prior to running <code>collatz()</code>. Another solution—perhaps the kinder one—is to define the <code>collatzRule()</code> function in the body of <code>collatz()</code>. Let’s adopt this approach.</p>
<p>The final version of the <code>collatz()</code> function appears below.</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb483-1" data-line-number="1">collatz &lt;-<span class="st"> </span><span class="cf">function</span>(n, <span class="dt">limit =</span> <span class="dv">10000</span>) {</a>
<a class="sourceLine" id="cb483-2" data-line-number="2">  <span class="co"># validation:</span></a>
<a class="sourceLine" id="cb483-3" data-line-number="3">  n &lt;-<span class="st"> </span><span class="kw">suppressWarnings</span>(<span class="kw">as.integer</span>(n))</a>
<a class="sourceLine" id="cb483-4" data-line-number="4">  isValid &lt;-<span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(n) <span class="op">&amp;&amp;</span><span class="st"> </span>n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb483-5" data-line-number="5">  <span class="cf">if</span> (<span class="op">!</span>isValid ) {</a>
<a class="sourceLine" id="cb483-6" data-line-number="6">    <span class="kw">stop</span>(<span class="st">&quot;Need an integer bigger than 1.  Try again.&quot;</span>)</a>
<a class="sourceLine" id="cb483-7" data-line-number="7">  }</a>
<a class="sourceLine" id="cb483-8" data-line-number="8">  <span class="co"># define collatzRule:</span></a>
<a class="sourceLine" id="cb483-9" data-line-number="9">  collatzRule &lt;-<span class="st"> </span><span class="cf">function</span>(m) {</a>
<a class="sourceLine" id="cb483-10" data-line-number="10">    <span class="cf">if</span> ( m <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb483-11" data-line-number="11">      <span class="kw">return</span>(m<span class="op">/</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb483-12" data-line-number="12">    } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb483-13" data-line-number="13">      <span class="kw">return</span>(<span class="dv">3</span><span class="op">*</span>m <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb483-14" data-line-number="14">    }</a>
<a class="sourceLine" id="cb483-15" data-line-number="15">  }</a>
<a class="sourceLine" id="cb483-16" data-line-number="16">  </a>
<a class="sourceLine" id="cb483-17" data-line-number="17">  <span class="co"># On with the show!</span></a>
<a class="sourceLine" id="cb483-18" data-line-number="18">  <span class="co"># Record initial number because we will change it:</span></a>
<a class="sourceLine" id="cb483-19" data-line-number="19">  initial &lt;-<span class="st"> </span>n </a>
<a class="sourceLine" id="cb483-20" data-line-number="20">  numbers &lt;-<span class="st"> </span><span class="kw">numeric</span>(limit)</a>
<a class="sourceLine" id="cb483-21" data-line-number="21">  counter &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb483-22" data-line-number="22">  <span class="cf">while</span> ( n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>counter <span class="op">&lt;</span><span class="st"> </span>limit) {</a>
<a class="sourceLine" id="cb483-23" data-line-number="23">    counter &lt;-<span class="st"> </span>counter <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb483-24" data-line-number="24">    numbers[counter] &lt;-<span class="st"> </span>n</a>
<a class="sourceLine" id="cb483-25" data-line-number="25">    n &lt;-<span class="st"> </span><span class="kw">collatzRule</span>(n)</a>
<a class="sourceLine" id="cb483-26" data-line-number="26">  }</a>
<a class="sourceLine" id="cb483-27" data-line-number="27">  howMany &lt;-<span class="st"> </span><span class="kw">min</span>(counter, limit)</a>
<a class="sourceLine" id="cb483-28" data-line-number="28">  <span class="kw">cat</span>(<span class="st">&quot;The Collatz sequence has &quot;</span>, howMany, <span class="st">&quot; elements.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb483-29" data-line-number="29">  show &lt;-<span class="st"> </span><span class="kw">readline</span>(<span class="st">&quot;Do you want to see it (y/n)?  &quot;</span>)</a>
<a class="sourceLine" id="cb483-30" data-line-number="30">  <span class="cf">if</span> ( show <span class="op">==</span><span class="st"> &quot;y&quot;</span> ) {</a>
<a class="sourceLine" id="cb483-31" data-line-number="31">    <span class="kw">print</span>(numbers[<span class="dv">1</span><span class="op">:</span>howMany])</a>
<a class="sourceLine" id="cb483-32" data-line-number="32">  }</a>
<a class="sourceLine" id="cb483-33" data-line-number="33">  plotTitle &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;Collatz Sequence for n = &quot;</span>, initial)</a>
<a class="sourceLine" id="cb483-34" data-line-number="34">  steps &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span>howMany</a>
<a class="sourceLine" id="cb483-35" data-line-number="35">  <span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> steps, <span class="dt">y =</span> numbers[<span class="dv">1</span><span class="op">:</span>howMany])) <span class="op">+</span></a>
<a class="sourceLine" id="cb483-36" data-line-number="36"><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb483-37" data-line-number="37"><span class="st">    </span><span class="kw">labs</span>( <span class="dt">x =</span> <span class="st">&quot;Step&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Collatz Value at Step&quot;</span>,</a>
<a class="sourceLine" id="cb483-38" data-line-number="38">          <span class="dt">title =</span> plotTitle)</a>
<a class="sourceLine" id="cb483-39" data-line-number="39">}</a></code></pre></div>

</div>
<div id="glossary" class="section level2 unnumbered">
<h2>Glossary</h2>
<dl>
<dt>Flow Control </dt>
<dd><p>The collection of devices within a programming language that allow the computer to make decisions and to repeat tasks.</p>
</dd>
<dt>Condition </dt>
<dd><p>A Boolean expression that commences an <code>if</code> or <code>while</code> statement. If the condition evaluates to <code>TRUE</code>, then the code in the body of the statement will be executed. Otherwise the code will be ignored.</p>
</dd>
<dt>Index Variable </dt>
<dd><p>The variable in a <code>for</code> loop that takes on each of the values of the iterable in succession.</p>
</dd>
<dt>Iterable </dt>
<dd><p>The vector that provides the sequence of values for the index variable in a <code>for</code> loop.</p>
</dd>
<dt>Validation </dt>
<dd><p>The process of checking user input and rejecting it—usually with helpful suggestions—if it is not of the correct form.</p>
</dd>
</dl>

</div>
<div id="exercises" class="section level2 unnumbered">
<h2>Exercises</h2>
<p><img src="images/thinking.png" width="50%" style="display: block; margin: auto;" /></p>
<ol style="list-style-type: decimal">
<li>The <em>absolute value</em> of a number <span class="math inline">\(x\)</span> is defined to be the number <span class="math inline">\(x\)</span> itself if <span class="math inline">\(x \ge 0\)</span>, whereas it is the opposite of <span class="math inline">\(x\)</span> if <span class="math inline">\(x &lt; 0\)</span>. Thus:
<ul>
<li>the absolute value of 3 is 3;</li>
<li>the absolute value of -3 is -(-3), which is 3;</li>
<li>the absolute value of -5.7 is -(-5.7), which is 5.7</li>
<li>the absolute value of 0 is 0.</li>
</ul>
<p>The absolute value is important enough that R provides the <code>abs()</code> function to compute it. Thus:</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb484-1" data-line-number="1"><span class="kw">abs</span>(<span class="op">-</span><span class="fl">3.7</span>)</a></code></pre></div>
<pre><code>## [1] 3.7</code></pre>
<p>Write a function called <code>absolute()</code> that computes the absolute value of any given number <code>x</code>. Your code should make no reference to R’s <code>abs()</code>.</p>
<p><strong>Small Bonus</strong>: Write the function so that it follows the vector-in, vector-out principle, that is: when it is given a vector of numbers it returns the vector of their absolute values, like this:</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb486-1" data-line-number="1">vec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">5</span>, <span class="fl">-2.7</span>)</a>
<a class="sourceLine" id="cb486-2" data-line-number="2"><span class="kw">absolute</span>(vec)</a></code></pre></div>
<pre><code>## [1] 3.0 5.0 2.7</code></pre></li>
<li><p>Write a function called <code>pattern()</code> that, when given any character <span class="math inline">\(x\)</span> and any positive number <span class="math inline">\(n\)</span>, will print the following pattern to the console:</p>
<ul>
<li>a line with just one <span class="math inline">\(x\)</span>,</li>
<li>another line with two <span class="math inline">\(x\)</span>’s,</li>
<li>another line with three <span class="math inline">\(x\)</span>’s,</li>
<li>and so on until …</li>
<li>a line with <span class="math inline">\(n\)</span> <span class="math inline">\(x\)</span>’s, and then</li>
<li>another line with <span class="math inline">\(n-1\)</span> <span class="math inline">\(x\)</span>’s,</li>
<li>and so on until …</li>
<li>a line with just one <span class="math inline">\(x\)</span>.</li>
</ul>
<p>The function should take two arguments:</p>
<ul>
<li><code>char</code>: the character to repeat. The default value should be <code>&quot;*&quot;</code>.</li>
<li><code>n</code>: the number of characters in the longest, middle line. The default value should be 3.</li>
</ul>
<p>Typical examples of use should be as follows:</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb488-1" data-line-number="1"><span class="kw">pattern</span>()</a></code></pre></div>
<pre><code>## *
## **
## ***
## **
## *</code></pre>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb490-1" data-line-number="1"><span class="kw">pattern</span>(<span class="dt">char =</span> <span class="st">&quot;y&quot;</span>, <span class="dt">n =</span> <span class="dv">5</span>)</a></code></pre></div>
<pre><code>## y
## yy
## yyy
## yyyy
## yyyyy
## yyyy
## yyy
## yy
## y</code></pre></li>
<li><p>Write a function called <code>checkerBoard()</code> that prints outs out checkerboard patterns like this:</p>
<pre><code>## -----------
## |*|*|*|*|*|
## -----------
## |*|*|*|*|*|
## -----------
## |*|*|*|*|*|
## -----------
## |*|*|*|*|*|
## -----------
## |*|*|*|*|*|
## -----------</code></pre>
<p>The function should take two parameters:</p>
<ul>
<li><code>char</code>, the character that fills the “squares” of the board. The default value should be <code>&quot;*&quot;</code>.</li>
<li><code>side</code>, the number of rows and columns of the board. There should be no default value.</li>
</ul>
<p>Note that the horizontal boundaries are formed by the hyphen <code>-</code> and the vetical boundaries are formed by the <em>pipe</em> character <code>|</code> that appears on your keyboard above the backslash <code>\</code> character.</p>
<p>Typical examples of use should be as follows:</p>
<pre><code>## -------
## |x|x|x|
## -------
## |x|x|x|
## -------
## |x|x|x|
## -------</code></pre>
<p><strong>Hint</strong>: Note that the number of hyphens in a boundary is always one more than twice the value of <code>side</code>. for example, suppose that <code>side</code> is 5. Then to get a row of the required hyphens, all you need is:</p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb494-1" data-line-number="1">boundary &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;-&quot;</span>, <span class="dt">times =</span> <span class="dv">2</span> <span class="op">*</span><span class="st"> </span>side <span class="op">+</span><span class="st"> </span><span class="dv">1</span>), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb494-2" data-line-number="2"><span class="kw">cat</span>(boundary, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## -----------</code></pre>
<p>For a single row containing the character itself, you might try:</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb496-1" data-line-number="1">between &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;|&quot;</span>, <span class="kw">rep</span>(<span class="kw">c</span>(char, <span class="st">&quot;|&quot;</span>), <span class="dt">times =</span> side), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb496-2" data-line-number="2"><span class="kw">cat</span>(between, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## |x|x|x|x|x|</code></pre>
<p>In the example above, the value of <code>char</code> was <code>&quot;x&quot;</code>.</p></li>
<li><p>Write a function called <code>beerTune()</code> that prints out the complete lyrics to the song <em>Ninety-Nine Bottles of Beer on the Wall</em>. You’ll recall that the song goes like this:</p>
<blockquote>
<p>99 bottles of beer on the wall,</p>
</blockquote>
<blockquote>
<p>99 bottles of beer!</p>
</blockquote>
<blockquote>
<p>Take one down and pass it around:</p>
</blockquote>
<blockquote>
<p>98 bottles of beer on the wall.</p>
</blockquote>
<p><br></p>
<blockquote>
<p>98 bottles of beer on the wall,</p>
</blockquote>
<blockquote>
<p>98 bottles of beer!</p>
</blockquote>
<blockquote>
<p>Take one down and pass it around:</p>
</blockquote>
<blockquote>
<p>97 bottles of beer on the wall.</p>
</blockquote>
<blockquote>
<p>…</p>
</blockquote>
<blockquote>
<p>1 bottle of beer on the wall.</p>
</blockquote>
<blockquote>
<p>1 bottle of beer!</p>
</blockquote>
<blockquote>
<p>Take it down and pass it around:</p>
</blockquote>
<blockquote>
<p>No more bottles of beer on the wall.</p>
</blockquote>
<p>Make sure to get the lyrics exactly right. For example, it’s “1 bottle”, not “1 bottles”.</p></li>
<li><p>Write a function called <code>farmSong()</code> that allows you to vary the lyrics the song about Old MacDonald’s Farm. The function should take two parameters:</p>
<ul>
<li><code>animal</code>: a character vector of names of the animals on the farm;</li>
<li><code>sound</code>: a character vector, of the same length as the vector <code>animal</code>, giving the sound made by each creature in <code>animal</code>.</li>
</ul>
<p>Neither parameter should have a default value. The function should validate its input, stopping with a helpful message if <code>animal</code> and <code>sound</code> don’t have the same length.</p>
<p>Typical examples of use should be as follows:</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb498-1" data-line-number="1"><span class="kw">farmSong</span>(<span class="dt">animal =</span> <span class="kw">c</span>(<span class="st">&quot;cow&quot;</span>, <span class="st">&quot;pig&quot;</span>), <span class="dt">sound =</span> <span class="kw">c</span>(<span class="st">&quot;moo&quot;</span>, <span class="st">&quot;oink&quot;</span>))</a></code></pre></div>
<pre><code>## Old MacDonald had a farm, ee-i-ee-i-oo!
## And on this farm he had a cow, ee-iee-i-oo!
## With a moo-moo here and a moo-moo there
## Here a moo, there a moo everywhere a moo-moo,
## Old MacDonald had a farm, ee-i-ee-i-oo!
## 
## Old MacDonald had a farm, ee-i-ee-i-oo!
## And on this farm he had a pig, ee-iee-i-oo!
## With a oink-oink here and a oink-oink there
## Here a oink, there a oink everywhere a oink-oink,
## Old MacDonald had a farm, ee-i-ee-i-oo!</code></pre>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb500-1" data-line-number="1"><span class="kw">farmSong</span>(<span class="dt">animal =</span> <span class="kw">c</span>(<span class="st">&quot;cow&quot;</span>, <span class="st">&quot;pig&quot;</span>, <span class="st">&quot;horse&quot;</span>), <span class="dt">sound =</span> <span class="kw">c</span>(<span class="st">&quot;moo&quot;</span>, <span class="st">&quot;oink&quot;</span>))</a></code></pre></div>
<pre><code>## I need the same number of sounds as there are animals!</code></pre>
<p><strong>Note</strong>: As the above examples show, you don’t have to worry about getting “a” vs. “an” correct.</p></li>
<li><p>Recall the function <code>madhavaPI()</code> from Section @ref(default-arguments). Use this function to write a function called <code>madhavaSums()</code> that will do the following: given a number <span class="math inline">\(n\)</span>, the function returns a vector consisting of the first <span class="math inline">\(n\)</span> approximations to <span class="math inline">\(\pi\)</span>, using the initial terms of the Madhava series. The function should take a single argument <code>n</code>, whose default value is 10. It should validate the input: if the number entered is not at least 1, then the function should explain to the user that the he/she must enter a positive number, and then stop.</p>
<p>Here is an example of how the function should work:</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb502-1" data-line-number="1"><span class="kw">madhavaSums</span>(<span class="dt">n =</span> <span class="dv">-3</span>)</a></code></pre></div>
<pre><code>## You need to enter a positive integer.  Try again!</code></pre>
<p>Here is another example:</p>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb504-1" data-line-number="1"><span class="kw">madhavaSums</span>()  <span class="co"># using the default value</span></a></code></pre></div>
<pre><code>##  [1] 4.000000 2.666667 3.466667 2.895238 3.339683 2.976046 3.283738
##  [8] 3.017072 3.252366 3.041840</code></pre>
<p>And another:</p>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb506-1" data-line-number="1"><span class="kw">madhavaSums</span>(<span class="dt">n =</span> <span class="dv">20</span>)</a></code></pre></div>
<pre><code>##  [1] 4.000000 2.666667 3.466667 2.895238 3.339683 2.976046 3.283738
##  [8] 3.017072 3.252366 3.041840 3.232316 3.058403 3.218403 3.070255
## [15] 3.208186 3.079153 3.200366 3.086080 3.194188 3.091624</code></pre></li>
<li><p>(*) <strong>The Subtraction Game.</strong> In this game there are two players, A and B, and a pile of <span class="math inline">\(n\)</span> pebbles. The players take turns removing pebbles from the pile. On each turn, a player can take either one or two pebbles. The players who takes the last pebble wins the game.</p>
<p>It turns out that one of the players has a winning strategy. If the initial number of pebbles is a multiple of 3, then player who goes second has a winning strategy, whereas if the initial number of pebbles is not a multiple of 3 then the player who goes second has the winning strategy.</p>
The idea for the winning strategy comes from the following observations:
<ul>
<li>If there are 3 pebbles left and it’s the other player’s turn, then you will win. Why? Because after the other player removes pebbles there will be either 1 or 2 pebbles left. In either case you will be able to take the last pebble.</li>
<li>If there are 6 pebbles left and it’s the other player’s turn, then you will win. Why? Because after the other player removes pebbles there will be either 4 or 5 pebbles left. In either case on your turn you will be able to reduce the number of pebbles to 3. The game is now in the state of the previous bullet item, where we know that you will win.</li>
<li>If there are 9 pebbles left and it’s the other player’s turn, then you will win. Why? Because after the other player removes pebbles there will be either 7 or 8 pebbles left. In either case on your turn you will be able to reduce the number of pebbles to 6. The game is now in the state of the previous bullet item, where we know that you will win.</li>
<li>And so on, for 12 left, 15 left, 18 left, etc.</li>
</ul>
<p>As long as the number of pebbles left is a multiple of 3 and it’s the other player’s turn, you will win!</p>
In this problem your task is to write a function called <code>subtraction()</code> that will play the Subtraction Game with a user. The function should take two parameters:
<ul>
<li><code>n</code>: the number of pebbles to begin with. The default value should be 12.</li>
<li><code>userFirst</code>: a logical parameter that indicates whether the user or the computer plays first. The default value should be <code>TRUE</code>, meaning that the user goes first.</li>
</ul>
<p>Each time the computer plays it should announce how many pebbles it removed, and how many are left. When there are no pebbles left the computer should say who won and then quit the function.</p>
The function should play optimally for the computer:
<ul>
<li>if at the outset the computer has a winning strategy, then the computer should follow it and win.</li>
<li>if at the outset the user has a winning strategy then the computer watch for opportunities to win if the user departs from her winning strategy.</li>
</ul></li>
</ol>
<!--chapter:end:040-flow-control.Rmd-->
</div>
</div>
<div id="turtle" class="section level1">
<h1><span class="header-section-number">3</span> Turtle Graphics</h1>
<div class="figure" style="text-align: center">
<img src="images/xkcd-turtles.png" alt="Turtles, by xkcd." width="90%" />
<p class="caption">
(#fig:xkcd-turtles)Turtles, by xkcd.
</p>
</div>
<p>In this chapter we will practice our knowledge of R—and of basic programming concepts—in the context of a special R-package for graphics: package <strong>TurtleGraphics</strong> <span class="citation">(Cena et al. <a href="#ref-R-TurtleGraphics">2018</a>)</span>. Many of the examples from this Chapter are drawn from the Vignette for the package.<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a></p>

<div id="basic-movements" class="section level2">
<h2><span class="header-section-number">3.1</span> Basic Movements</h2>
<p>First, we begin by loading the package:</p>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb508-1" data-line-number="1"><span class="kw">library</span>(TurtleGraphics)</a></code></pre></div>
<p>In order to create a Turtle Graphics scenario, call the function <code>turtle_init()</code>. You get the plot shown in Figure @ref(fig:initial-turtle).</p>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb509-1" data-line-number="1"><span class="kw">turtle_init</span>()</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/initial-turtle-1.png" alt="Initialized Turtle" width="50%" />
<p class="caption">
(#fig:initial-turtle)Initialized Turtle
</p>
</div>
<p>By default the turtle is positioned in the middle of a square of dimensions 100 units by 100 units. (These dimensions can be changed, as we will see later on.)</p>
<p>You can get the turtle’s position at any time:</p>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb510-1" data-line-number="1"><span class="kw">turtle_getpos</span>()</a></code></pre></div>
<pre><code>##  x  y 
## 50 50 </code></pre>
<p>The turtle also begins facing North. This is considered to be angle 0, as you can tell by asking for the current angle of the turtle:</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb512-1" data-line-number="1"><span class="kw">turtle_getangle</span>()</a></code></pre></div>
<pre><code>## angle 
##     0 </code></pre>
<p>Now let’s make the turtle move. If you are following along on your own computer, it’s best to run the lines of code one at a time, so you can see the effect of each command. (If you run multiples lines, you’ll only see the graph produced by the final line.)</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb514-1" data-line-number="1"><span class="kw">turtle_forward</span>(<span class="dt">dist =</span> <span class="dv">30</span>)</a>
<a class="sourceLine" id="cb514-2" data-line-number="2"><span class="kw">turtle_backward</span>(<span class="dt">dist =</span> <span class="dv">10</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/first-movement-1.png" alt="First Movements" width="50%" />
<p class="caption">
(#fig:first-movement)First Movements
</p>
</div>
<p>The result appears in Figure @ref(fig:first-movement). Next we’ll add a little triangle:</p>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb515-1" data-line-number="1"><span class="kw">turtle_right</span>(<span class="dv">90</span>)</a>
<a class="sourceLine" id="cb515-2" data-line-number="2"><span class="kw">turtle_forward</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb515-3" data-line-number="3"><span class="kw">turtle_left</span>(<span class="dt">angle =</span> <span class="dv">135</span>)</a>
<a class="sourceLine" id="cb515-4" data-line-number="4"><span class="kw">turtle_forward</span>(<span class="fl">14.14</span>)</a>
<a class="sourceLine" id="cb515-5" data-line-number="5"><span class="kw">turtle_left</span>(<span class="dt">angle =</span> <span class="dv">90</span>)</a>
<a class="sourceLine" id="cb515-6" data-line-number="6"><span class="kw">turtle_forward</span>(<span class="fl">14.14</span>)</a>
<a class="sourceLine" id="cb515-7" data-line-number="7"><span class="kw">turtle_left</span>(<span class="dt">angle =</span> <span class="dv">135</span>)</a>
<a class="sourceLine" id="cb515-8" data-line-number="8"><span class="kw">turtle_forward</span>(<span class="dv">10</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/add-triangle-1.png" alt="Adding a Triangle" width="50%" />
<p class="caption">
(#fig:add-triangle)Adding a Triangle
</p>
</div>
<p>You can see the triangle in Figure @ref(fig:add-triangle).</p>
<p>The turtle is set in the “down” position, so that it leaves a trace out the path that it follows. You can avoid the trace by pulling the turtle “up” with <code>turtle_up()</code>. Whenever you want to restore the tracing, call <code>turtle_down()</code>. See Figure @ref(fig:up-down) for the results of the following code.</p>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb516-1" data-line-number="1"><span class="kw">turtle_up</span>()  <span class="co"># stop tracing</span></a>
<a class="sourceLine" id="cb516-2" data-line-number="2"><span class="kw">turtle_right</span>(<span class="dt">angle =</span> <span class="dv">90</span>)</a>
<a class="sourceLine" id="cb516-3" data-line-number="3"><span class="kw">turtle_forward</span>(<span class="dt">dist =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb516-4" data-line-number="4"><span class="kw">turtle_right</span>(<span class="dt">angle =</span> <span class="dv">90</span>)</a>
<a class="sourceLine" id="cb516-5" data-line-number="5"><span class="kw">turtle_forward</span>(<span class="dt">dist =</span> <span class="dv">17</span>)</a>
<a class="sourceLine" id="cb516-6" data-line-number="6"><span class="kw">turtle_down</span>()  <span class="co"># start tracing again</span></a>
<a class="sourceLine" id="cb516-7" data-line-number="7"><span class="kw">turtle_left</span>(<span class="dt">angle =</span> <span class="dv">180</span>)</a>
<a class="sourceLine" id="cb516-8" data-line-number="8"><span class="kw">turtle_forward</span>(<span class="dt">dist =</span> <span class="dv">34</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/up-down-1.png" alt="We moved the turtle around in the up position, then put the turtle down and traced out a line segment." width="50%" />
<p class="caption">
(#fig:up-down)We moved the turtle around in the up position, then put the turtle down and traced out a line segment.
</p>
</div>
<p>You can change the color of the lines your turtle draws:</p>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb517-1" data-line-number="1"><span class="kw">turtle_col</span>(<span class="dt">col =</span> <span class="st">&quot;green&quot;</span>)</a></code></pre></div>
<p>In R here are many, many colors to choose from, and 657 of them even have names. To view them, use:= the <code>colors()</code> function: </p>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb518-1" data-line-number="1"><span class="kw">colors</span>()</a></code></pre></div>
<p>You can also hide your turtle, and show it again any time you like. See Figure @ref(fig:hide-show) for the results of the following code.</p>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb519-1" data-line-number="1"><span class="kw">turtle_hide</span>()</a>
<a class="sourceLine" id="cb519-2" data-line-number="2"><span class="kw">turtle_left</span>(<span class="dt">angle =</span> <span class="dv">150</span>)</a>
<a class="sourceLine" id="cb519-3" data-line-number="3"><span class="kw">turtle_forward</span>(<span class="dt">dist =</span> <span class="dv">20</span>)</a>
<a class="sourceLine" id="cb519-4" data-line-number="4"><span class="kw">turtle_left</span>(<span class="dt">angle =</span> <span class="dv">60</span>)</a>
<a class="sourceLine" id="cb519-5" data-line-number="5"><span class="kw">turtle_forward</span>(<span class="dt">dist =</span> <span class="dv">20</span>)</a>
<a class="sourceLine" id="cb519-6" data-line-number="6"><span class="kw">turtle_show</span>()</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/hide-show-1.png" alt="The graph after hiding, moving and showing." width="50%" />
<p class="caption">
(#fig:hide-show)The graph after hiding, moving and showing.
</p>
</div>
<p>Finally, you can choose the type of line your turtle draws, and the width of the line. See Figure @ref(fig:type-width) for the results of the following code.</p>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb520-1" data-line-number="1"><span class="kw">turtle_left</span>(<span class="dt">angle =</span> <span class="dv">150</span>)</a>
<a class="sourceLine" id="cb520-2" data-line-number="2"><span class="kw">turtle_lty</span>(<span class="dt">lty =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb520-3" data-line-number="3"><span class="kw">turtle_forward</span>(<span class="dt">dist =</span> <span class="dv">17</span>)</a>
<a class="sourceLine" id="cb520-4" data-line-number="4"><span class="kw">turtle_lwd</span>(<span class="dt">lwd =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb520-5" data-line-number="5"><span class="kw">turtle_forward</span>(<span class="dt">dist =</span> <span class="dv">15</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/type-width-1.png" alt="Choosing line-type and line-width." width="50%" />
<p class="caption">
(#fig:type-width)Choosing line-type and line-width.
</p>
</div>
<p><strong>Note:</strong> you can learn more about <code>lty</code> and <code>lwd</code> with <code>help(par)</code>.</p>
</div>
<div id="making-many-movements-an-introduction-to-looping" class="section level2">
<h2><span class="header-section-number">3.2</span> Making Many Movements: An Introduction to Looping</h2>
<p>Eventually we want to make some complex figures that require many movements on the part of the turtle. In order to make these go faster, we can turn off some of the turtle graphing by wrapping the desired movements in <code>turtle_do()</code>. See Figure @ref(fig:turtle-do-intro) for the results of the following code.</p>
<div class="sourceCode" id="cb521"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb521-1" data-line-number="1"><span class="kw">turtle_init</span>()</a>
<a class="sourceLine" id="cb521-2" data-line-number="2"><span class="kw">turtle_do</span>({</a>
<a class="sourceLine" id="cb521-3" data-line-number="3">  <span class="kw">turtle_move</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb521-4" data-line-number="4">  <span class="kw">turtle_turn</span>(<span class="dv">45</span>)</a>
<a class="sourceLine" id="cb521-5" data-line-number="5">  <span class="kw">turtle_move</span>(<span class="dv">15</span>)</a>
<a class="sourceLine" id="cb521-6" data-line-number="6">})</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/turtle-do-intro-1.png" alt="After final movement." width="50%" />
<p class="caption">
(#fig:turtle-do-intro)After final movement.
</p>
</div>
<p>(<code>turtle_turn()</code> turns to the left by default.) Of course, for such a small number of movements using <code>turtle_do()</code> does not matter much, but we will practice using it for a bit.</p>
<p>How might we make a square? The following code offers one way to do it. See Figure @ref(fig:turtle-square) for the results.</p>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb522-1" data-line-number="1"><span class="kw">turtle_init</span>()</a>
<a class="sourceLine" id="cb522-2" data-line-number="2"><span class="kw">turtle_do</span>({</a>
<a class="sourceLine" id="cb522-3" data-line-number="3">  <span class="kw">turtle_move</span>(<span class="dv">20</span>)</a>
<a class="sourceLine" id="cb522-4" data-line-number="4">  <span class="kw">turtle_right</span>(<span class="dv">90</span>)</a>
<a class="sourceLine" id="cb522-5" data-line-number="5">  <span class="kw">turtle_move</span>(<span class="dv">20</span>)</a>
<a class="sourceLine" id="cb522-6" data-line-number="6">  <span class="kw">turtle_right</span>(<span class="dv">90</span>)</a>
<a class="sourceLine" id="cb522-7" data-line-number="7">  <span class="kw">turtle_move</span>(<span class="dv">20</span>)</a>
<a class="sourceLine" id="cb522-8" data-line-number="8">  <span class="kw">turtle_right</span>(<span class="dv">90</span>)</a>
<a class="sourceLine" id="cb522-9" data-line-number="9">  <span class="kw">turtle_move</span>(<span class="dv">20</span>)</a>
<a class="sourceLine" id="cb522-10" data-line-number="10">  <span class="kw">turtle_right</span>(<span class="dv">90</span>)</a>
<a class="sourceLine" id="cb522-11" data-line-number="11">})</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/turtle-square-1.png" alt="Making a square." width="50%" />
<p class="caption">
(#fig:turtle-square)Making a square.
</p>
</div>
<p>This is a bit repetitious. Surely we can take advantage of the fact that there is a clear pattern to the turtle’s movements. A <code>for</code>-loop seems called for, as in the following code to build the square:</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb523-1" data-line-number="1"><span class="kw">turtle_init</span>()</a>
<a class="sourceLine" id="cb523-2" data-line-number="2"><span class="kw">turtle_do</span>({</a>
<a class="sourceLine" id="cb523-3" data-line-number="3">  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) {</a>
<a class="sourceLine" id="cb523-4" data-line-number="4">    <span class="kw">turtle_forward</span>(<span class="dt">dist =</span> <span class="dv">20</span>)</a>
<a class="sourceLine" id="cb523-5" data-line-number="5">    <span class="kw">turtle_right</span>(<span class="dt">angle =</span> <span class="dv">90</span>)</a>
<a class="sourceLine" id="cb523-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb523-7" data-line-number="7">})</a></code></pre></div>
<p>As we learned in Chapter @ref(flow), the more you need to repeat a particular pattern, the more it makes sense to write your code with a loop. Suppose, for example, that you decide to make regular octagons. A regular octagon has eight sides, and you turn 45 degrees after drawing each side. You can do this easily by modifying the square-code as follows (see Figure @ref(fig:turtle-octagon) for the results):</p>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb524-1" data-line-number="1"><span class="kw">turtle_init</span>()</a>
<a class="sourceLine" id="cb524-2" data-line-number="2"><span class="kw">turtle_do</span>({</a>
<a class="sourceLine" id="cb524-3" data-line-number="3">  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">8</span>) {</a>
<a class="sourceLine" id="cb524-4" data-line-number="4">    <span class="kw">turtle_forward</span>(<span class="dt">dist =</span> <span class="dv">20</span>)</a>
<a class="sourceLine" id="cb524-5" data-line-number="5">    <span class="kw">turtle_right</span>(<span class="dt">angle =</span> <span class="dv">45</span>)</a>
<a class="sourceLine" id="cb524-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb524-7" data-line-number="7">})</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/turtle-octagon-1.png" alt="Making an octagon." width="50%" />
<p class="caption">
(#fig:turtle-octagon)Making an octagon.
</p>
</div>
<p>You can even make many small turns, so that the resulting figure starts to look like a circle (see Figure @ref(fig:turtle-circle) for the results):</p>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb525-1" data-line-number="1"><span class="kw">turtle_init</span>()</a>
<a class="sourceLine" id="cb525-2" data-line-number="2"><span class="kw">turtle_setpos</span>(<span class="dt">x =</span> <span class="dv">30</span>, <span class="dt">y =</span> <span class="dv">50</span>)</a>
<a class="sourceLine" id="cb525-3" data-line-number="3"><span class="kw">turtle_do</span>({</a>
<a class="sourceLine" id="cb525-4" data-line-number="4">  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">180</span>) {</a>
<a class="sourceLine" id="cb525-5" data-line-number="5">    <span class="kw">turtle_forward</span>(<span class="dt">dist =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb525-6" data-line-number="6">    <span class="kw">turtle_right</span>(<span class="dt">angle =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb525-7" data-line-number="7">  }</a>
<a class="sourceLine" id="cb525-8" data-line-number="8">})</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/turtle-circle-1.png" alt="Making a circle." width="50%" />
<p class="caption">
(#fig:turtle-circle)Making a circle.
</p>
</div>
<p>Notice that in the above code the turtle was initially set a bit to the left of center, so that the resulting circle would be situated close to middle of the region.</p>
<p>If you allow the index variable to be involved in the computations in the body of the loop then you can start making more complex figures. For example, here is the code for a spiral (see Figure @ref(fig:turtle-spiral) for the results):</p>
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb526-1" data-line-number="1"><span class="kw">turtle_init</span>(<span class="dt">width =</span> <span class="dv">150</span>, <span class="dt">height =</span> <span class="dv">150</span>, <span class="dt">mode =</span> <span class="st">&quot;clip&quot;</span>)</a>
<a class="sourceLine" id="cb526-2" data-line-number="2"><span class="kw">turtle_do</span>({</a>
<a class="sourceLine" id="cb526-3" data-line-number="3">  <span class="kw">turtle_right</span>(<span class="dv">90</span>)</a>
<a class="sourceLine" id="cb526-4" data-line-number="4">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">720</span>) {</a>
<a class="sourceLine" id="cb526-5" data-line-number="5">    <span class="kw">turtle_left</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb526-6" data-line-number="6">    <span class="kw">turtle_forward</span>(i<span class="op">/</span><span class="dv">720</span>)</a>
<a class="sourceLine" id="cb526-7" data-line-number="7">  }</a>
<a class="sourceLine" id="cb526-8" data-line-number="8">})</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/turtle-spiral-1.png" alt="Using a loop to make a spiral." width="50%" />
<p class="caption">
(#fig:turtle-spiral)Using a loop to make a spiral.
</p>
</div>
<p>The turtle turns one degree every time R goes through the loop, but the amount it travels forward (<span class="math inline">\(i/720\)</span>) increases as the index variable <code>i</code> increases.</p>
<p>Another thing to notice is that we set the width and height of the region ourselves, so that the spiral would fit into it. We also set <code>mode</code> to <code>clip</code> rather then leaving it at its default value of <code>error</code>. With <code>mode = &quot;clip&quot;</code>, R won’t throw an error message at you when the turtle moves outside of its region. Clip-mode is very handy when you are developing a graph and don’t know in advance precisely where the turtle will go.</p>
<div id="practice-exercises-5" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Write a program to make a four-sided star with rays of length 20 each, like this:</p>
<p><img src="r-notes_files/figure-html/unnamed-chunk-466-1.png" width="50%" style="display: block; margin: auto;" /></p></li>
<li><p>Write a program to make an eight-sided star with rays of length 30 each, like this:</p>
<p><img src="r-notes_files/figure-html/unnamed-chunk-467-1.png" width="50%" style="display: block; margin: auto;" /></p></li>
</ol>
</div>
<div id="solutions-to-the-practice-exercises-1" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Solutions to the Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>In order to make a single ray you walk 20 units forward from a central point, then walk 20 units back to the center. In order to prepare to make the next ray, you turn after you get back to the center. Since you plan on four rays, you must turn <span class="math inline">\(360/4 = 90\)</span> degrees each time. It makes sense to trace each ray once inside a <code>for</code>-loop. Using <code>turtle_do()</code> will make the loop run much faster. Here’s the code:</p>
<div class="sourceCode" id="cb527"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb527-1" data-line-number="1"><span class="kw">turtle_init</span>(<span class="dt">mode =</span> <span class="st">&quot;clip&quot;</span>)</a>
<a class="sourceLine" id="cb527-2" data-line-number="2"><span class="kw">turtle_do</span>({</a>
<a class="sourceLine" id="cb527-3" data-line-number="3">  <span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span> ) {</a>
<a class="sourceLine" id="cb527-4" data-line-number="4">    <span class="kw">turtle_forward</span>(<span class="dv">20</span>)</a>
<a class="sourceLine" id="cb527-5" data-line-number="5">    <span class="kw">turtle_backward</span>(<span class="dv">20</span>)</a>
<a class="sourceLine" id="cb527-6" data-line-number="6">    <span class="kw">turtle_left</span>(<span class="dv">90</span>)</a>
<a class="sourceLine" id="cb527-7" data-line-number="7">  }</a>
<a class="sourceLine" id="cb527-8" data-line-number="8">})</a></code></pre></div></li>
<li><p>This time in order to make a single ray you walk 30 units forward from a central point, then walk 30 units back to the center. Since you now plan on eight rays, you must turn <span class="math inline">\(360/8 = 45\)</span> degrees each time. Again it makes sense to trace each ray once inside a <code>for</code>-loop. Here’s the code:</p>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb528-1" data-line-number="1"><span class="kw">turtle_init</span>(<span class="dt">mode =</span> <span class="st">&quot;clip&quot;</span>)</a>
<a class="sourceLine" id="cb528-2" data-line-number="2"><span class="kw">turtle_do</span>({</a>
<a class="sourceLine" id="cb528-3" data-line-number="3">  <span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">8</span> ) {</a>
<a class="sourceLine" id="cb528-4" data-line-number="4">    <span class="kw">turtle_forward</span>(<span class="dv">30</span>)</a>
<a class="sourceLine" id="cb528-5" data-line-number="5">    <span class="kw">turtle_backward</span>(<span class="dv">30</span>)</a>
<a class="sourceLine" id="cb528-6" data-line-number="6">    <span class="kw">turtle_left</span>(<span class="dv">45</span>)</a>
<a class="sourceLine" id="cb528-7" data-line-number="7">  }</a>
<a class="sourceLine" id="cb528-8" data-line-number="8">})</a></code></pre></div></li>
</ol>
</div>
</div>
<div id="writing-turtle-functions" class="section level2">
<h2><span class="header-section-number">3.3</span> Writing Turtle Functions</h2>
<p>Once you have designed some shapes that you think you might want to draw again, you should write them up as functions. Here for example, is the code for a function that makes squares:</p>
<div class="sourceCode" id="cb529"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb529-1" data-line-number="1">turtle_square &lt;-<span class="st"> </span><span class="cf">function</span>(side) { </a>
<a class="sourceLine" id="cb529-2" data-line-number="2">  <span class="kw">turtle_do</span>({</a>
<a class="sourceLine" id="cb529-3" data-line-number="3">    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) {</a>
<a class="sourceLine" id="cb529-4" data-line-number="4">      <span class="kw">turtle_forward</span>(side)</a>
<a class="sourceLine" id="cb529-5" data-line-number="5">      <span class="kw">turtle_right</span>(<span class="dv">90</span>)</a>
<a class="sourceLine" id="cb529-6" data-line-number="6">    }</a>
<a class="sourceLine" id="cb529-7" data-line-number="7">  })</a>
<a class="sourceLine" id="cb529-8" data-line-number="8">}</a></code></pre></div>
<p>Note that the user can vary the length of a side. You would use it like this:</p>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb530-1" data-line-number="1"><span class="kw">turtle_init</span>(<span class="dt">mode =</span> <span class="st">&quot;clip&quot;</span>)</a>
<a class="sourceLine" id="cb530-2" data-line-number="2"><span class="kw">turtle_square</span>(<span class="dt">side =</span> <span class="dv">30</span>)</a></code></pre></div>
<div id="practice-exercises-6" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Write a function called <code>star8()</code> that makes an eight-sided star with rays of length 20 each. The user should be able to specify the thickness of the rays (think <code>turtle_lwd()</code>). The body of the function should begin with <code>turtle_init()</code> so that the star is always drawn inside a new field. The function should take a single parameter called <code>width</code>, the desired thickness of the rays. Typical examples of use should be as follows:</p>
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb531-1" data-line-number="1"><span class="kw">star8</span>(<span class="dt">width =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="r-notes_files/figure-html/unnamed-chunk-473-1.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb532-1" data-line-number="1"><span class="kw">star8</span>(<span class="dt">width =</span> <span class="dv">10</span>)</a></code></pre></div>
<p><img src="r-notes_files/figure-html/unnamed-chunk-474-1.png" width="50%" style="display: block; margin: auto;" /></p></li>
<li><p>Modify your <code>star8()</code> function to make a new function called <code>superstar8()</code> that takes an additional parameter called <code>color</code> that allows the user to specify the color of the rays. The default value of <code>color</code> should be <code>&quot;burlywood&quot;</code>. Typical examples of use should be as follows:</p>
<div class="sourceCode" id="cb533"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb533-1" data-line-number="1"><span class="kw">superstar8</span>(<span class="dt">width =</span> <span class="dv">5</span>)</a></code></pre></div>
<p><img src="r-notes_files/figure-html/unnamed-chunk-475-1.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb534-1" data-line-number="1"><span class="kw">superstar8</span>(<span class="dt">width =</span> <span class="dv">15</span>, <span class="dt">color =</span> <span class="st">&quot;lavenderblush4&quot;</span>)</a></code></pre></div>
<p><img src="r-notes_files/figure-html/unnamed-chunk-476-1.png" width="50%" style="display: block; margin: auto;" /></p></li>
</ol>
</div>
<div id="solutions-to-the-practice-exercises-2" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Solutions to the Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>From the Practice Exercises of the previous section we are already familiar with making 8-ray stars; we just need to encapsulate the process into a function. Here’s the code:</p>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb535-1" data-line-number="1">star8 &lt;-<span class="st"> </span><span class="cf">function</span>(width) {</a>
<a class="sourceLine" id="cb535-2" data-line-number="2">  <span class="kw">turtle_init</span>(<span class="dt">mode =</span> <span class="st">&quot;clip&quot;</span>)</a>
<a class="sourceLine" id="cb535-3" data-line-number="3">  <span class="kw">turtle_lwd</span>(<span class="dt">lwd =</span> width)</a>
<a class="sourceLine" id="cb535-4" data-line-number="4">  <span class="kw">turtle_do</span>({</a>
<a class="sourceLine" id="cb535-5" data-line-number="5">  <span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">8</span> ) {</a>
<a class="sourceLine" id="cb535-6" data-line-number="6">    <span class="kw">turtle_forward</span>(<span class="dv">20</span>)</a>
<a class="sourceLine" id="cb535-7" data-line-number="7">    <span class="kw">turtle_backward</span>(<span class="dv">20</span>)</a>
<a class="sourceLine" id="cb535-8" data-line-number="8">    <span class="kw">turtle_turn</span>(<span class="dv">45</span>)</a>
<a class="sourceLine" id="cb535-9" data-line-number="9">  }</a>
<a class="sourceLine" id="cb535-10" data-line-number="10">  })</a>
<a class="sourceLine" id="cb535-11" data-line-number="11">}</a></code></pre></div></li>
<li><p>Try this:</p>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb536-1" data-line-number="1">superstar8 &lt;-<span class="st"> </span><span class="cf">function</span>(width, <span class="dt">color =</span> <span class="st">&quot;burlywood&quot;</span>) {</a>
<a class="sourceLine" id="cb536-2" data-line-number="2">  <span class="kw">turtle_init</span>(<span class="dt">mode =</span> <span class="st">&quot;clip&quot;</span>)</a>
<a class="sourceLine" id="cb536-3" data-line-number="3">  <span class="kw">turtle_lwd</span>(<span class="dt">lwd =</span> width)</a>
<a class="sourceLine" id="cb536-4" data-line-number="4">  <span class="kw">turtle_col</span>(<span class="dt">col =</span> color)</a>
<a class="sourceLine" id="cb536-5" data-line-number="5">  <span class="kw">turtle_do</span>({</a>
<a class="sourceLine" id="cb536-6" data-line-number="6">  <span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">8</span> ) {</a>
<a class="sourceLine" id="cb536-7" data-line-number="7">    <span class="kw">turtle_forward</span>(<span class="dv">20</span>)</a>
<a class="sourceLine" id="cb536-8" data-line-number="8">    <span class="kw">turtle_backward</span>(<span class="dv">20</span>)</a>
<a class="sourceLine" id="cb536-9" data-line-number="9">    <span class="kw">turtle_turn</span>(<span class="dv">45</span>)</a>
<a class="sourceLine" id="cb536-10" data-line-number="10">  }</a>
<a class="sourceLine" id="cb536-11" data-line-number="11">  })</a>
<a class="sourceLine" id="cb536-12" data-line-number="12">}</a></code></pre></div></li>
</ol>
</div>
</div>
<div id="random-moves" class="section level2">
<h2><span class="header-section-number">3.4</span> Random Moves</h2>
<p>So far our turtle has moved in very regular and disciplined ways. It’s time to break the pattern, a bit. R has a quite a few functions to generate numbers that look “random”; we will use some of these functions to make the turtle move about randomly.</p>
<div id="sampling-from-a-vector" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Sampling from a Vector</h3>
<p>You have already met the <code>sample()</code> function (see Section @ref(if-statements)). Let’s take a closer look at it.</p>
<p><code>sample()</code> makes a random choice from a given vector. From the R-help we read that the general form of a call to sample is as follows:</p>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb537-1" data-line-number="1"><span class="kw">sample</span>(x, size, <span class="dt">replace =</span> <span class="ot">FALSE</span>, <span class="dt">prob =</span> <span class="ot">NULL</span>)</a></code></pre></div>
<p>In the above call:</p>
<ul>
<li><code>x</code> is the vector from which we wish to sample (R refers to it as the “population”);</li>
<li><code>size</code> is the number of random samples we want;</li>
<li><code>replace</code> says whether or not to replace each member of the population after we have sampled it.</li>
<li><code>prob</code> specifies the desired probability for each member of the population to be chosen.</li>
</ul>
<p>A few examples will help us understand how the arguments work:</p>
<div class="sourceCode" id="cb538"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb538-1" data-line-number="1">vec &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span> <span class="co"># we&#39;ll sample from this vector</span></a>
<a class="sourceLine" id="cb538-2" data-line-number="2"><span class="kw">sample</span>(vec, <span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] 7</code></pre>
<p>We got only one number because we set <code>size</code> to 1. Every element in <code>vec</code> had an equal chance of being the element selected. This time we got 7, but if you were to run the function again for yourself your results would probably be different.</p>
<p>Let’s sample 10 numbers from <code>vec</code>:</p>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb540-1" data-line-number="1"><span class="kw">sample</span>(vec, <span class="dv">10</span>)</a></code></pre></div>
<pre><code>##  [1]  3  5  2  4  7  6  9  1  8 10</code></pre>
<p>Because <code>replace</code> was left at its default value of <code>FALSE</code>, R did not replace numbers after pulling them from the <code>vec</code>. After each sample, the remaining numbers all had the same chance to be picked next. Setting <code>size</code> to the length of <code>x</code> and keeping <code>replace = FALSE</code> therefore has the effect of randomly shuffling the elements of <code>x</code>.</p>
<p>Of course when <code>replace = FALSE</code> any attempt to sample more than the number of elements of <code>vec</code> will result in an error:</p>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb542-1" data-line-number="1"><span class="kw">sample</span>(vec, <span class="dv">11</span>)</a></code></pre></div>
<pre><code>Error in sample.int(length(x), size, replace, prob) : 
cannot take a sample larger than the 
population when &#39;replace = FALSE&#39;</code></pre>
<p>When we set <code>replace = TRUE</code> then each selected element is returned to the population. At any stage, the chance for a given member of the population to be the one selected next is the same—no matter how many times that member has already been selected. Thus, when <code>replace = TRUE</code> you are liable to see repeats:</p>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb544-1" data-line-number="1"><span class="kw">sample</span>(vec, <span class="dv">20</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>##  [1]  3  8  8  8  8  9  5  6  7  1  4  8  4  1 10  6  3  3  1  9</code></pre>
<p>When the <code>prob</code> parameter is left at its <code>NULL</code> value, R gives each member of the population the <em>same</em> chance to be the member that is selected. It is possible to adjust the probabilities of selection by setting <code>prob</code> to a vector of probabilities (one for each corresponding member of <code>x</code>). Thus, suppose we want to select 20 numbers from <code>vec</code>, according to the following the probabilities:</p>
<ul>
<li>5% chance of selection, for each number from 1 to 8;</li>
<li>30% chance for 9 to be selected;</li>
<li>30% chance for 10 to be selected.</li>
</ul>
<p>Then we can call <code>sample()</code> like this:</p>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb546-1" data-line-number="1"><span class="kw">sample</span>(vec, <span class="dv">20</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb546-2" data-line-number="2">       <span class="dt">prob  =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="fl">0.05</span>, <span class="dv">8</span>), <span class="fl">0.30</span>, <span class="fl">0.30</span>))</a></code></pre></div>
<pre><code>##  [1]  9  1  9 10  9  6  8  9  4  7 10 10  9  2  6  9  5  9 10 10</code></pre>
<p>Notice the majority of 9’s and 10’s: this was fairly likely to occur since each selection had a 60% chance of turning out to be 9 or 10.</p>
</div>
<div id="application-a-bouncing-turtle" class="section level3">
<h3><span class="header-section-number">3.4.2</span> Application: a Bouncing Turtle</h3>
<p>Let’s apply <code>sample()</code> to design a scenario in which the turtle moves a fixed amount at each step, but the direction—north, east, south, or west—is completely random. When the turtle reaches the boundary of its domain, however, we would like it to “bounce back”: i.e., take a step in the direction opposite to the step that brought it to the boundary. We will also query the user prior to each step, asking if he/she wants to see another move. This not only allows the user to decide when to end the scenario; it also permits the user to see where the turtle is after each step.</p>
<p>One possible implementation is as follows:</p>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb548-1" data-line-number="1">turtle_bounce &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">side =</span> <span class="dv">60</span>, <span class="dt">step=</span> <span class="dv">10</span>) {</a>
<a class="sourceLine" id="cb548-2" data-line-number="2">  <span class="cf">if</span> ( (side<span class="op">/</span><span class="dv">2</span>) <span class="op">%%</span><span class="st"> </span>step <span class="op">!=</span><span class="st"> </span><span class="dv">0</span> ) {</a>
<a class="sourceLine" id="cb548-3" data-line-number="3">    <span class="kw">stop</span>(<span class="st">&quot;Side-length divided by two must be a multiple of step.&quot;</span>)</a>
<a class="sourceLine" id="cb548-4" data-line-number="4">  }</a>
<a class="sourceLine" id="cb548-5" data-line-number="5">  bounds &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, side)</a>
<a class="sourceLine" id="cb548-6" data-line-number="6">  <span class="kw">turtle_init</span>(side, side, <span class="dt">mode =</span> <span class="st">&quot;clip&quot;</span>)</a>
<a class="sourceLine" id="cb548-7" data-line-number="7">  origin &lt;-<span class="st"> </span><span class="kw">turtle_getpos</span>()</a>
<a class="sourceLine" id="cb548-8" data-line-number="8">  cp &lt;-<span class="st"> </span><span class="kw">turtle_getpos</span>()</a>
<a class="sourceLine" id="cb548-9" data-line-number="9">  <span class="cf">repeat</span> {</a>
<a class="sourceLine" id="cb548-10" data-line-number="10">    move &lt;-<span class="st"> </span><span class="kw">readline</span>(<span class="dt">prompt =</span> <span class="st">&quot;Go Again? (enter q to quit):  &quot;</span>)</a>
<a class="sourceLine" id="cb548-11" data-line-number="11">    <span class="cf">if</span> ( move <span class="op">==</span><span class="st"> &quot;q&quot;</span>) <span class="cf">break</span></a>
<a class="sourceLine" id="cb548-12" data-line-number="12">    x &lt;-<span class="st"> </span>cp[<span class="st">&quot;x&quot;</span>]</a>
<a class="sourceLine" id="cb548-13" data-line-number="13">    y &lt;-<span class="st"> </span>cp[<span class="st">&quot;y&quot;</span>]</a>
<a class="sourceLine" id="cb548-14" data-line-number="14">    <span class="cf">if</span> (x <span class="op">%in%</span><span class="st"> </span>bounds <span class="op">|</span><span class="st"> </span>y <span class="op">%in%</span><span class="st"> </span>bounds) {</a>
<a class="sourceLine" id="cb548-15" data-line-number="15">      angle &lt;-<span class="st"> </span><span class="dv">180</span></a>
<a class="sourceLine" id="cb548-16" data-line-number="16">    } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb548-17" data-line-number="17">      angle &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">90</span>,<span class="dv">180</span>,<span class="dv">270</span>), <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb548-18" data-line-number="18">    }</a>
<a class="sourceLine" id="cb548-19" data-line-number="19">    <span class="kw">turtle_right</span>(angle)</a>
<a class="sourceLine" id="cb548-20" data-line-number="20">    <span class="kw">turtle_forward</span>(step)</a>
<a class="sourceLine" id="cb548-21" data-line-number="21">    cp &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">turtle_getpos</span>(), <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb548-22" data-line-number="22">    <span class="kw">print</span>(cp)</a>
<a class="sourceLine" id="cb548-23" data-line-number="23">  }</a>
<a class="sourceLine" id="cb548-24" data-line-number="24">  <span class="kw">cat</span>(<span class="st">&quot;All done!&quot;</span>)</a>
<a class="sourceLine" id="cb548-25" data-line-number="25">}</a></code></pre></div>
<p>Play the game a few times, to get a feel for how it works:</p>
<div class="sourceCode" id="cb549"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb549-1" data-line-number="1"><span class="kw">turtle_bounce</span>(<span class="dv">60</span>, <span class="dv">15</span>)</a></code></pre></div>
<p>Let’s examine the code a bit more closely.</p>
<p>The definition indicates that there are two parameters: <code>side</code> and <code>step</code>.</p>
<ul>
<li>The <code>side</code> parameter gives the dimensions of the Turtle’s field. Thus if <code>side</code> were set to 60—which is the default—then the field would be a 60-by-60 square, with the origin <span class="math inline">\((0,0)\)</span> in at lower-left corner and the point <span class="math inline">\((60, 60)\)</span> at the upper-right corner. When the turtle is initialized it will appear in the middle of the square, at the point <span class="math inline">\((30, 30)\)</span>.</li>
<li><code>step</code> specifies how many units the turtle will move at each step. In this analysis we will assume that <code>step</code> is set to 15.</li>
</ul>
<p>Inside the function, we begin with a bit of input-validation:</p>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb550-1" data-line-number="1"><span class="cf">if</span> ( (side<span class="op">/</span><span class="dv">2</span>) <span class="op">%%</span><span class="st"> </span>step <span class="op">!=</span><span class="st"> </span><span class="dv">0</span> ) {</a>
<a class="sourceLine" id="cb550-2" data-line-number="2">    <span class="kw">stop</span>(<span class="st">&quot;Side-length divided by two must be a multiple of step.&quot;</span>)</a>
<a class="sourceLine" id="cb550-3" data-line-number="3">  }</a></code></pre></div>
<p>Remember that the turtle will start at <span class="math inline">\((\texttt{side}/2, \texttt{side}/2)\)</span> and will move <code>step</code> each time. If <span class="math inline">\(\texttt{side}/2\)</span> is not evenly divisible by <code>step</code> then the turtle would be able to go from inside its field to outside in a single step. We don’t want that to happen so we stop the user if the remainder after dividing <span class="math inline">\(\texttt{side}/2\)</span> by <code>side</code> is anything other than zero.</p>
<p>If the input is OK, then we set up a vector <code>bounds</code> that records the smallest and largest possible values for the <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> coordinates of the turtle:</p>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb551-1" data-line-number="1">bounds &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, side)</a></code></pre></div>
<p>Next, we initialize the turtle in the middle of the field and record its initial position in the vector <code>cp</code>:</p>
<div class="sourceCode" id="cb552"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb552-1" data-line-number="1"><span class="kw">turtle_init</span>(side, side, <span class="dt">mode =</span> <span class="st">&quot;clip&quot;</span>)</a>
<a class="sourceLine" id="cb552-2" data-line-number="2">origin &lt;-<span class="st"> </span><span class="kw">turtle_getpos</span>()</a>
<a class="sourceLine" id="cb552-3" data-line-number="3">cp &lt;-<span class="st"> </span><span class="kw">turtle_getpos</span>()</a></code></pre></div>
<p>(You can think of <code>cp</code> as short for: “current position”.)</p>
<p>Next, we enter a <code>repeat</code>-loop. Inside the loop we begin with:</p>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb553-1" data-line-number="1">move &lt;-<span class="st"> </span><span class="kw">readline</span>(<span class="dt">prompt =</span> <span class="st">&quot;Go Again? (enter q to quit):  &quot;</span>)</a>
<a class="sourceLine" id="cb553-2" data-line-number="2"><span class="cf">if</span> ( move <span class="op">==</span><span class="st"> &quot;q&quot;</span>) <span class="cf">break</span></a>
<a class="sourceLine" id="cb553-3" data-line-number="3">x &lt;-<span class="st"> </span>cp[<span class="st">&quot;x&quot;</span>]</a>
<a class="sourceLine" id="cb553-4" data-line-number="4">y &lt;-<span class="st"> </span>cp[<span class="st">&quot;y&quot;</span>]</a></code></pre></div>
<p>We first asked the user if she wanted to quit. If she enters “q” then we’ll break out of the loop and end the scenario. If she enters anything else (including just pressing Enter) then we record the <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> coordinates of the turtle’s current position in the vectors <code>x</code> and <code>y</code> respectively.</p>
<p>Our next task is to determine how the turtle should move:</p>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb554-1" data-line-number="1"><span class="cf">if</span> (x <span class="op">%in%</span><span class="st"> </span>bounds <span class="op">|</span><span class="st"> </span>y <span class="op">%in%</span><span class="st"> </span>bounds) {</a>
<a class="sourceLine" id="cb554-2" data-line-number="2">      angle &lt;-<span class="st"> </span><span class="dv">180</span></a>
<a class="sourceLine" id="cb554-3" data-line-number="3">    } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb554-4" data-line-number="4">      angle &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">90</span>,<span class="dv">180</span>,<span class="dv">270</span>), <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb554-5" data-line-number="5">    }</a></code></pre></div>
<p>If the turtle is at a boundary (either <code>x</code> equal to 0 or 60 or <code>y</code> equal to 0 or 60) then we need to “bounce back”. This corresponds to making the turtle turn right by 180 degrees and then step. On the other hand if the turtle is not at a boundary then the direction of the turtle should be random, so we should have it turn right by either 0, 90, 180 or 270 degrees, with each possibility being equally likely. This is accomplished with the above call to the <code>sample()</code> function.</p>
<p>Having determined the amount by which to turn prior to the next step, we then have the turtle turn that amount and take the step:</p>
<div class="sourceCode" id="cb555"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb555-1" data-line-number="1"><span class="kw">turtle_right</span>(angle)</a>
<a class="sourceLine" id="cb555-2" data-line-number="2"><span class="kw">turtle_forward</span>(step)</a></code></pre></div>
<p>Finally, we set <code>cp</code> to the new position of the turtle, and print that position out to the console for the user to see:</p>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb556-1" data-line-number="1">cp &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">turtle_getpos</span>(), <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb556-2" data-line-number="2"><span class="kw">print</span>(cp)</a></code></pre></div>
<p>Note that we rounded off the position to the nearest while number. This was done because the authors of the <strong>TurtleGraphics</strong> package use floating point arithmetic for their numerical operations, so sometimes the computed positions differ from whole numbers by a very tiny amount.</p>
<p>We then repeat the loop.</p>
</div>
<div id="uniform-random-numbers" class="section level3">
<h3><span class="header-section-number">3.4.3</span> Uniform Random Numbers</h3>
<p><code>sample()</code> picks an element from a finite population. Sometimes, though, we want R to give the impression that it has picked a <em>real number</em> at random out of a range of real numbers. This can be accomplished with the <code>runif()</code> function.</p>
<p>A call to <code>runif()</code> looks like this:</p>
<div class="sourceCode" id="cb557"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb557-1" data-line-number="1"><span class="kw">runif</span>(n, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">1</span>)</a></code></pre></div>
<p>The idea is that R will produce <code>n</code> real numbers that have the appearance of having been drawn randomly from the interval of real numbers whose lower and upper bounds are specified respectively by <code>min</code> and <code>max</code>.</p>
<p>Thus, to get 10 “random” numbers that all lie between 0 and 1, you can leave <code>min</code> and <code>max</code> at their defaults and ask for:</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb558-1" data-line-number="1"><span class="kw">runif</span>(<span class="dv">10</span>)</a></code></pre></div>
<pre><code>##  [1] 0.646902839 0.394225758 0.618501814 0.476891136 0.136097186
##  [6] 0.067384386 0.129152617 0.393117930 0.002582699 0.620205954</code></pre>
</div>
<div id="pseudo-randomness-and-setting-a-seed" class="section level3">
<h3><span class="header-section-number">3.4.4</span> Pseudo-Randomness and Setting a Seed</h3>
<p>It’s important to point out that R doesn’t generate truly random numbers.<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a> After all, R simply runs a computer which operates according to a set of completely-specified steps. Thus the random data generated by R and by other computer languages is often called <em>pseudorandom</em>. Although the functions for random-number generation have been carefully designed so as to follow many of the statistical laws we associate with randomness in nature, all of the pseudo-random output is determined by an initial value and a deterministic number-generating algorithm.</p>
<p>We actually have the ability to set the pseudorandom data ourselves. This is called <em>setting the random seed</em>. From any specified seed, the result of calls to R’s random-data functions will be completely determined (although—just as in the case of “real” randomness—the output will still probably “look” random).</p>
<p>The <code>set.seed()</code> function will fix the random output. Try running the following two lines of code more than once:</p>
<div class="sourceCode" id="cb560"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb560-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">2025</span>)</a>
<a class="sourceLine" id="cb560-2" data-line-number="2"><span class="kw">runif</span>(<span class="dv">10</span>)</a></code></pre></div>
<pre><code>##  [1] 0.7326202 0.4757614 0.5142159 0.4984323 0.7802845 0.5042522 0.8984003
##  [8] 0.1278527 0.6446721 0.5695311</code></pre>
<p>You will get the same output every time. If you change the argument of <code>set.seed()</code> to some other integer the output will probably change—but it will stay the same when you run the code <em>again</em> from that that new seed.</p>
</div>
<div id="drunken-turtle-intro" class="section level3">
<h3><span class="header-section-number">3.4.5</span> Application: a Drunken Turtle</h3>
<p>We will now modify the previous scenario so that the turtle’s motion will be almost completely random. Even though it will take the same-size step every time, the angle at which it steps will be completely random: any real number of degrees from 0 to 360. We will also show the user the position of the turtle at each step, and use the “distance formula” from high-school geometry to compute and display the current distance of the turtle from the place where it started.</p>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb562-1" data-line-number="1">turtle_drunk &lt;-<span class="st"> </span><span class="cf">function</span>(side, step) {</a>
<a class="sourceLine" id="cb562-2" data-line-number="2">  <span class="kw">turtle_init</span>(side, side, <span class="dt">mode =</span> <span class="st">&quot;clip&quot;</span>)</a>
<a class="sourceLine" id="cb562-3" data-line-number="3">  <span class="co"># save (side/2, side/2), the turtle&#39;s initial position:</span></a>
<a class="sourceLine" id="cb562-4" data-line-number="4">  initial &lt;-<span class="st"> </span><span class="kw">turtle_getpos</span>()</a>
<a class="sourceLine" id="cb562-5" data-line-number="5">  <span class="cf">repeat</span> {</a>
<a class="sourceLine" id="cb562-6" data-line-number="6">    move &lt;-<span class="st"> </span><span class="kw">readline</span>(<span class="dt">prompt =</span> <span class="st">&quot;Go Again? (enter q to quit):  &quot;</span>)</a>
<a class="sourceLine" id="cb562-7" data-line-number="7">    <span class="cf">if</span> ( move <span class="op">==</span><span class="st"> &quot;q&quot;</span>) <span class="cf">break</span></a>
<a class="sourceLine" id="cb562-8" data-line-number="8">    <span class="co"># pick a random angle to turn by:</span></a>
<a class="sourceLine" id="cb562-9" data-line-number="9">    angle &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">360</span>)</a>
<a class="sourceLine" id="cb562-10" data-line-number="10">    <span class="kw">turtle_left</span>(angle)</a>
<a class="sourceLine" id="cb562-11" data-line-number="11">    <span class="kw">turtle_forward</span>(step)</a>
<a class="sourceLine" id="cb562-12" data-line-number="12">    <span class="co"># get new position, make it the current position:</span></a>
<a class="sourceLine" id="cb562-13" data-line-number="13">    cp &lt;-<span class="st"> </span><span class="kw">turtle_getpos</span>()</a>
<a class="sourceLine" id="cb562-14" data-line-number="14">    <span class="co"># print to console:</span></a>
<a class="sourceLine" id="cb562-15" data-line-number="15">    <span class="kw">print</span>(cp)</a>
<a class="sourceLine" id="cb562-16" data-line-number="16">    <span class="co"># determine distnce from initial position (round to 3 decimals):</span></a>
<a class="sourceLine" id="cb562-17" data-line-number="17">    distance &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">sqrt</span>((cp[<span class="dv">1</span>] <span class="op">-</span><span class="st"> </span>initial[<span class="dv">1</span>])<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>(cp[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>initial[<span class="dv">2</span>])<span class="op">^</span><span class="dv">2</span>),<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb562-18" data-line-number="18">    <span class="co"># prepare message to console,and print it:</span></a>
<a class="sourceLine" id="cb562-19" data-line-number="19">    message &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;Distance from starting point is: &quot;</span>, distance)</a>
<a class="sourceLine" id="cb562-20" data-line-number="20">    <span class="kw">cat</span>(message)</a>
<a class="sourceLine" id="cb562-21" data-line-number="21">  }</a>
<a class="sourceLine" id="cb562-22" data-line-number="22">  <span class="kw">cat</span>(<span class="st">&quot;All done!&quot;</span>)</a>
<a class="sourceLine" id="cb562-23" data-line-number="23">}</a></code></pre></div>
<p>Try the game once or twice:</p>
<div class="sourceCode" id="cb563"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb563-1" data-line-number="1"><span class="kw">turtle_drunk</span>(<span class="dv">100</span>, <span class="dv">5</span>)</a></code></pre></div>
<p>It is natural to wonder how likely the turtle is to wander back close to where it started, and to wonder how often that will happen. We will address questions like these in Chapter @ref(simulation).</p>
</div>
<div id="turtle-practice" class="section level3">
<h3><span class="header-section-number">3.4.6</span> Practice Exercises</h3>
<p>Many of these exercises don’t deal directly with turtles, but instead drill you on the <code>sample()</code> and runif()` functions.</p>
<ol style="list-style-type: decimal">
<li><p>Write a call to the <code>sample()</code> function so that it will pick a whole number at random from 1 to 10. Each number should have the same chance to be selected.</p></li>
<li><p>You have a large bag of M&amp;Ms. You reach in an grab a few. You have an equal to chance to grab any number of M&amp;Ms from 1 to 10. (You can’t grab more than 10, and you can’t grab none.) Write a one-line command that expresses how many you grab.</p></li>
<li><p>Write a call to the <code>sample()</code> function that will pick five numbers at random from the whole numbers from 1 to 10. On each pick, each of the ten numbers should have a 1-in-10 chance to be selected.</p></li>
<li><p>Write a call to the <code>sample()</code> function that will pick five numbers at random from the whole numbers from 1 to 10. It should not be possible to get the same number twice.</p></li>
<li><p>Write a call to the <code>sample()</code> function that scrambles the whole numbers from 1 to 10 in a random order.</p></li>
<li><p>Write a call to the <code>sample()</code> functions that randomly re-orders the lowercase letters of the English alphabet.</p></li>
<li><p>The function <code>color()</code> produces a character vector of the named colors that R is prepared to draw. Run it at the Console:</p>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb564-1" data-line-number="1"><span class="kw">colors</span>()</a></code></pre></div>
<p>How many named colors are there? Let’s let R find out for us:</p>
<div class="sourceCode" id="cb565"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb565-1" data-line-number="1"><span class="kw">length</span>(<span class="kw">colors</span>())</a></code></pre></div>
<pre><code>## [1] 657</code></pre>
<p>Write a call to the <code>sample()</code> function that will pick a single named color at random.</p></li>
<li><p>Write a call to <code>runif()</code> that will produce a single random real number between 0 and 1.</p></li>
<li><p>Write a call to <code>runif()</code> that will produce 20 random real numbers between 0 and 1.</p></li>
<li><p>Write a call to <code>runif()</code> that will produce 30 random real numbers, each of them between 10 and 15.</p></li>
<li><p>You enter a forest where there are many sticks on the ground. Each of them is equally likely to be anywhere between 0 and 10 feet long. You pick up five sticks at random. Write a one-line R-command that produces the length of shortest stick that you pick up.</p></li>
<li><p>Write a function called <code>randomColor8()</code> that produces an 8-ray star. Here are the specs:</p>
<ul>
<li>The user should be able to determine the type of the line (think <code>turtle_lty()</code>).</li>
<li>Each ray should have a 30% chance of being red and a 70% chance of being blue.</li>
<li>In addition, the length of each ray should be a random real number between 10 and 40.</li>
<li>The function should take a single parameter called <code>type</code> that the user can set to determine the line-type for the rays; its default-value should be 1.</li>
<li>The width of each ray should be 5.</li>
</ul>
<p>Typical examples of use should be as follows:</p>
<div class="sourceCode" id="cb567"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb567-1" data-line-number="1"><span class="kw">randomColor8</span>()</a></code></pre></div>
<p><img src="r-notes_files/figure-html/unnamed-chunk-502-1.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb568"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb568-1" data-line-number="1"><span class="kw">randomColor8</span>(<span class="dt">type =</span> <span class="dv">3</span>)</a></code></pre></div>
<p><img src="r-notes_files/figure-html/unnamed-chunk-503-1.png" width="50%" style="display: block; margin: auto;" /></p></li>
</ol>
</div>
<div id="solutions-to-the-practice-exercises-3" class="section level3">
<h3><span class="header-section-number">3.4.7</span> Solutions to the Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p><code>sample(1:10, size = 1)</code></p></li>
<li><p>The previous function call will do: <code>sample(1:10, size = 1)</code>.</p></li>
<li><p><code>sample(1:10, size = 5, replace = TRUE)</code></p></li>
<li><p><code>sample(1:10, size = 5, replace = FALSE)</code></p></li>
<li><p><code>sample(1:10, size = 10, replace = FALSE)</code></p></li>
<li><p><code>sample(letters, size = length(letters), replace = FALSE)</code></p></li>
<li><p><code>sample(colors(), size = 1)</code></p></li>
<li><p><code>runif()</code></p></li>
<li><p><code>runif(20)</code></p></li>
<li><p><code>runif(30, min = 10, max = 15)</code></p></li>
<li><p><code>min(runif(5, min = 0, max = 10))</code></p></li>
<li><p>Try this:</p>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb569-1" data-line-number="1">randomColor8 &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">type =</span> <span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb569-2" data-line-number="2">  allowedColors &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>)</a>
<a class="sourceLine" id="cb569-3" data-line-number="3">  <span class="kw">turtle_init</span>(<span class="dt">mode =</span> <span class="st">&quot;clip&quot;</span>)</a>
<a class="sourceLine" id="cb569-4" data-line-number="4">  <span class="kw">turtle_lty</span>(<span class="dt">lty =</span> type)</a>
<a class="sourceLine" id="cb569-5" data-line-number="5">  <span class="kw">turtle_lwd</span>(<span class="dt">lwd =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb569-6" data-line-number="6">  <span class="kw">turtle_do</span>({</a>
<a class="sourceLine" id="cb569-7" data-line-number="7">    <span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">8</span> ) {</a>
<a class="sourceLine" id="cb569-8" data-line-number="8">      <span class="kw">turtle_col</span>(<span class="dt">col =</span> <span class="kw">sample</span>(allowedColors, </a>
<a class="sourceLine" id="cb569-9" data-line-number="9">                              <span class="dt">size =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb569-10" data-line-number="10">                              <span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.3</span>, <span class="fl">0.7</span>)))</a>
<a class="sourceLine" id="cb569-11" data-line-number="11">      rayLength &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>, <span class="dt">min =</span> <span class="dv">10</span>, <span class="dt">max =</span> <span class="dv">40</span>)</a>
<a class="sourceLine" id="cb569-12" data-line-number="12">      <span class="kw">turtle_forward</span>(rayLength)</a>
<a class="sourceLine" id="cb569-13" data-line-number="13">      <span class="kw">turtle_backward</span>(rayLength)</a>
<a class="sourceLine" id="cb569-14" data-line-number="14">      <span class="kw">turtle_left</span>(<span class="dv">45</span>)</a>
<a class="sourceLine" id="cb569-15" data-line-number="15">    }</a>
<a class="sourceLine" id="cb569-16" data-line-number="16">  })</a>
<a class="sourceLine" id="cb569-17" data-line-number="17">}</a></code></pre></div></li>
</ol>
</div>
</div>
<div id="more-complex-turtle-graphs" class="section level2">
<h2><span class="header-section-number">3.5</span> More Complex Turtle Graphs</h2>
<p>Simple instructions, when combined with looping, can produce quite complex patterns. Consider the following process (with results shown in Figure @ref(fig:turtle-zany)):</p>
<div class="sourceCode" id="cb570"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb570-1" data-line-number="1"><span class="kw">turtle_init</span>(<span class="dv">1000</span>, <span class="dv">1000</span>, <span class="dt">mode =</span> <span class="st">&quot;clip&quot;</span>)</a>
<a class="sourceLine" id="cb570-2" data-line-number="2"><span class="kw">turtle_do</span>({</a>
<a class="sourceLine" id="cb570-3" data-line-number="3">  <span class="kw">turtle_setpos</span>(<span class="dv">600</span>,<span class="dv">400</span>)</a>
<a class="sourceLine" id="cb570-4" data-line-number="4">  <span class="kw">turtle_right</span>(<span class="dv">90</span>)</a>
<a class="sourceLine" id="cb570-5" data-line-number="5">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2000</span>) {</a>
<a class="sourceLine" id="cb570-6" data-line-number="6">    <span class="kw">turtle_right</span>(i)</a>
<a class="sourceLine" id="cb570-7" data-line-number="7">    <span class="kw">turtle_forward</span>(<span class="kw">sqrt</span>(i))</a>
<a class="sourceLine" id="cb570-8" data-line-number="8">  }</a>
<a class="sourceLine" id="cb570-9" data-line-number="9">})</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/turtle-zany-1.png" alt="Galactic Zany!" width="50%" />
<p class="caption">
(#fig:turtle-zany)Galactic Zany!
</p>
</div>
<p>You might enjoy figuring out why this pattern occurs. As you ponder this, it might help to construct a set of “ragged” spirals with somewhat larger steps, and pause at each step. Code like the following might be useful:<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a></p>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb571-1" data-line-number="1"><span class="kw">turtle_init</span>(<span class="dv">1000</span>, <span class="dv">1000</span>, <span class="dt">mode =</span> <span class="st">&quot;clip&quot;</span>)</a>
<a class="sourceLine" id="cb571-2" data-line-number="2"><span class="kw">turtle_do</span>({</a>
<a class="sourceLine" id="cb571-3" data-line-number="3">  i &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb571-4" data-line-number="4">  <span class="kw">turtle_right</span>(<span class="dv">90</span>)</a>
<a class="sourceLine" id="cb571-5" data-line-number="5">  <span class="cf">repeat</span> {</a>
<a class="sourceLine" id="cb571-6" data-line-number="6">    bidding &lt;-<span class="st"> </span><span class="kw">readline</span>(<span class="st">&quot;Proceed? (Enter q to quit) &quot;</span>)</a>
<a class="sourceLine" id="cb571-7" data-line-number="7">    <span class="cf">if</span> ( bidding <span class="op">==</span><span class="st"> &quot;q&quot;</span>) <span class="cf">break</span></a>
<a class="sourceLine" id="cb571-8" data-line-number="8">    <span class="kw">turtle_right</span>(i)</a>
<a class="sourceLine" id="cb571-9" data-line-number="9">    <span class="kw">turtle_forward</span>(<span class="dv">2</span><span class="op">*</span><span class="kw">sqrt</span>(i))</a>
<a class="sourceLine" id="cb571-10" data-line-number="10">    <span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot;Turned &quot;</span>, i, <span class="st">&quot; degrees,</span><span class="ch">\n</span><span class="st">&quot;</span>))</a>
<a class="sourceLine" id="cb571-11" data-line-number="11">    <span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot;stepped forward &quot;</span>, <span class="kw">round</span>(<span class="dv">2</span><span class="op">*</span><span class="kw">sqrt</span>(i), <span class="dv">3</span>), <span class="st">&quot; units.</span><span class="ch">\n</span><span class="st">&quot;</span>))</a>
<a class="sourceLine" id="cb571-12" data-line-number="12">    <span class="kw">cat</span>(<span class="st">&quot;Turtle&#39;s current angle is: &quot;</span>, <span class="kw">turtle_getangle</span>(), <span class="st">&quot; degrees.</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb571-13" data-line-number="13">    i &lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb571-14" data-line-number="14">  }</a>
<a class="sourceLine" id="cb571-15" data-line-number="15">  <span class="kw">cat</span>(<span class="st">&quot;All done!&quot;</span>)</a>
<a class="sourceLine" id="cb571-16" data-line-number="16">})</a></code></pre></div>
</div>
<div id="artistic-turtles" class="section level2">
<h2><span class="header-section-number">3.6</span> Artistic Turtles</h2>
<p>In the Practice Exercises (see Section @ref(turtle-practice)) you met the <code>colors()</code> function. Let’s have the Turtle put it to good use.</p>
<p>First of all, we might ask the Turtle to show us a sample of a given color:</p>
<div class="sourceCode" id="cb572"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb572-1" data-line-number="1">turtle_show_color &lt;-<span class="st"> </span><span class="cf">function</span>(color) {</a>
<a class="sourceLine" id="cb572-2" data-line-number="2">  <span class="kw">cat</span>(<span class="st">&quot;I&#39;m drawing a &quot;</span>, color, <span class="st">&quot; square!&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb572-3" data-line-number="3">  <span class="kw">turtle_init</span>()</a>
<a class="sourceLine" id="cb572-4" data-line-number="4">  <span class="kw">turtle_col</span>(color)</a>
<a class="sourceLine" id="cb572-5" data-line-number="5">  <span class="kw">turtle_lwd</span>(<span class="dv">50</span>)</a>
<a class="sourceLine" id="cb572-6" data-line-number="6">  <span class="kw">turtle_do</span>({</a>
<a class="sourceLine" id="cb572-7" data-line-number="7">    <span class="kw">turtle_setpos</span>(<span class="dt">x =</span> <span class="dv">30</span>, <span class="dt">y =</span> <span class="dv">30</span>)</a>
<a class="sourceLine" id="cb572-8" data-line-number="8">    <span class="kw">turtle_square</span>(<span class="dv">40</span>)</a>
<a class="sourceLine" id="cb572-9" data-line-number="9">  })</a>
<a class="sourceLine" id="cb572-10" data-line-number="10">}</a></code></pre></div>
<p>Note the very thick lines specified above: <code>turtle_lwd(50)</code>. Our turtle will draw a square with very thick sides that have the desired color. Let’s ask for burlywood. The resulting color-swatch is shown in Figure @ref(fig:turtle-burlywood).</p>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb573-1" data-line-number="1"><span class="kw">turtle_show_color</span>(<span class="st">&quot;burlywood&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/turtle-burlywood-1.png" alt="I'm drawing a burlywood square!" width="50%" />
<p class="caption">
(#fig:turtle-burlywood)I’m drawing a burlywood square!
</p>
</div>
<p>Feel free to ask for a random color. The result of the call below is shown in Figure @ref(fig:turtle-show-random-color).</p>
<div class="sourceCode" id="cb574"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb574-1" data-line-number="1"><span class="kw">turtle_show_color</span>(<span class="kw">sample</span>(<span class="kw">colors</span>(), <span class="dt">size =</span> <span class="dv">1</span>))</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/turtle-show-random-color-1.png" alt="I'm drawing a palegreen2 square!" width="50%" />
<p class="caption">
(#fig:turtle-show-random-color)I’m drawing a palegreen2 square!
</p>
</div>
<p>The function below is the Turtle’s attempt to dash off a quick imitation of the work of Jackson Pollack, the great American abstract expressionist:</p>
<div class="sourceCode" id="cb575"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb575-1" data-line-number="1">turtle_quick_pollack &lt;-<span class="st"> </span><span class="cf">function</span>(strokes) {</a>
<a class="sourceLine" id="cb575-2" data-line-number="2">  <span class="kw">turtle_init</span>(<span class="dt">mode =</span> <span class="st">&quot;clip&quot;</span>)</a>
<a class="sourceLine" id="cb575-3" data-line-number="3">  <span class="kw">turtle_lwd</span>(<span class="dv">50</span>)</a>
<a class="sourceLine" id="cb575-4" data-line-number="4">  colorsUsed &lt;-<span class="st"> </span><span class="kw">character</span>(strokes)</a>
<a class="sourceLine" id="cb575-5" data-line-number="5">  <span class="kw">turtle_do</span>({</a>
<a class="sourceLine" id="cb575-6" data-line-number="6">    <span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>strokes ) {</a>
<a class="sourceLine" id="cb575-7" data-line-number="7">      randomColor &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">colors</span>(), <span class="dt">size =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb575-8" data-line-number="8">      <span class="kw">turtle_col</span>(randomColor)</a>
<a class="sourceLine" id="cb575-9" data-line-number="9">      colorsUsed[i] &lt;-<span class="st"> </span>randomColor</a>
<a class="sourceLine" id="cb575-10" data-line-number="10">      randomAngle &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">360</span>)</a>
<a class="sourceLine" id="cb575-11" data-line-number="11">      <span class="kw">turtle_left</span>(randomAngle)</a>
<a class="sourceLine" id="cb575-12" data-line-number="12">      <span class="kw">turtle_forward</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb575-13" data-line-number="13">    }</a>
<a class="sourceLine" id="cb575-14" data-line-number="14">  })</a>
<a class="sourceLine" id="cb575-15" data-line-number="15">  <span class="kw">cat</span>(<span class="st">&quot;Behold my masterpiece!  It was painted with:</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb575-16" data-line-number="16">  <span class="kw">print</span>(colorsUsed)</a>
<a class="sourceLine" id="cb575-17" data-line-number="17">}</a></code></pre></div>
<p>Note that the colors used are output to the console. Let’s have it make a picture with 50 strokes made by random-colored brushes. The resulting painting appears as Figure @ref(fig:turtle-quick-pollack)</p>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb576-1" data-line-number="1"><span class="kw">turtle_quick_pollack</span>(<span class="dv">50</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/turtle-quick-pollack-1.png" alt="Behold my masterpiece!" width="50%" />
<p class="caption">
(#fig:turtle-quick-pollack)Behold my masterpiece!
</p>
</div>
<pre><code>## Behold my masterpiece!  It was painted with:
##  [1] &quot;floralwhite&quot;          &quot;darkolivegreen4&quot;      &quot;lemonchiffon&quot;        
##  [4] &quot;steelblue4&quot;           &quot;grey80&quot;               &quot;palegreen2&quot;          
##  [7] &quot;grey98&quot;               &quot;lightpink4&quot;           &quot;olivedrab&quot;           
## [10] &quot;lightyellow4&quot;         &quot;grey7&quot;                &quot;seashell&quot;            
## [13] &quot;gold&quot;                 &quot;grey3&quot;                &quot;limegreen&quot;           
## [16] &quot;darkorchid2&quot;          &quot;magenta1&quot;             &quot;gray72&quot;              
## [19] &quot;lightsalmon&quot;          &quot;maroon4&quot;              &quot;salmon2&quot;             
## [22] &quot;grey48&quot;               &quot;maroon3&quot;              &quot;green4&quot;              
## [25] &quot;coral3&quot;               &quot;lightgoldenrodyellow&quot; &quot;burlywood1&quot;          
## [28] &quot;gray9&quot;                &quot;lavenderblush4&quot;       &quot;chocolate4&quot;          
## [31] &quot;darkcyan&quot;             &quot;navajowhite1&quot;         &quot;gray21&quot;              
## [34] &quot;gray59&quot;               &quot;tomato&quot;               &quot;tan4&quot;                
## [37] &quot;maroon4&quot;              &quot;lightpink3&quot;           &quot;thistle1&quot;            
## [40] &quot;dodgerblue1&quot;          &quot;darkslategray1&quot;       &quot;gray87&quot;              
## [43] &quot;ivory2&quot;               &quot;grey&quot;                 &quot;snow&quot;                
## [46] &quot;lavenderblush2&quot;       &quot;ivory&quot;                &quot;indianred1&quot;          
## [49] &quot;lightyellow&quot;          &quot;powderblue&quot;</code></pre>

</div>
<div id="glossary-1" class="section level2 unnumbered">
<h2>Glossary</h2>
<dl>
<dt>Pseudo-random Numbers </dt>
<dd><p>A sequence of numbers generated by a computer procedure designed to make the sequence appear to follow statistical laws associated with random processes in nature.</p>
</dd>
</dl>

</div>
<div id="exercises-1" class="section level2 unnumbered">
<h2>Exercises</h2>
<p><img src="images/thinking.png" width="50%" style="display: block; margin: auto;" /></p>
<ol style="list-style-type: decimal">
<li><p>Write a function called <code>turtle_gon()</code> that draws a regular polygon. The user should be able to specify the side-length and the number of sides. Start with <code>turtle_init()</code> and use your function to draw a regular dodecagon (twelve sides) with each side having a side length of 15 units. Your figure should not stray outside of the turtle’s field, so you may have to adjust the position of your turtle a bit prior to calling your function.</p></li>
<li>Write a function called <code>turtle_star()</code> that can make stars like the ones in Figure @ref(fig:turtlestarstart). Here are the required parameters:
<ul>
<li><code>n</code>: the number of rays in a star (default should be 6);</li>
<li><code>length</code>: the length of the rays (default should be 20);</li>
<li><code>color</code>: the color of the rays (default should be <code>&quot;red&quot;</code>);</li>
<li><code>type</code>: the line-type of the rays (default should be 1);</li>
<li><code>width</code>: the line-width of the rays (default should be 1).</li>
</ul>
<div class="figure" style="text-align: center">
<img src="images/turtle-stars.png" alt="Sample Stars" width="60%" />
<p class="caption">
(#fig:turtlestarstart)Sample Stars
</p>
</div>
<p>Starting with <code>turtle_init()</code>, use your function to create a star with 10 rays, each of length 20 units. The lines should be red and dashed. I’ll leave the thickness up to you.</p></li>
<li><p>Make a new star function <code>turtle_rstar()</code> in which the lengths of the rays are not determined by the user but instead vary randomly from 5 to 25 units, as in Figure @ref(fig:next-turtle-star):</p>
<div class="figure" style="text-align: center">
<img src="images/turtle-stars-2.png" alt="A star with rays of random lengths." width="60%" />
<p class="caption">
(#fig:next-turtle-star)A star with rays of random lengths.
</p>
</div>
<p>There is no longer a <code>legnth</code> parameter, but the names and default-values for the other parameters should be the same as in the previous exercise. Starting from <code>turtle_init(50,50)</code> make a random star with 20 rays and a line-thickness of 3. Other parameters should be left at their default-values.</p>
<p><strong>Hint</strong>: You’ll probably use a loop to draw each ray of the star. As you go through the loop, get a random ray-length using the <code>runif()</code> function:</p>
<div class="sourceCode" id="cb578"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb578-1" data-line-number="1">randomLength &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>, <span class="dt">min =</span> <span class="dv">5</span>, <span class="dt">max =</span> <span class="dv">25</span>)</a></code></pre></div>
<p>Then have the turtle make the ray by moving forward and backward by that amount.</p></li>
<li><p>Make a new star function <code>turtle_rstarColors()</code> that behaves like <code>turtle_rstar()</code> except that instead of being determined by the user the ray-color varies randomly from one ray to another, as in Figure @ref(fig:turtle-star-3):</p>
<div class="figure" style="text-align: center">
<img src="images/turtle-stars-3.png" alt="A star with rays of random lengths and random colors." width="60%" />
<p class="caption">
(#fig:turtle-star-3)A star with rays of random lengths and random colors.
</p>
</div>
<p>Each ray should have a color drawn randomly from the vector of all colors given by <code>colors()</code>. Starting from <code>turtle_init(50,50)</code> make a random star with 20 rays and a line-thickness of 6. Other parameters should be left at their default-values.</p>
<p><strong>Hint</strong>: You’ll probably use a loop to draw each ray of the star. As you go through the loop, get a new random color like this:</p>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb579-1" data-line-number="1">randomColor &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">colors</span>(), <span class="dt">size =</span> <span class="dv">1</span>)</a></code></pre></div>
<p>Then set the turtle’s color accordingly:</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb580-1" data-line-number="1"><span class="kw">turtle_col</span>(<span class="dt">col =</span> randomColor)</a></code></pre></div></li>
<li><p>(*) Our <code>turtle_quick_pollack()</code> function has successive strokes attached to each other. However, Jackson Pollack famous “drip” style involved placing brush-strokes at seemingly random locations on the canvas—successive strokes weren’t placed together. Modify our Pollack-painter function so that each new stroke appears as a random location <em>inside</em> the canvas. If you really get into it, research <a href="https://www.nceas.ucsb.edu/~frazier/RSpatialGuides/colorPaletteCheatsheet.pdf" target ="_blank">colors in R</a> and try to come up with your own scheme for randomizing colors.</p></li>
</ol>
<!--chapter:end:050-turtle.Rmd-->
</div>
</div>
<div id="simulation" class="section level1">
<h1><span class="header-section-number">4</span> Simulation</h1>
<div class="figure" style="text-align: center">
<img src="images/monkey-typewriter.jpeg" alt="A monkey typing randomly manages to type out a line of Shakespeare.  What is the chance that the monkey would produce this particular line?  Source: http://www.gloryofkings.com/?p=189." width="40%" />
<p class="caption">
(#fig:monkey-typewriter)A monkey typing randomly manages to type out a line of Shakespeare. What is the chance that the monkey would produce this particular line? Source: <a href="http://www.gloryofkings.com/?p=189" class="uri">http://www.gloryofkings.com/?p=189</a>.
</p>
</div>

<div id="probability-and-random-variables" class="section level2">
<h2><span class="header-section-number">4.1</span> Probability and Random Variables</h2>
<p>Your favorite college basketball team is in the NCAA Tournament. What is the chance that it will make the Final Four?</p>
<p>An insurance company provides flood insurance to homeowners. How much can the company expect to pay out in insurance claims in the coming year?</p>
<p>What is the chance of a large asteroid striking our planet in the next ten years? in the next ten million years?</p>
<p>All of the above questions involve random processes—some of them rather complex. It is the aim of this Chapter to apply our knowledge of vectors, functions and flow control to give approximate answers to questions involving chance processes like these.</p>
<p>Sometimes we will be interested in finding the <em>probability</em> that an event of interest occurs: for example, the event that your team makes the final Four, or the event that the Earth is struck by a large asteroid sometime in the next ten years.</p>
<p>One popular definition of probability goes as follows:</p>
<blockquote>
<p>If <span class="math inline">\(E\)</span> is an event, then the probability that <span class="math inline">\(E\)</span> occurs is the long-term proportion of times that the event occurs, if we could repeat the random process many, many times.</p>
</blockquote>
<p>To be more precise, imagine that you can repeat the random process <span class="math inline">\(n\)</span> times. (Imagine that your team gets into the NCAA Tournament <span class="math inline">\(n\)</span> times, for example.) Each time, the event of interest will either occur or not occur. Count the number of times that the event occurs. Then divide by <span class="math inline">\(n\)</span>. You now have the <em>proportion</em> of times that it occurred. Now imagine that <span class="math inline">\(n\)</span> gets larger and larger. Our intuition says that the proportion of times that the event occurs will stabilize at some number between 0 and 1. This number is the <em>probability</em> that the event occurs. occurs.</p>
<p>We will also concern ourselves with <em>random variables</em>. A random variable is simply a number whose value is determined by the outcome of a chance process. The amount that the insurance company will pay out in the next year is an example of a random variable: its value depends on a complex chance process—how many homeowners experience a flood, how damaging each flood is, etc.</p>
<p>When it comes to random variables, we are often interested in what it might turn out to be <em>on average</em>. That is, suppose we could repeat the random process many, many times—say <span class="math inline">\(n\)</span> times, where <span class="math inline">\(n\)</span> is some large number. (Suppose that we could observe the insurance company for many, many years, with each year being the same in terms of how many people are insured, how much their houses are worth, what the climate is like, and so on.) Each time the process is repeated, we get a value for the random variable. We end up with <span class="math inline">\(n\)</span> values. Now add up these values and divide by <span class="math inline">\(n\)</span>. We have computed their average—the mean, as it is properly called. Now imagine that <span class="math inline">\(n\)</span> could be larger and larger, without bound.</p>
<blockquote>
<p>The <em>expected value</em> of the random variable is the number that this average converges to.</p>
</blockquote>
<p>In other words, the expected value of a random variable is what we expect to get on average, in the long run, if we could repeat the random process that produces the value many, many times.</p>
</div>
<div id="monte-carlo-simulation" class="section level2">
<h2><span class="header-section-number">4.2</span> Monte Carlo Simulation</h2>
<p>Our definitions of probability and expected value both involved a limiting notion, namely: what would happen if you could somehow repeat the random process more and more times, without a bound on the number of repetitions. Accordingly, even if we find that we are unable to compute a probability or an expected value exactly with mathematics, we can still attempt to estimate it by <strong>making the computer</strong> repeat the random experiment many times, keeping track of the result of the experiment each time. This technique is known as <em>Monte Carlo</em> simulation, after the famous <a href="https://en.wikipedia.org/wiki/Monte_Carlo_Casino">Monte Carlo casino</a> in the Principality of Monaco.</p>
<p>In this section we will employ Monte Carlo simulation to estimate probability and expected value in a couple of simple examples.</p>
<div id="estimating-a-probability" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Estimating a Probability</h3>
<p>Consider a box that holds ten tickets. Three of them are labeled with the letter “a”; the rest are labeled “b”:</p>
<div class="sourceCode" id="cb581"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb581-1" data-line-number="1">tickets &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;a&quot;</span>, <span class="dv">3</span>), <span class="kw">rep</span>(<span class="st">&quot;b&quot;</span>, <span class="dv">7</span>))</a>
<a class="sourceLine" id="cb581-2" data-line-number="2">tickets</a></code></pre></div>
<pre><code>##  [1] &quot;a&quot; &quot;a&quot; &quot;a&quot; &quot;b&quot; &quot;b&quot; &quot;b&quot; &quot;b&quot; &quot;b&quot; &quot;b&quot; &quot;b&quot;</code></pre>
<p>We plan to draw one of these tickets at random from the box, with each ticket having the same chance to be the ticket selected. Three of the ten tickets are a’s, so our intuition says that the probability of selecting an “a” ticket is 3 out of 10, or 0.3. Let’s use Monte Carlo simulation to estimate the probability, and see if we get something close to 0.3.</p>
<p>In order to set up the simulation, we need a device for repeating the random process as many times as we would like. At each repetition, the outcome of the chance process should not depend on previous outcomes. We can accomplish this by using R
s <code>sample()</code> function  on the <code>tickets</code> variable. For example, if we would like to repeat the process of selecting a ticket twenty times, we could write the following code:</p>
<div class="sourceCode" id="cb583"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb583-1" data-line-number="1">sims &lt;-<span class="st"> </span><span class="kw">sample</span>(tickets, <span class="dt">size =</span> <span class="dv">20</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb583-2" data-line-number="2">sims</a></code></pre></div>
<pre><code>##  [1] &quot;b&quot; &quot;b&quot; &quot;b&quot; &quot;a&quot; &quot;b&quot; &quot;b&quot; &quot;b&quot; &quot;b&quot; &quot;b&quot; &quot;b&quot; &quot;a&quot; &quot;a&quot; &quot;b&quot; &quot;b&quot; &quot;b&quot; &quot;b&quot; &quot;b&quot;
## [18] &quot;b&quot; &quot;a&quot; &quot;a&quot;</code></pre>
<p>Notice that we set <code>replace</code> to <code>TRUE</code>. This was important, since it guarantees that at each selection there are three “a”’s and seven “b”’s in the box, keeping the chance of getting an “a”-ticket the same each time.</p>
<p>We can summarize the results in a table using R’s <code>table()</code> function: </p>
<div class="sourceCode" id="cb585"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb585-1" data-line-number="1"><span class="kw">table</span>(sims)</a></code></pre></div>
<pre><code>## sims
##  a  b 
##  5 15</code></pre>
<p>Of course we don’t care so much about the <em>number</em> of times we got an “a”-ticket. Instead we care about the <em>proportion</em> of times we did so. In order to convert the numbers in a table to proportions we can make the table an argument for the function <code>prop.table()</code>: </p>
<div class="sourceCode" id="cb587"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb587-1" data-line-number="1"><span class="kw">prop.table</span>(<span class="kw">table</span>(sims))</a></code></pre></div>
<pre><code>## sims
##    a    b 
## 0.25 0.75</code></pre>
<p>Based on twenty repetitions of the random process, our estimate of the chance an “a”-ticket is 0.25. That’s not so close to the true chance of <span class="math inline">\(1/3\)</span>. In order to obtain a more accurate estimate, we should increase the number of repetitions of the random process. Let’s try again, with ten thousand repetitions:</p>
<div class="sourceCode" id="cb589"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb589-1" data-line-number="1">sims &lt;-<span class="st"> </span><span class="kw">sample</span>(tickets, <span class="dt">size =</span> <span class="dv">10000</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb589-2" data-line-number="2"><span class="kw">prop.table</span>(<span class="kw">table</span>(sims))</a></code></pre></div>
<pre><code>## sims
##     a     b 
## 0.308 0.692</code></pre>
<p>Our estimate is now a lot closer to the actual value of the probability.</p>
</div>
<div id="estimating-an-expected-value" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Estimating an Expected Value</h3>
<p>Imagine that you are about to play the following game: you will flip a fair coin twice.</p>
<ul>
<li>If you get Tails both times, you lose a dollar.</li>
<li>If you get exactly one Head, nothing happens.</li>
<li>If you get Heads both times, you win two dollars.</li>
</ul>
<p>Let <span class="math inline">\(W\)</span> be the number of dollars you will win.</p>
<p><span class="math inline">\(W\)</span> is a clearly a random variable: it’s a number whose value—either -1, 0 or 2—depends on the outcome of the random process of flipping the fair coin twice. What is the expected value of <span class="math inline">\(W\)</span>?</p>
<p>If we think about the probabilities involved then we can come up with a candidate for the expected value. When you flip a fair coin twice, there are four equally likely outcomes:</p>
<ul>
<li>Tails and then Tails (<span class="math inline">\(W = -1\)</span>)</li>
<li>Tails and then Heads (<span class="math inline">\(W = 0\)</span>)</li>
<li>Heads and then Tails (<span class="math inline">\(W = 0\)</span>)</li>
<li>Heads and then Heads (<span class="math inline">\(W = 2\)</span>)</li>
</ul>
<p>Hence you have:</p>
<ul>
<li>The chance that <span class="math inline">\(W=-1\)</span> is 0.25.</li>
<li>The chance that <span class="math inline">\(W=0\)</span> is 0.50.</li>
<li>The chance that <span class="math inline">\(W=2\)</span> is 0.25.</li>
</ul>
<p>Hence the expected value should be the <em>weighted average</em>:</p>
<p><span class="math display">\[0.25 \times -1 + 0.50 \times 0 + 0.25 \times 2.\]</span>
This works out to 0.25, or 25 cents.</p>
<p>We would like to see if Monte Carlo simulation can render an estimate that is close to this value.</p>
<p>For a simple game like ours where there are only a few possible outcomes for the random variable, it is still a good idea to use <code>sample()</code> to simulate the random process of playing the game. We only need to provide a vector of possible values for <span class="math inline">\(W\)</span> to sample from, and a vector of probabilities for obtaining each of those possible values. The following code illustrates how we might simulate playing the game ten times:</p>
<div class="sourceCode" id="cb591"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb591-1" data-line-number="1">w &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb591-2" data-line-number="2">pw &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.25</span>, <span class="fl">0.50</span>, <span class="fl">0.25</span>)</a>
<a class="sourceLine" id="cb591-3" data-line-number="3">winnings &lt;-<span class="st"> </span><span class="kw">sample</span>(w, <span class="dt">size =</span> <span class="dv">10</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>, <span class="dt">prob =</span> pw)</a>
<a class="sourceLine" id="cb591-4" data-line-number="4">winnings</a></code></pre></div>
<pre><code>##  [1]  0  0 -1 -1  2  0  0  0  2 -1</code></pre>
<p>The Monte Carlo estimate of the expected value of <span class="math inline">\(W\)</span> is just the average of the winnings in our simulations:</p>
<div class="sourceCode" id="cb593"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb593-1" data-line-number="1"><span class="kw">mean</span>(winnings)</a></code></pre></div>
<pre><code>## [1] 0.1</code></pre>
<p>Of course, with such a small number of repetitions of the game we cannot expect the Monte Carlo estimate to be very accurate. Let’s try again, but with ten thousand repetitions:</p>
<div class="sourceCode" id="cb595"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb595-1" data-line-number="1">winnings &lt;-<span class="st"> </span><span class="kw">sample</span>(w, <span class="dt">size =</span> <span class="dv">10000</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>, <span class="dt">prob =</span> pw)</a>
<a class="sourceLine" id="cb595-2" data-line-number="2"><span class="kw">mean</span>(winnings)</a></code></pre></div>
<pre><code>## [1] 0.2435</code></pre>
<p>Yes, that’s much closer to our mathematically-computed value!</p>
<p>By the way, R can easily compute the weighted average itself:</p>
<div class="sourceCode" id="cb597"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb597-1" data-line-number="1"><span class="kw">sum</span>(w<span class="op">*</span>pw)</a></code></pre></div>
<pre><code>## [1] 0.25</code></pre>
</div>
<div id="the-law-of-large-numbers" class="section level3">
<h3><span class="header-section-number">4.2.3</span> The Law of Large Numbers</h3>
<p>In our Monte Carlo simulations so far, we have seen that the more times we repeat the underlying random process, the closer our estimate is likely to be to the actual value, no matter whether we were estimating the probability of an event or an expected value for a random variable.</p>
<p>This is no accident: in fact, it is a consequence of a theorem in the subject of probability that is known as the <em>Law of Large Numbers</em>. We do not possess the mathematical machinery necessary to state the Law precisely—much less prove it—but we can take the rough statement given here as an assurance that the more repetitions we include in our simulation, the more accurate the resulting estimate is liable to be.</p>
</div>
<div id="practice-exercises-7" class="section level3">
<h3><span class="header-section-number">4.2.4</span> Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Consider the following game: you roll a fair die. If you get one or two spots, then you lose a dollar. If you get three, four, or five spots then nothing happens. If you get six spots then you win three dollars. You would like to know how much money you can expect to win per play of the game, on average.</p>
<p>Write a function called <code>diceGameSim()</code> that will help you answer the question. The function should take the following parameter:</p>
<ul>
<li><code>reps</code>: the number of times to repeat the simulation. The default value should be 10000.</li>
</ul>
<p>The function should return an estimate of the expected value of the game.</p></li>
<li><p>You command a Klingon vessel, and you are shooting photon torpedoes at the Starship <em>USS Enterprise</em>. Every torpedo you fire has a strength <span class="math inline">\(s\)</span> that is a random real number between 0 and 12. If the strength of the torpedo is less than or equal to 5, then the Enterprise’s shields will ward off any damage. However, if the strength <span class="math inline">\(s\)</span> exceeds 5, then the damage inflicted on the Enterprise will be <span class="math inline">\(12-s\)</span> units. What is the expected amount of damage done to the Enterprise, per shot? Write a function called <code>photonTorpedoSim()</code> that estimates the expected damage. The function should take the following parameter:</p>
<ul>
<li><code>reps</code>: the number of times to repeat the process of firing at the Enterprise. The default value should be 10000.</li>
</ul>
<p>The function should return the estimated expected value.</p></li>
</ol>
</div>
<div id="solutions-to-the-practice-exercises-4" class="section level3">
<h3><span class="header-section-number">4.2.5</span> Solutions to the Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Here’s the code:</p>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb599-1" data-line-number="1">diceGameSim &lt;-<span class="st"> </span><span class="cf">function</span>(reps) {</a>
<a class="sourceLine" id="cb599-2" data-line-number="2">  w &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb599-3" data-line-number="3">  pw &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span><span class="op">/</span><span class="dv">6</span>, <span class="dv">3</span><span class="op">/</span><span class="dv">6</span>, <span class="dv">1</span><span class="op">/</span><span class="dv">6</span>)</a>
<a class="sourceLine" id="cb599-4" data-line-number="4">  winnings &lt;-<span class="st"> </span><span class="kw">sample</span>(w, <span class="dt">size =</span> reps, </a>
<a class="sourceLine" id="cb599-5" data-line-number="5">                     <span class="dt">replace =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb599-6" data-line-number="6">                     <span class="dt">prob =</span> pw)</a>
<a class="sourceLine" id="cb599-7" data-line-number="7">  <span class="kw">mean</span>(winnings)</a>
<a class="sourceLine" id="cb599-8" data-line-number="8">}</a></code></pre></div>
<p>Let’s try it out:</p>
<div class="sourceCode" id="cb600"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb600-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">3838</span>)</a>
<a class="sourceLine" id="cb600-2" data-line-number="2"><span class="kw">diceGameSim</span>(<span class="dt">reps =</span> <span class="dv">100000</span>)</a></code></pre></div>
<pre><code>## [1] 0.16548</code></pre>
<p>Our estimate, based on one hundred thousand repetitions of the game, is that you can expect to win about 16.55 cents per game. (In fact the exact expected value is <span class="math inline">\(1/6\)</span> of a dollar.)</p></li>
<li><p>Here’s the code, if you use the <code>pmax()</code> function:</p>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb602-1" data-line-number="1">photonTorpedoSim &lt;-<span class="st"> </span><span class="cf">function</span>(reps) {</a>
<a class="sourceLine" id="cb602-2" data-line-number="2">  strengths &lt;-<span class="st"> </span><span class="kw">runif</span>(reps, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">12</span>)</a>
<a class="sourceLine" id="cb602-3" data-line-number="3">  damage &lt;-<span class="st"> </span><span class="kw">pmax</span>(<span class="dv">0</span>, strengths <span class="op">-</span><span class="st"> </span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb602-4" data-line-number="4">  <span class="kw">mean</span>(damage)</a>
<a class="sourceLine" id="cb602-5" data-line-number="5">}</a></code></pre></div>
<p>Let’s try it out:</p>
<div class="sourceCode" id="cb603"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb603-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">3838</span>)</a>
<a class="sourceLine" id="cb603-2" data-line-number="2"><span class="kw">photonTorpedoSim</span>(<span class="dt">reps =</span> <span class="dv">100000</span>)</a></code></pre></div>
<pre><code>## [1] 2.043227</code></pre>
<p>You can expect to do about 2.04 points worth of damage per shot. (In fact the exact expected value is <span class="math inline">\(49/24 \approx 2.04167\)</span>.)</p>
<p>Here’s the code if you used a loop instead:</p>
<div class="sourceCode" id="cb605"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb605-1" data-line-number="1">photonTorpedoSim &lt;-<span class="st"> </span><span class="cf">function</span>(reps) {</a>
<a class="sourceLine" id="cb605-2" data-line-number="2">  damage &lt;-<span class="st"> </span><span class="kw">numeric</span>(reps)</a>
<a class="sourceLine" id="cb605-3" data-line-number="3">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>reps) {</a>
<a class="sourceLine" id="cb605-4" data-line-number="4">    strength &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">12</span>)</a>
<a class="sourceLine" id="cb605-5" data-line-number="5">    <span class="cf">if</span> (strength <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>) {</a>
<a class="sourceLine" id="cb605-6" data-line-number="6">      damage[i] &lt;-<span class="st"> </span>strength <span class="op">-</span><span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb605-7" data-line-number="7">    } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb605-8" data-line-number="8">      damage[i] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb605-9" data-line-number="9">    }</a>
<a class="sourceLine" id="cb605-10" data-line-number="10">  }</a>
<a class="sourceLine" id="cb605-11" data-line-number="11">  <span class="kw">mean</span>(damage)</a>
<a class="sourceLine" id="cb605-12" data-line-number="12">}</a></code></pre></div></li>
</ol>
</div>
</div>
<div id="triangle-chance" class="section level2">
<h2><span class="header-section-number">4.3</span> Example: Chance of a Triangle</h2>
<p>In the examples considered so far, intuition or a simple calculation suggests what the exact value of the probability or expected value should be. The true power of the Monte Carlo simulation method shines forth in situations where it is difficult or impossible to compute a value mathematically.</p>
<p>Let’s revisit an example from Section @ref(ifelse), where we considered whether or not three segments could be put together to form a triangle. We developed the following function to determine, from the lengths of each segment, whether or not a triangle is possible:</p>
<div class="sourceCode" id="cb606"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb606-1" data-line-number="1">isTriangle &lt;-<span class="st"> </span><span class="cf">function</span>(x, y, z) {</a>
<a class="sourceLine" id="cb606-2" data-line-number="2">  (x <span class="op">+</span><span class="st"> </span>y <span class="op">&gt;</span><span class="st"> </span>z) <span class="op">&amp;</span><span class="st"> </span>(x <span class="op">+</span>z <span class="op">&gt;</span><span class="st"> </span>y) <span class="op">&amp;</span><span class="st"> </span>(y <span class="op">+</span><span class="st"> </span>z <span class="op">&gt;</span><span class="st"> </span>x)</a>
<a class="sourceLine" id="cb606-3" data-line-number="3">}</a></code></pre></div>
<p>Recall also that this function applied to vectors of any length, so we can use it to decide about many triples of segments at once.</p>
<p>Let’s now inject some chance variation into the situation. Suppose that you have a stick that is one unit in length: one foot, one meter, one yard—whatever. You plan to break the stick at two randomly selected points. Breaking the stick will yield three pieces. You wonder: what is the chance that these three pieces can form a triangle?</p>
<p>In an advanced probability course you can show that the probability of a triangle is exactly <span class="math inline">\(1/4\)</span>. Here we would like to estimate the probability with Monte Carlo simulation.</p>
<p>In order to carry out the simulation, we will need to develop code that produces a pair of break-points, any number of times that we like—let’s think about ten times, to start.</p>
<p>This is not so difficult if we use the <code>runif()</code> function:</p>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb607-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">10</span>)  <span class="co"># the first breaks</span></a>
<a class="sourceLine" id="cb607-2" data-line-number="2">y &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">10</span>)  <span class="co"># the second breaks</span></a></code></pre></div>
<p>Next we must compute—for each pair of breaks—the lengths of the three segments that are produced. If we knew that the <code>x</code> break was always less than the <code>y</code> break, this would be easy:</p>
<ul>
<li>the leftmost piece would be <code>x</code> units long;</li>
<li>the middle piece would be <code>y</code> minus <code>x</code> units long;</li>
<li>the rightmost piece would be 1 minus <code>y</code> units long.</li>
</ul>
<p>The problem is that a given element of the vector <code>y</code> can easily be less than than corresponding element of the vector <code>x</code>. When that happens, the pieces won’t be as described in the bullet-ed items above.</p>
<p>We can solve this problem with the <code>pmin()</code> and <code>pmax()</code> functions  that were introduced in Section @ref(maxmin):</p>
<div class="sourceCode" id="cb608"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb608-1" data-line-number="1">a &lt;-<span class="st"> </span><span class="kw">pmin</span>(x, y)</a>
<a class="sourceLine" id="cb608-2" data-line-number="2">b &lt;-<span class="st"> </span><span class="kw">pmax</span>(x, y)</a>
<a class="sourceLine" id="cb608-3" data-line-number="3">side1 &lt;-<span class="st"> </span>a     <span class="co"># leftmost</span></a>
<a class="sourceLine" id="cb608-4" data-line-number="4">side2 &lt;-<span class="st"> </span>b <span class="op">-</span><span class="st"> </span>a  <span class="co"># middle</span></a>
<a class="sourceLine" id="cb608-5" data-line-number="5">side3 &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>b <span class="co"># rigttmost</span></a></code></pre></div>
<p>It is useful to write a helper-function that starts from the breaks, computes the sides, and then decides whether they form a triangle:</p>
<div class="sourceCode" id="cb609"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb609-1" data-line-number="1">makesTriangle &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) {</a>
<a class="sourceLine" id="cb609-2" data-line-number="2">  a &lt;-<span class="st"> </span><span class="kw">pmin</span>(x, y)</a>
<a class="sourceLine" id="cb609-3" data-line-number="3">  b &lt;-<span class="st"> </span><span class="kw">pmax</span>(x, y)</a>
<a class="sourceLine" id="cb609-4" data-line-number="4">  side1 &lt;-<span class="st"> </span>a</a>
<a class="sourceLine" id="cb609-5" data-line-number="5">  side2 &lt;-<span class="st"> </span>b <span class="op">-</span><span class="st"> </span>a</a>
<a class="sourceLine" id="cb609-6" data-line-number="6">  side3 &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>b</a>
<a class="sourceLine" id="cb609-7" data-line-number="7">  <span class="kw">isTriangle</span>(<span class="dt">x =</span> side1, <span class="dt">y =</span> side2, <span class="dt">z =</span> side3)</a>
<a class="sourceLine" id="cb609-8" data-line-number="8">}</a></code></pre></div>
<p>Let’s try it our for our repetitions</p>
<p>Table @ref(tab:trianglesimstab) shows the results. Based on our ten repetitions, we would estimate the probability of a triangle as <span class="math inline">\(4/10\)</span>.</p>
<table>
<caption>(#tab:trianglesimstab)Results of ten repetitions of breaking a unit length at two random points to form three segments.</caption>
<thead>
<tr class="header">
<th align="right">x</th>
<th align="right">y</th>
<th align="right">side1</th>
<th align="right">side2</th>
<th align="right">side3</th>
<th align="left">triangle</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.6469028</td>
<td align="right">0.7644140</td>
<td align="right">0.6469028</td>
<td align="right">0.1175112</td>
<td align="right">0.2355860</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="right">0.3942258</td>
<td align="right">0.7438358</td>
<td align="right">0.3942258</td>
<td align="right">0.3496100</td>
<td align="right">0.2561642</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="right">0.6185018</td>
<td align="right">0.8261657</td>
<td align="right">0.6185018</td>
<td align="right">0.2076639</td>
<td align="right">0.1738343</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="right">0.4768911</td>
<td align="right">0.4227291</td>
<td align="right">0.4227291</td>
<td align="right">0.0541621</td>
<td align="right">0.5231089</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="right">0.1360972</td>
<td align="right">0.4092877</td>
<td align="right">0.1360972</td>
<td align="right">0.2731905</td>
<td align="right">0.5907123</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="right">0.0673844</td>
<td align="right">0.5396926</td>
<td align="right">0.0673844</td>
<td align="right">0.4723082</td>
<td align="right">0.4603074</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="right">0.1291526</td>
<td align="right">0.9607224</td>
<td align="right">0.1291526</td>
<td align="right">0.8315698</td>
<td align="right">0.0392776</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="right">0.3931179</td>
<td align="right">0.6535573</td>
<td align="right">0.3931179</td>
<td align="right">0.2604394</td>
<td align="right">0.3464427</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="right">0.0025827</td>
<td align="right">0.5467153</td>
<td align="right">0.0025827</td>
<td align="right">0.5441326</td>
<td align="right">0.4532847</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="right">0.6202060</td>
<td align="right">0.2660636</td>
<td align="right">0.2660636</td>
<td align="right">0.3541424</td>
<td align="right">0.3797940</td>
<td align="left">TRUE</td>
</tr>
</tbody>
</table>
<p>Interestingly, R can compute the proportion of times that a triangle was formed, directly from the logical vector <code>triangle</code>. Look at the following code:</p>
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb610-1" data-line-number="1"><span class="kw">sum</span>(triangle)</a></code></pre></div>
<pre><code>## [1] 4</code></pre>
<div class="sourceCode" id="cb612"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb612-1" data-line-number="1"><span class="kw">mean</span>(triangle)</a></code></pre></div>
<pre><code>## [1] 0.4</code></pre>
<p>When we ask R to add the elements of a logical vector, it coerces the Boolean values to numbers: <code>TRUE</code> becomes 1 and <code>FALSE</code> becomes 0. Summing the numbers is then equivalent to counting how many times <code>TRUE</code> appeared in <code>triangle</code>. Taking the mean is equivalent to computing the proportion of <code>TRUE</code>s in <code>triangle</code>.</p>
<p>We would like, of course, to simulate breaking the unit length many times, and we would like to be able to choose easily—without a lot of fuss in coding—the number of repetitions. It makes sense, therefore, to write a simulation function that will do our work for us:</p>
<div class="sourceCode" id="cb614"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb614-1" data-line-number="1">triangleSim &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">reps =</span> <span class="dv">10000</span> ) {</a>
<a class="sourceLine" id="cb614-2" data-line-number="2">  cut1 &lt;-<span class="st"> </span><span class="kw">runif</span>(reps)</a>
<a class="sourceLine" id="cb614-3" data-line-number="3">  cut2 &lt;-<span class="st"> </span><span class="kw">runif</span>(reps)</a>
<a class="sourceLine" id="cb614-4" data-line-number="4">  triangle &lt;-<span class="st"> </span><span class="kw">makesTriangle</span>(cut1, cut2)</a>
<a class="sourceLine" id="cb614-5" data-line-number="5">  <span class="kw">cat</span>(<span class="st">&quot;The proportion of triangles was &quot;</span>, <span class="kw">mean</span>(triangle), <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb614-6" data-line-number="6">}</a></code></pre></div>
<p>Now that we think about it, it might also be nice to have the option to view a table of the results, along with the estimate of the probability:</p>
<div class="sourceCode" id="cb615"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb615-1" data-line-number="1">triangleSim &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">reps =</span> <span class="dv">10000</span>, <span class="dt">table =</span> <span class="ot">FALSE</span> ) {</a>
<a class="sourceLine" id="cb615-2" data-line-number="2">  cut1 &lt;-<span class="st"> </span><span class="kw">runif</span>(reps)</a>
<a class="sourceLine" id="cb615-3" data-line-number="3">  cut2 &lt;-<span class="st"> </span><span class="kw">runif</span>(reps)</a>
<a class="sourceLine" id="cb615-4" data-line-number="4">  triangle &lt;-<span class="st"> </span><span class="kw">makesTriangle</span>(cut1, cut2)</a>
<a class="sourceLine" id="cb615-5" data-line-number="5">  <span class="cf">if</span> ( table ) {</a>
<a class="sourceLine" id="cb615-6" data-line-number="6">    <span class="kw">cat</span>(<span class="st">&quot;Here is a table of the results:</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb615-7" data-line-number="7">    <span class="kw">print</span>(<span class="kw">table</span>(triangle))</a>
<a class="sourceLine" id="cb615-8" data-line-number="8">    <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb615-9" data-line-number="9">  }</a>
<a class="sourceLine" id="cb615-10" data-line-number="10">  <span class="kw">cat</span>(<span class="st">&quot;The proportion of triangles was &quot;</span>, <span class="kw">mean</span>(triangle), <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb615-11" data-line-number="11">}</a></code></pre></div>
<p>Let’s give our function a try, using the default of ten thousand repetitions and asking for a table of results:</p>
<div class="sourceCode" id="cb616"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb616-1" data-line-number="1"><span class="kw">triangleSim</span>(<span class="dt">table =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## Here is a table of the results:
## triangle
## FALSE  TRUE 
##  7466  2534 
## 
## The proportion of triangles was 0.2534.</code></pre>
<p>As we would expect, our estimate of the probability of a triangle is pretty close to <span class="math inline">\(1/4\)</span>, the value that is known to experts in probability.</p>
<div id="setting-a-seed" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Setting a Seed</h3>
<p>There are further possibilities for refining the simulation function. We know that it can be a good idea to set a seed for R’s random-number generator. When you do this you still get random-looking results, but they will be the same results no matter how often you call the simulation function. In that way others who have access to your function can “reproduce” the results you got, thus assuring themselves that you weren’t making anything up. Let’s add a <code>seed</code> parameter to our simulation function:</p>
<div class="sourceCode" id="cb618"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb618-1" data-line-number="1">triangleSim &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">reps =</span> <span class="dv">10000</span>, <span class="dt">table =</span> <span class="ot">FALSE</span>, seed ) {</a>
<a class="sourceLine" id="cb618-2" data-line-number="2">  <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb618-3" data-line-number="3">  cut1 &lt;-<span class="st"> </span><span class="kw">runif</span>(reps)</a>
<a class="sourceLine" id="cb618-4" data-line-number="4">  cut2 &lt;-<span class="st"> </span><span class="kw">runif</span>(reps)</a>
<a class="sourceLine" id="cb618-5" data-line-number="5">  triangle &lt;-<span class="st"> </span><span class="kw">makesTriangle</span>(cut1, cut2)</a>
<a class="sourceLine" id="cb618-6" data-line-number="6">  <span class="cf">if</span> ( table ) {</a>
<a class="sourceLine" id="cb618-7" data-line-number="7">    <span class="kw">cat</span>(<span class="st">&quot;Here is a table of the results:</span><span class="ch">\n\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb618-8" data-line-number="8">    <span class="kw">print</span>(<span class="kw">table</span>(triangle))</a>
<a class="sourceLine" id="cb618-9" data-line-number="9">    <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb618-10" data-line-number="10">  }</a>
<a class="sourceLine" id="cb618-11" data-line-number="11">  <span class="kw">cat</span>(<span class="st">&quot;The proportion of triangles was &quot;</span>, <span class="kw">mean</span>(triangle), <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb618-12" data-line-number="12">}</a></code></pre></div>
<p>This is all very well, but if for some reason you <em>desire</em> to have the function produce different results with every call, you have to come up with the seed yourself. It would be nice to have the option to call your function without having to provide a seed.</p>
<p>This is not difficult to accomplish. We’ll set the default value for <code>seed</code> to be <code>NULL</code>. Then when the function begins we’ll check the value of <code>seed</code>. If it is not <code>NULL</code>, then the user has provided a seed, and we’ll use that. Otherwise, we’ll let R grab pseudo-random numbers however it likes.</p>
<div class="sourceCode" id="cb619"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb619-1" data-line-number="1">triangleSim &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">reps =</span> <span class="dv">10000</span>, <span class="dt">table =</span> <span class="ot">FALSE</span>, <span class="dt">seed =</span> <span class="ot">NULL</span>) {</a>
<a class="sourceLine" id="cb619-2" data-line-number="2">  <span class="cf">if</span> ( <span class="op">!</span><span class="kw">is.null</span>(seed) ) {</a>
<a class="sourceLine" id="cb619-3" data-line-number="3">    <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb619-4" data-line-number="4">  }</a>
<a class="sourceLine" id="cb619-5" data-line-number="5">  cut1 &lt;-<span class="st"> </span><span class="kw">runif</span>(reps)</a>
<a class="sourceLine" id="cb619-6" data-line-number="6">  cut2 &lt;-<span class="st"> </span><span class="kw">runif</span>(reps)</a>
<a class="sourceLine" id="cb619-7" data-line-number="7">  triangle &lt;-<span class="st"> </span><span class="kw">makesTriangle</span>(cut1, cut2)</a>
<a class="sourceLine" id="cb619-8" data-line-number="8">  <span class="cf">if</span> ( table ) {</a>
<a class="sourceLine" id="cb619-9" data-line-number="9">    <span class="kw">cat</span>(<span class="st">&quot;Here is a table of the results:</span><span class="ch">\n\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb619-10" data-line-number="10">    <span class="kw">print</span>(<span class="kw">table</span>(triangle))</a>
<a class="sourceLine" id="cb619-11" data-line-number="11">    <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb619-12" data-line-number="12">  }</a>
<a class="sourceLine" id="cb619-13" data-line-number="13">  <span class="kw">cat</span>(<span class="st">&quot;The proportion of triangles was &quot;</span>, <span class="kw">mean</span>(triangle), <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb619-14" data-line-number="14">}</a></code></pre></div>
</div>
<div id="program-development" class="section level3">
<h3><span class="header-section-number">4.3.2</span> Program Development</h3>
<p>Think about how we developed the <code>triangleSim()</code> function.</p>
<ol style="list-style-type: decimal">
<li>We began by writing simple code that got us a simulation for a few repetitions.</li>
<li>When we were sure how to make a simulation work, we <em>encapsulated</em> our code into a function that we could call to perform the simulation for us.</li>
<li>We though about features that we would like the function to have—user chooses number of repetitions, user chooses whether to see a table, etc.—and implemented these features one by one. This made the function more <em>general</em>, i.e., useful in a wider range of settings.</li>
</ol>
<p>The above method of program development is called <em>encapsulation and generalization</em>. For small projects of the sort that we have on hand, it’s a good way to go about writing a computer program. </p>
</div>
<div id="number-of-repetitions" class="section level3">
<h3><span class="header-section-number">4.3.3</span> Number of Repetitions</h3>
<p>The Law of Large Numbers says that the more times you repeat the simulation, the better our estimate of the desired probability—or expected value—is liable to be. Let’s use the Stick-Splitting Problem to investigate the effect of the choice of repetitions on the accuracy of our estimate of the probability of getting a triangle.</p>
<p>We will need to run the <code>triangleSim()</code> function several times, with a different choice for <code>reps</code> each time, keeping track of the estimates we obtain. In the process we won’t need tables or other output to the console. Let’s rewrite <code>triangleSim()</code> for maximum flexibility, making console output optional and using the invisible return discussed in Section @ref(invisible-returns).<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a></p>
<div class="sourceCode" id="cb620"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb620-1" data-line-number="1">triangleSim &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">reps =</span> <span class="dv">10000</span>, <span class="dt">table =</span> <span class="ot">FALSE</span>, <span class="dt">seed =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb620-2" data-line-number="2">                        <span class="dt">verbose =</span> <span class="ot">TRUE</span>) {</a>
<a class="sourceLine" id="cb620-3" data-line-number="3">  <span class="cf">if</span> ( <span class="op">!</span><span class="kw">is.null</span>(seed) ) {</a>
<a class="sourceLine" id="cb620-4" data-line-number="4">    <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb620-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb620-6" data-line-number="6">  cut1 &lt;-<span class="st"> </span><span class="kw">runif</span>(reps)</a>
<a class="sourceLine" id="cb620-7" data-line-number="7">  cut2 &lt;-<span class="st"> </span><span class="kw">runif</span>(reps)</a>
<a class="sourceLine" id="cb620-8" data-line-number="8">  triangle &lt;-<span class="st"> </span><span class="kw">makesTriangle</span>(cut1, cut2)</a>
<a class="sourceLine" id="cb620-9" data-line-number="9">  <span class="cf">if</span> ( table ) {</a>
<a class="sourceLine" id="cb620-10" data-line-number="10">    <span class="kw">cat</span>(<span class="st">&quot;Here is a table of the results:</span><span class="ch">\n\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb620-11" data-line-number="11">    <span class="kw">print</span>(<span class="kw">table</span>(triangle))</a>
<a class="sourceLine" id="cb620-12" data-line-number="12">    <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb620-13" data-line-number="13">  }</a>
<a class="sourceLine" id="cb620-14" data-line-number="14">  <span class="cf">if</span> ( verbose ) {</a>
<a class="sourceLine" id="cb620-15" data-line-number="15">    <span class="kw">cat</span>(<span class="st">&quot;The proportion of triangles was &quot;</span>, <span class="kw">mean</span>(triangle), <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb620-16" data-line-number="16">  }</a>
<a class="sourceLine" id="cb620-17" data-line-number="17">  <span class="kw">invisible</span>(<span class="kw">mean</span>(triangle))</a>
<a class="sourceLine" id="cb620-18" data-line-number="18">}</a></code></pre></div>
<p>Next, we make a vector of repetitions, and a vector to hold our estimates:</p>
<div class="sourceCode" id="cb621"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb621-1" data-line-number="1">reps &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">1000</span>, <span class="dv">10000</span>, <span class="dv">100000</span>, <span class="dv">1000000</span>)</a>
<a class="sourceLine" id="cb621-2" data-line-number="2">estimates &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="kw">length</span>(reps))</a></code></pre></div>
<p>Next we loop through <code>reps</code>, performing a complete simulation for each repetition-number and storing our results:</p>
<div class="sourceCode" id="cb622"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb622-1" data-line-number="1"><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(reps)) {</a>
<a class="sourceLine" id="cb622-2" data-line-number="2">  estimates[i] &lt;-<span class="st"> </span><span class="kw">triangleSim</span>(<span class="dt">reps =</span> reps[i], <span class="dt">seed =</span> <span class="dv">3030</span>,</a>
<a class="sourceLine" id="cb622-3" data-line-number="3">                             <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb622-4" data-line-number="4">}</a></code></pre></div>
<p>Let’s have a look at our estimates:</p>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb623-1" data-line-number="1"><span class="kw">names</span>(estimates) &lt;-<span class="st"> </span>reps</a>
<a class="sourceLine" id="cb623-2" data-line-number="2">estimates</a></code></pre></div>
<pre><code>##      100     1000    10000    1e+05    1e+06 
## 0.200000 0.245000 0.254700 0.251570 0.249779</code></pre>
<p>The estimates are indeed getting closer to the theoretical value of <span class="math inline">\(1/4\)</span>.<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a></p>
</div>
<div id="basic-simulations" class="section level3">
<h3><span class="header-section-number">4.3.4</span> Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Rewrite the <code>diceGameSim()</code> function from the previous section so that, just as we did with the <code>triangleSim()</code> function in this section:</p>
<ul>
<li>it allows the user to set a seed;</li>
<li>it returns the estimated expected value invisibly, and has a <code>verbose</code> option to <code>cat</code> the estimate out to the Console.</li>
</ul></li>
<li><p>Rewrite the <code>photonTorpedoSim()</code> function from the previous section so that, just as we did with the <code>triangleSim()</code> function in this section:</p>
<ul>
<li>it allows the user to set a seed;</li>
<li>it returns the estimated expected value invisibly, and has a <code>verbose</code> option to <code>cat</code> the estimate out to the Console.</li>
</ul></li>
<li><p>Extend the <code>photonTorpedoSim()</code> just a bit more, by adding two new parameters:</p>
<ul>
<li><code>shield</code>: the level at which the Enterpise’s shields are set. (If the strength of the torpedo is less than <code>shield</code>, then there is zero damage.) The default value of <code>shield</code> should be 5.</li>
<li><code>upper</code>: the upper bound on the strenght of a torpedo-shot. (That is, a tropedo shot will be a random real number from 0 to <code>upper</code>.) The default value of <code>upper</code> should be 10.</li>
</ul>
<p>The program should stop with a helpful message if the user sets <code>upper</code> or <code>shield</code> to a negative number.`</p></li>
<li><p>Abe and Bo engage in a duel. They take turns shooting at each other until one person manages to hit the other, thus winning the dual. Abe has a 40 percent chance of hitting with each shot he takes, whereas Bo has a 60 percent chance of hitting on each of his shots. Since Abe is the weaker shooter, Bo generously permits Abe to go first. We would like to estimate Abe’s chance of winning the duel. Write a function called <code>dual()</code> to estimate this probability. The function should have two parameters:</p>
<ul>
<li><code>reps</code>: the number of times to simulate a dual. The default should be 10,000.</li>
<li><code>seed</code>: a seed that the user can set. The default value should be <code>NULL</code>.</li>
</ul></li>
</ol>
</div>
<div id="solutions-to-practice-exercises-5" class="section level3">
<h3><span class="header-section-number">4.3.5</span> Solutions to Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Here’s the code:</p>
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb625-1" data-line-number="1">diceGameSim &lt;-<span class="st"> </span><span class="cf">function</span>(reps, <span class="dt">seed =</span> <span class="ot">NULL</span>, <span class="dt">verbose =</span> <span class="ot">TRUE</span>) {</a>
<a class="sourceLine" id="cb625-2" data-line-number="2">  <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(seed) ) {</a>
<a class="sourceLine" id="cb625-3" data-line-number="3">    <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb625-4" data-line-number="4">  }</a>
<a class="sourceLine" id="cb625-5" data-line-number="5">  w &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb625-6" data-line-number="6">  pw &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span><span class="op">/</span><span class="dv">6</span>, <span class="dv">3</span><span class="op">/</span><span class="dv">6</span>, <span class="dv">1</span><span class="op">/</span><span class="dv">6</span>)</a>
<a class="sourceLine" id="cb625-7" data-line-number="7">  winnings &lt;-<span class="st"> </span><span class="kw">sample</span>(w, <span class="dt">size =</span> reps, </a>
<a class="sourceLine" id="cb625-8" data-line-number="8">                     <span class="dt">replace =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb625-9" data-line-number="9">                     <span class="dt">prob =</span> pw)</a>
<a class="sourceLine" id="cb625-10" data-line-number="10">  <span class="cf">if</span> ( verbose ) {</a>
<a class="sourceLine" id="cb625-11" data-line-number="11">    <span class="kw">cat</span>(<span class="st">&quot;The expected amount to win is about &quot;</span>,</a>
<a class="sourceLine" id="cb625-12" data-line-number="12">        <span class="kw">mean</span>(winnings), <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb625-13" data-line-number="13">  }</a>
<a class="sourceLine" id="cb625-14" data-line-number="14">  <span class="kw">invisible</span>(<span class="kw">mean</span>(winnings))</a>
<a class="sourceLine" id="cb625-15" data-line-number="15">}</a></code></pre></div>
<p>Let’s try it out:</p>
<div class="sourceCode" id="cb626"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb626-1" data-line-number="1"><span class="kw">diceGameSim</span>(<span class="dt">reps =</span> <span class="dv">100000</span>, <span class="dt">seed =</span> <span class="dv">5252</span>)</a></code></pre></div>
<pre><code>## The expected amount to win is about 0.17503.</code></pre></li>
<li><p>Here’s the code, if you use the <code>pmax()</code> function:</p>
<div class="sourceCode" id="cb628"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb628-1" data-line-number="1">photonTorpedoSim &lt;-<span class="st"> </span><span class="cf">function</span>(reps, <span class="dt">seed =</span> <span class="ot">NULL</span>, <span class="dt">verbose =</span> <span class="ot">TRUE</span>) {</a>
<a class="sourceLine" id="cb628-2" data-line-number="2">  <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(seed) ) {</a>
<a class="sourceLine" id="cb628-3" data-line-number="3">    <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb628-4" data-line-number="4">  }</a>
<a class="sourceLine" id="cb628-5" data-line-number="5">  strengths &lt;-<span class="st"> </span><span class="kw">runif</span>(reps, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">12</span>)</a>
<a class="sourceLine" id="cb628-6" data-line-number="6">  damage &lt;-<span class="st"> </span><span class="kw">pmax</span>(<span class="dv">0</span>, strengths <span class="op">-</span><span class="st"> </span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb628-7" data-line-number="7">  <span class="cf">if</span> ( verbose ) {</a>
<a class="sourceLine" id="cb628-8" data-line-number="8">    <span class="kw">cat</span>(<span class="st">&quot;The expected damage is about &quot;</span>,</a>
<a class="sourceLine" id="cb628-9" data-line-number="9">        <span class="kw">mean</span>(damage), <span class="st">&quot; units.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb628-10" data-line-number="10">  }</a>
<a class="sourceLine" id="cb628-11" data-line-number="11">  <span class="kw">invisible</span>(<span class="kw">mean</span>(damage))</a>
<a class="sourceLine" id="cb628-12" data-line-number="12">}</a></code></pre></div>
<p>Let’s try it out:</p>
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb629-1" data-line-number="1"><span class="kw">photonTorpedoSim</span>(<span class="dt">reps =</span> <span class="dv">100000</span>, <span class="dt">seed =</span> <span class="dv">4040</span>)</a></code></pre></div>
<pre><code>## The expected damage is about 2.034732 units.</code></pre></li>
<li><p>Here’s the code:</p>
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb631-1" data-line-number="1">photonTorpedoSim &lt;-<span class="st"> </span><span class="cf">function</span>(reps, <span class="dt">seed =</span> <span class="ot">NULL</span>, <span class="dt">verbose =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb631-2" data-line-number="2">                             <span class="dt">shield =</span> <span class="dv">5</span>, <span class="dt">upper =</span> <span class="dv">10</span>) {</a>
<a class="sourceLine" id="cb631-3" data-line-number="3">  <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(seed) ) {</a>
<a class="sourceLine" id="cb631-4" data-line-number="4">    <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb631-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb631-6" data-line-number="6">  <span class="cf">if</span> ( upper <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> ) {</a>
<a class="sourceLine" id="cb631-7" data-line-number="7">    <span class="kw">return</span>(<span class="kw">cat</span>(<span class="st">&quot;Upper bound on torpedo strength cannot be a negative number!&quot;</span>))</a>
<a class="sourceLine" id="cb631-8" data-line-number="8">  }</a>
<a class="sourceLine" id="cb631-9" data-line-number="9">  <span class="cf">if</span> ( shield <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> ) {</a>
<a class="sourceLine" id="cb631-10" data-line-number="10">    <span class="kw">return</span>(<span class="kw">cat</span>(<span class="st">&quot;Shield strength cannot be set to a negative number!&quot;</span>))</a>
<a class="sourceLine" id="cb631-11" data-line-number="11">  }</a>
<a class="sourceLine" id="cb631-12" data-line-number="12">  <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(seed) ) {</a>
<a class="sourceLine" id="cb631-13" data-line-number="13">    <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb631-14" data-line-number="14">  }</a>
<a class="sourceLine" id="cb631-15" data-line-number="15">  strengths &lt;-<span class="st"> </span><span class="kw">runif</span>(reps, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> upper)</a>
<a class="sourceLine" id="cb631-16" data-line-number="16">  damage &lt;-<span class="st"> </span><span class="kw">pmax</span>(<span class="dv">0</span>, strengths <span class="op">-</span><span class="st"> </span>shield)</a>
<a class="sourceLine" id="cb631-17" data-line-number="17">  <span class="cf">if</span> ( verbose ) {</a>
<a class="sourceLine" id="cb631-18" data-line-number="18">    <span class="kw">cat</span>(<span class="st">&quot;The expected damage is about &quot;</span>,</a>
<a class="sourceLine" id="cb631-19" data-line-number="19">        <span class="kw">mean</span>(damage), <span class="st">&quot; units.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb631-20" data-line-number="20">  }</a>
<a class="sourceLine" id="cb631-21" data-line-number="21">  <span class="kw">invisible</span>(<span class="kw">mean</span>(damage))</a>
<a class="sourceLine" id="cb631-22" data-line-number="22">}</a></code></pre></div>
<p>Let’s try it out:</p>
<div class="sourceCode" id="cb632"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb632-1" data-line-number="1"><span class="kw">photonTorpedoSim</span>(<span class="dt">reps =</span> <span class="dv">100000</span>, <span class="dt">seed =</span> <span class="dv">4040</span>,</a>
<a class="sourceLine" id="cb632-2" data-line-number="2">                 <span class="dt">upper =</span> <span class="dv">15</span>, <span class="dt">shield =</span> <span class="dv">12</span>)</a></code></pre></div>
<pre><code>## The expected damage is about 0.2991273 units.</code></pre></li>
<li><p>Here’s the function:</p>
<div class="sourceCode" id="cb634"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb634-1" data-line-number="1">dual &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">reps =</span> <span class="dv">10000</span>, <span class="dt">seed =</span> <span class="ot">NULL</span>) {</a>
<a class="sourceLine" id="cb634-2" data-line-number="2">  <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(seed)) {</a>
<a class="sourceLine" id="cb634-3" data-line-number="3">    <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb634-4" data-line-number="4">  }</a>
<a class="sourceLine" id="cb634-5" data-line-number="5">  <span class="co"># set up logical vector to store results of each simulation:</span></a>
<a class="sourceLine" id="cb634-6" data-line-number="6">  abeWins &lt;-<span class="st"> </span><span class="kw">logical</span>(reps)</a>
<a class="sourceLine" id="cb634-7" data-line-number="7">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>reps) {</a>
<a class="sourceLine" id="cb634-8" data-line-number="8">    dualing &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb634-9" data-line-number="9">    shotNumber &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb634-10" data-line-number="10">    <span class="cf">while</span> (dualing) {</a>
<a class="sourceLine" id="cb634-11" data-line-number="11">      <span class="co"># if i is an odd number, then Abe is shooting:</span></a>
<a class="sourceLine" id="cb634-12" data-line-number="12">      abeToShoot &lt;-<span class="st"> </span>shotNumber <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb634-13" data-line-number="13">      <span class="co"># probability of hitting depends on who is shooting:</span></a>
<a class="sourceLine" id="cb634-14" data-line-number="14">      hitProb &lt;-<span class="st"> </span><span class="kw">ifelse</span>(abeToShoot, <span class="fl">0.4</span>, <span class="fl">0.6</span>)</a>
<a class="sourceLine" id="cb634-15" data-line-number="15">      <span class="co"># shooter takes a shot:</span></a>
<a class="sourceLine" id="cb634-16" data-line-number="16">      resultOfShot &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;hit&quot;</span>, <span class="st">&quot;miss&quot;</span>),</a>
<a class="sourceLine" id="cb634-17" data-line-number="17">                             <span class="dt">size =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb634-18" data-line-number="18">                             <span class="dt">prob =</span> <span class="kw">c</span>(hitProb, <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>hitProb))</a>
<a class="sourceLine" id="cb634-19" data-line-number="19">      <span class="cf">if</span> (resultOfShot <span class="op">==</span><span class="st"> &quot;hit&quot;</span>) {</a>
<a class="sourceLine" id="cb634-20" data-line-number="20">        abeWins[i] &lt;-<span class="st"> </span><span class="kw">ifelse</span>(abeToShoot, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb634-21" data-line-number="21">        dualing &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb634-22" data-line-number="22">      }</a>
<a class="sourceLine" id="cb634-23" data-line-number="23">      shotNumber &lt;-<span class="st"> </span>shotNumber <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb634-24" data-line-number="24">    }</a>
<a class="sourceLine" id="cb634-25" data-line-number="25">  }</a>
<a class="sourceLine" id="cb634-26" data-line-number="26">  <span class="co"># count up how many times abe won, divide by number of plays,</span></a>
<a class="sourceLine" id="cb634-27" data-line-number="27">  <span class="co"># and return:</span></a>
<a class="sourceLine" id="cb634-28" data-line-number="28">  <span class="kw">sum</span>(abeWins)<span class="op">/</span>reps</a>
<a class="sourceLine" id="cb634-29" data-line-number="29">}</a></code></pre></div>
<p>Let’s try it out:</p>
<div class="sourceCode" id="cb635"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb635-1" data-line-number="1"><span class="kw">dual</span>(<span class="dt">reps =</span> <span class="dv">100000</span>, <span class="dt">seed =</span> <span class="dv">3939</span>)</a></code></pre></div>
<pre><code>## [1] 0.52441</code></pre>
<p>Looks like Abe has a slight advantage!</p></li>
</ol>
</div>
</div>
<div id="simulation-connect" class="section level2">
<h2><span class="header-section-number">4.4</span> Example: Will They Connect?</h2>
<p>Anna and Raj make a date for coffee tomorrow at the local Coffee Shop. After making the date, both of them forget the exact time they agreed to meet: they can only remember that it was to be sometime between 10 and 11am. Each person, independently of the other, randomly picks a time between 10 and 11 to arrive. If Anna arrives and Raj is not there, she will wait up to ten minutes for him, but will leave if he does not show within that time period. Raj is similarly disposed: he will wait ten minutes—but no more—for Anna. What is the chance that they meet?</p>
<p>The key to designing a simulation procedure is to realize that Anna and Raj will connect if and only if the difference between their arrival times is less than 10 minutes. It doesn’t matter who arrived first, so long as the <em>difference</em> is less than 10. This means that we want to check on the <em>absolute value</em> of Anna’s arrival time minus Raj’s arrival time. The following code implements this idea:</p>
<div class="sourceCode" id="cb637"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb637-1" data-line-number="1">meetupSim &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">reps =</span> <span class="dv">10000</span>, <span class="dt">table =</span> <span class="ot">FALSE</span>, <span class="dt">seed =</span> <span class="ot">NULL</span>) {</a>
<a class="sourceLine" id="cb637-2" data-line-number="2">  <span class="cf">if</span> ( <span class="op">!</span><span class="kw">is.null</span>(seed) ) {</a>
<a class="sourceLine" id="cb637-3" data-line-number="3">    <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb637-4" data-line-number="4">  }</a>
<a class="sourceLine" id="cb637-5" data-line-number="5">  anna &lt;-<span class="st"> </span><span class="kw">runif</span>(reps, <span class="dv">0</span>, <span class="dv">60</span>)</a>
<a class="sourceLine" id="cb637-6" data-line-number="6">  raj &lt;-<span class="st"> </span><span class="kw">runif</span>(reps, <span class="dv">0</span>, <span class="dv">60</span>)</a>
<a class="sourceLine" id="cb637-7" data-line-number="7">  connect &lt;-<span class="st"> </span>(<span class="kw">abs</span>(anna <span class="op">-</span><span class="st"> </span>raj) <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb637-8" data-line-number="8">  <span class="cf">if</span> ( table ) {</a>
<a class="sourceLine" id="cb637-9" data-line-number="9">    <span class="kw">cat</span>(<span class="st">&quot;Here is a table of the results:</span><span class="ch">\n\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb637-10" data-line-number="10">    <span class="kw">print</span>(<span class="kw">table</span>(connect))</a>
<a class="sourceLine" id="cb637-11" data-line-number="11">    <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb637-12" data-line-number="12">  }</a>
<a class="sourceLine" id="cb637-13" data-line-number="13">  <span class="kw">cat</span>(<span class="st">&quot;The proportion of times they met was &quot;</span>, <span class="kw">mean</span>(connect), <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb637-14" data-line-number="14">}</a></code></pre></div>
<p>Let’s try it out:</p>
<div class="sourceCode" id="cb638"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb638-1" data-line-number="1"><span class="kw">meetupSim</span>(<span class="dt">reps =</span> <span class="dv">100000</span>, <span class="dt">table =</span> <span class="ot">TRUE</span>, <span class="dt">seed =</span> <span class="dv">3939</span>)</a></code></pre></div>
<pre><code>## Here is a table of the results:
## 
## connect
## FALSE  TRUE 
## 69781 30219 
## 
## The proportion of times they met was 0.30219.</code></pre>
<div id="vectorization-vs.looping" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Vectorization vs. Looping</h3>
<p>Whenever you perform a simulation you have the option to use a <code>for</code>-loop, running through the loop once for each repetition of the random process in question. For example, you could rewrite the meetup-simulation as follows:</p>
<div class="sourceCode" id="cb640"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb640-1" data-line-number="1">meetupSim2 &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">reps =</span> <span class="dv">10000</span>, <span class="dt">table =</span> <span class="ot">FALSE</span>, <span class="dt">seed =</span> <span class="ot">NULL</span>) {</a>
<a class="sourceLine" id="cb640-2" data-line-number="2">  <span class="cf">if</span> ( <span class="op">!</span><span class="kw">is.null</span>(seed) ) {</a>
<a class="sourceLine" id="cb640-3" data-line-number="3">    <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb640-4" data-line-number="4">  }</a>
<a class="sourceLine" id="cb640-5" data-line-number="5">  <span class="co">#create an empty vector to hold the results:</span></a>
<a class="sourceLine" id="cb640-6" data-line-number="6">  connect &lt;-<span class="st"> </span><span class="kw">numeric</span>(reps)</a>
<a class="sourceLine" id="cb640-7" data-line-number="7">  <span class="co"># loop through:</span></a>
<a class="sourceLine" id="cb640-8" data-line-number="8">  <span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>reps ) {</a>
<a class="sourceLine" id="cb640-9" data-line-number="9">    <span class="co"># get one arrival time for anna:</span></a>
<a class="sourceLine" id="cb640-10" data-line-number="10">    anna &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">60</span>)</a>
<a class="sourceLine" id="cb640-11" data-line-number="11">    <span class="co"># and one for raj:</span></a>
<a class="sourceLine" id="cb640-12" data-line-number="12">    raj &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">60</span>)</a>
<a class="sourceLine" id="cb640-13" data-line-number="13">    <span class="co">#compute result and record in conncect:</span></a>
<a class="sourceLine" id="cb640-14" data-line-number="14">    connect[i] &lt;-<span class="st"> </span>(<span class="kw">abs</span>(anna <span class="op">-</span><span class="st"> </span>raj) <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb640-15" data-line-number="15">  }</a>
<a class="sourceLine" id="cb640-16" data-line-number="16">  <span class="co">#the rest is the same as in meetupSim:</span></a>
<a class="sourceLine" id="cb640-17" data-line-number="17">  <span class="cf">if</span> ( table ) {</a>
<a class="sourceLine" id="cb640-18" data-line-number="18">    <span class="kw">cat</span>(<span class="st">&quot;Here is a table of the results:</span><span class="ch">\n\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb640-19" data-line-number="19">    <span class="kw">print</span>(<span class="kw">table</span>(connect))</a>
<a class="sourceLine" id="cb640-20" data-line-number="20">    <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb640-21" data-line-number="21">  }</a>
<a class="sourceLine" id="cb640-22" data-line-number="22">  <span class="kw">cat</span>(<span class="st">&quot;The proportion of times they met was &quot;</span>, <span class="kw">mean</span>(connect), <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb640-23" data-line-number="23">}</a></code></pre></div>
<p>Be aware, though, that when you use a loop in place of vectorization your routine is liable to run more slowly. We can measure the difference with the R-function <code>system.time()</code>. As an illustration, let’s compare the running times for the vectorized and the looping versions of the meetup simulation.</p>
<p>First we get the time for the thousand repetitions of the meetup, using the original vectorized function:</p>
<div class="sourceCode" id="cb641"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb641-1" data-line-number="1"><span class="kw">system.time</span>(<span class="kw">meetupSim</span>(<span class="dt">reps =</span> <span class="dv">10000</span>, <span class="dt">seed =</span> <span class="dv">4040</span>))</a></code></pre></div>
<pre><code>## The proportion of times they met was 0.3079.
##   user  system elapsed 
##  0.002   0.001   0.003 </code></pre>
<p>Our concern is with the total elapsed time: a mere three-thousandths of a second!</p>
<p>Next we get the time for the same number of repetitions, using the looping implementation:</p>
<div class="sourceCode" id="cb643"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb643-1" data-line-number="1"><span class="kw">system.time</span>(<span class="kw">meetupSim2</span>(<span class="dt">reps =</span> <span class="dv">10000</span>, <span class="dt">seed =</span> <span class="dv">4040</span>))</a></code></pre></div>
<pre><code>## The proportion of times they met was 0.2993.
##    user  system elapsed 
##  0.056   0.007   0.065 </code></pre>
<p>Here the elapsed time is 0.065 seconds. This still seems pretty fast, but it’s more than 20 times as long as for the vectorized simulation. For more complex simulations such a dramatic slowdown could pose serious practical problems.</p>

<div class="rmdtip">
When performance is an issue, prefer vectorization to looping as much as possible.
</div>

</div>
</div>
<div id="appeals-court-paradox" class="section level2">
<h2><span class="header-section-number">4.5</span> Example: the Appeals Court Paradox</h2>
<p>The following example is discussed in <span class="citation">(J.Nahin <a href="#ref-Nahin2008">2008</a>)</span>.</p>
<p>An appeals court generally consists of an odd number of justices, so the court will not be hampered with tie-votes and will thus always be able to render a decision for any case brought before it. Let’s imagine an appeals court that has five members. Let us further imagine that for each case before the court, each of the justices, independently of the others, makes a decision for either one or the other of the two opposing parties. Assume also for the sake of simplicity that there is always one side that is “in the right”. It follows that each judge is making a decision that is either correct or incorrect. The judges then report their decisions to one another, and the decision of the court is determined by majority vote. To be precise: whichever side gets three or more votes is the side that wins.</p>
<p>Although all of the members of the court are pretty sharp, they differ somewhat in their legal abilities:</p>
<ul>
<li>In any case that comes before her, Judge A has a 95% chance to decide correctly.</li>
<li>Judge B has a 94% chance to judge correctly.</li>
<li>Judges C and D each have a 90% chance to judge correctly.</li>
<li>Judge E is the weak link on the court, with a mere 80% chance to judge correctly.</li>
</ul>
<p>We are interested in estimating the probability that the majority opinion of the court will be correct.</p>
<p>Before we write a simulation in full, we should consider how we are going to simulate something that has a specified percentage chance of happening. For example, how would we simulate decisions made by Judge A?</p>
<p>One approach is to use <code>runif()</code> with a cutoff:</p>
<div class="sourceCode" id="cb645"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb645-1" data-line-number="1">number &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>) <span class="co"># random number between 0 and 1</span></a>
<a class="sourceLine" id="cb645-2" data-line-number="2">number <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.95</span></a></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>In repeated trials, a random real number between 0 and 1 will turn out to be less than 0.95 about 95% of the time.</p>
<p>Another—and more convenient—way is to use the function <code>rbinom()</code>.  This function simulates the results of flipping a coin a number of times and counting how many heads one gets. The general form of a call to <code>rbinom()</code>is as follows:</p>
<div class="sourceCode" id="cb647"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb647-1" data-line-number="1"><span class="kw">rbinom</span>(n, size, prob)</a></code></pre></div>
<p>In this call:</p>
<ul>
<li><code>size</code> is how many times you plan to flip the coin;</li>
<li><code>prob</code> is the chance on any flip that the coin will turn up heads;</li>
<li><code>n</code> is how many times you plan to repeat the process of flipping the coin <code>size</code> times (counting up the number of heads each time).</li>
</ul>
<p>In order to simulate flipping a fair coin 100 times, you could ask for:</p>
<div class="sourceCode" id="cb648"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb648-1" data-line-number="1"><span class="kw">rbinom</span>(<span class="dt">n =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">100</span>, <span class="dt">prob =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<pre><code>## [1] 52</code></pre>
<p>It seems that we got 52 heads!</p>
<p>If you want to go through the above process twenty times instead of just doing it once, you could ask for:</p>
<div class="sourceCode" id="cb650"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb650-1" data-line-number="1"><span class="kw">rbinom</span>(<span class="dt">n =</span> <span class="dv">20</span>, <span class="dt">size =</span> <span class="dv">100</span>, <span class="dt">prob =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<pre><code>##  [1] 52 49 45 57 53 60 46 53 50 54 59 47 42 45 41 56 47 57 56 49</code></pre>
<p>Nothing in <code>rbinom()</code> says that it addresses only coin-flipping. In general it serves as a model for any situation in which:</p>
<ul>
<li>there is a fixed number of trials (e.g., flip of a coin, taking a free-throw shot, deciding about a court case);</li>
<li>each trial has two possible outcomes, often termed Success or Failure (e.g., coins lands heads or tails, you make the shot or you don’t, you decide the case correctly or you don’t);</li>
<li>the chance of the Success outcome is the same, on any trial (e.g., the coin always has the same chance of coming up heads, for <em>any</em> case Judge A has a 95% chance of being right);</li>
<li>the outcome of any trial is independent of the outcome of all other trials (e.g., making the first free throw does not increase or decrease one’s chances of making the next free throw, etc.)</li>
<li>you are counting up the number of successes in your trials.</li>
</ul>
<p>In such a situation the count of the number of successes is called a <em>binomial</em> random variable.<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a> The <code>size</code> parameter in <code>rbinom()</code> gives the fixed number of trials. The <code>prob</code> parameter specifies the chance of success on each trial.</p>
<p>In this example we would like to simulate each judge deciding about each case. Suppose for example, that there are twenty cases. We would like to know, for each judge and each case, whether or not the judge was correct</p>
<p>Suppose we were to watch Judge A making 20 decisions, recording each time whether she was correct or not. In order to simulate the results with R, we could ask for:</p>
<div class="sourceCode" id="cb652"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb652-1" data-line-number="1"><span class="kw">rbinom</span>(<span class="dt">n =</span> <span class="dv">20</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> <span class="fl">0.95</span>)</a></code></pre></div>
<pre><code>##  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 1 1 1</code></pre>
<p>In the above results, each 1 stands for a correct decision and the 0 stands for an incorrect decision.</p>
<p>Note that the following call would be incorrect:</p>
<div class="sourceCode" id="cb654"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb654-1" data-line-number="1"><span class="kw">rbinom</span>(<span class="dt">n =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">20</span>, <span class="dt">prob =</span> <span class="fl">0.95</span>)</a></code></pre></div>
<p>This would give us a <em>count</em> of the number of times Judge A was correct, but it would not tell us which of the cases she judged correctly and which she judged incorrectly.</p>
<p>Assuming that the court hears 20 cases, we would like to simulate the decision of each judge in each case. We could store the results in variables, as follows:</p>
<div class="sourceCode" id="cb655"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb655-1" data-line-number="1">a &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dt">n =</span> <span class="dv">20</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> <span class="fl">0.95</span>)  <span class="co"># Judge A</span></a>
<a class="sourceLine" id="cb655-2" data-line-number="2">b &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dt">n =</span> <span class="dv">20</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> <span class="fl">0.94</span>)  <span class="co"># Judge B</span></a>
<a class="sourceLine" id="cb655-3" data-line-number="3">c &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dt">n =</span> <span class="dv">20</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> <span class="fl">0.90</span>)  <span class="co"># Judge C</span></a>
<a class="sourceLine" id="cb655-4" data-line-number="4">d &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dt">n =</span> <span class="dv">20</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> <span class="fl">0.90</span>)  <span class="co"># Judge D</span></a>
<a class="sourceLine" id="cb655-5" data-line-number="5">e &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dt">n =</span> <span class="dv">20</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> <span class="fl">0.80</span>)  <span class="co"># Judge E</span></a></code></pre></div>
<p>Now we come to the key idea in coding our simulation: in order to determine the total number of correct votes in each case, all we need to do is <em>add</em> the five vectors we created above:</p>
<div class="sourceCode" id="cb656"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb656-1" data-line-number="1">correctVotes &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span>b <span class="op">+</span><span class="st"> </span>c <span class="op">+</span><span class="st"> </span>d <span class="op">+</span><span class="st"> </span>e</a></code></pre></div>
<p>The court will decide correctly when the number of votes for the correct option is at least 3. The following logical vector records this:</p>
<div class="sourceCode" id="cb657"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb657-1" data-line-number="1">courtCorrect &lt;-<span class="st"> </span>(correctVotes <span class="op">&gt;=</span><span class="st"> </span><span class="dv">3</span>)</a></code></pre></div>
<p>Table @ref(tab:judge-votes) shows some possible results:</p>
<table>
<caption>(#tab:judge-votes)Results of 20 simulated appeals court decisions.</caption>
<thead>
<tr class="header">
<th align="right">A</th>
<th align="right">B</th>
<th align="right">C</th>
<th align="right">D</th>
<th align="right">E</th>
<th align="right">Number Correct</th>
<th align="left">Court Correct</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="left">TRUE</td>
</tr>
</tbody>
</table>
<p>Note that all of the court’s decisions were correct, even though in a couple of cases the correct decisions were barely in the majority.</p>
<p>We now have the basic idea of the simulation. In order to estimate the probability of a correct decision, we simply need to recast our idea in the form of a function that permits us to simulate a very large number of imaginary court cases and that will report the results to us. Here is the code for such a function.</p>
<div class="sourceCode" id="cb658"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb658-1" data-line-number="1">courtSim &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">reps =</span> <span class="dv">10000</span>,</a>
<a class="sourceLine" id="cb658-2" data-line-number="2">                     <span class="dt">seed =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb658-3" data-line-number="3">                     <span class="dt">table =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb658-4" data-line-number="4">                     <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.95</span>, <span class="fl">0.94</span>, <span class="fl">0.90</span>, <span class="fl">0.90</span>, <span class="fl">0.80</span>)) {</a>
<a class="sourceLine" id="cb658-5" data-line-number="5">  </a>
<a class="sourceLine" id="cb658-6" data-line-number="6">  <span class="cf">if</span> ( <span class="op">!</span><span class="kw">is.null</span>(seed) ) {</a>
<a class="sourceLine" id="cb658-7" data-line-number="7">    <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb658-8" data-line-number="8">  }</a>
<a class="sourceLine" id="cb658-9" data-line-number="9">  </a>
<a class="sourceLine" id="cb658-10" data-line-number="10">  <span class="co"># get the probabilities</span></a>
<a class="sourceLine" id="cb658-11" data-line-number="11">  aProb &lt;-<span class="st"> </span>probs[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb658-12" data-line-number="12">  bProb &lt;-<span class="st"> </span>probs[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb658-13" data-line-number="13">  cProb &lt;-<span class="st"> </span>probs[<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb658-14" data-line-number="14">  dProb &lt;-<span class="st"> </span>probs[<span class="dv">4</span>]</a>
<a class="sourceLine" id="cb658-15" data-line-number="15">  eProb &lt;-<span class="st"> </span>probs[<span class="dv">5</span>]</a>
<a class="sourceLine" id="cb658-16" data-line-number="16">  </a>
<a class="sourceLine" id="cb658-17" data-line-number="17">  <span class="co"># simulate decisions of each judge:                 </span></a>
<a class="sourceLine" id="cb658-18" data-line-number="18">  a &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dt">n =</span> reps, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> aProb)</a>
<a class="sourceLine" id="cb658-19" data-line-number="19">  b &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dt">n =</span> reps, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> bProb)</a>
<a class="sourceLine" id="cb658-20" data-line-number="20">  c &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dt">n =</span> reps, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> cProb)</a>
<a class="sourceLine" id="cb658-21" data-line-number="21">  d &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dt">n =</span> reps, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> dProb)</a>
<a class="sourceLine" id="cb658-22" data-line-number="22">  e &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dt">n =</span> reps, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> eProb)</a>
<a class="sourceLine" id="cb658-23" data-line-number="23">  </a>
<a class="sourceLine" id="cb658-24" data-line-number="24">  <span class="co"># count the number of correct votes in each case:</span></a>
<a class="sourceLine" id="cb658-25" data-line-number="25">  correctVotes &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span>b <span class="op">+</span><span class="st"> </span>c <span class="op">+</span><span class="st"> </span>d <span class="op">+</span><span class="st"> </span>e</a>
<a class="sourceLine" id="cb658-26" data-line-number="26">  </a>
<a class="sourceLine" id="cb658-27" data-line-number="27">  <span class="co"># determine whether court decided correctly, in each case:</span></a>
<a class="sourceLine" id="cb658-28" data-line-number="28">  courtCorrect &lt;-<span class="st"> </span>(correctVotes <span class="op">&gt;=</span><span class="st"> </span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb658-29" data-line-number="29">  </a>
<a class="sourceLine" id="cb658-30" data-line-number="30">  <span class="co"># record results</span></a>
<a class="sourceLine" id="cb658-31" data-line-number="31">  <span class="cf">if</span> ( table ) {</a>
<a class="sourceLine" id="cb658-32" data-line-number="32">    <span class="kw">cat</span>(<span class="st">&quot;Here is a table of the results:</span><span class="ch">\n\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb658-33" data-line-number="33">    <span class="kw">print</span>(<span class="kw">table</span>(courtCorrect))</a>
<a class="sourceLine" id="cb658-34" data-line-number="34">    <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb658-35" data-line-number="35">  }</a>
<a class="sourceLine" id="cb658-36" data-line-number="36">  <span class="kw">cat</span>(<span class="st">&quot;The proportion of times the court was correct was &quot;</span>, </a>
<a class="sourceLine" id="cb658-37" data-line-number="37">      <span class="kw">mean</span>(courtCorrect), <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb658-38" data-line-number="38">}</a></code></pre></div>
<p>Let’s now estimate the probability of the court rendering a correct verdict, using one hundred thousand simulated cases:</p>
<div class="sourceCode" id="cb659"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb659-1" data-line-number="1"><span class="kw">courtSim</span>(<span class="dt">reps =</span> <span class="dv">100000</span>, <span class="dt">seed =</span> <span class="dv">3838</span>, <span class="dt">table =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## Here is a table of the results:
## 
## courtCorrect
## FALSE  TRUE 
##   787 99213 
## 
## The proportion of times the court was correct was 0.99213.</code></pre>
<p>The court seems to be doing quite well! But of course this is not very surprising: after all, most of the judges make the correct decision almost all the time. It is interesting, though, that the chance of the <em>full court</em> rendering a correct verdict is higher than the chance of any individual judge to be correct. There appears to be a benefit to the voting procedure.</p>
<p>But things get even more interesting if we imagine that the judges recognize, after some time, that Judge E simply isn’t as sharp as Judge A, and that they pressure him into voting whichever way Judge A votes. “Surely”, they reason, “since Judge A is so good this new policy will increase our chance to hand down a correct verdict!”</p>
<p>We will simulate to see if the judges’ reasoning is correct. All we need to do is to count Judge A’s vote twice in the sum, and not count Judge E’s vote at all:</p>
<div class="sourceCode" id="cb661"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb661-1" data-line-number="1">correctVotes &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span>a <span class="op">+</span><span class="st"> </span>b <span class="op">+</span><span class="st"> </span>c <span class="op">+</span><span class="st"> </span>d</a></code></pre></div>
<p>Here is the new simulation-function:</p>
<div class="sourceCode" id="cb662"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb662-1" data-line-number="1">courtSim2 &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">reps =</span> <span class="dv">10000</span>,</a>
<a class="sourceLine" id="cb662-2" data-line-number="2">                     <span class="dt">seed =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb662-3" data-line-number="3">                     <span class="dt">table =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb662-4" data-line-number="4">                     <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.95</span>, <span class="fl">0.94</span>, <span class="fl">0.90</span>, <span class="fl">0.90</span>, <span class="fl">0.80</span>)) {</a>
<a class="sourceLine" id="cb662-5" data-line-number="5">  </a>
<a class="sourceLine" id="cb662-6" data-line-number="6">  <span class="cf">if</span> ( <span class="op">!</span><span class="kw">is.null</span>(seed) ) {</a>
<a class="sourceLine" id="cb662-7" data-line-number="7">    <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb662-8" data-line-number="8">  }</a>
<a class="sourceLine" id="cb662-9" data-line-number="9">  </a>
<a class="sourceLine" id="cb662-10" data-line-number="10">  <span class="co"># get the probabilities</span></a>
<a class="sourceLine" id="cb662-11" data-line-number="11">  aProb &lt;-<span class="st"> </span>probs[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb662-12" data-line-number="12">  bProb &lt;-<span class="st"> </span>probs[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb662-13" data-line-number="13">  cProb &lt;-<span class="st"> </span>probs[<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb662-14" data-line-number="14">  dProb &lt;-<span class="st"> </span>probs[<span class="dv">4</span>]</a>
<a class="sourceLine" id="cb662-15" data-line-number="15">  eProb &lt;-<span class="st"> </span>probs[<span class="dv">5</span>]</a>
<a class="sourceLine" id="cb662-16" data-line-number="16">  </a>
<a class="sourceLine" id="cb662-17" data-line-number="17">  <span class="co"># simulate decisions (this time, no need for Judge E) :             </span></a>
<a class="sourceLine" id="cb662-18" data-line-number="18">  a &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dt">n =</span> reps, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> aProb)</a>
<a class="sourceLine" id="cb662-19" data-line-number="19">  b &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dt">n =</span> reps, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> bProb)</a>
<a class="sourceLine" id="cb662-20" data-line-number="20">  c &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dt">n =</span> reps, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> cProb)</a>
<a class="sourceLine" id="cb662-21" data-line-number="21">  d &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dt">n =</span> reps, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> dProb)</a>
<a class="sourceLine" id="cb662-22" data-line-number="22">  </a>
<a class="sourceLine" id="cb662-23" data-line-number="23">  <span class="co"># count rhe number of correct votes in each case:</span></a>
<a class="sourceLine" id="cb662-24" data-line-number="24">  correctVotes &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span>a <span class="op">+</span><span class="st"> </span>b <span class="op">+</span><span class="st"> </span>c <span class="op">+</span><span class="st"> </span>d</a>
<a class="sourceLine" id="cb662-25" data-line-number="25">  </a>
<a class="sourceLine" id="cb662-26" data-line-number="26">  <span class="co"># determine whether court decided correctly, in each case:</span></a>
<a class="sourceLine" id="cb662-27" data-line-number="27">  courtCorrect &lt;-<span class="st"> </span>(correctVotes <span class="op">&gt;=</span><span class="st"> </span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb662-28" data-line-number="28">  </a>
<a class="sourceLine" id="cb662-29" data-line-number="29">  <span class="co"># record results</span></a>
<a class="sourceLine" id="cb662-30" data-line-number="30">  <span class="cf">if</span> ( table ) {</a>
<a class="sourceLine" id="cb662-31" data-line-number="31">    <span class="kw">cat</span>(<span class="st">&quot;Here is a table of the results:</span><span class="ch">\n\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb662-32" data-line-number="32">    <span class="kw">print</span>(<span class="kw">table</span>(courtCorrect))</a>
<a class="sourceLine" id="cb662-33" data-line-number="33">    <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb662-34" data-line-number="34">  }</a>
<a class="sourceLine" id="cb662-35" data-line-number="35">  <span class="kw">cat</span>(<span class="st">&quot;The proportion of times the court was correct was &quot;</span>, </a>
<a class="sourceLine" id="cb662-36" data-line-number="36">      <span class="kw">mean</span>(courtCorrect), <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb662-37" data-line-number="37">}</a></code></pre></div>
<p>Let’s try it out:</p>
<div class="sourceCode" id="cb663"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb663-1" data-line-number="1"><span class="kw">courtSim2</span>(<span class="dt">reps =</span> <span class="dv">100000</span>, <span class="dt">seed =</span> <span class="dv">3838</span>, <span class="dt">table =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## Here is a table of the results:
## 
## courtCorrect
## FALSE  TRUE 
##  1221 98779 
## 
## The proportion of times the court was correct was 0.98779.</code></pre>
<p>Hey! That’s a <em>lower</em> chance of success than before! The difference is small but significant: compelling the weakest judge to vote with the strongest judge actually <em>decreased</em> the court’s chance of rendering a correct verdict overall. This circumstance is sometimes called the Appeals Court Paradox, but it occurs in many other practical situations. More often than you might think, the benefit of independent voting can outweigh the advantage associated with relying solely on a small number of “experts.”</p>
<div id="practice-exercises-8" class="section level3">
<h3><span class="header-section-number">4.5.1</span> Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Use <code>rbinom()</code> to simulate taking twenty free throws, where you have a 70% chance to make each shot. Your simulation should produce a vector of 20 ones and zeros, where 1 stands for making the shot and 0 stands for missing it.</p></li>
<li><p>Use <code>rbinom()</code> to simulate taking twenty free throws, where you have a 70% chance to make each shot, and counting up how many shots you make. Your simulation should produce a vector of length one that represents the number of shots you made.</p></li>
<li><p>Every morning for 100 mornings in a row you take twenty free throws. You have a 70% chance to make each shot, and you always count up how many shots you make. Use <code>rbinom()</code> to simulate the counts. Your simulation should produce a vector of length 100 where the first element represents the number of shots you made on day 1, the second element represents the number of shots you made on day 2, etc.</p></li>
<li><p>You have a 70% chance to make each free throw shot you take. Your friend Lester has a 60% chance to make each shot. Both of you will take 20 shots. You are interested in knowing the probability that you will make more shots than Lester does. Write a function called <code>freeThrowSim()</code> that will help you estimate this probability. The function should take two parameters:</p>
<ul>
<li><code>seed</code>, so that the user can set a seed;</li>
<li><code>reps</code>, the number of times to simulate a competition between you and Lester.</li>
</ul>
<p>The function should return the estimated probability.</p></li>
</ol>
</div>
<div id="solutions-to-the-practice-exercises-5" class="section level3">
<h3><span class="header-section-number">4.5.2</span> Solutions to the Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Try this:</p>
<div class="sourceCode" id="cb665"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb665-1" data-line-number="1"><span class="kw">rbinom</span>(<span class="dv">20</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> <span class="fl">0.70</span>)</a></code></pre></div>
<pre><code>##  [1] 0 0 0 0 1 0 1 0 1 1 1 0 0 1 0 0 1 1 1 1</code></pre></li>
<li><p>Try this:</p>
<div class="sourceCode" id="cb667"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb667-1" data-line-number="1"><span class="kw">rbinom</span>(<span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">20</span>, <span class="dt">prob =</span> <span class="fl">0.70</span>)</a></code></pre></div>
<pre><code>## [1] 14</code></pre></li>
<li><p>Try this:</p>
<div class="sourceCode" id="cb669"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb669-1" data-line-number="1"><span class="kw">rbinom</span>(<span class="dv">100</span>, <span class="dt">size =</span> <span class="dv">20</span>, <span class="dt">prob =</span> <span class="fl">0.70</span>)</a></code></pre></div></li>
<li><p>Here’s the function if you decide to use a loop:</p>
<div class="sourceCode" id="cb670"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb670-1" data-line-number="1">freeThrowSim &lt;-<span class="st"> </span><span class="cf">function</span>(reps, seed) {</a>
<a class="sourceLine" id="cb670-2" data-line-number="2">  youWin &lt;-<span class="st"> </span><span class="kw">logical</span>(reps)</a>
<a class="sourceLine" id="cb670-3" data-line-number="3">  <span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>reps ) {</a>
<a class="sourceLine" id="cb670-4" data-line-number="4">    youMake &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">20</span>, <span class="dt">prob =</span> <span class="fl">0.70</span>)</a>
<a class="sourceLine" id="cb670-5" data-line-number="5">    lesterMakes &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">20</span>, <span class="dt">prob =</span> <span class="fl">0.60</span>)</a>
<a class="sourceLine" id="cb670-6" data-line-number="6">    youWin[i] &lt;-<span class="st"> </span>(youMake <span class="op">&gt;</span><span class="st"> </span>lesterMakes)</a>
<a class="sourceLine" id="cb670-7" data-line-number="7">  }</a>
<a class="sourceLine" id="cb670-8" data-line-number="8">  <span class="kw">mean</span>(youWin)</a>
<a class="sourceLine" id="cb670-9" data-line-number="9">}</a></code></pre></div>
<p>Here’s the function if you vectorize:</p>
<div class="sourceCode" id="cb671"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb671-1" data-line-number="1">freeThrowSim &lt;-<span class="st"> </span><span class="cf">function</span>(reps, seed) {</a>
<a class="sourceLine" id="cb671-2" data-line-number="2">  youMake &lt;-<span class="st"> </span><span class="kw">rbinom</span>(reps, <span class="dt">size =</span> <span class="dv">20</span>, <span class="dt">prob =</span> <span class="fl">0.70</span>)</a>
<a class="sourceLine" id="cb671-3" data-line-number="3">  lesterMakes &lt;-<span class="st"> </span><span class="kw">rbinom</span>(reps, <span class="dt">size =</span> <span class="dv">20</span>, <span class="dt">prob =</span> <span class="fl">0.60</span>)</a>
<a class="sourceLine" id="cb671-4" data-line-number="4">  youWin&lt;-<span class="st"> </span>(youMake <span class="op">&gt;</span><span class="st"> </span>lesterMakes)</a>
<a class="sourceLine" id="cb671-5" data-line-number="5">  <span class="kw">mean</span>(youWin)</a>
<a class="sourceLine" id="cb671-6" data-line-number="6">}</a></code></pre></div>
<p>Let’s try it:</p>
<div class="sourceCode" id="cb672"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb672-1" data-line-number="1"><span class="kw">freeThrowSim</span>(<span class="dt">reps =</span> <span class="dv">100000</span>, <span class="dt">seed =</span> <span class="dv">3535</span>)</a></code></pre></div>
<pre><code>## [1] 0.69132</code></pre>
<p>You have nearly a 70% chance to make more shots than Lester.</p></li>
</ol>
</div>
</div>
<div id="simulation-number-needed" class="section level2">
<h2><span class="header-section-number">4.6</span> Example: How Many Numbers Needed?</h2>
<p>Let us pause for a review.</p>
<p>So far our examples have involved estimating a probability: the chance for a particular event to occur. We have accomplished this with Monte Carlo simulation:</p>
<ul>
<li>We repeated the chance process a very large number of times</li>
<li>On each repetition, we recorded whether or not the event occurred.</li>
<li>After we finished all of the repetitions, we computed the proportion of those repetitions in which the event <em>did</em> occur.</li>
<li>This proportion served as our estimate of the probability for the event to occur.</li>
<li>We know that the more repetitions we arrange for, the closer our estimate is liable to be to the actual probability for the event to occur.</li>
</ul>
<p>Let us now switch gears and take up the task of estimating the <em>expected value</em> of a random variable.</p>
<p>Recall that a random variable is a number whose value is the result of some chance process. The expected value of the random variable is the <em>average</em>—the mean—of its values over many, many repetitions of that chance process.</p>
<p>Let us consider the following chance process:</p>
<ul>
<li>Pick a real number <span class="math inline">\(x_1\)</span> between 0 and 1 at random.</li>
<li>Pick another real number <span class="math inline">\(x_2\)</span> at random (also between 0 and 1). Add it to <span class="math inline">\(x_1\)</span>.</li>
<li>If the sum <span class="math inline">\(x_1 + x_2\)</span> exceeds 1, then stop.</li>
<li>Otherwise, pick a third real number <span class="math inline">\(x_3\)</span>, and add it to the sum of the previous two.</li>
<li>If the sum <span class="math inline">\(x_1+x_2+x_3\)</span> exceeds 1, then stop.</li>
<li>Otherwise, pick a fourth real number …</li>
</ul>
<p>The idea is to keep on going in this way until the sum of the numbers you have picked exceeds 1.</p>
<p>The random variable we are interested in is the <em>number</em> of numbers we have to pick to make the sum of those numbers exceed 1. Let us call this random variable <span class="math inline">\(X\)</span>. As you can see, this number could be 2, or 3, or 4, or even more depending on how small the random numbers you pick happen to be.</p>
<p>In order to fully grasp what is going on, it will be helpful to go through the process of computing <span class="math inline">\(X\)</span>. The following function will do this for us:</p>
<div class="sourceCode" id="cb674"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb674-1" data-line-number="1">numberNeeded &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">verbose =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb674-2" data-line-number="2">  mySum &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb674-3" data-line-number="3">  count &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb674-4" data-line-number="4">  <span class="cf">while</span>( mySum <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span> ) {</a>
<a class="sourceLine" id="cb674-5" data-line-number="5">    number &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb674-6" data-line-number="6">    mySum &lt;-<span class="st"> </span>mySum <span class="op">+</span><span class="st"> </span>number</a>
<a class="sourceLine" id="cb674-7" data-line-number="7">    count &lt;-<span class="st"> </span>count <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb674-8" data-line-number="8">    <span class="cf">if</span> ( verbose ) {</a>
<a class="sourceLine" id="cb674-9" data-line-number="9">      <span class="kw">cat</span>(<span class="st">&quot;Just now picked &quot;</span>, number, <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb674-10" data-line-number="10">      <span class="kw">cat</span>(count, <span class="st">&quot; number(s) picked so far.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb674-11" data-line-number="11">      <span class="kw">cat</span>(<span class="st">&quot;Their sum is &quot;</span>, mySum, <span class="st">&quot;.</span><span class="ch">\n\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb674-12" data-line-number="12">    }</a>
<a class="sourceLine" id="cb674-13" data-line-number="13">  }</a>
<a class="sourceLine" id="cb674-14" data-line-number="14">  count</a>
<a class="sourceLine" id="cb674-15" data-line-number="15">}</a></code></pre></div>
<p>Call the function a few times, like this:</p>
<div class="sourceCode" id="cb675"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb675-1" data-line-number="1"><span class="kw">numberNeeded</span>(<span class="dt">verbose =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## Just now picked 0.2869393.
## 1 number(s) picked so far.
## Their sum is 0.2869393.
## 
## Just now picked 0.7092682.
## 2 number(s) picked so far.
## Their sum is 0.9962075.
## 
## Just now picked 0.7524099.
## 3 number(s) picked so far.
## Their sum is 1.748617.</code></pre>
<pre><code>## [1] 3</code></pre>
<p>As you can see, it’s quite common to need 2 or 3 numbers to make the sum exceed 1, but sometimes, you need 4, 5 or even more numbers.</p>
<p>Since we are interested in the expected value of <span class="math inline">\(X\)</span>, we should repeat the process a large number of times and compute the mean of the <span class="math inline">\(X\)</span>-values that we find. The following code repeats the process 1000 times:</p>
<div class="sourceCode" id="cb678"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb678-1" data-line-number="1">needed &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb678-2" data-line-number="2"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">1000</span> ) {</a>
<a class="sourceLine" id="cb678-3" data-line-number="3">  needed[i] &lt;-<span class="st"> </span><span class="kw">numberNeeded</span>()</a>
<a class="sourceLine" id="cb678-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb678-5" data-line-number="5"><span class="kw">cat</span>(<span class="st">&quot;The expected number needed is about &quot;</span>, </a>
<a class="sourceLine" id="cb678-6" data-line-number="6">    <span class="kw">mean</span>(needed), <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## The expected number needed is about 2.697.</code></pre>
<p>Of course the expected value indicates what <span class="math inline">\(X\)</span> will be <em>on average</em>. By itself it doesn’t tell us about the <em>variability</em> in <span class="math inline">\(X\)</span>—how much <span class="math inline">\(X\)</span> tends to “hop around” from one repetition to another. In order to get a sense of the variability of <span class="math inline">\(X\)</span>, we can make a table of the results of our 1000 repetitions:</p>
<div class="sourceCode" id="cb680"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb680-1" data-line-number="1"><span class="kw">table</span>(needed)</a></code></pre></div>
<pre><code>## needed
##   2   3   4   5   6   7 
## 528 303 123  37   8   1</code></pre>
<p>Sure enough, we usually got 2 or 3, but higher values are certainly possible.</p>
<p>For the most part we are less interested in the <em>number</em> of times we got each possible value than we are in the <em>proportion</em> of times we got each possible value. For this all we need is <code>prop.table()</code>:</p>
<div class="sourceCode" id="cb682"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb682-1" data-line-number="1"><span class="kw">prop.table</span>(<span class="kw">table</span>(needed))</a></code></pre></div>
<pre><code>## needed
##     2     3     4     5     6     7 
## 0.528 0.303 0.123 0.037 0.008 0.001</code></pre>
<p>The proportions serve as estimates of the <em>probability</em> of getting each of the possible values of <span class="math inline">\(X\)</span>. Such a table of proportions gives us a sense of the <em>distribution</em> of <span class="math inline">\(X\)</span>—the chances for <span class="math inline">\(X\)</span> to assume each of its possible values.<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a></p>
<p>Now that we have the basic idea of how to accomplish the simulation, it remains to package up our code into a nice function that will enable a user to set the number of repetitions, set a seed, and choose reporting options. Along the way we will generalize a bit, allowing the user to set a target sum other than 1. We’ll also return our estimate of the expected number needed invisibly, so that the function can be used in the context of larger-scale investigations (see the exercises from this Chapter).</p>
<div class="sourceCode" id="cb684"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb684-1" data-line-number="1">numberNeededSim &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">target =</span> <span class="dv">1</span>, <span class="dt">reps =</span> <span class="dv">1000</span>, </a>
<a class="sourceLine" id="cb684-2" data-line-number="2">                            <span class="dt">seed =</span> <span class="ot">NULL</span>, <span class="dt">report =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb684-3" data-line-number="3">  </a>
<a class="sourceLine" id="cb684-4" data-line-number="4">  <span class="cf">if</span> ( <span class="op">!</span><span class="kw">is.null</span>(seed) ) {</a>
<a class="sourceLine" id="cb684-5" data-line-number="5">    <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb684-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb684-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb684-8" data-line-number="8">  <span class="co"># define helper function</span></a>
<a class="sourceLine" id="cb684-9" data-line-number="9">  numberNeeded &lt;-<span class="st"> </span><span class="cf">function</span>(target) {</a>
<a class="sourceLine" id="cb684-10" data-line-number="10">    mySum &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb684-11" data-line-number="11">    count &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb684-12" data-line-number="12">    <span class="cf">while</span>( mySum <span class="op">&lt;</span><span class="st"> </span>target ) {</a>
<a class="sourceLine" id="cb684-13" data-line-number="13">      number &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb684-14" data-line-number="14">     mySum &lt;-<span class="st"> </span>mySum <span class="op">+</span><span class="st"> </span>number</a>
<a class="sourceLine" id="cb684-15" data-line-number="15">      count &lt;-<span class="st"> </span>count <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb684-16" data-line-number="16">    }</a>
<a class="sourceLine" id="cb684-17" data-line-number="17">    count</a>
<a class="sourceLine" id="cb684-18" data-line-number="18">  }</a>
<a class="sourceLine" id="cb684-19" data-line-number="19">  </a>
<a class="sourceLine" id="cb684-20" data-line-number="20">  <span class="co">#perform simulation</span></a>
<a class="sourceLine" id="cb684-21" data-line-number="21">  needed &lt;-<span class="st"> </span><span class="kw">numeric</span>(reps)</a>
<a class="sourceLine" id="cb684-22" data-line-number="22">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>reps ) {</a>
<a class="sourceLine" id="cb684-23" data-line-number="23">    needed[i] &lt;-<span class="st"> </span><span class="kw">numberNeeded</span>(target)</a>
<a class="sourceLine" id="cb684-24" data-line-number="24">  }</a>
<a class="sourceLine" id="cb684-25" data-line-number="25">  </a>
<a class="sourceLine" id="cb684-26" data-line-number="26">  <span class="co"># report results (if desired)</span></a>
<a class="sourceLine" id="cb684-27" data-line-number="27">  <span class="cf">if</span> ( report ) {</a>
<a class="sourceLine" id="cb684-28" data-line-number="28">    <span class="kw">print</span>(<span class="kw">prop.table</span>(<span class="kw">table</span>(needed)))</a>
<a class="sourceLine" id="cb684-29" data-line-number="29">    <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb684-30" data-line-number="30">    <span class="kw">cat</span>(<span class="st">&quot;The expected number needed is about &quot;</span>,</a>
<a class="sourceLine" id="cb684-31" data-line-number="31">        <span class="kw">mean</span>(needed), <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb684-32" data-line-number="32">  }</a>
<a class="sourceLine" id="cb684-33" data-line-number="33">  <span class="co"># return estimate of the expected number needed:</span></a>
<a class="sourceLine" id="cb684-34" data-line-number="34">  <span class="kw">invisible</span>(<span class="kw">mean</span>(needed))</a>
<a class="sourceLine" id="cb684-35" data-line-number="35">}</a></code></pre></div>
<p>Let’s test the function with ten thousand repetitions:</p>
<div class="sourceCode" id="cb685"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb685-1" data-line-number="1"><span class="kw">numberNeededSim</span>(<span class="dt">target =</span> <span class="dv">1</span>, <span class="dt">reps =</span> <span class="dv">10000</span>, <span class="dt">seed =</span> <span class="dv">4848</span>, <span class="dt">report =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## needed
##      2      3      4      5      6      7      8 
## 0.4937 0.3350 0.1313 0.0317 0.0071 0.0010 0.0002 
## 
## The expected number needed is about 2.7273.</code></pre>
<p>Does the estimate of the expected number of numbers look a bit familiar? Mathematicians have proven that the exact expected value—what you would get for an average if you could do more and more repetitions, without limit—is the famous number <span class="math inline">\(e\)</span>:</p>
<p><span class="math display">\[\mathrm{e} \approx 2.71828 \ldots\]</span>
In the exercises you will be asked to investigate the expected value when the target is a number other than 1.</p>
</div>
<div id="example-dental-floss" class="section level2">
<h2><span class="header-section-number">4.7</span> Example: Dental Floss</h2>
<p>If you are like me, you don’t like to run out of an item that you commonly use, so you always try to have a spare source for the item on hand. Take dental floss, for example. It’s difficult to know when the little box is almost out of floss. Hence I try to keep <em>two</em> boxes on hand in my bathroom drawer: the one I’m using, and a spare. The problem is that I can never tell which one is “the one I’m using” and which one is the spare. In fact on any given day I’m equally likely to pull a length of floss out of either one of the boxes.<a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a></p>
<p>Let’s make the following assumptions:</p>
<ul>
<li>A box of floss starts out with 150 feet of floss.</li>
<li>I start with two fresh boxes.</li>
<li>Every time I floss, each box has a 50% chance of being the box I pull from.</li>
<li>When I pull out floss, the length I choose to pull is a random number between 1 and 2 feet. If the box has less than than the amount I choose to pull, then:
<ul>
<li>If the remaining length is more than 1 foot, I pull it all out and use it. (Next time I’ll have to use the other box.)</li>
<li>If the remaining length is less than 1 foot, I also pull it all out, but I don’t use it because it’s not long enough. (I’ll have to move on to the other box.)</li>
</ul></li>
</ul>
<p>There are several interesting questions we could ask concerning this situation. In this example, let’s focus on finding the expected value of <span class="math inline">\(X\)</span>, the amount of floss left in the <em>other</em> box when I discover the one of the boxes is exhausted.</p>
<p>I would also like to get some idea of the distribution of <span class="math inline">\(X\)</span>—the chance for it to assume each of its possible values. Unlike the previous “Number of Numbers” example, however, <span class="math inline">\(X\)</span> is what we call a <em>continuous</em> random variable: it can assume any of the values in a <em>range of real numbers</em>. After all, the amount left in the “other” box could be anything from 0 to 150 feet: it could be 3.5633 feet or 5.21887 feet, or any real number at all, so long as it’s between 0 and 150. Although any real number value—3.5633 feet, for instance—is <em>possible</em>, it seems that the chance of <span class="math inline">\(X\)</span> being <em>exactly</em> 3.5633 is vanishingly small, and the same goes for any of the possible real numbers value for <span class="math inline">\(X\)</span>. Hence it seems that the distribution of <span class="math inline">\(X\)</span> cannot be described well with a table of the values that we actually get in a simulation: indeed, we are highly unlikely to get any value more than once in the course of our simulation.</p>
<p>One way to visualize the distribution of a continuous random variable is to make a <em>density plot</em> of a large, representative sample of its values. Let’s practice making a density plot for a random variable that R provides for us: a so-called <em>normal</em> random variable. Try this code:</p>
<div class="sourceCode" id="cb687"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb687-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dt">mean =</span> <span class="dv">70</span>, <span class="dt">sd =</span> <span class="dv">3</span>)</a></code></pre></div>
<p>We have just asked R to produce 100 numbers chosen randomly from a <em>normal</em> distribution. The <code>mean</code> parameter sets what the values should be “on average”, and the <code>sd</code> parameter indicates how much they should typically differ from that average value. The bigger the <code>sd</code>, the bigger the difference between the mean and value actually obtained is liable to be.</p>
<p>Let’s get a look at the first ten values in the vector <code>x</code>:</p>
<div class="sourceCode" id="cb688"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb688-1" data-line-number="1">x[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</a></code></pre></div>
<pre><code>##  [1] 71.13092 70.90465 66.70593 66.60878 61.61040 72.16172 72.81736
##  [8] 69.31187 75.27739 70.35210</code></pre>
<p>Sure enough, the numbers are typically around the mean of 70, give or take 3 units or so.</p>
<p>We can use the <strong>ggplot2</strong> package to produce a density curve from all 100 values in the vector <code>x</code>. (The resulting plot appears as Figure @ref(fig:densitynormal).)</p>
<div class="sourceCode" id="cb690"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb690-1" data-line-number="1"><span class="kw">library</span>(ggplot2)</a></code></pre></div>
<div class="sourceCode" id="cb691"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb691-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> x)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_rug</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb691-2" data-line-number="2"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;x-value&quot;</span>)</a>
<a class="sourceLine" id="cb691-3" data-line-number="3">p</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/densitynormal-1.png" alt="Density plot of 100 random values from a normal distribution with mean 70 and standard deviation 3." width="60%" />
<p class="caption">
(#fig:densitynormal)Density plot of 100 random values from a normal distribution with mean 70 and standard deviation 3.
</p>
</div>
<p>The <code>geom_density()</code> part of the plotting-command produces the curve. The <code>geom_rug()</code> part produces tick-marks along the horizontal axis, each of which is located at a particular value in the vector <code>x</code>. You can see that the curve is higher where values are crowded together, and lower where the values are spread apart. The scale on the y-axis has been chosen carefully so that the area under the density curve between any two numbers <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> on the axis gives an estimate of the chance that the normal random variable would produce a value between <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>. In this way the density curve gives us a visual sense of the distribution of the random variable: it seems rather likely to be between 67 and 73 (most of the area under the curve occurs there) and rather unlikely to be greater than 76, and so on.</p>
<p>We are now ready to simulate the dental-floss scenario. Since we have worked through the encapsulation-and-generalization development process a number of times by now, we will simply show a final-form implementation of a simulation function:</p>
<div class="sourceCode" id="cb692"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb692-1" data-line-number="1">flossSim &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">len =</span> <span class="dv">150</span>, <span class="dt">min =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb692-2" data-line-number="2">                     <span class="dt">max =</span> <span class="dv">2</span>, <span class="dt">reps =</span> <span class="dv">10000</span>, </a>
<a class="sourceLine" id="cb692-3" data-line-number="3">                     <span class="dt">graph =</span> <span class="ot">FALSE</span>, <span class="dt">seed =</span> <span class="ot">NULL</span>) {</a>
<a class="sourceLine" id="cb692-4" data-line-number="4">  <span class="cf">if</span> ( <span class="op">!</span><span class="kw">is.null</span>(seed) ) {</a>
<a class="sourceLine" id="cb692-5" data-line-number="5">    <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb692-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb692-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb692-8" data-line-number="8">  <span class="co"># helper function to pick whihc box gets used:</span></a>
<a class="sourceLine" id="cb692-9" data-line-number="9">  whichOne &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb692-10" data-line-number="10">    <span class="cf">if</span> (x <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5</span> ) {</a>
<a class="sourceLine" id="cb692-11" data-line-number="11">      <span class="kw">return</span>(<span class="st">&quot;a&quot;</span>)</a>
<a class="sourceLine" id="cb692-12" data-line-number="12">    } <span class="cf">else</span> <span class="kw">return</span>(<span class="st">&quot;b&quot;</span>)</a>
<a class="sourceLine" id="cb692-13" data-line-number="13">  }</a>
<a class="sourceLine" id="cb692-14" data-line-number="14">  </a>
<a class="sourceLine" id="cb692-15" data-line-number="15">  <span class="co"># vector to contains our results:</span></a>
<a class="sourceLine" id="cb692-16" data-line-number="16">  leftover &lt;-<span class="st"> </span><span class="kw">numeric</span>(reps)</a>
<a class="sourceLine" id="cb692-17" data-line-number="17">  </a>
<a class="sourceLine" id="cb692-18" data-line-number="18">  <span class="co"># now the simulation.  Each time we loop through, we</span></a>
<a class="sourceLine" id="cb692-19" data-line-number="19">  <span class="co"># start with two fresh boxes and use them until one of</span></a>
<a class="sourceLine" id="cb692-20" data-line-number="20">  <span class="co"># them runs out.</span></a>
<a class="sourceLine" id="cb692-21" data-line-number="21">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>reps ) {</a>
<a class="sourceLine" id="cb692-22" data-line-number="22">    <span class="co"># set the initial lengh of the two fresh boxes:</span></a>
<a class="sourceLine" id="cb692-23" data-line-number="23">    a &lt;-<span class="st"> </span>b &lt;-<span class="st"> </span>len</a>
<a class="sourceLine" id="cb692-24" data-line-number="24">    </a>
<a class="sourceLine" id="cb692-25" data-line-number="25">    <span class="co"># at the beignning, both can be used:</span></a>
<a class="sourceLine" id="cb692-26" data-line-number="26">    bothOK &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb692-27" data-line-number="27">    </a>
<a class="sourceLine" id="cb692-28" data-line-number="28">    <span class="co"># start flossing</span></a>
<a class="sourceLine" id="cb692-29" data-line-number="29">    <span class="cf">while</span> ( bothOK ) {</a>
<a class="sourceLine" id="cb692-30" data-line-number="30">      <span class="co"># determine which box is picked</span></a>
<a class="sourceLine" id="cb692-31" data-line-number="31">      <span class="co"># &lt; 0.5 is a; &gt;= 0.5 is b;</span></a>
<a class="sourceLine" id="cb692-32" data-line-number="32">      boxPicked &lt;-<span class="st"> </span><span class="kw">whichOne</span>(<span class="kw">runif</span>(<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb692-33" data-line-number="33">      </a>
<a class="sourceLine" id="cb692-34" data-line-number="34">      <span class="co"># if we choose box a, attempt to use floss from it</span></a>
<a class="sourceLine" id="cb692-35" data-line-number="35">      <span class="cf">if</span> ( boxPicked <span class="op">==</span><span class="st"> &quot;a&quot;</span> ) {</a>
<a class="sourceLine" id="cb692-36" data-line-number="36">        <span class="cf">if</span> ( a <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span> ) {</a>
<a class="sourceLine" id="cb692-37" data-line-number="37">          leftover[i] &lt;-<span class="st"> </span>b</a>
<a class="sourceLine" id="cb692-38" data-line-number="38">          bothOK &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb692-39" data-line-number="39">        } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb692-40" data-line-number="40">          useAmount &lt;-<span class="st"> </span><span class="kw">min</span>(<span class="kw">runif</span>(<span class="dv">1</span>, min, max), a)</a>
<a class="sourceLine" id="cb692-41" data-line-number="41">          a &lt;-<span class="st"> </span>a <span class="op">-</span><span class="st"> </span>useAmount</a>
<a class="sourceLine" id="cb692-42" data-line-number="42">          <span class="cf">if</span> (<span class="kw">abs</span>(a) <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span><span class="op">^</span>(<span class="op">-</span><span class="dv">4</span>)) {</a>
<a class="sourceLine" id="cb692-43" data-line-number="43">            leftover[i] &lt;-<span class="st"> </span>b</a>
<a class="sourceLine" id="cb692-44" data-line-number="44">            bothOK &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb692-45" data-line-number="45">          }</a>
<a class="sourceLine" id="cb692-46" data-line-number="46">        }</a>
<a class="sourceLine" id="cb692-47" data-line-number="47">      }</a>
<a class="sourceLine" id="cb692-48" data-line-number="48">      </a>
<a class="sourceLine" id="cb692-49" data-line-number="49">      <span class="co"># use floss from b (if we choose it) </span></a>
<a class="sourceLine" id="cb692-50" data-line-number="50">      <span class="cf">if</span> ( boxPicked <span class="op">==</span><span class="st"> &quot;b&quot;</span> ) {</a>
<a class="sourceLine" id="cb692-51" data-line-number="51">        <span class="cf">if</span> ( b <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span> ) {</a>
<a class="sourceLine" id="cb692-52" data-line-number="52">          leftover[i] &lt;-<span class="st"> </span>a</a>
<a class="sourceLine" id="cb692-53" data-line-number="53">          bothOK &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb692-54" data-line-number="54">        } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb692-55" data-line-number="55">          useAmount &lt;-<span class="st"> </span><span class="kw">min</span>(<span class="kw">runif</span>(<span class="dv">1</span>, min, max), b)</a>
<a class="sourceLine" id="cb692-56" data-line-number="56">          b &lt;-<span class="st"> </span>b <span class="op">-</span><span class="st"> </span>useAmount</a>
<a class="sourceLine" id="cb692-57" data-line-number="57">          <span class="cf">if</span> (<span class="kw">abs</span>(b) <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span><span class="op">^</span>(<span class="op">-</span><span class="dv">4</span>)) {</a>
<a class="sourceLine" id="cb692-58" data-line-number="58">            leftover[i] &lt;-<span class="st"> </span>a</a>
<a class="sourceLine" id="cb692-59" data-line-number="59">            bothOK &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb692-60" data-line-number="60">          }</a>
<a class="sourceLine" id="cb692-61" data-line-number="61">        }</a>
<a class="sourceLine" id="cb692-62" data-line-number="62">      }</a>
<a class="sourceLine" id="cb692-63" data-line-number="63">        </a>
<a class="sourceLine" id="cb692-64" data-line-number="64">    }  <span class="co"># end while  loop</span></a>
<a class="sourceLine" id="cb692-65" data-line-number="65">  }    <span class="co"># end for loop</span></a>
<a class="sourceLine" id="cb692-66" data-line-number="66">  </a>
<a class="sourceLine" id="cb692-67" data-line-number="67">  <span class="co"># report results:</span></a>
<a class="sourceLine" id="cb692-68" data-line-number="68">  <span class="cf">if</span> ( graph ) {</a>
<a class="sourceLine" id="cb692-69" data-line-number="69">    plotTitle &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;Dental-Floss Simulation with &quot;</span>, reps, <span class="st">&quot; Repetitions&quot;</span>)</a>
<a class="sourceLine" id="cb692-70" data-line-number="70">    p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(leftover)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb692-71" data-line-number="71"><span class="st">      </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Amount left in spare (ft)&quot;</span>,</a>
<a class="sourceLine" id="cb692-72" data-line-number="72">          <span class="dt">title =</span> plotTitle)</a>
<a class="sourceLine" id="cb692-73" data-line-number="73">    <span class="co"># add a rug of individual points, provided there are not too many:</span></a>
<a class="sourceLine" id="cb692-74" data-line-number="74">    <span class="cf">if</span> ( reps <span class="op">&lt;=</span><span class="st"> </span><span class="dv">100</span> ) {</a>
<a class="sourceLine" id="cb692-75" data-line-number="75">      p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_rug</span>()</a>
<a class="sourceLine" id="cb692-76" data-line-number="76">    }</a>
<a class="sourceLine" id="cb692-77" data-line-number="77">  }</a>
<a class="sourceLine" id="cb692-78" data-line-number="78">  <span class="kw">print</span>(p)</a>
<a class="sourceLine" id="cb692-79" data-line-number="79">  <span class="kw">cat</span>(<span class="st">&quot;The average amount left in the spare is:  &quot;</span>, </a>
<a class="sourceLine" id="cb692-80" data-line-number="80">      <span class="kw">mean</span>(leftover), <span class="st">&quot;.&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb692-81" data-line-number="81">}      <span class="co"># end flossSim</span></a></code></pre></div>
<p>Let’s give it a try with one thousand repetitions.</p>
<div class="sourceCode" id="cb693"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb693-1" data-line-number="1"><span class="kw">flossSim</span>(<span class="dt">reps =</span> <span class="dv">1000</span>, <span class="dt">graph =</span> <span class="ot">TRUE</span>, <span class="dt">seed =</span> <span class="dv">3535</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/dentalflosssim-1.png" alt="Density plot of the results of a dental-floss simulation." width="60%" />
<p class="caption">
(#fig:dentalflosssim)Density plot of the results of a dental-floss simulation.
</p>
</div>
<pre><code>## The average amount left in the spare is:  16.55715.</code></pre>
<p>A density plot of the results appears as Figure @ref(fig:dentalflosssim). The expected value of the amount left in the remaining box is about 16.3 feet, but you can see from the plot that there is quite a bit of variability: it’s not all that unlikely to have 40 or more feet left!</p>
</div>
<div id="drunken-turtle-sim" class="section level2">
<h2><span class="header-section-number">4.8</span> Example: The Drunken Turtle</h2>
<p>Let us return to the scenario of the Drunken Turtle that was introduced in Section @ref(drunken-turtle-intro). At each step the turtle would turn by a random angle—any angle between 0 and 360 degrees with equal likelihood—and then move forward by a fixed number of units. We wondered whether the turtle would simply wander away from its starting point or perhaps eventually loop back close to its starting point.</p>
<p>In this section we will construct a simulation that sheds light on our question. We will imagine that the turtle starts at the origin on the <span class="math inline">\(xy\)</span>-plane and takes a large but fixed number of steps—one thousand steps, say—each of a fixed length of one unit, but each of which is preceded by a drunken turn through a random angle. We will concern ourselves with the random variable <span class="math inline">\(X\)</span>, defined as follows:</p>
<blockquote>
<p><span class="math inline">\(X\)</span> = the number of times in the turtle returns to within <span class="math inline">\(1/2\)</span> of a unit of the origin, during its first 1000 steps.</p>
</blockquote>
<p>(Apparently we consider a “close return” to be anything within half a unit of the origin.)</p>
<p>In particular, we would like to know the distribution of <span class="math inline">\(X\)</span>: what is the chance that the turtle does not make a close return during the first thousand steps? What’s the chance of making only one close return? Two close returns? And so on … . We would also like to estimate the expected value of <span class="math inline">\(X\)</span>: the average number of close returns in the first 1000 steps.</p>
<p>We will next consider how to code a simulation. Obviously we will need a way to record the turtle’s position at each step. In order to accomplish this we will have to apply the unit-circle trigonometry you learned in high school.</p>
<p>Instead of measuring angles in degrees, we will work in radians: by default R does trigonometry that way. Recall that 360 degrees is <span class="math inline">\(2 \pi\)</span> radians; hence the way to determine the angle of a turn by the drunken turtle is with the following call to <code>runif()</code>:</p>
<div class="sourceCode" id="cb695"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb695-1" data-line-number="1"><span class="kw">runif</span>(<span class="dv">1</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">2</span><span class="op">*</span>pi)</a></code></pre></div>
<pre><code>## [1] 4.146176</code></pre>
<p>If we want a thousand drunken turn-angles, then we can get them all in a vector, as follows:</p>
<div class="sourceCode" id="cb697"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb697-1" data-line-number="1"><span class="kw">runif</span>(<span class="dv">1000</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">2</span><span class="op">*</span>pi)</a></code></pre></div>
<p>So much for the turning angles. But in order to decide at each step whether the turtle has made a close return, we have to know the coordinates of the turtle after each step. This is where unit-circle trigonometry comes in handy. Recall that if a right triangle has a hypotenuse of length 1 (the length of a turtle step) and if one of the angles of the triangle is <span class="math inline">\(\alpha\)</span>, then the side adjacent to <span class="math inline">\(\alpha\)</span> is <span class="math inline">\(\cos(\alpha)\)</span> and the side opposite is <span class="math inline">\(\sin(\alpha)\)</span>. The situation is illustrated in Figure @ref(fig:right-triangle).</p>
<div class="figure" style="text-align: center">
<img src="images/righttriangle.png" alt="Sides of a right triangle with hypotenuse 1, in terms of the angle shown." width="75%" />
<p class="caption">
(#fig:right-triangle)Sides of a right triangle with hypotenuse 1, in terms of the angle shown.
</p>
</div>
<p>From this principle it follows that if the turtle turns a random angle of <span class="math inline">\(a_1\)</span> radians for its first step, then after it takes the one-unit step it will be at the point <span class="math inline">\((\cos(a_1), \sin(a_2))\)</span>.</p>
<p>For the second step, the turtle begins by turning another random angle, say <span class="math inline">\(a_2\)</span> radians. It then takes another one-unit step. This second step forms the hypotenuse of a second right triangle (see Figure @ref(fig:two-steps)). The horizontal and vertical sides of this right triangle must be <span class="math inline">\(\cos(a_2)\)</span> and <span class="math inline">\(\sin(a_2)\)</span> respectively. When the turtle complete the second step, it has added these values to its previous <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> coordinates, so that it is now at the point:</p>
<p><span class="math display">\[(\cos(a_1) + \cos(a_2), \sin(a_1) +\sin(a_2)).\]</span>
We now see the idea: in order to record the position of the turtle at the end of each step, we simply need to:</p>
<ul>
<li>take the cosine of all the turning-angles;</li>
<li>take the sine of all the turning-angles;</li>
<li>sum the cosines to get the <span class="math inline">\(x\)</span>-coordinate;</li>
<li>sum the sines to get the <span class="math inline">\(y\)</span>-coordinate.</li>
</ul>
<div class="figure" style="text-align: center">
<img src="images/twosteps.png" alt="The first two steps by the Drunken Turtle.  Turtle turns by $a_1$ radians for Step One, then by $a_2$ radians for Step Two." width="75%" />
<p class="caption">
(#fig:two-steps)The first two steps by the Drunken Turtle. Turtle turns by <span class="math inline">\(a_1\)</span> radians for Step One, then by <span class="math inline">\(a_2\)</span> radians for Step Two.
</p>
</div>
<p>Let’s put this idea into practice, for just the first ten steps. First, get the turning angles, the sines and the cosines:</p>
<div class="sourceCode" id="cb698"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb698-1" data-line-number="1">angle &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">10</span>, <span class="dv">0</span> , <span class="dv">2</span><span class="op">*</span>pi)</a>
<a class="sourceLine" id="cb698-2" data-line-number="2">xSteps &lt;-<span class="st"> </span><span class="kw">cos</span>(angle)</a>
<a class="sourceLine" id="cb698-3" data-line-number="3">ySteps &lt;-<span class="st"> </span><span class="kw">sin</span>(angle)</a></code></pre></div>
<p>Next, we need to add the <code>xSteps</code> together. If we do a sum, we would get the <span class="math inline">\(x\)</span>-coordinate after the tenth step:</p>
<div class="sourceCode" id="cb699"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb699-1" data-line-number="1"><span class="kw">sum</span>(xSteps)</a></code></pre></div>
<pre><code>## [1] -1.370258</code></pre>
<p>(Apparently some of the cosines were negative, meaning that some of the turning angles were between 90 and 270 degrees.)</p>
<p>We need the <span class="math inline">\(x\)</span>-coordinates after all of the previous steps, as well. This can be accomplished by R’s <code>cumsum()</code> function.  You may think of <code>cumsum</code> as short for “cumulative sum”. Given a vector <code>vec</code> of numbers, <code>cumsum(vec)</code> returns a vector of the same length, where for every index <code>i</code>, <code>cumsum(vec)[i]</code> is <code>sum(vec[1:i])</code>. This is made clear in the following example:</p>
<div class="sourceCode" id="cb701"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb701-1" data-line-number="1">vec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">-1</span>, <span class="dv">4</span>, <span class="dv">-2</span>)</a>
<a class="sourceLine" id="cb701-2" data-line-number="2"><span class="kw">cumsum</span>(vec)</a></code></pre></div>
<pre><code>## [1] 3 5 4 8 6</code></pre>
<p>Look at the table below.</p>
<table>
<thead>
<tr class="header">
<th align="left"><code>vec</code></th>
<th align="left">cumulative sum</th>
<th><code>cumsum(vec)</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">3</td>
<td align="left">3</td>
<td>3</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left"><span class="math inline">\(3+2\)</span></td>
<td>5</td>
</tr>
<tr class="odd">
<td align="left">-1</td>
<td align="left"><span class="math inline">\(3+2+-1\)</span></td>
<td>4</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left"><span class="math inline">\(3+2+-1+4\)</span></td>
<td>8</td>
</tr>
<tr class="odd">
<td align="left">-2</td>
<td align="left"><span class="math inline">\(3+2+-1+4+-2\)</span></td>
<td>6</td>
</tr>
</tbody>
</table>
<p>See how it works?</p>
<p>Returning to <code>xSteps</code>, we see that we can get the <span class="math inline">\(x\)</span>-coordinates of the first ten steps like this:</p>
<div class="sourceCode" id="cb703"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb703-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">cumsum</span>(xSteps)</a>
<a class="sourceLine" id="cb703-2" data-line-number="2">x</a></code></pre></div>
<pre><code>##  [1] -0.6034165 -1.3905805 -2.1259607 -3.1154380 -2.4593130 -1.5476110
##  [7] -0.8591924 -1.6420445 -0.6421761 -1.3702583</code></pre>
<p>Similarly we can get the first ten <span class="math inline">\(y\)</span>-coordinates:</p>
<div class="sourceCode" id="cb705"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb705-1" data-line-number="1">y &lt;-<span class="st"> </span><span class="kw">cumsum</span>(ySteps)</a></code></pre></div>
<p>Using the distance formula, we can compute the distance of each point from the origin as follows:</p>
<div class="sourceCode" id="cb706"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb706-1" data-line-number="1">dist &lt;-<span class="st"> </span><span class="kw">sqrt</span>(x<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>y<span class="op">^</span><span class="dv">2</span>)</a></code></pre></div>
<p>The following logical vector will then record, at each each step, whether or not the turtle has made a close return:</p>
<div class="sourceCode" id="cb707"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb707-1" data-line-number="1">closeReturn &lt;-<span class="st"> </span>(dist <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5</span>)</a></code></pre></div>
<p>The results are shown in Table @ref(tab:tensteptab).</p>
<table>
<caption>(#tab:tensteptab)Record of the turtle’s first ten steps. It has not yet made a close return.</caption>
<thead>
<tr class="header">
<th align="right">angle</th>
<th align="right">xSteps</th>
<th align="right">ySteps</th>
<th align="right">x</th>
<th align="right">y</th>
<th align="right">dist</th>
<th align="left">closeReturn</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">4.0646104</td>
<td align="right">-0.6034165</td>
<td align="right">-0.7974262</td>
<td align="right">-0.6034165</td>
<td align="right">-0.7974262</td>
<td align="right">1.000000</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="right">2.4769935</td>
<td align="right">-0.7871641</td>
<td align="right">0.6167437</td>
<td align="right">-1.3905805</td>
<td align="right">-0.1806826</td>
<td align="right">1.402270</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="right">3.8861615</td>
<td align="right">-0.7353801</td>
<td align="right">-0.6776548</td>
<td align="right">-2.1259607</td>
<td align="right">-0.8583374</td>
<td align="right">2.292695</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="right">2.9963954</td>
<td align="right">-0.9894774</td>
<td align="right">0.1446876</td>
<td align="right">-3.1154380</td>
<td align="right">-0.7136497</td>
<td align="right">3.196131</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="right">0.8551238</td>
<td align="right">0.6561251</td>
<td align="right">0.7546522</td>
<td align="right">-2.4593130</td>
<td align="right">0.0410024</td>
<td align="right">2.459655</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="right">0.4233886</td>
<td align="right">0.9117020</td>
<td align="right">0.4108522</td>
<td align="right">-1.5476110</td>
<td align="right">0.4518546</td>
<td align="right">1.612226</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="right">0.8114898</td>
<td align="right">0.6884186</td>
<td align="right">0.7253136</td>
<td align="right">-0.8591924</td>
<td align="right">1.1771682</td>
<td align="right">1.457373</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="right">2.4700328</td>
<td align="right">-0.7828521</td>
<td align="right">0.6222079</td>
<td align="right">-1.6420445</td>
<td align="right">1.7993761</td>
<td align="right">2.435993</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="right">0.0162276</td>
<td align="right">0.9998683</td>
<td align="right">0.0162269</td>
<td align="right">-0.6421761</td>
<td align="right">1.8156030</td>
<td align="right">1.925826</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="right">3.8968689</td>
<td align="right">-0.7280822</td>
<td align="right">-0.6854899</td>
<td align="right">-1.3702583</td>
<td align="right">1.1301131</td>
<td align="right">1.776165</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
<p>It remains only to package our code into a simulation function. We will allow the user to specify the fixed initial number of steps (it does not have to be 1000), and also to determine what distance counts as a “close return.”</p>
<div class="sourceCode" id="cb708"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb708-1" data-line-number="1">drunkenSim &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">steps =</span> <span class="dv">1000</span>, <span class="dt">reps =</span> <span class="dv">10000</span>, <span class="dt">close =</span> <span class="fl">0.5</span>, </a>
<a class="sourceLine" id="cb708-2" data-line-number="2">                       <span class="dt">seed =</span> <span class="ot">NULL</span>, <span class="dt">table =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb708-3" data-line-number="3">  <span class="cf">if</span> ( <span class="op">!</span><span class="kw">is.null</span>(seed) ) {</a>
<a class="sourceLine" id="cb708-4" data-line-number="4">    <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb708-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb708-6" data-line-number="6">  </a>
<a class="sourceLine" id="cb708-7" data-line-number="7">  <span class="co"># set up returns vector to store the number of </span></a>
<a class="sourceLine" id="cb708-8" data-line-number="8">  <span class="co"># close returns in each repetition:</span></a>
<a class="sourceLine" id="cb708-9" data-line-number="9">  returns &lt;-<span class="st"> </span><span class="kw">numeric</span>(reps)</a>
<a class="sourceLine" id="cb708-10" data-line-number="10">  </a>
<a class="sourceLine" id="cb708-11" data-line-number="11">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>reps) {</a>
<a class="sourceLine" id="cb708-12" data-line-number="12">  angle &lt;-<span class="st"> </span><span class="kw">runif</span>(steps, <span class="dv">0</span> , <span class="dv">2</span><span class="op">*</span>pi)</a>
<a class="sourceLine" id="cb708-13" data-line-number="13">  xSteps &lt;-<span class="st"> </span><span class="kw">cos</span>(angle)</a>
<a class="sourceLine" id="cb708-14" data-line-number="14">  ySteps &lt;-<span class="st"> </span><span class="kw">sin</span>(angle)</a>
<a class="sourceLine" id="cb708-15" data-line-number="15">  </a>
<a class="sourceLine" id="cb708-16" data-line-number="16">  x &lt;-<span class="st"> </span><span class="kw">cumsum</span>(xSteps)</a>
<a class="sourceLine" id="cb708-17" data-line-number="17">  y &lt;-<span class="st"> </span><span class="kw">cumsum</span>(ySteps)</a>
<a class="sourceLine" id="cb708-18" data-line-number="18">  </a>
<a class="sourceLine" id="cb708-19" data-line-number="19">  dist &lt;-<span class="st"> </span><span class="kw">sqrt</span>(x<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>y<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb708-20" data-line-number="20">  closeReturn &lt;-<span class="st"> </span>(dist <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb708-21" data-line-number="21">  returns[i] &lt;-<span class="st"> </span><span class="kw">sum</span>(closeReturn)</a>
<a class="sourceLine" id="cb708-22" data-line-number="22">  }</a>
<a class="sourceLine" id="cb708-23" data-line-number="23">  </a>
<a class="sourceLine" id="cb708-24" data-line-number="24">  <span class="cf">if</span> ( table ) {</a>
<a class="sourceLine" id="cb708-25" data-line-number="25">    <span class="kw">cat</span>(<span class="st">&quot;Here is a table of the number of close returns:</span><span class="ch">\n\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb708-26" data-line-number="26">    tab &lt;-<span class="st"> </span><span class="kw">prop.table</span>(<span class="kw">table</span>(returns))</a>
<a class="sourceLine" id="cb708-27" data-line-number="27">    <span class="kw">print</span>(tab)</a>
<a class="sourceLine" id="cb708-28" data-line-number="28">    <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb708-29" data-line-number="29">  }</a>
<a class="sourceLine" id="cb708-30" data-line-number="30">  <span class="kw">cat</span>(<span class="st">&quot;The average number of close returns was:  &quot;</span>, </a>
<a class="sourceLine" id="cb708-31" data-line-number="31">      <span class="kw">mean</span>(returns), <span class="st">&quot;.&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb708-32" data-line-number="32">}</a></code></pre></div>
<p>Let’s try it out:</p>
<div class="sourceCode" id="cb709"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb709-1" data-line-number="1"><span class="kw">drunkenSim</span>(<span class="dt">steps =</span> <span class="dv">1000</span>, <span class="dt">reps =</span> <span class="dv">10000</span>, </a>
<a class="sourceLine" id="cb709-2" data-line-number="2">           <span class="dt">close =</span> <span class="fl">0.5</span>, <span class="dt">seed =</span> <span class="dv">3535</span>, <span class="dt">table =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## Here is a table of the number of close returns:
## 
## returns
##      0      1      2      3      4      5      6      7      8      9 
## 0.3881 0.2290 0.1517 0.0908 0.0572 0.0335 0.0227 0.0107 0.0064 0.0048 
##     10     11     12     13     14     15     16     17 
## 0.0018 0.0012 0.0008 0.0007 0.0003 0.0001 0.0001 0.0001 
## 
## The average number of close returns was:  1.5655.</code></pre>
<p>Notice that 38.81% of the time the turtle did not make a close return at all during the first thousand steps. On the other hand it is possible, though not at all likely, for the turtle to make quite a few close returns.<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a></p>
<p>It is interesting to look specifically at the distances from the origin. The following function draws a graph of the distance from the origin for the specified number of turtle steps:</p>
<div class="sourceCode" id="cb711"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb711-1" data-line-number="1">drunkenSim2 &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">steps =</span> <span class="dv">1000</span>, <span class="dt">seed =</span> <span class="ot">NULL</span>) {</a>
<a class="sourceLine" id="cb711-2" data-line-number="2">  <span class="cf">if</span> ( <span class="op">!</span><span class="kw">is.null</span>(seed) ) {</a>
<a class="sourceLine" id="cb711-3" data-line-number="3">    <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb711-4" data-line-number="4">  }</a>
<a class="sourceLine" id="cb711-5" data-line-number="5">  </a>
<a class="sourceLine" id="cb711-6" data-line-number="6">  angle &lt;-<span class="st"> </span><span class="kw">runif</span>(steps, <span class="dv">0</span> , <span class="dv">2</span><span class="op">*</span>pi)</a>
<a class="sourceLine" id="cb711-7" data-line-number="7">  xSteps &lt;-<span class="st"> </span><span class="kw">cos</span>(angle)</a>
<a class="sourceLine" id="cb711-8" data-line-number="8">  ySteps &lt;-<span class="st"> </span><span class="kw">sin</span>(angle)</a>
<a class="sourceLine" id="cb711-9" data-line-number="9">  x &lt;-<span class="st"> </span><span class="kw">cumsum</span>(xSteps)</a>
<a class="sourceLine" id="cb711-10" data-line-number="10">  y &lt;-<span class="st"> </span><span class="kw">cumsum</span>(ySteps)</a>
<a class="sourceLine" id="cb711-11" data-line-number="11">  dist &lt;-<span class="st"> </span><span class="kw">sqrt</span>(x<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>y<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb711-12" data-line-number="12">  plotTitle &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;First &quot;</span>, steps, <span class="st">&quot; Steps of the Drunken Turtle&quot;</span>)</a>
<a class="sourceLine" id="cb711-13" data-line-number="13">  p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span>steps, <span class="dt">y=</span>dist)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb711-14" data-line-number="14"><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Step&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Distance From Origin&quot;</span>,</a>
<a class="sourceLine" id="cb711-15" data-line-number="15">         <span class="dt">title =</span> plotTitle)</a>
<a class="sourceLine" id="cb711-16" data-line-number="16">  <span class="kw">print</span>(p)</a>
<a class="sourceLine" id="cb711-17" data-line-number="17">}</a></code></pre></div>
<p>Let’s try it out! The results appear in Figure @ref(fig:drunken-turtle-steps)</p>
<div class="sourceCode" id="cb712"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb712-1" data-line-number="1"><span class="kw">drunkenSim2</span>(<span class="dt">steps =</span> <span class="dv">1000</span>, <span class="dt">seed =</span> <span class="dv">2525</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/drunken-turtle-steps-1.png" alt="Line plot of the Turtle's distance from the origin, as a function of how many steps the turtle has taken." width="60%" />
<p class="caption">
(#fig:drunken-turtle-steps)Line plot of the Turtle’s distance from the origin, as a function of how many steps the turtle has taken.
</p>
</div>
<p>It appears that although the turtle might have returned close to the origin a couple of times, for the most part it seems to be wandering further and further away. In the mathematical field known as <em>stochastic processes</em>, it has been shown that if the turtle is allowed to go on forever then it will certainly make a close return <em>infinitely many times</em>. These returns, though, will tend to be spaced further and further apart as time goes on, and our graph suggests that this is so.</p>

</div>
<div id="glossary-2" class="section level2 unnumbered">
<h2>Glossary</h2>
<dl>
<dt>Probability of an Event </dt>
<dd><p>The long-run proportion of times that the event will occur if the underlying random process is repeated many, many times.</p>
</dd>
<dt>Random Variable </dt>
<dd><p>A number whose value depends on the outcome of a chance process.</p>
</dd>
<dt>Expected Value of a Random Variable </dt>
<dd><p>The long-run average of the values of a random variable, where the underlying chance process is repeated many, many times.</p>
</dd>
<dt>Continuous Random Variable </dt>
<dd><p>A random variable that can assume any value in a range of real numbers.</p>
</dd>
<dt>Distribution of a Random Variable </dt>
<dd><p>A statement of the probabilities for a random variable to assume its various possible values.</p>
</dd>
<dt>Encapsulation and Generalization </dt>
<dd><p>A method for developing a computer program according to which the programmer first designs a basic procedure, then encapsulates it in one or more functions, and then progressively generalizes these functions until the program possesses all desired features.</p>
</dd>
</dl>

</div>
<div id="exercises-2" class="section level2 unnumbered">
<h2>Exercises</h2>
<p><img src="images/thinking.png" width="50%" style="display: block; margin: auto;" /></p>
<ol style="list-style-type: decimal">
<li>Consider the following two games.
<ul>
<li>In Game A you flip a fair coin. If the coin comes up Heads you get two dollars, whereas if it comes up Tails you get one dollar.</li>
<li>In Game B you roll a fair die. If the six-spot comes up, you win twenty-five dollars. If you get 2, 3, 4, or 5, nothing happens. If the one-spot comes up, you lose fifteen dollars.</li>
</ul>
In this exercise you need to answer two questions:
<ol style="list-style-type: decimal">
<li>If you could choose to play either Game A or Game B <em>just once</em>, which game would you prefer to play, and why?</li>
<li>Suppose that you can choose either to play Game A ten thousand times, or Game B ten thousand times. Which choice would you prefer, and why?</li>
</ol>
Answers to the first question will vary from person to person, depending on circumstances and personal taste. On the other hand, astute consideration of expected values leads most people to answer the second question in the same way. Therefore, before you answer the question please write two simulation functions: one called <code>GameA</code> that provides an estimate of the expected value of the winnings from a play of Game A, and another called <code>GameB</code> that estimates the expected value of the winnings from a play of Game B. The functions should have two parameters:
<ul>
<li>a <code>reps</code> parameter to permit the user to choose the number of repetitions of the game;</li>
<li>a <code>seed</code> parameter to permit the user to choose a starting seed.</li>
</ul>
<p>Use both functions with fifty thousand reps, in order to obtain estimates for the expected amount of winnings in a single play of each game. Use a simple starting seed for each function. Report the seeds you used, along with the estimated expected values for each game. Use your results to decide which game is the better choice to play ten thousand times.</p>
<p><strong>Note</strong>: Please keep in mind that the fifty-thousand figure is just the number of times you repeat your simulations in order to estimate the expected value of a <em>single play</em> of one of the games. It’s <strong>not</strong> how many times you actually get to play either game—that’s ten thousand.</p></li>
<li>Reconsider the meeting of Anna and Raj. Suppose that they still plan to meet during the same one-hour period, but that Anna is willing to wait <span class="math inline">\(a\)</span> minutes and Raj is willing to wait <span class="math inline">\(r\)</span> minutes, where <span class="math inline">\(a\)</span> and <span class="math inline">\(r\)</span> could differ. Modify the <code>meetupSim()</code> function so that it accepts two additional parameters:
<ul>
<li><code>a</code>: the time Anna is willing to wait;</li>
<li><code>r</code>: the time Raj is willing to wait;</li>
</ul>
<p>Apply the function with ten thousand repetitions (and a simple seed that you report) in order to estimate the probability of a meeting, assuming that Anna is willing to wait 13 minutes and Raj is willing to wait 7 minutes.</p>
<p><strong>Hint</strong>: Suppose that Anna arrvies at time <span class="math inline">\(Anna\)</span> and Raj arrives at times <span class="math inline">\(raj\)</span>. We want a simple mathematical expression that gives the conditions for Anna and Raj to connect. In the example in the text, this was:</p>
<p><span class="math display">\[\vert\ anna - raj \ \vert &lt; 10\]</span></p>
<p>because both Anna and Raj were willing to wait the same amount of time: ten minutes. Now we have to think a bit more carefully when Anna waits <span class="math inline">\(a\)</span> minutes and Raj waits <span class="math inline">\(r\)</span> minutes, where <span class="math inline">\(a\)</span> and <span class="math inline">\(r\)</span> may differ. You might start by observing that we must have</p>
<p><span class="math display">\[anna - r \le raj,\]</span></p>
<p>for if not then Raj would arrive and leave before Anna gets there. Also, we would have to have</p>
<p><span class="math display">\[raj \le anna + a,\]</span></p>
<p>for if not then Anna would arrive and leave before Raj gets there. But if we have <em>both</em> of those conditions:</p>
<p><span class="math display">\[anna - r \le raj \text{ and } raj \le anna + a\]</span></p>
<p>then they must connect, since neither person will arrive too much before the other.</p></li>
<li><p>Review the function <code>dual()</code> in the Practice Exercises of this Chapter (see Section @ref(basic-simulations)). Modify the function as follows:</p>
<ul>
<li>Add a parameter <code>abe</code> that gives the probability for Abe to hit when he shoots, and a parameter <code>bo</code> that gives the chance for Bo to hit when he shoots. the probabilities should be expressed as numbers between 0 and 1. (Thus, a 30% chance of hitting is 0.30.)</li>
<li>Make the function estimate the expected value number of shots taken in a dual, rahter than the chance for Abe to win.</li>
</ul>
<p>When you have your function working, use it to estimate the expected number of shots when:</p>
<ul>
<li>Abe’s chance of hitting is 50 percent and Bo’s chance if 50%;</li>
<li>Abe’s chance of hitting is 20% and Bo’s chance of hitting is 25%.</li>
</ul>
<p>In each simulation, use one hundred thousand repetitions and a seed that you choose.</p></li>
<li><p>A candy-maker makes a particular type of candy that always has 20 candies in each bag. When you buy a bag of this candy, you take a few candies from it every day until they are all gone. The amount you take each day is a random whole number from 1 to 10. A possible scenario is:</p>
<ul>
<li>Day 1: take 4 candies. (There are 16 left.)</li>
<li>Day 2: take 8 candies. (There are 8 left.)</li>
<li>Day 3: take 3 candies. (There are 5 left.)</li>
<li>Day 4: take 6 candies. (There were only 5 left, so you take all the remaining candies.)</li>
</ul>
<p>In the scenario above, it took you four days to finish the bag.</p>
<p>Write a function called <code>daysNeededSim()</code> that will estimate the expected number of days required to empty a bag. It should take two parameters:</p>
<ul>
<li><code>reps</code>: the number of times to simulate the process of emptying one bag. The default value should be 10,000.</li>
<li><code>seed</code>: a random seed that the user can set. The default value should be <code>NULL</code>.</li>
</ul>
<p>Apply the function with 50,000 repetitions and a seed that you report, in order to estimate the expected number fo days required to empty the bag.</p>
<p><strong>Hint:</strong> This scenario is quite similar to the <code>numberNeededSim()</code> problem from this Chapter. Begin by reviewing it.</p></li>
<li><p>(*) Refer back to the <code>numberNeededSim()</code> function. Write a program that computes the estimated expected number needed, for the following targets:</p>
<div class="sourceCode" id="cb713"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb713-1" data-line-number="1">targets &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>, <span class="dt">by =</span> <span class="fl">0.05</span>)</a></code></pre></div>
<p>Each estimate should be based on ten thousand repetitions. Start with a simple seed that you report. Report the estimated expected values for all of the required targets. Compare these estimates with <code>exp(targets)</code> (the number <span class="math inline">\(e\)</span> raised to the power of each of the targets.) Formulate a conjecture about the value of the expected number of numbers needed, when the target is a real number between 0 and 1.</p>
<p><strong>Hint</strong>: Recall that <code>numberNeededSim()</code> function returns its estimate of the expected number needed. Hence you could use it inside a <code>for</code>-loop that iterates through the elements of the <code>targets</code> vector above, something like this:</p>
<div class="sourceCode" id="cb714"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb714-1" data-line-number="1">targets &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>, <span class="dt">by =</span> <span class="fl">0.05</span>)</a>
<a class="sourceLine" id="cb714-2" data-line-number="2">n &lt;-<span class="st"> </span><span class="kw">length</span>(targets)</a>
<a class="sourceLine" id="cb714-3" data-line-number="3">results &lt;-<span class="st"> </span><span class="kw">numeric</span>(n)</a>
<a class="sourceLine" id="cb714-4" data-line-number="4"><span class="kw">set.seed</span>(<span class="dv">3030</span>) <span class="co"># or some other simple seed that you like</span></a>
<a class="sourceLine" id="cb714-5" data-line-number="5"><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n ) {</a>
<a class="sourceLine" id="cb714-6" data-line-number="6">  <span class="co"># use numberNeededSim() with:</span></a>
<a class="sourceLine" id="cb714-7" data-line-number="7">  <span class="co">#    * 10000 reps</span></a>
<a class="sourceLine" id="cb714-8" data-line-number="8">  <span class="co">#    * seed left at the default NULL (you provided one already)</span></a>
<a class="sourceLine" id="cb714-9" data-line-number="9">  <span class="co">#    * target set to targets[i]</span></a>
<a class="sourceLine" id="cb714-10" data-line-number="10">  <span class="co">#    * report left at FALSE (no need to have R talk to you at each step)</span></a>
<a class="sourceLine" id="cb714-11" data-line-number="11">  <span class="co"># make sure to store the estimate in results[i]</span></a>
<a class="sourceLine" id="cb714-12" data-line-number="12">}</a>
<a class="sourceLine" id="cb714-13" data-line-number="13"><span class="co"># after the loop, you can compare results with exp(targets)</span></a></code></pre></div></li>
<li><p>(*) A pipe-smoker has two boxes of matches in his pocket. Both boxes contain 40 matches. Every time he lights his pipe, the smoker reaches into his pocket and randomly picks one of the boxes, pulling a match from the box. Eventually one of the boxes runs out. What is the expected value of the number of matches remaining in the other box at that time? Write a simulation function to estimate the answer. Your function should have at least a <code>reps</code> and a <code>seed</code> parameter. Apply the function with ten thousand repetitions—and with a simple seed that you report—in order to estimate the expected value.</p></li>
<li>(*) A gambler starts with 10 dollars, and repeatedly plays a game. If she wins the game she gets one dollar and if she loses the game she loses one dollar. Her chance of winning each game is a fixed number that is less than 0.50. Write a function to simulate the gambler repeatedly playing the game until her money runs out. The function should keep track of how much money she has left after each play, so that it can produce a line graph (similar to the one in the section on the Drunken Turtle) of the money left after each play. Write the function so that it has
<ul>
<li>a <code>start</code> parameter for the initial amount of money the gambler has;</li>
<li>a <code>seed</code> parameter`;</li>
<li>a <code>p</code> parameter for the chance of winning, so that the user can enter any chance less than or equal to 0.5. (The function should stop the user if the user enters more than 0.5.)</li>
</ul>
<p>Apply the function with a simple seed that you report, a starting amount of ten dollars, and a chance of winning equal to 0.45.</p></li>
<li><p>(*) An absent-minded professor walks to and from campus every day. Prior to every commute—either from home to office or the reverse—she checks the weather, taking an umbrella with her if it is raining. The problem is that she <em>never</em> takes an umbrella when the weather is dry, so even though she owns quite a few umbrellas the time comes eventually when it is raining but all of her umbrellas are at her destination, so that she will have to put up with a wet commute.</p>
<p>Suppose that there are <span class="math inline">\(x\)</span> umbrellas at her house and <span class="math inline">\(y\)</span> umbrellas at her office, and that she begins at home. Suppose further that the chance of rain on any commute is <span class="math inline">\(p\)</span>, a number between 0 and 1.</p>
Write a simulation function to estimate the expected number of dry commutes that she will enjoy before her first wet commute. The function should have five parameters:
<ul>
<li><code>x</code>: the initial number of umbrellas at home (default 1);</li>
<li><code>y</code>: the initial number of umbrellas at the office (default 1);</li>
<li><code>p</code>: the probability of rain at any commute (default 0.5);</li>
<li><code>seed</code>: an seed for the randomizers (default <code>NULL</code>).</li>
<li><code>reps</code>: the number of times to simulate commuting until wet.</li>
</ul>
<p>Apply the function with <code>x</code> and <code>y</code> set at three, for the values 0.1, 0.5 and 0.9 for <code>p</code>. Use 10,000 repetitions for each simulation, with seeds that you report. Which value of <code>p</code> results in the smallest expected number of dry commutes?</p></li>
</ol>
<!--chapter:end:060-simulation.Rmd-->
</div>
</div>
<div id="frames" class="section level1">
<h1><span class="header-section-number">5</span> Data Frames</h1>

<div class="leadquote">
<p><em>Can one be a good data analyst without being a half-good programmer? The short answer to that is, ‘No.’ The long answer to that is, ‘No.’</em></p>
—Frank Harrell
</div>

<p>Up to this point we have given a great deal of attention to vectors, and we have always treated them as one-dimensional objects: a vector has a length, but not a “width.”</p>
<p>It is time to begin working in two dimensions. In this Chapter we will study <em>matrices</em>, which are simply vectors that have both length and width. Matrices are immensely useful for scientific computation in R, but for the most part we will treat them as a warm-up for <em>data frames</em>—the two-dimensional R-objects that are especially designed for the storage of data collected in the course of practical data analysis. Once you understand how to construct and manipulate data frames, you will be ready to learn how to visualize and analyze data using R.</p>

<div id="introduction-to-matrices" class="section level2">
<h2><span class="header-section-number">5.1</span> Introduction to Matrices</h2>
<p>In R, a <em>matrix</em>  is actually an atomic vector—it can only hold one type of element—but with two extra attributes:</p>
<ul>
<li>a certain number of rows, and</li>
<li>a certain number of columns.</li>
</ul>
<p>One way to create is matrix is to take a vector and <em>give</em> it those two extra attributes, via the <code>matrix()</code> function.  Here is an example:</p>
<div class="sourceCode" id="cb715"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb715-1" data-line-number="1">numbers &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">24</span>  <span class="co"># this is an ordinary atomic vector</span></a>
<a class="sourceLine" id="cb715-2" data-line-number="2">numbersMat &lt;-<span class="st"> </span><span class="kw">matrix</span>(numbers, <span class="dt">nrow =</span> <span class="dv">6</span>, <span class="dt">ncol =</span> <span class="dv">4</span>)  <span class="co"># make a matrix</span></a>
<a class="sourceLine" id="cb715-3" data-line-number="3">numbersMat</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    7   13   19
## [2,]    2    8   14   20
## [3,]    3    9   15   21
## [4,]    4   10   16   22
## [5,]    5   11   17   23
## [6,]    6   12   18   24</code></pre>
<p>Of course if you are making a matrix out of 24 numbers and you know that it’s going to have 6 rows, then you know it must have 4 columns. Similarly, if you know the number of columns then the number of rows is determined. Hence you could have constructed the matrix with just one of the row or column arguments, like this:</p>
<div class="sourceCode" id="cb717"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb717-1" data-line-number="1">numbersMat &lt;-<span class="st"> </span><span class="kw">matrix</span>(numbers, <span class="dt">nrow =</span> <span class="dv">6</span>)</a></code></pre></div>
<p>Notice that the numbers went down the first column, then down the second, and so on. If you would rather fill up the matrix row-by-row, then set the <code>byrow</code> parameter, which is <code>FALSE</code> by default, to <code>TRUE</code>:</p>
<div class="sourceCode" id="cb718"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb718-1" data-line-number="1"><span class="kw">matrix</span>(numbers, <span class="dt">nrow =</span> <span class="dv">6</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    2    3    4
## [2,]    5    6    7    8
## [3,]    9   10   11   12
## [4,]   13   14   15   16
## [5,]   17   18   19   20
## [6,]   21   22   23   24</code></pre>
<p>Sometimes we like to give names to our rows, or to our columns, or even to both:</p>
<div class="sourceCode" id="cb720"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb720-1" data-line-number="1"><span class="kw">rownames</span>(numbersMat) &lt;-<span class="st"> </span>letters[<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>]</a>
<a class="sourceLine" id="cb720-2" data-line-number="2"><span class="kw">colnames</span>(numbersMat) &lt;-<span class="st"> </span>LETTERS[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]</a>
<a class="sourceLine" id="cb720-3" data-line-number="3">numbersMat</a></code></pre></div>
<pre><code>##   A  B  C  D
## a 1  7 13 19
## b 2  8 14 20
## c 3  9 15 21
## d 4 10 16 22
## e 5 11 17 23
## f 6 12 18 24</code></pre>
<p>Matrices don’t have to be numerical. They can be character or logical matrices as well:</p>
<div class="sourceCode" id="cb722"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb722-1" data-line-number="1">creatures &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Dorothy&quot;</span>, <span class="st">&quot;Lion&quot;</span>, <span class="st">&quot;Scarecrow&quot;</span>, <span class="st">&quot;Oz&quot;</span>,</a>
<a class="sourceLine" id="cb722-2" data-line-number="2">               <span class="st">&quot;Toto&quot;</span>, <span class="st">&quot;Boq&quot;</span>)</a>
<a class="sourceLine" id="cb722-3" data-line-number="3"><span class="kw">matrix</span>(creatures, <span class="dt">ncol =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##      [,1]        [,2]  
## [1,] &quot;Dorothy&quot;   &quot;Oz&quot;  
## [2,] &quot;Lion&quot;      &quot;Toto&quot;
## [3,] &quot;Scarecrow&quot; &quot;Boq&quot;</code></pre>
<p>If you have to spread out the elements of a matrix into a one-dimensional vector, you can do so:</p>
<div class="sourceCode" id="cb724"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb724-1" data-line-number="1"><span class="kw">as.vector</span>(numbersMat)</a></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23
## [24] 24</code></pre>
<div id="practice-exercises-9" class="section level3">
<h3><span class="header-section-number">5.1.1</span> Practice Exercises</h3>
<p>Let’s work with the following vector:</p>
<div class="sourceCode" id="cb726"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb726-1" data-line-number="1">dozen &lt;-<span class="st"> </span>letters[<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>]</a></code></pre></div>
<ol style="list-style-type: decimal">
<li><p>Starting with <code>dozen</code> write a command that produces the following matrix:</p>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,] &quot;a&quot;  &quot;d&quot;  &quot;g&quot;  &quot;j&quot; 
## [2,] &quot;b&quot;  &quot;e&quot;  &quot;h&quot;  &quot;k&quot; 
## [3,] &quot;c&quot;  &quot;f&quot;  &quot;i&quot;  &quot;l&quot;</code></pre></li>
<li><p>Starting with <code>dozen</code> write a command that produces the following matrix:</p>
<pre><code>##      [,1] [,2] [,3]
## [1,] &quot;a&quot;  &quot;e&quot;  &quot;i&quot; 
## [2,] &quot;b&quot;  &quot;f&quot;  &quot;j&quot; 
## [3,] &quot;c&quot;  &quot;g&quot;  &quot;k&quot; 
## [4,] &quot;d&quot;  &quot;h&quot;  &quot;l&quot;</code></pre></li>
<li><p>Starting with <code>dozen</code> write a command that produces the following matrix:</p>
<pre><code>##      [,1] [,2] [,3]
## [1,] &quot;a&quot;  &quot;b&quot;  &quot;c&quot; 
## [2,] &quot;d&quot;  &quot;e&quot;  &quot;f&quot; 
## [3,] &quot;g&quot;  &quot;h&quot;  &quot;i&quot; 
## [4,] &quot;j&quot;  &quot;k&quot;  &quot;l&quot;</code></pre></li>
<li><p>Starting with <code>dozen</code>, write commands that produce the following matrix:</p>
<pre><code>##    c1  c2  c3 
## r1 &quot;a&quot; &quot;b&quot; &quot;c&quot;
## r2 &quot;d&quot; &quot;e&quot; &quot;f&quot;
## r3 &quot;g&quot; &quot;h&quot; &quot;i&quot;
## r4 &quot;j&quot; &quot;k&quot; &quot;l&quot;</code></pre></li>
<li><p>Suppose you make the following matrix:</p>
<div class="sourceCode" id="cb731"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb731-1" data-line-number="1">smallMat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">4</span>), <span class="dt">nrow =</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb731-2" data-line-number="2">smallMat</a></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    8    3
## [2,]    5    4</code></pre>
<p>What’s a one-line command to get the folowing vector from <code>smallMat</code>?</p>
<pre><code>## [1] 8 5 3 4</code></pre></li>
<li><p><code>nrow()</code> is a function that, when given a matrix, will tell you the number of rows in that matrix. Write a one-line command to find the number of rows in a matrix called <code>mysteryMat</code>.</p></li>
<li><p><code>ncol()</code> is a function that, when given a matrix, will tell you the number of rows in that matrix. Write a one-line command to find the number of columns in a matrix called <code>mysteryMat</code>.</p></li>
</ol>
</div>
<div id="solutions-to-practice-exercises-6" class="section level3">
<h3><span class="header-section-number">5.1.2</span> Solutions to Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Here’s one way to do it:</p>
<div class="sourceCode" id="cb734"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb734-1" data-line-number="1"><span class="kw">matrix</span>(dozen, <span class="dt">nrow =</span> <span class="dv">3</span>)</a></code></pre></div>
<p>Here’s another way:</p>
<div class="sourceCode" id="cb735"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb735-1" data-line-number="1"><span class="kw">matrix</span>(dozen, <span class="dt">ncol =</span> <span class="dv">4</span>)</a></code></pre></div></li>
<li><p>Here’s one way to do it:</p>
<div class="sourceCode" id="cb736"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb736-1" data-line-number="1"><span class="kw">matrix</span>(dozen, <span class="dt">nrow =</span> <span class="dv">4</span>)</a></code></pre></div></li>
<li><p>Here’s one way to do it:</p>
<div class="sourceCode" id="cb737"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb737-1" data-line-number="1"><span class="kw">matrix</span>(dozen, <span class="dt">nrow =</span> <span class="dv">4</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a></code></pre></div></li>
<li><p>Here’s one way to do it:</p>
<div class="sourceCode" id="cb738"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb738-1" data-line-number="1">answerMatrix &lt;-<span class="st"> </span><span class="kw">matrix</span>(dozen, <span class="dt">nrow =</span> <span class="dv">4</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb738-2" data-line-number="2"><span class="kw">rownames</span>(answerMatrix) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;r1&quot;</span>, <span class="st">&quot;r2&quot;</span>, <span class="st">&quot;r3&quot;</span>, <span class="st">&quot;r4&quot;</span>)</a>
<a class="sourceLine" id="cb738-3" data-line-number="3"><span class="kw">colnames</span>(answerMatrix) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;c1&quot;</span>, <span class="st">&quot;c2&quot;</span>, <span class="st">&quot;c3&quot;</span>)</a>
<a class="sourceLine" id="cb738-4" data-line-number="4">answerMatrix</a></code></pre></div></li>
<li><p>Here’s how:</p>
<div class="sourceCode" id="cb739"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb739-1" data-line-number="1"><span class="kw">as.vector</span>(smallMat)</a></code></pre></div></li>
<li><p>The command <code>nrow(mysteryMat)</code> will work.</p></li>
<li><p>The command <code>ncol(mysteryMat)</code> will work.</p></li>
</ol>
</div>
</div>
<div id="matrix-indexing" class="section level2">
<h2><span class="header-section-number">5.2</span> Matrix Indexing</h2>
<p>Matrices are incredibly useful in data analysis, but the primary reason we are talking about them now is to get you used to working in two dimensions. Let’s practice sub-setting with matrices.</p>
<p>We use the sub-setting operator <code>[</code> to pick out parts of a matrix. For example, in order to get the element in the second row and third column of <code>numbersMat</code>, ask for:</p>
<div class="sourceCode" id="cb740"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb740-1" data-line-number="1">numbersMat[<span class="dv">2</span>,<span class="dv">3</span>]</a></code></pre></div>
<pre><code>## [1] 14</code></pre>
<p>The row and column numbers are called <em>indices</em>.</p>
<p>If we want the entire second row, then we could ask for:</p>
<div class="sourceCode" id="cb742"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb742-1" data-line-number="1">numbersMat[<span class="dv">2</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]</a></code></pre></div>
<pre><code>##  A  B  C  D 
##  2  8 14 20</code></pre>
<p>The result is a one-dimensional vector consisting of the elements in the second row of <code>numbersMat</code>. It inherits as its names the column names of <code>numbersMat</code>.</p>
<p>Actually, if you want the entire row you don’t have to specify which columns you want. Just leave the spot after the comma empty, like this:</p>
<div class="sourceCode" id="cb744"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb744-1" data-line-number="1">numbersMat[<span class="dv">2</span>, ]</a></code></pre></div>
<pre><code>##  A  B  C  D 
##  2  8 14 20</code></pre>
<p>What if you want some items on the second row, but only the items in columns 1, 2 and 4? Then frame your request in terms of a vector of column-indices:</p>
<div class="sourceCode" id="cb746"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb746-1" data-line-number="1">numbersMat[<span class="dv">2</span>, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>)]</a></code></pre></div>
<pre><code>##  A  B  D 
##  2  8 20</code></pre>
<p>You can specify a vector of row-indices along with a vector of column-indices, if you like:</p>
<div class="sourceCode" id="cb748"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb748-1" data-line-number="1">numbersMat[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</a></code></pre></div>
<pre><code>##   A B  C
## a 1 7 13
## b 2 8 14</code></pre>
<p>If the vector has row or column names then you may use them in place of indices to make a selection:</p>
<div class="sourceCode" id="cb750"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb750-1" data-line-number="1">numbersMat[, <span class="kw">c</span>(<span class="st">&quot;B&quot;</span>, <span class="st">&quot;D&quot;</span>)]</a></code></pre></div>
<pre><code>##    B  D
## a  7 19
## b  8 20
## c  9 21
## d 10 22
## e 11 23
## f 12 24</code></pre>
<p>You can use sub-setting to change the values of the elements of a matrix</p>
<div class="sourceCode" id="cb752"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb752-1" data-line-number="1">numbersMat[<span class="dv">2</span>,<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb752-2" data-line-number="2">numbersMat</a></code></pre></div>
<pre><code>##   A  B  C  D
## a 1  7 13 19
## b 2  8  0 20
## c 3  9 15 21
## d 4 10 16 22
## e 5 11 17 23
## f 6 12 18 24</code></pre>
<p>You can assign a value to an entire row:</p>
<div class="sourceCode" id="cb754"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb754-1" data-line-number="1">numbersMat[<span class="dv">2</span>,] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb754-2" data-line-number="2">numbersMat</a></code></pre></div>
<pre><code>##   A  B  C  D
## a 1  7 13 19
## b 0  0  0  0
## c 3  9 15 21
## d 4 10 16 22
## e 5 11 17 23
## f 6 12 18 24</code></pre>
<p>In the code above, the 0 was “recycled”  into each of the four elements of the second row</p>
<p>You can assign the elements of a vector to corresponding selected elements of a matrix:</p>
<div class="sourceCode" id="cb756"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb756-1" data-line-number="1">numbersMat[<span class="dv">2</span>,] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>, <span class="dv">400</span>)</a>
<a class="sourceLine" id="cb756-2" data-line-number="2">numbersMat</a></code></pre></div>
<pre><code>##     A   B   C   D
## a   1   7  13  19
## b 100 200 300 400
## c   3   9  15  21
## d   4  10  16  22
## e   5  11  17  23
## f   6  12  18  24</code></pre>
<div id="to-drop-or-not" class="section level3">
<h3><span class="header-section-number">5.2.1</span> To Drop or Not?</h3>
<p>Note that when we ask for a single row of <code>numbersMat</code> we got a regular one-dimensional vector:</p>
<div class="sourceCode" id="cb758"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb758-1" data-line-number="1">numbersMat[<span class="dv">3</span>, ]</a></code></pre></div>
<pre><code>##  A  B  C  D 
##  3  9 15 21</code></pre>
<p>The same things happens if we ask for a single column:</p>
<div class="sourceCode" id="cb760"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb760-1" data-line-number="1">numbersMat[ , <span class="dv">2</span>]</a></code></pre></div>
<pre><code>##   a   b   c   d   e   f 
##   7 200   9  10  11  12</code></pre>
<p>We get the second column of <code>numbersMat</code>, but as a regular vector. It’s not a “column” anymore. (Note that it inherits the row names from <code>numbersMat</code>.)</p>
<p>When a subset of a matrix comes from only one row or column, R takes the opportunity to “drop” the class of the subset from “matrix” to “vector.” If you would like the subset to stay a vector, set the <code>drop</code> parameter, which by default is <code>TRUE</code>, to <code>FALSE</code>. Thus the second column of <code>numbersMat</code>, kept as a matrix with six rows and one column, is found as follows:</p>
<div class="sourceCode" id="cb762"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb762-1" data-line-number="1">numbersMat[ , <span class="dv">2</span>, drop =<span class="st"> </span><span class="ot">FALSE</span>]</a></code></pre></div>
<pre><code>##     B
## a   7
## b 200
## c   9
## d  10
## e  11
## f  12</code></pre>
<p>In most applications people want the simpler vector structure, so they usually leave <code>drop</code> at its default value.</p>
</div>
<div id="practice-exercises-10" class="section level3">
<h3><span class="header-section-number">5.2.2</span> Practice Exercises</h3>
<p>In these exercises we’ll work with the following matrix:</p>
<div class="sourceCode" id="cb764"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb764-1" data-line-number="1">numbers &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">40</span></a>
<a class="sourceLine" id="cb764-2" data-line-number="2">practiceMatrix &lt;-<span class="st"> </span><span class="kw">matrix</span>(numbers, <span class="dt">nrow =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb764-3" data-line-number="3"><span class="kw">rownames</span>(practiceMatrix) &lt;-<span class="st"> </span>letters[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]</a>
<a class="sourceLine" id="cb764-4" data-line-number="4"><span class="kw">colnames</span>(practiceMatrix) &lt;-<span class="st"> </span>LETTERS[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</a>
<a class="sourceLine" id="cb764-5" data-line-number="5">practiceMatrix</a></code></pre></div>
<pre><code>##   A B  C  D  E  F  G  H  I  J
## a 1 5  9 13 17 21 25 29 33 37
## b 2 6 10 14 18 22 26 30 34 38
## c 3 7 11 15 19 23 27 31 35 39
## d 4 8 12 16 20 24 28 32 36 40</code></pre>
<ol style="list-style-type: decimal">
<li><p>Write two different one-line commands to get this matrix:</p>
<pre><code>##   B  C  D  E
## a 5  9 13 17
## c 7 11 15 19</code></pre></li>
<li><p>Write a one-line command to get this matrix:</p>
<pre><code>##   A  C  E  G  I
## a 1  9 17 25 33
## b 2 10 18 26 34
## c 3 11 19 27 35
## d 4 12 20 28 36</code></pre></li>
<li><p>Write a one-line command to get this vector:</p>
<pre><code>## a b c d 
## 1 2 3 4</code></pre></li>
<li><p>Write a one-line command to get this vector:</p>
<pre><code>##  A  B  C  D  E  F  G  H  I  J 
##  2  6 10 14 18 22 26 30 34 38</code></pre></li>
<li><p>Write a one-line command to get this matrix:</p>
<pre><code>##   A
## a 1
## b 2
## c 3
## d 4</code></pre></li>
<li><p>Write a convenient one-line command to get this matrix:</p>
<pre><code>##   A B  C  D  E  F  G  H  I
## a 1 5  9 13 17 21 25 29 33
## b 2 6 10 14 18 22 26 30 34
## c 3 7 11 15 19 23 27 31 35
## d 4 8 12 16 20 24 28 32 36</code></pre></li>
<li><p>Write a convenient one-line command to get this matrix:</p>
<pre><code>##   A  C  D  E  F  G  H  I
## a 1  9 13 17 21 25 29 33
## b 2 10 14 18 22 26 30 34
## c 3 11 15 19 23 27 31 35
## d 4 12 16 20 24 28 32 36</code></pre></li>
<li><p>Write a function called <code>myRowSums()</code> that will find the sums of the rows of any given matrix. The function should use a <code>for</code>-loop (see the Chapter on Flow Control). The function should take a single parameter called <code>mat</code>, the matrix whose rows the user wishes to sum. It should work like this:</p>
<div class="sourceCode" id="cb773"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb773-1" data-line-number="1">myMatrix &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">24</span>, <span class="dt">ncol =</span> <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb773-2" data-line-number="2"><span class="kw">myRowSums</span>(<span class="dt">mat =</span> myMatrix)</a></code></pre></div>
<pre><code>## [1] 66 72 78 84</code></pre></li>
</ol>
</div>
<div id="solutions-to-practice-exercises-7" class="section level3">
<h3><span class="header-section-number">5.2.3</span> Solutions to Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Here are two ways:</p>
<div class="sourceCode" id="cb775"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb775-1" data-line-number="1">practiceMatrix[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>), <span class="dv">2</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb775-2" data-line-number="2">practiceMatrix[<span class="kw">c</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;c&quot;</span>), <span class="dv">2</span><span class="op">:</span><span class="dv">5</span>]</a></code></pre></div></li>
<li><p>Here’s one way:</p>
<div class="sourceCode" id="cb776"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb776-1" data-line-number="1">practiceMatrix[ , <span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">9</span>, <span class="dt">by =</span> <span class="dv">2</span>)]</a></code></pre></div></li>
<li><p>Here’s one way:</p>
<div class="sourceCode" id="cb777"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb777-1" data-line-number="1">practiceMatrix[ , <span class="dv">1</span>]</a></code></pre></div></li>
<li><p>Here’s one way:</p>
<div class="sourceCode" id="cb778"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb778-1" data-line-number="1">practiceMatrix[<span class="dv">2</span>, ]</a></code></pre></div></li>
<li><p>Here’s one way:</p>
<div class="sourceCode" id="cb779"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb779-1" data-line-number="1">practiceMatrix[ , <span class="dv">1</span>, drop =<span class="st"> </span><span class="ot">FALSE</span>]</a></code></pre></div></li>
<li><p>Here’s one way:</p>
<div class="sourceCode" id="cb780"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb780-1" data-line-number="1">practiceMatrix[ , <span class="dv">-10</span>]</a></code></pre></div></li>
<li><p>Here’s one way:</p>
<div class="sourceCode" id="cb781"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb781-1" data-line-number="1">practiceMatrix[ , <span class="op">-</span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">10</span>)]</a></code></pre></div></li>
<li><p>Here is one way to write the function:</p>
<div class="sourceCode" id="cb782"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb782-1" data-line-number="1">myRowSums &lt;-<span class="st"> </span><span class="cf">function</span>(mat) {</a>
<a class="sourceLine" id="cb782-2" data-line-number="2">  n &lt;-<span class="st"> </span><span class="kw">nrow</span>(mat)</a>
<a class="sourceLine" id="cb782-3" data-line-number="3">  sums &lt;-<span class="st"> </span><span class="kw">numeric</span>(n)</a>
<a class="sourceLine" id="cb782-4" data-line-number="4">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) {</a>
<a class="sourceLine" id="cb782-5" data-line-number="5">    sums[i] &lt;-<span class="st"> </span><span class="kw">sum</span>(mat[i, ])</a>
<a class="sourceLine" id="cb782-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb782-7" data-line-number="7">  sums</a>
<a class="sourceLine" id="cb782-8" data-line-number="8">}</a></code></pre></div></li>
</ol>
</div>
</div>
<div id="operations-on-matrices" class="section level2">
<h2><span class="header-section-number">5.3</span> Operations on Matrices</h2>
<p>Matrices can be involved in arithmetical and logical operations.</p>
<div id="arithmetical-operations" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Arithmetical Operations</h3>
<p>The usual arithmetic operations apply to matrices, operating element-wise. For example, suppose that we have:</p>
<div class="sourceCode" id="cb783"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb783-1" data-line-number="1">mat1 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">4</span>), <span class="dt">nrow =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb783-2" data-line-number="2">mat2 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(<span class="dv">2</span>, <span class="dv">4</span>), <span class="dt">nrow =</span> <span class="dv">2</span>)</a></code></pre></div>
<p>To get the sum of the above two matrices, R adds their corresponding elements and forms a new matrix out of their sums, thus:</p>
<div class="sourceCode" id="cb784"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb784-1" data-line-number="1">mat1 <span class="op">+</span><span class="st"> </span>mat2</a></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    3    3
## [2,]    3    3</code></pre>
<p>R applies recycling as needed. For example, suppose we have:</p>
<div class="sourceCode" id="cb786"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb786-1" data-line-number="1">mat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">nrow =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb786-2" data-line-number="2">mat</a></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    1    3
## [2,]    2    4</code></pre>
<p>In order to multiply each element of <code>mat</code> by 2, we need not create a 2-by-2 matrix of 2’s. We can simply multiply by 2, and R will take care of recycling the 2:</p>
<div class="sourceCode" id="cb788"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb788-1" data-line-number="1"><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>mat</a></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    2    6
## [2,]    4    8</code></pre>
<p>Or we could subtract 3 from each element of <code>mat</code>:</p>
<div class="sourceCode" id="cb790"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb790-1" data-line-number="1">mat <span class="op">-</span><span class="st"> </span><span class="dv">3</span></a></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]   -2    0
## [2,]   -1    1</code></pre>
</div>
<div id="matrix-multiplication" class="section level3">
<h3><span class="header-section-number">5.3.2</span> Matrix Multiplication</h3>
<p>This section is optional reading, but it may interest you if you know about matrix multiplication in linear algebra.</p>
<p>In order to accomplish matrix multiplication, we have to keep in mind that the regular multiplication operator <code>*</code> works element-wise on matrices, as we have already seen. For matrix multiplication R provides the special operator <code>%*%</code>. For example, consider the following matrices:</p>
<div class="sourceCode" id="cb792"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb792-1" data-line-number="1">a &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">ncol =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb792-2" data-line-number="2">a</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    3    5
## [2,]    2    4    6</code></pre>
<div class="sourceCode" id="cb794"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb794-1" data-line-number="1">b &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">-1</span>), <span class="dt">nrow =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb794-2" data-line-number="2">b</a></code></pre></div>
<pre><code>##      [,1]
## [1,]    2
## [2,]    1
## [3,]   -1</code></pre>
<p>Observe that the number of columns of <code>a</code> is equal to the number of rows of <code>b</code>. Hence it is possible to form the matrix product <code>a %*% b</code>:</p>
<div class="sourceCode" id="cb796"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb796-1" data-line-number="1">a <span class="op">%*%</span><span class="st"> </span>b</a></code></pre></div>
<pre><code>##      [,1]
## [1,]    0
## [2,]    2</code></pre>
<p>As expected, the result is a matrix having as many rows as the rows of <code>a</code>and as many columns as the columns of <code>b</code>.</p>
<p>It is also interesting to recall how matrix multiplication works when the second matrix has only one column. The product is obtained by multiplying each column of <code>a</code> by the element on the corresponding row of <code>b</code>, and adding the resulting matrices:</p>
<div class="sourceCode" id="cb798"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb798-1" data-line-number="1">b[<span class="dv">1</span>,<span class="dv">1</span>]<span class="op">*</span>a[ ,<span class="dv">1</span>, drop =<span class="st"> </span><span class="ot">FALSE</span>] <span class="op">+</span><span class="st"> </span>b[<span class="dv">2</span>,<span class="dv">1</span>, drop =<span class="st"> </span><span class="ot">FALSE</span>]<span class="op">*</span>a[ ,<span class="dv">2</span>] <span class="op">+</span><span class="st"> </span>b[<span class="dv">3</span>,<span class="dv">1</span>]<span class="op">*</span>a[ ,<span class="dv">3</span>, drop =<span class="st"> </span><span class="ot">FALSE</span>]</a></code></pre></div>
<pre><code>##      [,1]
## [1,]    0
## [2,]    2</code></pre>
</div>
<div id="logical-operations" class="section level3">
<h3><span class="header-section-number">5.3.3</span> Logical Operations</h3>
<p>Boolean operations apply to matrices element-wise, just as they do to ordinary vectors. The result is a matrix of logical values. For examples, consider the original matrix <code>numbersMat</code>:</p>
<div class="sourceCode" id="cb800"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb800-1" data-line-number="1">numbersMat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">24</span>, <span class="dt">nrow =</span> <span class="dv">6</span>)</a></code></pre></div>
<p>Suppose we wish to determine which elements of <code>numbersMat</code> are odd. Then we simply ask whether the remainder of an element after division by 2 is equal to 1:</p>
<div class="sourceCode" id="cb801"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb801-1" data-line-number="1">numbersMat <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span></a></code></pre></div>
<pre><code>##       [,1]  [,2]  [,3]  [,4]
## [1,]  TRUE  TRUE  TRUE  TRUE
## [2,] FALSE FALSE FALSE FALSE
## [3,]  TRUE  TRUE  TRUE  TRUE
## [4,] FALSE FALSE FALSE FALSE
## [5,]  TRUE  TRUE  TRUE  TRUE
## [6,] FALSE FALSE FALSE FALSE</code></pre>
<p>We can select elements from a matrix using a Boolean operator, too:</p>
<div class="sourceCode" id="cb803"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb803-1" data-line-number="1">numbersMat[numbersMat <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span>]</a></code></pre></div>
<pre><code>##  [1]  1  3  5  7  9 11 13 15 17 19 21 23</code></pre>
<p>Note that the result is an ordinary, one-dimensional vector.</p>
</div>
<div id="practice-exercises-11" class="section level3">
<h3><span class="header-section-number">5.3.4</span> Practice Exercises</h3>
<p>We’ll work with the following three matrices:</p>
<div class="sourceCode" id="cb805"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb805-1" data-line-number="1">a &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">9</span>, <span class="dv">10</span>), <span class="dt">nrow =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb805-2" data-line-number="2">a</a></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    7    9
## [2,]    4   10</code></pre>
<div class="sourceCode" id="cb807"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb807-1" data-line-number="1">b &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">nrow =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb807-2" data-line-number="2">b</a></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    1    3
## [2,]    2    4</code></pre>
<div class="sourceCode" id="cb809"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb809-1" data-line-number="1">c &lt;-<span class="st"> </span><span class="kw">matrix</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">24</span>], <span class="dt">nrow =</span> <span class="dv">6</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb809-2" data-line-number="2">c</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,] &quot;a&quot;  &quot;b&quot;  &quot;c&quot;  &quot;d&quot; 
## [2,] &quot;e&quot;  &quot;f&quot;  &quot;g&quot;  &quot;h&quot; 
## [3,] &quot;i&quot;  &quot;j&quot;  &quot;k&quot;  &quot;l&quot; 
## [4,] &quot;m&quot;  &quot;n&quot;  &quot;o&quot;  &quot;p&quot; 
## [5,] &quot;q&quot;  &quot;r&quot;  &quot;s&quot;  &quot;t&quot; 
## [6,] &quot;u&quot;  &quot;v&quot;  &quot;w&quot;  &quot;x&quot;</code></pre>
<ol style="list-style-type: decimal">
<li><p>Find a one-line command using <code>a</code> that results in:</p>
<pre><code>##      [,1] [,2]
## [1,]   10   12
## [2,]    7   13</code></pre></li>
<li><p>Find a one-line command using <code>a</code> that results in:</p>
<pre><code>##      [,1] [,2]
## [1,]   14   18
## [2,]    8   20</code></pre></li>
<li><p>Find a one-line command using <code>a</code> that results in:</p>
<pre><code>##      [,1] [,2]
## [1,]   49   81
## [2,]   16  100</code></pre></li>
<li><p>Find a one-line command using <code>a</code> and <code>b</code> that results in:</p>
<pre><code>##      [,1] [,2]
## [1,]    6    6
## [2,]    2    6</code></pre></li>
<li><p>Describe in words what the following command does:</p>
<div class="sourceCode" id="cb815"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb815-1" data-line-number="1">a <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span></a></code></pre></div></li>
<li><p>Write a one-line command using <code>a</code> that tells you which elements of <code>a</code> are one more than a multiple of 3.</p></li>
<li><p>Using <code>c</code>, write a one-line boolean expression that produces the following:</p>
<pre><code>##       [,1]  [,2]  [,3]  [,4]
## [1,] FALSE FALSE FALSE FALSE
## [2,] FALSE FALSE FALSE  TRUE
## [3,]  TRUE  TRUE  TRUE  TRUE
## [4,]  TRUE  TRUE  TRUE  TRUE
## [5,]  TRUE  TRUE  TRUE  TRUE
## [6,]  TRUE  TRUE  TRUE  TRUE</code></pre></li>
</ol>
</div>
<div id="solutions-to-practice-exercises-8" class="section level3">
<h3><span class="header-section-number">5.3.5</span> Solutions to Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Here’s one way:</p>
<div class="sourceCode" id="cb817"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb817-1" data-line-number="1">a <span class="op">+</span><span class="st"> </span><span class="dv">3</span></a></code></pre></div></li>
<li><p>Here’s one way:</p>
<div class="sourceCode" id="cb818"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb818-1" data-line-number="1"><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>a</a></code></pre></div></li>
<li><p>Here’s one way:</p>
<div class="sourceCode" id="cb819"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb819-1" data-line-number="1">a<span class="op">^</span><span class="dv">2</span></a></code></pre></div></li>
<li><p>Here’s one way:</p></li>
</ol>
<pre><code>```r
a - b
```</code></pre>
<ol style="list-style-type: decimal">
<li><p>It produces a logical matrix of the same dimensions as <code>a</code>. The new matrix will have <code>TRUE</code> in a cell when the corresponding cell of <code>a</code> is greater than 5. Otherwise, the cell will have <code>FALSE</code> in it.</p></li>
<li><p>Here’s one way:</p>
<div class="sourceCode" id="cb821"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb821-1" data-line-number="1">a <span class="op">%%</span><span class="st"> </span><span class="dv">3</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span></a></code></pre></div></li>
<li><p>Here’s one way:</p>
<div class="sourceCode" id="cb822"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb822-1" data-line-number="1">c <span class="op">&gt;=</span><span class="st"> &quot;h&quot;</span></a></code></pre></div></li>
</ol>
</div>
</div>
<div id="introduction-to-data-frames" class="section level2">
<h2><span class="header-section-number">5.4</span> Introduction to Data Frames</h2>
<p>R is known as a <em>domain-specific programming language</em>, meaning that although it can in principle perform any sort of computation that a human can perform (given enough pencil, paper and time), it was originally designed to perform tasks in a particular area of application. R’s area of application is data analysis and statistics, especially when performed <em>interactively</em>—i.e., in a setting where the analyst asks for a relatively small computation, examines the results, modifies his or her requests and asks again, and so on.<a href="#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a> Although R can be used effectively for a wide range of programming tasks, data analysis is where it really shines.</p>
<p>The data structures of R reflect its orientation to data analysis. We have met a data-oriented structure already—the table, which is one of many convenient ways to display the results of data analysis. For the purpose of organizing data in preparation for analysis, R provides the structure known as the <em>data frame</em>. A data frame facilitates the storage of related data in one location, in a form that makes the most sense to human users.</p>
<p>A data frame is like a matrix in that it is two-dimensional—it has rows and columns. Unlike a matrix, though, the elements of a data frame do not have to be all of the same data-type. Each column of a data frame is a vector—of the same length as all the others—but these vectors may be of different types: some numerical, some logical, etc.</p>
<div id="viewing-a-data-frame" class="section level3">
<h3><span class="header-section-number">5.4.1</span> Viewing a Data Frame</h3>
<p>Let’s take a close look at a data frame: the frame <code>m111survey</code>, which is available from the <strong>bcscr</strong> package <span class="citation">(White <a href="#ref-R-bcscr">2018</a>)</span>. First let’s attach the package itself:</p>
<div class="sourceCode" id="cb823"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb823-1" data-line-number="1"><span class="kw">library</span>(bcscr)</a></code></pre></div>
<p>In the R Studio IDE, we can get a look at the frame in a tab in the Editor pane if we use the <code>View()</code> function:</p>
<div class="sourceCode" id="cb824"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb824-1" data-line-number="1"><span class="kw">View</span>(m111survey)</a></code></pre></div>
<p>As with many objects provided by a package, we can get more information about it:</p>
<div class="sourceCode" id="cb825"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb825-1" data-line-number="1"><span class="kw">help</span>(<span class="st">&quot;m111survey&quot;</span>)</a></code></pre></div>
<p>From the Help we see that <code>m111survey</code> records the results of a survey conducted in a number of sections of an elementary statistics course at Georgetown College. From the View we see that the frame is arranged in rows and columns. Each row corresponds to what in data analysis is known as a <em>case</em> or an <em>individual</em>: here, each row goes with a student who participated in the survey. The columns correspond to <em>variables</em>: measurements made on each individual. For a student on a given row, the values in the columns are the values recorded for that student.</p>
<p>When you are not working in R Studio, there are still a couple of way so view the frame. You could print it all out to the console:</p>
<div class="sourceCode" id="cb826"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb826-1" data-line-number="1">m111survey</a></code></pre></div>
<p>You could also use the <code>head()</code> function  to view a specified number of initial rows:</p>
<div class="sourceCode" id="cb827"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb827-1" data-line-number="1"><span class="kw">head</span>(m111survey, <span class="dt">n =</span> <span class="dv">6</span>)  <span class="co"># see first six rows</span></a></code></pre></div>
</div>
<div id="the-stucture-of-a-data-frame" class="section level3">
<h3><span class="header-section-number">5.4.2</span> The Stucture of a Data Frame</h3>
<p>Further information about the frame may be obtained with the <code>str()</code> function: </p>
<div class="sourceCode" id="cb828"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb828-1" data-line-number="1"><span class="kw">str</span>(m111survey)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    71 obs. of  12 variables:
##  $ height         : num  76 74 64 62 72 70.8 70 79 59 67 ...
##  $ ideal_ht       : num  78 76 NA 65 72 NA 72 76 61 67 ...
##  $ sleep          : num  9.5 7 9 7 8 10 4 6 7 7 ...
##  $ fastest        : int  119 110 85 100 95 100 85 160 90 90 ...
##  $ weight_feel    : Factor w/ 3 levels &quot;1_underweight&quot;,..: 1 2 2 1 1 3 2 2 2 3 ...
##  $ love_first     : Factor w/ 2 levels &quot;no&quot;,&quot;yes&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ extra_life     : Factor w/ 2 levels &quot;no&quot;,&quot;yes&quot;: 2 2 1 1 2 1 2 2 2 1 ...
##  $ seat           : Factor w/ 3 levels &quot;1_front&quot;,&quot;2_middle&quot;,..: 1 2 2 1 3 1 1 3 3 2 ...
##  $ GPA            : num  3.56 2.5 3.8 3.5 3.2 3.1 3.68 2.7 2.8 NA ...
##  $ enough_Sleep   : Factor w/ 2 levels &quot;no&quot;,&quot;yes&quot;: 1 1 1 1 1 2 1 2 1 2 ...
##  $ sex            : Factor w/ 2 levels &quot;female&quot;,&quot;male&quot;: 2 2 1 1 2 2 2 2 1 1 ...
##  $ diff.ideal.act.: num  2 2 NA 3 0 NA 2 -3 2 0 ...</code></pre>
<p>The concept of <em>structure</em> extends far beyond the domain of computer programming.<a href="#fn14" class="footnote-ref" id="fnref14"><sup>14</sup></a> In general the structure of any object consists of:</p>
<ul>
<li>the kind of thing that the object is;</li>
<li>the parts of the object is made up of;</li>
<li>the relationships between these parts—the rules, if you will, for how the parts work together to make the object do what it does.</li>
</ul>
<p>In the case of <code>m111survey</code> the kind of thing this is its <em>class</em>: it’s a data frame.</p>
<div class="sourceCode" id="cb830"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb830-1" data-line-number="1"><span class="kw">class</span>(m111survey)</a></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<p>Next we see the account of the parts of the object and the way in which the parts relate to one another:</p>
<pre><code>## 71 obs. of  12 variables</code></pre>
<p>From this we know that there are 71 individuals in the study. The data consists of 12 “parts”—the variables—which are related in the sense that they all provide information about the same set of 71 people.</p>
<p>After that the output of <code>str()</code> launches into an account of the structure of each of the parts, for example:</p>
<pre><code>## $ height         : num  76 74 64 62 72 70.8 70 79 59 67 ...</code></pre>
<p>We are told the kind of thing that height is: it’s a numerical vector (a vector of type <code>double</code>, in fact). Next we are given the beginning of a statement of its parts: the heights of the individuals. So R is actually giving us the structure of the parts, as well as of the whole <code>m11survey</code>.</p>
<p>The variable <code>fastest</code> refers to the fastest speed—in miles per hour—that a person has ever driven a car. Note that it is a vector of type <code>integer</code>. Officially this is a numerical variable, too, but R is calling attention to the fact that the fastest-speed data is being stored as integers rather than as floating-point decimals.</p>
<p>The variables of a data frame are typically associated with the <em>names</em> of the frame:</p>
<div class="sourceCode" id="cb834"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb834-1" data-line-number="1"><span class="kw">names</span>(m111survey)</a></code></pre></div>
<pre><code>##  [1] &quot;height&quot;          &quot;ideal_ht&quot;        &quot;sleep&quot;          
##  [4] &quot;fastest&quot;         &quot;weight_feel&quot;     &quot;love_first&quot;     
##  [7] &quot;extra_life&quot;      &quot;seat&quot;            &quot;GPA&quot;            
## [10] &quot;enough_Sleep&quot;    &quot;sex&quot;             &quot;diff.ideal.act.&quot;</code></pre>
<p>By means of the names we can isolate a vector in any column, identified in our code in the format <code>frame$variable</code>. For example, to see the first ten elements of the <code>fastest</code> variable, we ask for:</p>
<div class="sourceCode" id="cb836"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb836-1" data-line-number="1">m111survey<span class="op">$</span>fastest[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</a></code></pre></div>
<pre><code>##  [1] 119 110  85 100  95 100  85 160  90  90</code></pre>
<p>In order to compute the mean fastest speed our subjects drove their cars, we can ask for:</p>
<div class="sourceCode" id="cb838"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb838-1" data-line-number="1"><span class="kw">mean</span>(m111survey<span class="op">$</span>fastest, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 105.9014</code></pre>
<p>If you want to see the speeds that are at least 150 miles per hour, you could ask for:</p>
<div class="sourceCode" id="cb840"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb840-1" data-line-number="1">m111survey<span class="op">$</span>fastest[m111survey<span class="op">$</span>fastest <span class="op">&gt;=</span><span class="st"> </span><span class="dv">150</span>]</a></code></pre></div>
<pre><code>## [1] 160 190</code></pre>
<p>If you worry that the form <code>frame$variable</code> will require an annoying amount of typing—as seems to be the case in the the example above—then you can use the <code>with()</code> function: </p>
<div class="sourceCode" id="cb842"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb842-1" data-line-number="1"><span class="kw">with</span>(m111survey, fastest[fastest <span class="op">&gt;=</span><span class="dv">150</span>])</a></code></pre></div>
<pre><code>## [1] 160 190</code></pre>
<p>It’s instructive to consider how <code>with()</code> works. If we were to includes the names of the parameters of <code>with()</code> explicitly, then the call would have looked like this:</p>
<div class="sourceCode" id="cb844"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb844-1" data-line-number="1"><span class="kw">with</span>(<span class="dt">data =</span> m111survey, <span class="dt">expr =</span> fastest[fastest <span class="op">&gt;=</span><span class="dv">150</span>])</a></code></pre></div>
<p>For the <code>data</code> parameter we can supply a data frame or any other R-object that can be used to construct an environment . In this case <code>m111survey</code> provides a miniature environment consisting of the names of its variables. For the <code>expr</code> parameter we supply an expression for R to evaluate. As R evaluates the expression, it encounters names (such as <code>fastest</code>). Now ordinarily R would first search whatever counts as the active environment—in this case it’s the Global Environment—for the names in the expression, but <code>with()</code> forces R to look first within the environment created by the <code>data</code> argument. In our example, R finds <code>fastest</code> inside <code>m111survey</code> and evaluates the expression on that basis. If it had not found <code>fastest</code> in <code>m111survey</code>, R would have moved on to the Global Environment and then the rest of the usual search path and (probably) would have found nothing, causing it to throw an “object not found” error message. In R, as in any other programming language, good programming depends very much on paying attention to how the language searches for the objects to which names refer.</p>
</div>
<div id="factor-variables" class="section level3">
<h3><span class="header-section-number">5.4.3</span> Factors</h3>
<p>Some of the variables in <code>m111survey</code> are called <em>factors</em>; an example is <code>seat</code>, which pertains to where one prefers to sit in a classroom:</p>
<div class="sourceCode" id="cb845"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb845-1" data-line-number="1"><span class="kw">str</span>(m111survey<span class="op">$</span>seat)</a></code></pre></div>
<pre><code>##  Factor w/ 3 levels &quot;1_front&quot;,&quot;2_middle&quot;,..: 1 2 2 1 3 1 1 3 3 2 ...</code></pre>
<p>Seating preference is an example of a <em>categorical</em> variable: one whose values are not meaningfully expressed in terms of numbers. When a categorical variable has a relatively small number of possible values, it can be convenient to store its values in a vector of class <code>factor</code>.</p>
<p>The <em>levels</em> of factor variable are its possible values. In the case of <code>seat</code>, these are: Front, Middle and Back. As a memory-saving measure, R stores the values in the factor as numbers, where 1 stands for the first level, 2 for the second level, and so on. But please bear in mind that we are dealing with a categorical variable, so the numbers don’t relate to the possible values in any natural way: they are just storage conventions.</p>
<p>It’s possible to create a factor from any type of vector, but most often this is done with a character vector. Suppose for instance, that eight people are asked for their favorite Wizard of Oz character and they answer:</p>
<div class="sourceCode" id="cb847"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb847-1" data-line-number="1">ozFavs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Glinda&quot;</span>, <span class="st">&quot;Toto&quot;</span>, <span class="st">&quot;Toto&quot;</span>, <span class="st">&quot;Dorothy&quot;</span>, <span class="st">&quot;Toto&quot;</span>,</a>
<a class="sourceLine" id="cb847-2" data-line-number="2">            <span class="st">&quot;Glinda&quot;</span>, <span class="st">&quot;Scarecrow&quot;</span>, <span class="st">&quot;Dorothy&quot;</span>)</a></code></pre></div>
<p>We can create a factor variable as follows:</p>
<div class="sourceCode" id="cb848"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb848-1" data-line-number="1">factorFavs &lt;-<span class="st"> </span><span class="kw">factor</span>(ozFavs)</a>
<a class="sourceLine" id="cb848-2" data-line-number="2">factorFavs</a></code></pre></div>
<pre><code>## [1] Glinda    Toto      Toto      Dorothy   Toto      Glinda    Scarecrow
## [8] Dorothy  
## Levels: Dorothy Glinda Scarecrow Toto</code></pre>
<p>Note that the levels are given in alphabetical order: this is the default procedure when R creates a factor. It is possible to ask for a different order, though:</p>
<div class="sourceCode" id="cb850"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb850-1" data-line-number="1"><span class="kw">factor</span>(ozFavs, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Toto&quot;</span>, <span class="st">&quot;Scarecrow&quot;</span>, <span class="st">&quot;Glinda&quot;</span>, <span class="st">&quot;Dorothy&quot;</span>))</a></code></pre></div>
<pre><code>## [1] Glinda    Toto      Toto      Dorothy   Toto      Glinda    Scarecrow
## [8] Dorothy  
## Levels: Toto Scarecrow Glinda Dorothy</code></pre>
<p>In many instances it is appropriate to convert a character vector to a factor, but sometimes this is not such a great idea. Consider something like your address, or your favorite inspirational quote: pretty much every person in a study will have a different address or favorite quote than others in the study. Hence there won’t be any memory-storage benefit associated with creating a factor: the vector of levels—itself a character vector—would require as much storage space as the original character vector itself! In addition, we will see that the status of a variable as class “factor” can affect how R’s statistical and graphical functions deal with it. It’s not a good idea to treat a categorical variable as a factor unless its set of possible values is considered important.</p>
<p>We will think more about how to deal with factor variables later on, when we begin data analysis in earnest.</p>
</div>
<div id="practice-exercises-12" class="section level3">
<h3><span class="header-section-number">5.4.4</span> Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>How would you learn more about the data frame <code>RailTrail</code> from the <strong>mosaicData</strong> package?</p></li>
<li><p>Write a one-line command to see the first 10 rows of <code>RailTrail</code> in the Console.</p></li>
<li><p>Write a one-line command to get the names of all of the variables in <code>mosaicData::RailTrail</code>.</p></li>
<li><p>Regarding <code>RailTrail</code>: write a one-line command to get the high temperature on all the days when the precipitation was more than 0.5 inches.</p></li>
<li><p>Regarding <code>RailTrail</code>: write a one-line command to sort the average temperatures from highest to lowest.</p></li>
</ol>
</div>
<div id="solutions-to-the-practice-exercises-6" class="section level3">
<h3><span class="header-section-number">5.4.5</span> Solutions to the Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>One way is to attach, then then ask for help:</p>
<div class="sourceCode" id="cb852"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb852-1" data-line-number="1"><span class="kw">library</span>(mosaicData)</a>
<a class="sourceLine" id="cb852-2" data-line-number="2"><span class="kw">help</span>(RailTrail)</a></code></pre></div>
<p>Another way is to refer to the data frame through the package, with double colons:</p>
<div class="sourceCode" id="cb853"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb853-1" data-line-number="1"><span class="kw">library</span>(mosaicData<span class="op">::</span>RailTrail)</a></code></pre></div>
<p>That way you don’t have to add all the items in <strong>mosaicData</strong> to your search path.</p></li>
<li><p>Here’s one way:</p>
<div class="sourceCode" id="cb854"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb854-1" data-line-number="1"><span class="kw">head</span>(mosaicData<span class="op">::</span>RailTrail, <span class="dt">n =</span> <span class="dv">10</span>)</a></code></pre></div></li>
<li><p>It’s <code>names(mosaicData::RailTrail)</code>.</p></li>
<li><p>Here’s one way:</p>
<div class="sourceCode" id="cb855"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb855-1" data-line-number="1"><span class="kw">with</span>(mosaicData<span class="op">::</span>RailTrail, hightemp[precip <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>])</a></code></pre></div></li>
<li><p>Try this:</p>
<div class="sourceCode" id="cb856"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb856-1" data-line-number="1"><span class="kw">sort</span>(mosaicData<span class="op">::</span>RailTrail<span class="op">$</span>avgtemp, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)</a></code></pre></div></li>
</ol>
</div>
</div>
<div id="creating-data-frames" class="section level2">
<h2><span class="header-section-number">5.5</span> Creating Data Frames</h2>
<p>There are many ways to create data frames in R. Here we will introduce just two ways.</p>
<div id="creation-from-vectors" class="section level3">
<h3><span class="header-section-number">5.5.1</span> Creation from Vectors</h3>
<p>Whenever you have vectors of the same length, you can combine them into a data frame, using the <code>data.frame()</code> function: </p>
<div class="sourceCode" id="cb857"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb857-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Dorothy&quot;</span>, <span class="st">&quot;Lion&quot;</span>, <span class="st">&quot;Scarecrow&quot;</span>)</a>
<a class="sourceLine" id="cb857-2" data-line-number="2">h &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">58</span>, <span class="dv">75</span>, <span class="dv">69</span>)</a>
<a class="sourceLine" id="cb857-3" data-line-number="3">a &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">12</span>, <span class="fl">0.04</span>, <span class="dv">18</span>)</a>
<a class="sourceLine" id="cb857-4" data-line-number="4">ozFolk &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">name =</span> n, <span class="dt">height =</span> h, <span class="dt">age =</span> a)</a>
<a class="sourceLine" id="cb857-5" data-line-number="5">ozFolk</a></code></pre></div>
<pre><code>##        name height   age
## 1   Dorothy     58 12.00
## 2      Lion     75  0.04
## 3 Scarecrow     69 18.00</code></pre>
<p>Note that at the time of creation you can provide the variables with any names that you like. If later on you change your mind about the names, you can always revise them:</p>
<div class="sourceCode" id="cb859"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb859-1" data-line-number="1"><span class="kw">names</span>(ozFolk)  </a></code></pre></div>
<pre><code>## [1] &quot;name&quot;   &quot;height&quot; &quot;age&quot;</code></pre>
<div class="sourceCode" id="cb861"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb861-1" data-line-number="1"><span class="kw">names</span>(ozFolk)[<span class="dv">2</span>] &lt;-<span class="st"> &quot;Height&quot;</span>  <span class="co"># &quot;height&quot; was at index 2&quot;</span></a>
<a class="sourceLine" id="cb861-2" data-line-number="2">ozFolk</a></code></pre></div>
<pre><code>##        name Height   age
## 1   Dorothy     58 12.00
## 2      Lion     75  0.04
## 3 Scarecrow     69 18.00</code></pre>
<p>Let’s check the structure of the frame we have made:</p>
<div class="sourceCode" id="cb863"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb863-1" data-line-number="1"><span class="kw">str</span>(ozFolk)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    3 obs. of  3 variables:
##  $ name  : Factor w/ 3 levels &quot;Dorothy&quot;,&quot;Lion&quot;,..: 1 2 3
##  $ Height: num  58 75 69
##  $ age   : num  12 0.04 18</code></pre>
<p>Maybe we would prefer that the <code>name</code> variable not be a factor. We have a couple of options to accomplish this.</p>
<ol style="list-style-type: decimal">
<li><p>We could coerce <code>names</code> to a character variable, and assign it to the data frame:</p>
<div class="sourceCode" id="cb865"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb865-1" data-line-number="1">ozFolk<span class="op">$</span>name &lt;-<span class="st"> </span><span class="kw">as.character</span>(ozFolk<span class="op">$</span>name)</a>
<a class="sourceLine" id="cb865-2" data-line-number="2"><span class="kw">str</span>(ozFolk)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    3 obs. of  3 variables:
##  $ name  : chr  &quot;Dorothy&quot; &quot;Lion&quot; &quot;Scarecrow&quot;
##  $ Height: num  58 75 69
##  $ age   : num  12 0.04 18</code></pre></li>
<li><p>We could prevent <code>names</code> from being made into a factor at the time of creation:</p>
<div class="sourceCode" id="cb867"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb867-1" data-line-number="1">ozFolk &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">name =</span> n, <span class="dt">height =</span> h, <span class="dt">age =</span> a,</a>
<a class="sourceLine" id="cb867-2" data-line-number="2">                     <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb867-3" data-line-number="3"><span class="kw">str</span>(ozFolk)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    3 obs. of  3 variables:
##  $ name  : chr  &quot;Dorothy&quot; &quot;Lion&quot; &quot;Scarecrow&quot;
##  $ height: num  58 75 69
##  $ age   : num  12 0.04 18</code></pre></li>
</ol>
</div>
<div id="creation-from-other-frames" class="section level3">
<h3><span class="header-section-number">5.5.2</span> Creation From Other Frames</h3>
<p>If two frames have the same number of rows, you may combine their columns to form a new frame with the <code>cbind()</code> function: </p>
<div class="sourceCode" id="cb869"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb869-1" data-line-number="1">ozMore &lt;-<span class="st"> </span><span class="kw">data.frame</span>( <span class="dt">color =</span> <span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;yellow&quot;</span>),</a>
<a class="sourceLine" id="cb869-2" data-line-number="2">                      <span class="dt">desire =</span> <span class="kw">c</span>(<span class="st">&quot;Kansas&quot;</span>, <span class="st">&quot;courage&quot;</span>, <span class="st">&quot;brains&quot;</span>))</a>
<a class="sourceLine" id="cb869-3" data-line-number="3"><span class="kw">cbind</span>(ozFolk, ozMore)</a></code></pre></div>
<pre><code>##        name height   age  color  desire
## 1   Dorothy     58 12.00   blue  Kansas
## 2      Lion     75  0.04    red courage
## 3 Scarecrow     69 18.00 yellow  brains</code></pre>
<p>Similarly if two data frames have the same number <em>and type</em> of columns then we can use the <code>rbind()</code> function to combine them: </p>
<div class="sourceCode" id="cb871"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb871-1" data-line-number="1">ozFolk2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;Toto&quot;</span>, <span class="st">&quot;Glinda&quot;</span>),</a>
<a class="sourceLine" id="cb871-2" data-line-number="2">                      <span class="dt">height =</span> <span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">66</span>), <span class="dt">age =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">246</span>),</a>
<a class="sourceLine" id="cb871-3" data-line-number="3">                      <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb871-4" data-line-number="4"><span class="kw">rbind</span>(ozFolk, ozFolk2)</a></code></pre></div>
<pre><code>##        name height    age
## 1   Dorothy     58  12.00
## 2      Lion     75   0.04
## 3 Scarecrow     69  18.00
## 4      Toto     12   3.00
## 5    Glinda     66 246.00</code></pre>
<p><strong>Note</strong>: <code>cbind()</code> and <code>rbind()</code> work for matrices, too.</p>
</div>
</div>
<div id="subsetting-data-frames" class="section level2">
<h2><span class="header-section-number">5.6</span> Subsetting Data Frames</h2>
<p>Our study of sub-setting matrices can be applied to the selection of parts of a data frame. As with a vector, one or both of the dimensions of the frame can come into play.</p>
<p>We can create a new data frame consisting of any columns we like from the original frame:</p>
<div class="sourceCode" id="cb873"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb873-1" data-line-number="1">df &lt;-<span class="st"> </span>m111survey[, <span class="kw">c</span>(<span class="st">&quot;height&quot;</span>, <span class="st">&quot;ideal_ht&quot;</span>)]</a>
<a class="sourceLine" id="cb873-2" data-line-number="2"><span class="kw">head</span>(df)</a></code></pre></div>
<pre><code>##   height ideal_ht
## 1   76.0       78
## 2   74.0       76
## 3   64.0       NA
## 4   62.0       65
## 5   72.0       72
## 6   70.8       NA</code></pre>
<p>If we select just one column, then the result is a vector rather than a data frame:</p>
<div class="sourceCode" id="cb875"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb875-1" data-line-number="1">df &lt;-<span class="st"> </span>m111survey[, <span class="st">&quot;height&quot;</span>]</a>
<a class="sourceLine" id="cb875-2" data-line-number="2"><span class="kw">is.vector</span>(df)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>If for some reason you want to prevent this, set <code>drop</code> to <code>FALSE</code>:</p>
<div class="sourceCode" id="cb877"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb877-1" data-line-number="1">df &lt;-<span class="st"> </span>m111survey[, <span class="st">&quot;height&quot;</span>, drop =<span class="ot">FALSE</span>]</a>
<a class="sourceLine" id="cb877-2" data-line-number="2"><span class="kw">head</span>(df)</a></code></pre></div>
<pre><code>##   height
## 1   76.0
## 2   74.0
## 3   64.0
## 4   62.0
## 5   72.0
## 6   70.8</code></pre>
<p>You may select particular rows, too:</p>
<div class="sourceCode" id="cb879"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb879-1" data-line-number="1">m111survey[<span class="dv">10</span><span class="op">:</span><span class="dv">15</span>, <span class="kw">c</span>(<span class="st">&quot;height&quot;</span>, <span class="st">&quot;ideal_ht&quot;</span>)]</a></code></pre></div>
<pre><code>##    height ideal_ht
## 10     67       67
## 11     65       69
## 12     62       62
## 13     59       62
## 14     78       75
## 15     69       72</code></pre>
<p>You can even select some of the rows at random. Here is a random sample of size six:</p>
<div class="sourceCode" id="cb881"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb881-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="kw">nrow</span>(m111survey)</a>
<a class="sourceLine" id="cb881-2" data-line-number="2">df &lt;-<span class="st"> </span>m111survey[<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span>n, <span class="dt">size =</span> <span class="dv">6</span>, <span class="dt">replace =</span> <span class="ot">FALSE</span>), ]</a>
<a class="sourceLine" id="cb881-3" data-line-number="3">df[<span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;seat&quot;</span>)]  <span class="co"># show just two columns</span></a></code></pre></div>
<pre><code>##       sex     seat
## 47 female 2_middle
## 51 female 2_middle
## 34   male 2_middle
## 19 female  1_front
## 41 female 2_middle
## 61 female  1_front</code></pre>
<p>Note the function <code>nrow()</code>  that gives the number of rows of the frame. When we sample six items without replacement from the vector <code>1:n</code>, we are picking six numbers at random from the row-numbers of the vector. Specifying these six numbers in the selection operator <code>[</code> yields the desired random sample of rows.</p>
<div id="boolean-expressions" class="section level3">
<h3><span class="header-section-number">5.6.1</span> Boolean Expressions</h3>
<p>It is especially common to select rows by the values of a logical vector. For example, to select the rows where the fast speed ever driven is at least 150 miles per hour, try this:</p>
<div class="sourceCode" id="cb883"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb883-1" data-line-number="1">df &lt;-<span class="st"> </span>m111survey[m111survey<span class="op">$</span>fastest <span class="op">&gt;=</span><span class="st"> </span><span class="dv">150</span>, ]</a>
<a class="sourceLine" id="cb883-2" data-line-number="2">df[, <span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;fastest&quot;</span>)]  <span class="co"># show just two of the variables</span></a></code></pre></div>
<pre><code>##     sex fastest
## 8  male     160
## 32 male     190</code></pre>
<p>When you are selecting rows it can be convenient to use the <code>subset()</code> function.  The first argument to the function is the frame from which you plan to select, and the second is the Boolean expression by which to select:</p>
<div class="sourceCode" id="cb885"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb885-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">subset</span>(m111survey, fastest <span class="op">&gt;=</span><span class="st"> </span><span class="dv">150</span>)</a>
<a class="sourceLine" id="cb885-2" data-line-number="2">df[, <span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;fastest&quot;</span>)] </a></code></pre></div>
<pre><code>##     sex fastest
## 8  male     160
## 32 male     190</code></pre>
<p>Note that we did not need to type <code>m111survey$fastest</code>: the first argument to <code>subset()</code> provides the environment in which to search for names that appear in the Boolean expression.</p>
<p>The Boolean sub-setting expressions can be quite complex:</p>
<div class="sourceCode" id="cb887"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb887-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">subset</span>(m111survey, seat <span class="op">==</span><span class="st"> &quot;3_back&quot;</span> <span class="op">&amp;</span><span class="st"> </span>height <span class="op">&lt;</span><span class="st"> </span><span class="dv">72</span> <span class="op">&amp;</span><span class="st"> </span>sex <span class="op">==</span><span class="st"> &quot;female&quot;</span>)</a>
<a class="sourceLine" id="cb887-2" data-line-number="2">df[, <span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;height&quot;</span>, <span class="st">&quot;seat&quot;</span>)]</a></code></pre></div>
<pre><code>##       sex height   seat
## 9  female     59 3_back
## 20 female     65 3_back
## 30 female     69 3_back
## 53 female     69 3_back
## 70 female     65 3_back</code></pre>
<p><strong>Note</strong>: <code>subset()</code> takes a third parameter called <code>select</code> that allows you to pick out any desired columns. For example:</p>
<div class="sourceCode" id="cb889"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb889-1" data-line-number="1"><span class="kw">subset</span>(m111survey, seat <span class="op">==</span><span class="st"> &quot;3_back&quot;</span> <span class="op">&amp;</span><span class="st"> </span>height <span class="op">&lt;</span><span class="st"> </span><span class="dv">72</span> <span class="op">&amp;</span><span class="st"> </span>sex <span class="op">==</span><span class="st"> &quot;female&quot;</span>,</a>
<a class="sourceLine" id="cb889-2" data-line-number="2">       <span class="dt">select =</span> <span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;height&quot;</span>, <span class="st">&quot;seat&quot;</span>))</a></code></pre></div>
<pre><code>##       sex height   seat
## 9  female     59 3_back
## 20 female     65 3_back
## 30 female     69 3_back
## 53 female     69 3_back
## 70 female     65 3_back</code></pre>
</div>
<div id="practice-exercises-13" class="section level3">
<h3><span class="header-section-number">5.6.2</span> Practice Exercises</h3>
<p>We’ll use the <code>CPS85</code> data frame from the <strong>mosaicData</strong> package. You should go ahead and load the package and then read about the data frame:</p>
<div class="sourceCode" id="cb891"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb891-1" data-line-number="1"><span class="kw">library</span>(mosaicData)</a>
<a class="sourceLine" id="cb891-2" data-line-number="2">?CPS85</a></code></pre></div>
<p>Each row in the data frame corresponds to an employee in the survey.</p>
<ol style="list-style-type: decimal">
<li><p>Write a command that gives the number of employees in the data frame.</p></li>
<li><p>Select the employees who are between 40 and 50 years old.</p></li>
<li><p>Select the employees who are married and have fewer than 30 years of experience.</p></li>
<li><p>Select the nonunion employees who either live in the South or who have more than 12 years of education (or both).</p></li>
<li><p>Select the employees who work in the clerical, construction, management or professional sector.</p></li>
<li><p>Select the employees who make more than 30 dollars per hour, and keep only their wage, sex and sector of employment</p></li>
<li><p>Select 10 employees at random, keeping only their wage and sex.</p></li>
<li><p>Select all of the employees, keeping all information about them except for their union status and whether or not they are from the South.</p></li>
</ol>
</div>
<div id="solutions-to-practice-exercises-9" class="section level3">
<h3><span class="header-section-number">5.6.3</span> Solutions to Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>The command is <code>nrow(CPS85)</code>.</p></li>
<li><p>Try this:</p>
<div class="sourceCode" id="cb892"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb892-1" data-line-number="1"><span class="kw">subset</span>(CPS85, age <span class="op">&gt;</span><span class="st"> </span><span class="dv">40</span> <span class="op">&amp;</span><span class="st"> </span>age <span class="op">&lt;</span><span class="st"> </span><span class="dv">50</span>)</a></code></pre></div></li>
<li><p>Try this:</p>
<div class="sourceCode" id="cb893"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb893-1" data-line-number="1"><span class="kw">subset</span>(CPS85, married <span class="op">==</span><span class="st"> &quot;Married&quot;</span> <span class="op">&amp;</span><span class="st"> </span>exper <span class="op">&lt;</span><span class="st"> </span><span class="dv">30</span>)</a></code></pre></div></li>
<li><p>Try this:</p>
<div class="sourceCode" id="cb894"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb894-1" data-line-number="1"><span class="kw">subset</span>(CPS85, union <span class="op">==</span><span class="st"> &quot;Not&quot;</span> <span class="op">&amp;</span><span class="st"> </span>(south <span class="op">==</span><span class="st"> &quot;S&quot;</span> <span class="op">|</span><span class="st"> </span>educ <span class="op">&gt;</span><span class="st"> </span><span class="dv">12</span>))</a></code></pre></div></li>
<li><p>Try this:</p>
<div class="sourceCode" id="cb895"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb895-1" data-line-number="1"><span class="kw">subset</span>(CPS85, sector <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;clerical&quot;</span>, <span class="st">&quot;construction&quot;</span>,</a>
<a class="sourceLine" id="cb895-2" data-line-number="2">                            <span class="st">&quot;management&quot;</span>, <span class="st">&quot;professional&quot;</span>))</a></code></pre></div></li>
<li><p>Try this:</p>
<div class="sourceCode" id="cb896"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb896-1" data-line-number="1">CPS85[CPS85<span class="op">$</span>wage <span class="op">&gt;</span><span class="st"> </span><span class="dv">30</span>, <span class="kw">c</span>(<span class="st">&quot;wage&quot;</span>, <span class="st">&quot;sex&quot;</span>, <span class="st">&quot;sector&quot;</span>)]</a></code></pre></div></li>
<li><p>Try this:</p>
<div class="sourceCode" id="cb897"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb897-1" data-line-number="1">CPS85[<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(CPS85), <span class="dt">size =</span> <span class="dv">10</span>, <span class="dt">replace =</span> <span class="ot">FALSE</span>),</a>
<a class="sourceLine" id="cb897-2" data-line-number="2">      <span class="kw">c</span>(<span class="st">&quot;wage&quot;</span>, <span class="st">&quot;sex&quot;</span>)]</a></code></pre></div></li>
<li><p>Try this (<code>south</code> and <code>union</code> are columns 6 and 9, respectively):</p>
<div class="sourceCode" id="cb898"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb898-1" data-line-number="1">CPS85[ , <span class="op">-</span><span class="kw">c</span>(<span class="dv">6</span>, <span class="dv">9</span>)]</a></code></pre></div></li>
</ol>
</div>
</div>
<div id="ordering-data-frames" class="section level2">
<h2><span class="header-section-number">5.7</span> Ordering Data Frames</h2>
<p>You can reorder as well as select. For example, the following code selects the first five rows of<code>m111survey</code> and then reverses them:</p>
<div class="sourceCode" id="cb899"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb899-1" data-line-number="1">df &lt;-<span class="st"> </span>m111survey[, <span class="kw">c</span>(<span class="st">&quot;height&quot;</span>, <span class="st">&quot;ideal_ht&quot;</span>)]</a>
<a class="sourceLine" id="cb899-2" data-line-number="2">dfRev &lt;-<span class="st"> </span>df[<span class="dv">5</span><span class="op">:</span><span class="dv">1</span>, ]</a>
<a class="sourceLine" id="cb899-3" data-line-number="3"><span class="kw">head</span>(dfRev)</a></code></pre></div>
<pre><code>##   height ideal_ht
## 5     72       72
## 4     62       65
## 3     64       NA
## 2     74       76
## 1     76       78</code></pre>
<p>If you want, you can even scramble the rows of the data frame in a random order:</p>
<div class="sourceCode" id="cb901"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb901-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="kw">nrow</span>(m111survey)</a>
<a class="sourceLine" id="cb901-2" data-line-number="2">shuffle &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span>n, <span class="dt">size =</span> n, <span class="dt">replace =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb901-3" data-line-number="3">df &lt;-<span class="st"> </span>m111survey[shuffle, ]</a>
<a class="sourceLine" id="cb901-4" data-line-number="4"><span class="kw">head</span>(df[<span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;seat&quot;</span>)])  <span class="co">#show just two columns</span></a></code></pre></div>
<pre><code>##       sex     seat
## 9  female   3_back
## 62 female  1_front
## 49   male 2_middle
## 27   male  1_front
## 66   male 2_middle
## 43 female  1_front</code></pre>
<p>It is quite common to order the rows of a frame according to the values of a particular variable. For example, you might want to arrange the rows by <code>height</code>, so that the frame begins with the shortest subject and ends with the tallest.</p>
<p>Accomplishing this task requires a study of R’s <code>order()</code> function. Consider the following vector:</p>
<div class="sourceCode" id="cb903"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb903-1" data-line-number="1">vec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">15</span>, <span class="dv">12</span>, <span class="dv">23</span>, <span class="dv">7</span>)</a></code></pre></div>
<p>Call <code>order()</code> with this vector as an argument:</p>
<div class="sourceCode" id="cb904"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb904-1" data-line-number="1"><span class="kw">order</span>(vec)</a></code></pre></div>
<pre><code>## [1] 4 2 1 3</code></pre>
<p><code>order()</code> returns the indices of the elements of <code>vec</code>, in the following order:</p>
<ul>
<li>the index of the smallest element (7, at index 4 of <code>vec</code>);</li>
<li>the index of the second-smallest element (12, at index 2 of <code>vec</code>);</li>
<li>the index of the third-smallest element (15, at index 1 of <code>vec</code>);</li>
<li>the index of the largest element (23, at index 3 of <code>vec</code>).</li>
</ul>
<p>Can you guess the output of the following function-call without looking for the answer underneath?</p>
<div class="sourceCode" id="cb906"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb906-1" data-line-number="1">vec[<span class="kw">order</span>(vec)]</a></code></pre></div>
<pre><code>## [1]  7 12 15 23</code></pre>
<p>Sure enough, the result is <code>vec</code> sorted: from smallest to largest element.</p>
<p>Now the sorting of <code>vec</code> could have been accomplished with R’s <code>sort()</code>function: </p>
<div class="sourceCode" id="cb908"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb908-1" data-line-number="1"><span class="kw">sort</span>(vec)</a></code></pre></div>
<pre><code>## [1]  7 12 15 23</code></pre>
<p>The power of <code>order()</code> comes with the rearrangement of rows of a data frame. In order to “sort” the frame from shortest to tallest subject, call:</p>
<div class="sourceCode" id="cb910"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb910-1" data-line-number="1">df &lt;-<span class="st"> </span>m111survey[<span class="kw">order</span>(m111survey<span class="op">$</span>height), ]</a>
<a class="sourceLine" id="cb910-2" data-line-number="2"><span class="kw">head</span>(df[, <span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;height&quot;</span>)])  <span class="co"># to show that it worked</span></a></code></pre></div>
<pre><code>##       sex height
## 45 female     51
## 26 female     54
## 9  female     59
## 13 female     59
## 40 female     60
## 69 female     61</code></pre>
<p>If you want to order the rows from tallest to shortest instead, then use the <code>decreasing</code> parameter, which by default is <code>FALSE</code>:</p>
<div class="sourceCode" id="cb912"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb912-1" data-line-number="1">df &lt;-<span class="st"> </span>m111survey[<span class="kw">order</span>(m111survey<span class="op">$</span>height, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>), ]</a>
<a class="sourceLine" id="cb912-2" data-line-number="2"><span class="kw">head</span>(df[, <span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;height&quot;</span>)])  <span class="co"># to show that it worked</span></a></code></pre></div>
<pre><code>##       sex height
## 8    male     79
## 14 female     78
## 1    male     76
## 58   male     76
## 34   male     75
## 54   male     75</code></pre>
<p>Sometimes you want to order by two or more variables. For example suppose you want to arrange the frame so that the folks preferring to sit in front come first, followed by the people who prefer the middle and ending with the people who prefer the back. Within these groups you would like people to be arranged from shortest to tallest. Then call:</p>
<div class="sourceCode" id="cb914"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb914-1" data-line-number="1">ordering &lt;-<span class="st"> </span><span class="kw">with</span>(m111survey, <span class="kw">order</span>(seat, height))</a>
<a class="sourceLine" id="cb914-2" data-line-number="2">df &lt;-<span class="st"> </span>m111survey[ordering, ]</a>
<a class="sourceLine" id="cb914-3" data-line-number="3"><span class="kw">head</span>(df[, <span class="kw">c</span>(<span class="st">&quot;seat&quot;</span>, <span class="st">&quot;height&quot;</span>)], <span class="dt">n =</span> <span class="dv">10</span>)  <span class="co"># see if it worked</span></a></code></pre></div>
<pre><code>##       seat height
## 45 1_front     51
## 26 1_front     54
## 13 1_front     59
## 69 1_front     61
## 4  1_front     62
## 12 1_front     62
## 23 1_front     63
## 38 1_front     63
## 61 1_front     63
## 57 1_front     64</code></pre>
<div id="practice-exercises-14" class="section level3">
<h3><span class="header-section-number">5.7.1</span> Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Consider the following vector:</p>
<div class="sourceCode" id="cb916"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb916-1" data-line-number="1">creatures &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Mole&quot;</span>, <span class="st">&quot;Frog&quot;</span>, <span class="st">&quot;Rat&quot;</span>, <span class="st">&quot;Badger&quot;</span>)</a></code></pre></div>
<p>Write down what you think will be the result of the call:</p>
<div class="sourceCode" id="cb917"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb917-1" data-line-number="1"><span class="kw">order</span>(creatures)</a></code></pre></div>
<p>Then check your answer by actually running:</p>
<div class="sourceCode" id="cb918"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb918-1" data-line-number="1">creatures &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Mole&quot;</span>, <span class="st">&quot;Frog&quot;</span>, <span class="st">&quot;Rat&quot;</span>, <span class="st">&quot;Badger&quot;</span>)</a>
<a class="sourceLine" id="cb918-2" data-line-number="2"><span class="kw">order</span>(creatures)</a></code></pre></div></li>
<li><p>What will be the result of the following?</p>
<div class="sourceCode" id="cb919"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb919-1" data-line-number="1"><span class="kw">order</span>(creatures, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)</a></code></pre></div></li>
<li><p>Arrange the rows of the data frame <code>mosaicData::CPS85</code> in order, from the lowest to the highest wage. Break ties by experience (less experience coming before more experience).</p></li>
<li><p>Arrange the rows of the data frame <code>mosaicData::CPS85</code> in order, from the lowest to the highest wage. Break ties by experience (more experience coming before less experience).</p></li>
</ol>
</div>
<div id="solutions-to-practice-exercises-10" class="section level3">
<h3><span class="header-section-number">5.7.2</span> Solutions to Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Here’s what you get:</p>
<div class="sourceCode" id="cb920"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb920-1" data-line-number="1"><span class="kw">order</span>(creatures)</a></code></pre></div>
<pre><code>## [1] 4 2 1 3</code></pre></li>
<li><p>Here’s what you get:</p>
<div class="sourceCode" id="cb922"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb922-1" data-line-number="1"><span class="kw">order</span>(creatures, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 3 1 2 4</code></pre></li>
<li><p>Here is one way:</p>
<div class="sourceCode" id="cb924"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb924-1" data-line-number="1">CPS85[<span class="kw">order</span>(CPS85<span class="op">$</span>wage, CPS85<span class="op">$</span>exper), ]</a></code></pre></div></li>
<li><p>Here is one way:</p>
<div class="sourceCode" id="cb925"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb925-1" data-line-number="1">CPS85[<span class="kw">order</span>(CPS85<span class="op">$</span>wage, CPS85<span class="op">$</span>exper, </a>
<a class="sourceLine" id="cb925-2" data-line-number="2">            <span class="dt">decreasing =</span> <span class="kw">c</span>(<span class="ot">FALSE</span>, <span class="ot">TRUE</span>)), ]</a></code></pre></div></li>
</ol>
</div>
</div>
<div id="new-variables-from-old" class="section level2">
<h2><span class="header-section-number">5.8</span> New Variables from Old</h2>
<p>Quite often you will want to <em>transform</em> one or more variables in a data frame. Transforming a variable means changing its values in a systematic way.</p>
<p>For example, you might want to measure height in feet rather than inches. Then you want the following</p>
<div class="sourceCode" id="cb926"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb926-1" data-line-number="1">heightInFeet &lt;-<span class="st"> </span><span class="kw">with</span>(m111survey, height<span class="op">/</span><span class="dv">12</span>)  <span class="co"># 12 inches in a foot</span></a></code></pre></div>
<p>If you plan to use this new variable in your analysis later on, it might be a good idea to add it to the data frame:</p>
<div class="sourceCode" id="cb927"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb927-1" data-line-number="1">m111survey<span class="op">$</span>height_ft &lt;-<span class="st"> </span>heightInFeet</a></code></pre></div>
<p>Another common need is to <em>recode</em> the values of a categorical variable. For example, you might want to divide people into two groups: those who prefer to sit in the back and those who don’t. This is a good time to use <code>ifelse()</code>:</p>
<div class="sourceCode" id="cb928"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb928-1" data-line-number="1">seat2 &lt;-<span class="st"> </span><span class="kw">ifelse</span>(m111survey<span class="op">$</span>seat <span class="op">==</span><span class="st"> &quot;3_back&quot;</span>, <span class="st">&quot;Back&quot;</span>, <span class="st">&quot;Other&quot;</span>)</a>
<a class="sourceLine" id="cb928-2" data-line-number="2">m111survey<span class="op">$</span>seat2 &lt;-<span class="st"> </span>seat2</a></code></pre></div>
<p>If you plan to re-code into a variable that involves more than two values, then you might want to look into the <code>mapvalues()</code> function from the <strong>plyr</strong> package <span class="citation">(Wickham <a href="#ref-R-plyr">2016</a>)</span>:</p>
<div class="sourceCode" id="cb929"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb929-1" data-line-number="1">seat3 &lt;-<span class="st"> </span>plyr<span class="op">::</span><span class="kw">mapvalues</span>(m111survey<span class="op">$</span>seat,</a>
<a class="sourceLine" id="cb929-2" data-line-number="2">                <span class="dt">from =</span> <span class="kw">c</span>(<span class="st">&quot;1_front&quot;</span>, <span class="st">&quot;2_middle&quot;</span>, <span class="st">&quot;3_back&quot;</span>),</a>
<a class="sourceLine" id="cb929-3" data-line-number="3">                <span class="dt">to =</span> <span class="kw">c</span>(<span class="st">&quot;Front&quot;</span>, <span class="st">&quot;Middle&quot;</span>, <span class="st">&quot;Back&quot;</span>))</a>
<a class="sourceLine" id="cb929-4" data-line-number="4"><span class="kw">str</span>(seat3)</a></code></pre></div>
<pre><code>##  Factor w/ 3 levels &quot;Front&quot;,&quot;Middle&quot;,..: 1 2 2 1 3 1 1 3 3 2 ...</code></pre>
<p>The do-it-yourself approach is to write a loop. Remember <code>switch()</code>? </p>
<div class="sourceCode" id="cb931"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb931-1" data-line-number="1">seat &lt;-<span class="st"> </span>m111survey<span class="op">$</span>seat</a>
<a class="sourceLine" id="cb931-2" data-line-number="2">seat3 &lt;-<span class="st"> </span><span class="kw">character</span>(<span class="kw">length</span>(seat))  <span class="co"># this will be the recoded variable</span></a>
<a class="sourceLine" id="cb931-3" data-line-number="3"><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(seat) ) {</a>
<a class="sourceLine" id="cb931-4" data-line-number="4">  seat3[i] &lt;-<span class="st"> </span><span class="cf">switch</span>(<span class="kw">as.character</span>(seat[i]),</a>
<a class="sourceLine" id="cb931-5" data-line-number="5">                     <span class="st">&quot;1_front&quot;</span> =<span class="st"> &quot;Front&quot;</span>,</a>
<a class="sourceLine" id="cb931-6" data-line-number="6">                     <span class="st">&quot;2_middle&quot;</span> =<span class="st"> &quot;Middle&quot;</span>,</a>
<a class="sourceLine" id="cb931-7" data-line-number="7">                     <span class="st">&quot;3_back&quot;</span> =<span class="st"> &quot;Back&quot;</span>)</a>
<a class="sourceLine" id="cb931-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb931-9" data-line-number="9"><span class="kw">str</span>(seat3)</a></code></pre></div>
<pre><code>##  chr [1:71] &quot;Front&quot; &quot;Middle&quot; &quot;Middle&quot; &quot;Front&quot; &quot;Back&quot; &quot;Front&quot; &quot;Front&quot; ...</code></pre>
<p>The re-coding is done but the result is a character vector and not a factor. We have to make it a factor ourselves:</p>
<div class="sourceCode" id="cb933"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb933-1" data-line-number="1">m111survey<span class="op">$</span>seat3 &lt;-<span class="st"> </span><span class="kw">factor</span>(seat3, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Front&quot;</span>, <span class="st">&quot;Middle&quot;</span>, <span class="st">&quot;Back&quot;</span>))</a></code></pre></div>
<p>This seems like a lot of work!</p>
<p>Another common transformation involves turning a numerical variable into a factor. For example, we might need to classify people as:</p>
<ul>
<li>Tall (height over 70 inches)</li>
<li>Medium (65 - 70 inches)</li>
<li>Short (less than 65 inches)</li>
</ul>
<p>The <code>cut()</code> function  will be helpful.</p>
<div class="sourceCode" id="cb934"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb934-1" data-line-number="1">heightClass &lt;-<span class="st"> </span><span class="kw">cut</span>(m111survey<span class="op">$</span>height,</a>
<a class="sourceLine" id="cb934-2" data-line-number="2">                   <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="dv">65</span>, <span class="dv">70</span>, <span class="ot">Inf</span>),</a>
<a class="sourceLine" id="cb934-3" data-line-number="3">                   <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Short&quot;</span>, <span class="st">&quot;Medium&quot;</span>,<span class="st">&quot;Tall&quot;</span>),</a>
<a class="sourceLine" id="cb934-4" data-line-number="4">                   <span class="dt">right =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb934-5" data-line-number="5"><span class="kw">str</span>(heightClass)</a></code></pre></div>
<pre><code>##  Factor w/ 3 levels &quot;Short&quot;,&quot;Medium&quot;,..: 3 3 1 1 3 3 2 3 1 2 ...</code></pre>
<p>Setting <code>right = TRUE</code> indicates that the upper bound of each interval is included in the interval. Thus, a person with a height of 70 inches is classed as Medium, not Tall.</p>
<div id="getting-rid-of-variables" class="section level3">
<h3><span class="header-section-number">5.8.1</span> Getting Rid of Variables</h3>
<p>We have added several variables to <code>m111survey</code>. In order to remove them (or any other variables we don’t want) we can assign them the value <code>NULL</code>.</p>
<div class="sourceCode" id="cb936"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb936-1" data-line-number="1"><span class="kw">names</span>(m111survey)</a></code></pre></div>
<pre><code>##  [1] &quot;height&quot;          &quot;ideal_ht&quot;        &quot;sleep&quot;          
##  [4] &quot;fastest&quot;         &quot;weight_feel&quot;     &quot;love_first&quot;     
##  [7] &quot;extra_life&quot;      &quot;seat&quot;            &quot;GPA&quot;            
## [10] &quot;enough_Sleep&quot;    &quot;sex&quot;             &quot;diff.ideal.act.&quot;
## [13] &quot;height_ft&quot;       &quot;seat2&quot;           &quot;seat3&quot;</code></pre>
<div class="sourceCode" id="cb938"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb938-1" data-line-number="1">m111survey<span class="op">$</span>height_ft &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb938-2" data-line-number="2">m111survey<span class="op">$</span>seat2 &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb938-3" data-line-number="3">m111survey<span class="op">$</span>seat3 &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb938-4" data-line-number="4"><span class="kw">names</span>(m111survey)  <span class="co"># the extra variables are gone</span></a></code></pre></div>
<pre><code>##  [1] &quot;height&quot;          &quot;ideal_ht&quot;        &quot;sleep&quot;          
##  [4] &quot;fastest&quot;         &quot;weight_feel&quot;     &quot;love_first&quot;     
##  [7] &quot;extra_life&quot;      &quot;seat&quot;            &quot;GPA&quot;            
## [10] &quot;enough_Sleep&quot;    &quot;sex&quot;             &quot;diff.ideal.act.&quot;</code></pre>
</div>
<div id="practice-exercises-15" class="section level3">
<h3><span class="header-section-number">5.8.2</span> Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Remove the variables <code>hispanic</code> and <code>married</code> from the <code>mosaicData::CPS85</code> data frame.</p></li>
<li><p>Change the units of <code>wage</code> in <code>mosaicData::CPS85</code> from dollars per hour to dollars per day. Assume an eight-hour working day.</p></li>
<li><p>For <code>CPS85</code>, create a new variable <code>experGrp</code> that has the following values</p>
<ul>
<li><code>low</code> for experience less than 10 years;</li>
<li><code>medium</code> for experience of at least 10 years but less than 25 years;</li>
<li><code>high</code> for experience at least 25 years.</li>
</ul></li>
<li><p>Using the <code>experGrp</code> variable in the previous exercise, create the following tally of the ages of the employees:</p>
<pre><code>## experGrp
##    low medium   high 
##    179    217    138</code></pre></li>
<li><p>You’ve made some changes to <code>CPS85</code>, but in fact you haven’t changed the original data frame in the <strong>mosaicData</strong> package—you’ve simply made your own copy, which should now be in your Global Environment. Since the Global Environment comes before any package on your search path, if you want to get to the original <code>CPS85</code> you will either have to refer to it as <code>mosaicData::CPS85</code>. Another option, though, is to remove the modified copy from your Global Environment. Go ahead and remove it now.</p></li>
</ol>
</div>
<div id="solutions-to-practice-exercises-11" class="section level3">
<h3><span class="header-section-number">5.8.3</span> Solutions to Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Here’s one way to do it:</p>
<div class="sourceCode" id="cb941"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb941-1" data-line-number="1">CPS85<span class="op">$</span>hispanic &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb941-2" data-line-number="2">CPS85<span class="op">$</span>married &lt;-<span class="st"> </span><span class="ot">NULL</span></a></code></pre></div></li>
<li><p>Here’s one way to do it:</p>
<div class="sourceCode" id="cb942"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb942-1" data-line-number="1">CPS85<span class="op">$</span>wage &lt;-<span class="st"> </span>CPS85<span class="op">$</span>wage <span class="op">*</span><span class="st"> </span><span class="dv">8</span></a></code></pre></div></li>
<li><p>Here’s one way to do it:</p>
<div class="sourceCode" id="cb943"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb943-1" data-line-number="1">CPS85<span class="op">$</span>experGrp &lt;-<span class="st"> </span><span class="kw">cut</span>(CPS85<span class="op">$</span>exper,</a>
<a class="sourceLine" id="cb943-2" data-line-number="2">                      <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="dv">10</span>, <span class="dv">25</span>, <span class="ot">Inf</span>),</a>
<a class="sourceLine" id="cb943-3" data-line-number="3">                      <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;low&quot;</span>, <span class="st">&quot;medium&quot;</span>, <span class="st">&quot;high&quot;</span>))</a></code></pre></div></li>
<li><p>Use <code>table(CPS85$experGrp)</code>.</p></li>
<li><p>Here’s what to do:</p>
<div class="sourceCode" id="cb944"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb944-1" data-line-number="1"><span class="kw">rm</span>(CPS85)</a></code></pre></div></li>
</ol>

</div>
</div>
<div id="glossary-3" class="section level2 unnumbered">
<h2>Glossary</h2>
<dl>
<dt>Matrix </dt>
<dd><p>An atomic vector that has two additional attributes: a number of rows and a number of columns.</p>
</dd>
<dt>Data Frame </dt>
<dd><p>A two-dimensional data structure in R in which the columns are atomic vectors that can be of different types.</p>
</dd>
<dt>Case (also called an Individual) </dt>
<dd><p>An individual unit under study. In a data frame in R, the rows correspond to cases.</p>
</dd>
<dt>Variable (in Data Analysis)</dt>
<dd><p>In data analysis, a <em>variable</em> is a measurement made on the individuals in a study.</p>
</dd>
<dt>Categorical Variable (in Data Analysis)</dt>
<dd><p>In data analysis, a <em>categorical variable</em> is a variable whose values cannot be expressed meaningfully by numbers.</p>
</dd>
</dl>

</div>
<div id="frames-exercises" class="section level2 unnumbered">
<h2>Exercises</h2>
<p><img src="images/thinking.png" width="50%" style="display: block; margin: auto;" /></p>
<ol style="list-style-type: decimal">
<li><p>R has a function called <code>t()</code> that computes the <em>transpose</em> of a given matrix. This means that it switches around the rows and columns of the matrix, like this:</p>
<div class="sourceCode" id="cb945"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb945-1" data-line-number="1">myMatrix &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">24</span>, <span class="dt">nrow =</span> <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb945-2" data-line-number="2">myMatrix</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    7   13   19
## [2,]    2    8   14   20
## [3,]    3    9   15   21
## [4,]    4   10   16   22
## [5,]    5   11   17   23
## [6,]    6   12   18   24</code></pre>
<div class="sourceCode" id="cb947"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb947-1" data-line-number="1"><span class="kw">t</span>(myMatrix)</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6]
## [1,]    1    2    3    4    5    6
## [2,]    7    8    9   10   11   12
## [3,]   13   14   15   16   17   18
## [4,]   19   20   21   22   23   24</code></pre>
<p>Write your own function called <code>transpose()</code> that will perform the same task on any given matrix. The function should take a single parameter called <code>mat</code>, the matrix to be transposed. <strong>Of course you may NOT use <code>t()</code> in the code for your function!</strong></p>
<strong>Hints:</strong> Your function will have to:
<ol style="list-style-type: decimal">
<li>break <code>mat</code> down into the vector of its elements, and then</li>
<li>build the new matrix from those elements, with a number of rows equal to the number of columns of <code>mat</code>.</li>
</ol>
<p>For the first task, <code>as.vector()</code> will be useful.</p>
<p>For the second task, recall (see previous Practice Exercises from this Chapter) that there is a function <code>nrow()</code> that returns the number of rows of a given matrix. It will also be helpful to remember the function <code>ncol()</code> that computes the number of columns of a given matrix.</p></li>
<li><p>R has functions called <code>rowSums()</code> and <code>colSums()</code> that will respectively sum the rows and the columns of a matrix. Here is an example:</p>
<div class="sourceCode" id="cb949"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb949-1" data-line-number="1">myMatrix &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">24</span>, <span class="dt">nrow =</span> <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb949-2" data-line-number="2"><span class="kw">rowSums</span>(myMatrix)</a></code></pre></div>
<pre><code>## [1] 40 44 48 52 56 60</code></pre>
Your task is to write your own function called <code>dimSum()</code> that will sum either the rows or the columns of a given matrix. The function should have two parameters:
<ul>
<li><code>mat</code>: the matrix to be summed.</li>
<li><code>dim</code>: the dimension to sum along, either rows or columns. The default value should be <code>&quot;rows&quot;</code>. If the user sets <code>dim</code> to <code>&quot;columns&quot;</code> then the function would compute the column-sums.</li>
</ul>
<p><strong>You may NOT use <code>rowSums()</code> or <code>colSums()</code> in the code for your function.</strong> A typical example of use should look like this:</p>
<div class="sourceCode" id="cb951"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb951-1" data-line-number="1">myMatrix &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">24</span>, <span class="dt">nrow =</span> <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb951-2" data-line-number="2"><span class="kw">dimSum</span>(myMatrix)</a></code></pre></div>
<pre><code>## [1] 40 44 48 52 56 60</code></pre>
<div class="sourceCode" id="cb953"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb953-1" data-line-number="1"><span class="kw">dimSum</span>(myMatrix, <span class="st">&quot;columns&quot;</span>)</a></code></pre></div>
<pre><code>## [1]  21  57  93 129</code></pre>
<p><strong>Hint</strong>: Recall that in previous Practice Exercises of this Chapter we made a function called <code>myRowSums()</code> that sums the rows of any given matrix. Modify the idea for <code>myRowSums()</code> to write a function called <code>myColSums()</code> that finds the column-sums of any given matrix. You may then use the two previously-created functions to write the required function <code>dimsum()</code>.</p></li>
<li><p>Starting with <code>m111survey</code> in the <strong>bcscr</strong> package, write the code necessary to create a new data frame called <code>smaller</code> that consists precisely of the male students who believe in extraterrestrial life and who are more than 68 inches tall. The new data frame should contain all of the original variables except for <code>sex</code> and <code>extra_life</code>.</p></li>
<li>Write a function called <code>dfRandSelect()</code> that randomly selects (without replacement) a specified number of rows from a given data frame. The function should have two parameters:
<ul>
<li><code>df</code>: the data frame from which to select;</li>
<li><code>n</code>: the number of rows to select.</li>
</ul>
<p>If <code>n</code> is greater than the number of rows in <code>df</code>, the function should return immediately with a message informing the user that the required task is not possible and informing him/her of the number of rows in <code>df</code>. Typical examples of use should be as follows:</p>
<div class="sourceCode" id="cb955"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb955-1" data-line-number="1"><span class="kw">dfRandSelect</span>(bcscr<span class="op">::</span>fuel, <span class="dv">5</span>)</a></code></pre></div>
<pre><code>##    speed efficiency
## 10   100       8.27
## 6     60       5.90
## 9     90       7.57
## 14   140      11.77
## 2     20      13.00</code></pre>
<div class="sourceCode" id="cb957"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb957-1" data-line-number="1"><span class="kw">dfRandSelect</span>(bcscr<span class="op">::</span>fuel, <span class="dv">200</span>)</a></code></pre></div>
<pre><code>## No can do!  The frame has only 15 rows.</code></pre>
<p><strong>Hint</strong>: Use the function <code>nrow()</code>, which gives the number of rows of a matrix or data frame.</p></li>
<li>(*) Create your own data frame, named <code>myFrame</code>. The frame should have 100 rows, along with the following variables:
<ul>
<li><code>lowerLetters</code>: a character vector randomly-produced 3-letter strings, like “chj”, “bbw”, and so on. The letters should all be lowercase.</li>
<li><code>height</code>: a numerical vector consisting of real numbers chosen randomly between the values of 60 and 75.</li>
<li><code>sex</code>: a factor whose possible value are “female” and “male”. Again, these values should be chosen randomly.</li>
</ul>
<p>A call to <code>str(myFrame)</code> would come out <em>like</em> this (although your results will vary a bit since the vectors are constructed randomly):</p>
<div class="sourceCode" id="cb959"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb959-1" data-line-number="1"><span class="kw">str</span>(myFrame)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    100 obs. of  3 variables:
##  $ lowerLetters: chr  &quot;hst&quot; &quot;stx&quot; &quot;knq&quot; &quot;bit&quot; ...
##  $ height      : num  68.6 67 63.1 70.7 62 ...
##  $ sex         : Factor w/ 2 levels &quot;female&quot;,&quot;male&quot;: 2 2 1 1 1 2 1 1 2 2 ...</code></pre>
<p><code>summary()</code> is useful when working with data frames. Here is how a call to <code>summary(myFrame)</code> might look:</p>
<div class="sourceCode" id="cb961"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb961-1" data-line-number="1"><span class="kw">summary</span>(myFrame)</a></code></pre></div>
<pre><code>##  lowerLetters           height          sex    
##  Length:100         Min.   :60.63   female:46  
##  Class :character   1st Qu.:64.14   male  :54  
##  Mode  :character   Median :68.56              
##                     Mean   :68.06              
##                     3rd Qu.:71.91              
##                     Max.   :74.58</code></pre>
<p><strong>Hint</strong>: If you have a vector of three letters, such as</p>
<div class="sourceCode" id="cb963"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb963-1" data-line-number="1">vec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;g&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;r&quot;</span>)</a></code></pre></div>
<p>then you can paste them together as follows:</p>
<div class="sourceCode" id="cb964"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb964-1" data-line-number="1"><span class="kw">paste0</span>(vec, <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;gar&quot;</code></pre></li>
<li><p>(*) Study the data frame <code>fuel</code> in the <strong>bcscr</strong> package. Note that the fuel efficiency is reported as the number of liters of fuel required to travel 100 kilometers. Look up the conversion between gallons and liters and between kilometers and miles, and use this information to create a new variable called <code>mpg</code> that gives the fuel efficiency as miles per gallon. While you are at it, create a new variable <code>mph</code> that gives the speed in miles per hour. Finally, add these new variables to the <code>fuel</code> data frame.</p></li>
<li>(*) Use matrices to generalize the simulation in the Appeals Court Paradox (see Section @ref(appeals-court-paradox)). Your goal is to write a simulation function called <code>appealsSimPlus()</code> that comes with all the options provided in the text, but with additional parameters so that the user can choose:
<ul>
<li>the number of judges on the court;</li>
<li>the probability for each judge to make a correct decision;</li>
<li>the voting pattern (how many votes each judge gets).</li>
</ul>
<p>A typical call to the functions should look like this:</p>
<div class="sourceCode" id="cb966"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb966-1" data-line-number="1"><span class="kw">appealsSimPlus</span>(<span class="dt">reps =</span> <span class="dv">10000</span>, <span class="dt">seed =</span> <span class="dv">5252</span>, </a>
<a class="sourceLine" id="cb966-2" data-line-number="2">               <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.95</span>, <span class="fl">0.90</span>, <span class="fl">0.90</span>, <span class="fl">0.90</span>, <span class="fl">0.80</span>),</a>
<a class="sourceLine" id="cb966-3" data-line-number="3">               <span class="dt">votes =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>))</a></code></pre></div>
<p>In the above call the court consists of five judges. The best one decides cases correctly 95% of the time, three are right 90% of the time and one is right 80%of the time. The voting arrangement is that the best judge gets two votes, the next three get one vote each, and the worst gets no vote. Any voting scheme—even a scheme involving fractional votes—should be allowed so long as the votes add up to the number of judges.</p>
<p><strong>Here is a hint.</strong> When you write the function it may be helpful to use the fact that <code>rbinom()</code> can take a <code>prob</code> parameter that is a vector of any length. Here’s an example:</p>
<div class="sourceCode" id="cb967"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb967-1" data-line-number="1">results &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dv">6</span>, <span class="dt">size =</span> <span class="dv">100</span>, <span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.10</span>, <span class="fl">0.50</span>, <span class="fl">0.90</span>))</a>
<a class="sourceLine" id="cb967-2" data-line-number="2">results</a></code></pre></div>
<pre><code>## [1] 20 49 94 15 50 88</code></pre>
<p>The first and fourth entries simulate a person tossing a fair coin 100 times when she has only a 10% chance of heads. The second and fifth entries simulate the same, when the chance of heads is 50%. The third and sixth simulate coin-tossing when there is a 90% chance of heads.</p>
<p>If you would like to arrange the results more nicely—say in a matrix where each column gives the results for a different person—you can do so:</p>
<div class="sourceCode" id="cb969"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb969-1" data-line-number="1">resultsMat &lt;-<span class="st"> </span><span class="kw">matrix</span>(results, <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb969-2" data-line-number="2">resultsMat</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]   20   49   94
## [2,]   15   50   88</code></pre>
<p>Of course judges don’t flip a coin 100 times, they decide one case at a time. Suppose you have five judges with probabilities as follows:</p>
<div class="sourceCode" id="cb971"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb971-1" data-line-number="1">probCorrect &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.95</span>, <span class="fl">0.90</span>, <span class="fl">0.90</span>, <span class="fl">0.90</span>, <span class="fl">0.80</span>)</a></code></pre></div>
<p>If you would like to simulate the judges deciding, say, 6 cases, try this:</p>
<div class="sourceCode" id="cb972"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb972-1" data-line-number="1">results &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dv">5</span><span class="op">*</span><span class="dv">6</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob=</span> <span class="kw">rep</span>(probCorrect, <span class="dv">6</span>))</a>
<a class="sourceLine" id="cb972-2" data-line-number="2">resultsMat &lt;-<span class="st"> </span><span class="kw">matrix</span>(results, <span class="dt">nrow =</span> <span class="dv">6</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb972-3" data-line-number="3">resultsMat</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,]    1    1    1    0    1
## [2,]    0    1    1    1    1
## [3,]    1    1    1    1    1
## [4,]    1    1    1    1    1
## [5,]    1    1    1    1    1
## [6,]    1    1    1    1    0</code></pre>
<p>When it comes to applying the voting pattern to compute the decision in each case, consider matrix multiplication. For example, suppose that the pattern is:</p>
<div class="sourceCode" id="cb974"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb974-1" data-line-number="1">votes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)</a></code></pre></div>
<p>Then make <code>votes</code> a one-column matrix and perform matrix multiplication:</p>
<div class="sourceCode" id="cb975"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb975-1" data-line-number="1">correctVotes &lt;-<span class="st"> </span>resultsMat <span class="op">%*%</span><span class="st"> </span><span class="kw">matrix</span>(votes, <span class="dt">nrow =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb975-2" data-line-number="2">correctVotes</a></code></pre></div>
<pre><code>##      [,1]
## [1,]    4
## [2,]    3
## [3,]    5
## [4,]    5
## [5,]    5
## [6,]    5</code></pre>
<p>Think about how to encapsulate all of this into a nice, general simulation function.</p></li>
</ol>
<!--chapter:end:070-frames.Rmd-->
</div>
</div>
<div id="graphics" class="section level1">
<h1><span class="header-section-number">6</span> Graphics</h1>

<div class="leadquote">
<p><em>It’s hard to succinctly describe how <strong>ggplot2</strong> works because it embodies a deep philosophy of visualisation.</em></p>
—Hadley Wickham (creator of <strong>ggplot2</strong>)
</div>

<p>Now that we know a bit about how data can be stored and manipulated in data frames, we can begin to <em>analyze</em> data, so in this Chapter we will take a closer look at the aspect of data analysis known as <em>data visialization</em>. We’ll become acquainted with the <em>grammar of graphics</em>, a general approach to visualization, and then learn how this approach is implemented in the <strong>ggplot2</strong> with which we have worked previously. Finally, we’ll engage in a case study.</p>
<div id="the-grammar-of-graphics" class="section level2">
<h2><span class="header-section-number">6.1</span> The Grammar of Graphics</h2>
<p>A graph begins with data, and the data we work with will be tidy data that comes in a data frame. Leland Wilkinson’s Grammar of Graphics (see <span class="citation">(Wilkinson <a href="#ref-Wilkinson2005">2005</a>)</span>) posits that most quantitative graphics constructed from a data frame can be understood in terms of a few basic elements. In our quite elementary introduction to the Grammar, the elements to which we will pay the most attention are as follows:</p>
<ul>
<li><em>Glyphs</em>: the basic units of a graph. Glyphs represent cases in the data frame. Each glyph corresponds to one or more cases, but no two glyphs correspond to the same case.</li>
<li><em>Aesthetics</em>: perceptual properties of glyphs that are not the same for all glyphs but instead vary depending on the values of variables for the case (or cases) that each glyph represents.</li>
<li><em>Frame</em>: special aesthetics that relate the <strong>position</strong> of each glyphs in the graph to values of variables for the cases that the glyph represents.</li>
<li><em>Scales</em>: particular choices that determine the precise relationship between aesthetic properties and data values for glyphs.</li>
<li><em>Guides</em>: visual aids that help the human viewer to infer data values for cases from the aesthetic properties of the glyphs that represent them.</li>
</ul>
<p>We will clarify these abstract ideas with a series of examples. Many of our examples will be drawn from the <code>m111survey</code> data frame in the <strong>tigerstats</strong> package.</p>
<div class="sourceCode" id="cb977"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb977-1" data-line-number="1"><span class="kw">library</span>(bcscr)</a>
<a class="sourceLine" id="cb977-2" data-line-number="2"><span class="kw">help</span>(m111survey)</a></code></pre></div>
<p>You will recall that the data frame records the results of a survey of 71 students at Georgetown College in Kentucky. Each case (row in the frame) corresponds to an individual student. See Table @ref(tab:m111surveyhead).</p>
<table>
<caption>(#tab:m111surveyhead)The first few rows of the m111survey data frame. Five variables are shown.</caption>
<thead>
<tr class="header">
<th align="left">sex</th>
<th align="right">fastest</th>
<th align="right">GPA</th>
<th align="left">seat</th>
<th align="left">weight_feel</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">male</td>
<td align="right">119</td>
<td align="right">3.56</td>
<td align="left">1_front</td>
<td align="left">1_underweight</td>
</tr>
<tr class="even">
<td align="left">male</td>
<td align="right">110</td>
<td align="right">2.50</td>
<td align="left">2_middle</td>
<td align="left">2_about_right</td>
</tr>
<tr class="odd">
<td align="left">female</td>
<td align="right">85</td>
<td align="right">3.80</td>
<td align="left">2_middle</td>
<td align="left">2_about_right</td>
</tr>
<tr class="even">
<td align="left">female</td>
<td align="right">100</td>
<td align="right">3.50</td>
<td align="left">1_front</td>
<td align="left">1_underweight</td>
</tr>
<tr class="odd">
<td align="left">male</td>
<td align="right">95</td>
<td align="right">3.20</td>
<td align="left">3_back</td>
<td align="left">1_underweight</td>
</tr>
<tr class="even">
<td align="left">male</td>
<td align="right">100</td>
<td align="right">3.10</td>
<td align="left">1_front</td>
<td align="left">3_overweight</td>
</tr>
</tbody>
</table>
<div id="example-a-scatterplot" class="section level3">
<h3><span class="header-section-number">6.1.1</span> Example: a Scatterplot</h3>
<p>We begin with a simple scatter plot based on the data. A scatter plot is often a good way to investigate graphically the relationship between two numerical variables. Figure @ref(fig:ggfastestgpasex) shows a scatter plot of student GPA vs. the fastest speed at which the student has ever driven a car.</p>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/ggfastestgpasex-1.png" alt="Scatterplot of fastest driving speed and GPA.  Points are colored by sex of the student." width="95%" />
<p class="caption">
(#fig:ggfastestgpasex)Scatterplot of fastest driving speed and GPA. Points are colored by sex of the student.
</p>
</div>
<div id="the-glyphs" class="section level4">
<h4><span class="header-section-number">6.1.1.1</span> The Glyphs </h4>
<p>In this scatter plot, the glyphs are points. Each case—each student in the survey—is represented by one and only one point on the plot.</p>
</div>
<div id="the-aesthetics" class="section level4">
<h4><span class="header-section-number">6.1.1.2</span> The Aesthetics </h4>
<p>In ordinary discourse the term <em>aesthetic</em> refers to any perceptual property of an object. For a point, the list of its perceptual properties includes its location, its shape, its size, its color, and so on. In the Grammar of Graphics, however, only some of the properties—the one that vary from glyph to glyph depending on data—count as aesthetics in the graph.</p>
<p>For the scatter plot, the property of <strong>size</strong> is not considered to be an aesthetic: we can see that this is so because all of the points are the same size, and so the size cannot vary with the values of some variable in the data frame. The same goes for the property of <strong>shape</strong>: all of the points in this scatter plot are circular.</p>
<p>On the other hand, the property of <strong>color</strong> IS an aesthetic for the glyphs in the graph, since the males and the females in the study are represented by points of different colors. You could say that color is <em>mapped</em> to the variable <code>sex</code> in the data frame:</p>
<ul>
<li>the reddish color goes with the value “female”;</li>
<li>the turquoise color goes with the value “male”.</li>
</ul>
</div>
<div id="the-frame" class="section level4">
<h4><span class="header-section-number">6.1.1.3</span> The Frame </h4>
<p>In our scatter plot there are two other glyph properties that count as aesthetics:</p>
<ul>
<li><em>x-location</em>: the position of the glyph relative to the horizontal axis of the graph;</li>
<li><em>y-location</em>: the position of the glyph relative to the vertical axis.</li>
</ul>
<p>We can see that these properties are aesthetics because:</p>
<ul>
<li><em>x-location</em> is mapped to the variable <code>fastest</code>: the further to the right the glyph is, the greater is the value of <code>fastest</code> for the student represented by that glyph.</li>
<li><em>y-location</em> is mapped to the variable <code>GPA</code>: the higher up the glyph is, the greater is the value of <code>GPA</code> for the student represented by that glyph.</li>
</ul>
<p>Although x and y locations are just two more aesthetics, they are so crucial to the nature of a two-dimensional graph that they are classed separately in the Grammar of Graphics as the <em>frame</em> for the graph.</p>
<p>In the graphs we consider in this Chapter, the frame will always consist of at least the x-location, and sometimes—as in the case of our scatter plot—the y-location as well.</p>
</div>
<div id="scales" class="section level4">
<h4><span class="header-section-number">6.1.1.4</span> Scales </h4>
<p>We can decide that color (for example) is to be mapped to <code>sex</code>, but that decision leaves open the question of how, precisely, to make the connection. The computer can make thousands of colors: which one will correspond to the value “male”, and which to “female”? To answer that question is to choose a <em>scale</em>.</p>
<p>In this example our scale was:</p>
<ul>
<li>reddish = female</li>
<li>turquoise = male</li>
</ul>
<p>But we might have adopted a different scale, such as:</p>
<ul>
<li>blue = female</li>
<li>pink = male</li>
</ul>
<p>Every aesthetic mapping involves a choice of a scale. Consider x-location: apparently a point on the extreme left of the scatter plot represent a student who drove 50 miles per hour. A point at the extreme right corresponds to a speed of 200 miles per hour, and in general the relationship between x-location and <code>fastest</code> is linear: for example, a point halfway across the graph goes with a speed of 125 miles per hour, halfway between 50 mph and 200 mph. In the same way, the mapping of y-location to <code>GPA</code> involves a linear choice of scale.</p>
</div>
<div id="guides" class="section level4">
<h4><span class="header-section-number">6.1.1.5</span> Guides </h4>
<p>How were we able to see what the scales were for each of the three aesthetic mappings in the scatter plot? We were assisted by three set of <em>guides</em>, one for each mapping:</p>
<ul>
<li>the legend to the right of the plot guided us from color to value of <code>sex</code>;</li>
<li>the labels and tick marks on the x-axis and the thin vertical white lines guided us from x-location to value of <code>fastest</code>;</li>
<li>the labels and tick marks on the y-axis and the thin horizontal white lines guided us from y-location to value of <code>GPA</code>.</li>
</ul>
<p>Most of the time, every aesthetic mapping is accompanied by a guide that gives the human viewer at least a rough idea of the scale chosen for that mapping.</p>
</div>
<div id="summary" class="section level4">
<h4><span class="header-section-number">6.1.1.6</span> Summary</h4>
<p>In summary we say that for this scatter plot:</p>
<ul>
<li>The <em>glyphs</em> are points.
<ul>
<li>This time each glyph represents one and only one case.</li>
</ul></li>
<li>The <em>frame</em> is:
<ul>
<li>x = <code>fastest</code></li>
<li>y = <code>GPA</code></li>
</ul></li>
<li>Other <em>aesthetics</em> are:
<ul>
<li>color = <code>sex</code></li>
</ul></li>
<li>There are <em>scales</em> for the three aesthetic mappings above. (But we usually don’t say much about the x and y-location scales if they are linear, and we don’t make a big deal of the color scale unless we went to some trouble to choose it ourselves.)</li>
<li>The legend and the axis labels, tick marks and hash-lines are the <em>guides</em>.</li>
</ul>
</div>
</div>
<div id="example-two-bar-graphs" class="section level3">
<h3><span class="header-section-number">6.1.2</span> Example: Two Bar Graphs</h3>
<p>Bar graphs are useful in the study of categorical variables, especially factor variables that have only a few possible values. Figure @ref(fig:ggseatbargraph) shows the distribution of the factor variable <code>seat</code> in the <code>mat111survey</code> data frame.</p>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/ggseatbargraph-1.png" alt="Bar graph of seating preference.  The bars have a burlywood fill." width="95%" />
<p class="caption">
(#fig:ggseatbargraph)Bar graph of seating preference. The bars have a burlywood fill.
</p>
</div>
<p>In this graph:</p>
<ul>
<li>The <em>glyphs</em> are bars.
<ul>
<li>This time each glyph an entire group of cases: there is a bar for the students who prefer the front, a bar for the students who prefer the middle, and a bar for the back-sitters.</li>
</ul></li>
<li>The <em>frame</em> is:
<ul>
<li>x = <code>seat</code>. Note that it is possible for x-location to map to a categorical variable!</li>
<li>In this graph the y-location does not count as part of the frame, since it is not really an aesthetic. Instead the height of a bar along the y-axis tells us how many students are represented by that bar. In the Grammar of Graphics we say that the y-axis represents a <strong>statistic</strong>—a value computed from the data. In the situation at hand, our statistic is a simple tally of the cases for each value of <code>seat</code>.</li>
</ul></li>
<li>There are no other <em>aesthetics</em>! The glyphs have various perceptual properties such as a shape rectangular and color, but these don’t vary with the cases: the shape is always rectangular and the color is always burlywood.</li>
<li>There is a <em>scale</em> for the x-location, but there is nothing very interesting about it: the three values of <code>seat</code> are equally spaced along the axis.</li>
<li>There is a <em>guide</em> for the x-location: labels on the x-axis tell us which bar goes with which value of the variable <code>seat</code>.</li>
</ul>
<p>Bar graphs can also be used to study the relationship between two categorical variables. Figure @ref(fig:ggsexseat) shows the relationship between sex and seating preference in the <code>m111survey</code> data.</p>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/ggsexseat-1.png" alt="Seating preference, by sex." width="95%" />
<p class="caption">
(#fig:ggsexseat)Seating preference, by sex.
</p>
</div>
<p>Again the glyphs are bars and each bar represents many cases, but now there is a bar for each combination of the values of <code>sex</code> and <code>seat</code>. The frame is again specified only by the x-location, but this time it is mapped to <code>sex</code>. There is another aesthetic as well: the color (more technically, the <em>fill</em>) of the bars is mapped to the variable <code>seat</code>, allowing us to see the relationship between the two categorical variables <code>sex</code> and <code>seat</code>. Scales and guides work much the same way as in the previous example.</p>
</div>
<div id="examples-histograms-density-plots-and-box-plots" class="section level3">
<h3><span class="header-section-number">6.1.3</span> Examples: Histograms, Density Plots and Box Plots</h3>
<p>In this section we’ll examine some glyphs that are useful in the visualization of numerical variables.</p>
<div id="histograms" class="section level4">
<h4><span class="header-section-number">6.1.3.1</span> Histograms</h4>
<p>How are the fastest speeds driven distributed, for students in the <code>m111survey</code> data? In order to investigate such a question graphically, we might make a <em>histogram</em> like the one in Figure @ref(fig:ggfastesthistogram).</p>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/ggfastesthistogram-1.png" alt="Histogram of the fastest speed ever driven." width="95%" />
<p class="caption">
(#fig:ggfastesthistogram)Histogram of the fastest speed ever driven.
</p>
</div>
<p>In this graph:</p>
<ul>
<li>The <em>glyphs</em> are rectangles. Each rectangle represents cases where the value of <code>fastest</code> lies within a particular range covered by the bottom left and right corners of the rectangle.</li>
<li>The <em>frame</em> is:
<ul>
<li>x = <code>fastest</code>.</li>
<li>As with our bar graphs, the y-location does not count as part of the frame, but instead represents a statistic, permitting the height of a rectangle to indicate the number of cases that it represents.</li>
</ul></li>
<li>Again there are no other <em>aesthetics</em>. The burlywood fill of the rectangles is constant.</li>
<li>The <em>scale</em> for x-location, maps location to <code>fastest</code> in the familiar linear fashion, and the x-axis has the usual <em>guides</em> found for numerical variables.</li>
</ul>
<p>Figure @ref(fig:ggfastesthistogramrug) is a variant, containing a second type of glyph: each student is now represented along the X-axis by a rug-tick located approximately at his or her fastest speed. (The ticks are actually “jittered” randomly so as to avoid over-plotting when two or more students report the same speed.) The addition of a second set of glyphs is called <em>layerng</em>, and is a common device to enhance the communicative power of a graph.</p>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/ggfastesthistogramrug-1.png" alt="Histogram of the fastest speed ever driven." width="95%" />
<p class="caption">
(#fig:ggfastesthistogramrug)Histogram of the fastest speed ever driven.
</p>
</div>
</div>
<div id="graphics-density-plots" class="section level4">
<h4><span class="header-section-number">6.1.3.2</span> Density Plots</h4>
<p>One may also study the distribution of numerical variable with a <em>density plot</em>, as in Figure @ref(fig:ggdensityfastest). In this figure there is only one glyph, the curve itself, and it represents all of the cases. However, its height represents crowding (density) of values of <code>fastest</code> for the cases: when the curve is high, many values are crowded closely together on the x-axis, and for speeds where the curve is low the viewer knows that few (if any) students drive around that speed. The y-axis is again used along with a statistic: for density plots the vertical scale is chosen in such a way that the total area under the density curve is 1, so that the area under the curve between two given speeds is approximately equal to the proportion of students who had speeds within that range. For density plots a rug, provided again by slightly jittered ticks, is a useful additional layer to indicate crowding of values.</p>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/ggdensityfastest-1.png" alt="Density plot of the fastest speed ever driven." width="95%" />
<p class="caption">
(#fig:ggdensityfastest)Density plot of the fastest speed ever driven.
</p>
</div>
<p>Since they don’t take up much territory on a graph, density curves are especially useful when we want to study the relationship between a numerical and a categorical variable. For example, Figure @ref(fig:ggdensityfastestseat) shows density plots of the fastest speeds for each of the three possible seating preferences. The glyphs are again density curves, but since the color aesthetic has been mapped to <code>seat</code>, we get a separate and differently-colored glyphs, one for each seating-preference..</p>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/ggdensityfastestseat-1.png" alt="Density plot of the fastest speed ever driven." width="95%" />
<p class="caption">
(#fig:ggdensityfastestseat)Density plot of the fastest speed ever driven.
</p>
</div>
<p>Another approach to the same graphing problem is to use a type of glyph known as a <em>violin</em>. Look at Figure @ref(fig:ggviolinfastestseat).</p>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/ggviolinfastestseat-1.png" alt="Violin plot of the fastest speed ever driven." width="95%" />
<p class="caption">
(#fig:ggviolinfastestseat)Violin plot of the fastest speed ever driven.
</p>
</div>
<p>A violin glyph is simply two mirror-images of the same density plot, pasted together along their bases. Thus the violin is thick where many values are clustered together and thin where data values are rare. In this plot, the frame is constituted by mapping x-location to <code>seat</code> and y-location to the variable <code>fastest</code>. For additional communicative power we have layered another set of glyphs–jittered points, one for each case–onto the plot.</p>
<p>Suppose that one wished to incorporate a third variable, such as sex, into the graph? One possible way to to this is to divide the graphs into separate plots based on the values of one of the categorical variables in question. The separate plots are known as <em>facets</em>,  and are illustrated in Figure @ref(fig:ggviolinfastestseatsex), where facet-ing has been done on the basis of the variable <code>seat</code>.</p>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/ggviolinfastestseatsex-1.png" alt="Violin plots of the fastest speed ever driven, by sex and seating preference." width="95%" />
<p class="caption">
(#fig:ggviolinfastestseatsex)Violin plots of the fastest speed ever driven, by sex and seating preference.
</p>
</div>
</div>
<div id="box-plots" class="section level4">
<h4><span class="header-section-number">6.1.3.3</span> Box Plots</h4>
<p>The <em>five number</em> summary is a convenient way to summarize the distribution of a numerical variable. The five numbers involved are:</p>
<ul>
<li>the minimum value</li>
<li>the <em>first quartile</em> <span class="math inline">\(Q1\)</span>, the <span class="math inline">\(25^{\text{th}}\)</span> percentile of the values</li>
<li>the <em>median</em>, which is the <span class="math inline">\(50^{\text{th}}\)</span> percentile</li>
<li>the <em>third quartile</em> <span class="math inline">\(Q3\)</span>, the <span class="math inline">\(75^{\text{th}}\)</span> percentile</li>
<li>the maximum value</li>
</ul>
<p>Also of interest is the <em>interquartile range</em> <span class="math inline">\(IQR\)</span>, defined as:</p>
<p><span class="math display">\[IQR = Q3 - Q1.\]</span></p>
<p>The interquartile range covers measures the spread in the middle 50% of the values.</p>
<p>In R the five number summary can be got quickly with the <code>fivenum()</code> function:</p>
<div class="sourceCode" id="cb978"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb978-1" data-line-number="1">fnFastest &lt;-<span class="st"> </span><span class="kw">fivenum</span>(m111survey<span class="op">$</span>fastest)</a>
<a class="sourceLine" id="cb978-2" data-line-number="2"><span class="kw">names</span>(fnFastest) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;min&quot;</span>, <span class="st">&quot;Q1&quot;</span>, <span class="st">&quot;median&quot;</span>, <span class="st">&quot;Q3&quot;</span>, <span class="st">&quot;max&quot;</span>)</a>
<a class="sourceLine" id="cb978-3" data-line-number="3">fnFastest</a></code></pre></div>
<pre><code>##    min     Q1 median     Q3    max 
##   60.0   90.5  102.0  119.5  190.0</code></pre>
<p>A box-plot glyph is the graphical counterpart of the five number summary. Figure @ref(fig:ggboxplotsample) shows how it works for the variable <code>fastest</code> in the <code>m111survey</code> data frame. The box ranges from <span class="math inline">\(Q1\)</span> to <span class="math inline">\(Q3\)</span>, covering the middle half of the speeds. The lower hinge extends from <span class="math inline">\(Q1\)</span> down to the minimum speed. The upper hinge would have extended from <span class="math inline">\(Q3\)</span> to the maximum value, but the maximum value was flagged as an outlier. When <strong>ggplot2</strong> makes a box-plot, any point that is</p>
<ul>
<li>greater than <span class="math inline">\(Q3 + 1.5 \times IQR\)</span> or</li>
<li>less than <span class="math inline">\(Q1 - 1.5 \times IQR\)</span></li>
</ul>
<p>is flagged for individual plotting, and the corresponding hinge will be <span class="math inline">\(1.5 \times IQR\)</span> units long.</p>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/ggboxplotsample-1.png" alt="Illustration of a simple box plot." width="95%" />
<p class="caption">
(#fig:ggboxplotsample)Illustration of a simple box plot.
</p>
</div>
<p>A single box glyph on its own is not very interesting. Where box plots shine is in the study of the relationship between a numerical variable and a categorical with a large number of levels, as in Figure @ref(fig:utilitybills1). Here the glyphs are boxes, with each box being constructed from the bills that were issued in a particular month.</p>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/utilitybills1-1.png" alt="Utility bills through the year." width="95%" />
<p class="caption">
(#fig:utilitybills1)Utility bills through the year.
</p>
</div>
</div>
</div>
<div id="example-choropleth-maps" class="section level3">
<h3><span class="header-section-number">6.1.4</span> Example: Choropleth Maps</h3>
<p>The term “choropleth” derives from Greek and means “many regions.” A choropleth graph is a graph in which the frame is provided by some sort of map with regions that might be countries, cities or counties in the U.S. etc.</p>
<p>In the choropleth map shown in Figure @ref(fig:ggchoropleth), is based on a data frame in which ease case is a state in the U.S (along with the District of Columbia). One of the variables is <code>population</code>, the population of the state. The glyphs are the territories of each of the U.S. states. The frame is determined by mapping x and y-location to latitude and longitude. The aesthetic property <em>color</em> is mapped to the <code>population</code>, and a guide is provided to the right of the graph.</p>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/ggchoropleth-1.png" alt="Choropleth map of state populations in the U.S." width="95%" />
<p class="caption">
(#fig:ggchoropleth)Choropleth map of state populations in the U.S.
</p>
</div>
</div>
<div id="practice-exercises-16" class="section level3">
<h3><span class="header-section-number">6.1.5</span> Practice Exercises</h3>
<p>In each of the exercises below, consult the Help for the relevant data frame. (You’ll need to identify variables by their names in the data frame when you discuss aesthetic mappings.)</p>
<ol style="list-style-type: decimal">
<li><p>The following graph is based on the data frame <code>mosaicData::SwimRecords</code>:</p>
<img src="r-notes_files/figure-html/unnamed-chunk-770-1.png" width="95%" style="display: block; margin: auto;" />
<ul>
<li>What variables are used to make the frame?</li>
<li>What are the two types of glyphs?</li>
<li>What other aesthetic(s) are there (besides the x and y-locations in the frame)? To what variable(s) are they mapped?</li>
<li>What guides do you see?</li>
</ul></li>
<li><p>The following graph is based on the data frame <code>mosaicData::KidsFeet</code>:</p>
<img src="r-notes_files/figure-html/unnamed-chunk-771-1.png" width="95%" style="display: block; margin: auto;" />
<ul>
<li>What variable(s) are used to make the frame?</li>
<li>What are the two types of glyphs?</li>
<li>What other aesthetic(s) are there (besides the frame)? To what variable(s) are they mapped?</li>
<li>What guides do you see?</li>
</ul></li>
<li><p>The following graph is based on the data frame <code>mosaicData::Galton</code>:</p>
<img src="r-notes_files/figure-html/unnamed-chunk-772-1.png" width="95%" style="display: block; margin: auto;" />
<ul>
<li>What variable(s) are used to make the frame?</li>
<li>What are the two types of glyphs?</li>
<li>What other aesthetic(s) are there (besides the frame)? To what variable(s) are they mapped?</li>
<li>What guides do you see?</li>
</ul></li>
</ol>
</div>
<div id="solutions-to-practice-exercises-12" class="section level3">
<h3><span class="header-section-number">6.1.6</span> Solutions to Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Answers:</p>
<ul>
<li>Frame: x -&gt; <code>year</code>, y -&gt; <code>time</code>;</li>
<li>Glyphs: points and line-segments between pairs of points;</li>
<li>Other aesthetics: point-color and line-color are both mapped to <code>sex</code>;</li>
<li>Guides: legend for <code>sex</code>, axis labels and ticks for <code>year</code> and <code>time</code>.</li>
</ul></li>
<li><p>Answers:</p>
<ul>
<li>Frame: x -&gt; <code>biggerfoot</code>;</li>
<li>Glyphs: bars;</li>
<li>Other aesthetics: bar fill -&gt; <code>sex</code>;</li>
<li>Guides: legend for <code>sex</code>, axis labels and ticks for <code>biggerfoot</code>.</li>
</ul></li>
<li><p>Answers:</p>
<ul>
<li>Frame: x -&gt; <code>father</code>;</li>
<li>Glyphs: density curve, jittered rug-ticks;</li>
<li>Other aesthetics: none;</li>
<li>Guides: axis labels and ticks for <code>father</code>.</li>
</ul></li>
</ol>
</div>
</div>
<div id="implementation-in-ggplot2" class="section level2">
<h2><span class="header-section-number">6.2</span> Implementation in <strong>ggplot2</strong></h2>
<p>In its syntax, the <strong>ggplot2</strong> package attempts to follow the Grammar of Graphics fairly closely. Let’s see how this works by building up, in step-by-step fashion, to our initial graph example—the scatter plot in Figure @ref(fig:ggfastestgpasex).</p>
<div id="basic-setup-the-data-frame" class="section level3">
<h3><span class="header-section-number">6.2.1</span> Basic Setup: the Data Frame</h3>
<p>Construction of a graph in <strong>ggplot2</strong> begins with the <code>ggplot()</code> function. The first parameter of the function is <code>data</code>, the value of which will be the data frame on which we plan to build the graph.</p>
<p>It is possible call <code>ggplot()</code> with just the data, and indeed it is instructive to do so. The result is seen in Figure @ref(fig:impblank): it is simply a blank window.</p>
<div class="sourceCode" id="cb980"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb980-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> m111survey)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/impblank-1.png" alt="A completely blank plot!" width="95%" />
<p class="caption">
(#fig:impblank)A completely blank plot!
</p>
</div>
</div>
<div id="more-setup-establishing-the-frame" class="section level3">
<h3><span class="header-section-number">6.2.2</span> More Setup: Establishing the Frame</h3>
<p><code>ggplot()</code> has a second parameter, the parameter <code>mapping</code>. Usually it is assigned the result of a call to the <strong>ggplot</strong> function <code>aes()</code>, which is used to establish aesthetic mappings. The common procedure is to use this first call to <code>aes()</code> to establish the frame: later calls will map other aesthetics properties to other variables, as desired.</p>
<p>If we want to work toward Figure @ref(fig:ggfastestgpasex), we will have to map x-location to <code>fastest</code> and y-location to <code>GPA</code>. This is accomplished by the following code:</p>
<div class="sourceCode" id="cb981"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb981-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> m111survey,</a>
<a class="sourceLine" id="cb981-2" data-line-number="2">       <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> fastest, <span class="dt">y =</span> GPA))</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/impframe1-1.png" alt="Just the frame:  no glyphs yet!" width="95%" />
<p class="caption">
(#fig:impframe1)Just the frame: no glyphs yet!
</p>
</div>
<p>The result appears as Figure @ref(fig:impframe1). A frame has been established, along with guides to <strong>ggplot2</strong>’s default choice of linear scales for the mappings to <code>fastest</code> and to <code>GPA</code>.</p>
<p>It is worth noting that most programmers do not bother to name the <code>data</code> and <code>mapping</code> parameters. Figure @ref(fig:impframe1) could just as well have been produced as follows:</p>
<div class="sourceCode" id="cb982"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb982-1" data-line-number="1"><span class="kw">ggplot</span>(m111survey, <span class="kw">aes</span>(<span class="dt">x =</span> fastest, <span class="dt">y =</span> GPA))</a></code></pre></div>
<p>In the future we will also drop these parameter names.</p>
</div>
<div id="labels" class="section level3">
<h3><span class="header-section-number">6.2.3</span> Labels</h3>
<p>At any point we can add labels to our plot. If you are simply exploring data you don’t need labels, but if you are writing up the final version of a report you will want to give careful consideration to labeling axes and to providing a good title (or—if you are able to to do so—a good caption). The following code adds labels for the x and y axes, a title—and even a subtitle, although subtitles are somewhat rare in practice.</p>
<div class="sourceCode" id="cb983"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb983-1" data-line-number="1"><span class="kw">ggplot</span>(m111survey, <span class="kw">aes</span>(<span class="dt">x =</span> fastest, <span class="dt">y =</span> GPA)) <span class="op">+</span></a>
<a class="sourceLine" id="cb983-2" data-line-number="2"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;fastest speed ever driven (mph)&quot;</span>,</a>
<a class="sourceLine" id="cb983-3" data-line-number="3">       <span class="dt">y =</span> <span class="st">&quot;grade point average&quot;</span>,</a>
<a class="sourceLine" id="cb983-4" data-line-number="4">       <span class="dt">title =</span> <span class="st">&quot;Dunno what to say, yet!&quot;</span>,</a>
<a class="sourceLine" id="cb983-5" data-line-number="5">       <span class="dt">subtitle =</span> <span class="kw">paste0</span>(<span class="st">&#39;A title should briefly indicate the main&#39;</span>,</a>
<a class="sourceLine" id="cb983-6" data-line-number="6">                         <span class="st">&#39; lesson the plot has for us.  Instead of:&#39;</span>,</a>
<a class="sourceLine" id="cb983-7" data-line-number="7">                         <span class="st">&#39; &quot;Scatterplot of</span><span class="ch">\n</span><span class="st">GPA vs. fastest speed&quot;,&#39;</span>,</a>
<a class="sourceLine" id="cb983-8" data-line-number="8">                         <span class="st">&#39; say something like: &quot;Speed and GPA are&#39;</span>,</a>
<a class="sourceLine" id="cb983-9" data-line-number="9">                         <span class="st">&#39; not strongly related.&quot;&#39;</span>))</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/impframe2-1.png" alt="You can always add some labels!" width="95%" />
<p class="caption">
(#fig:impframe2)You can always add some labels!
</p>
</div>
</div>
<div id="adding-a-type-of-glyph" class="section level3">
<h3><span class="header-section-number">6.2.4</span> Adding a Type of Glyph</h3>
<p>It is high time now to make some data appear on our plot, so let’s add some glyphs. In <strong>ggplot2</strong> syntax glyphs are added with functions whose names are of the form:</p>
<blockquote>
<p><code>geom_gylphType()</code></p>
</blockquote>
<p>Thus we have such things as:</p>
<ul>
<li><code>geom_point()</code> for points;</li>
<li><code>geom_line()</code> for line segments between points;</li>
<li><code>geom_bar()</code> for the bars of a bar graph;</li>
<li><code>geom_histogram()</code> for the rectangles that make up a histogram;</li>
<li><code>geom_density()</code> for the curve of a density plot;</li>
<li><code>geom_violin()</code> for the violins of a violin plot;</li>
<li><code>geom_jitter()</code> for jittered points representing individual cases;</li>
<li><code>geom_rug()</code> for rug-ticks representing individual cases;</li>
<li>and a number of other <code>geom</code>’s!</li>
</ul>
<div id="our-first-geoms" class="section level4">
<h4><span class="header-section-number">6.2.4.1</span> Our First Geoms</h4>
<p>Let’s add some points to the plot with the following code. The result appears as Figure @ref(fig:impfastestGPA). We are now quite close to the target plot.</p>
<div class="sourceCode" id="cb984"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb984-1" data-line-number="1"><span class="kw">ggplot</span>(m111survey, <span class="kw">aes</span>(<span class="dt">x =</span> fastest, <span class="dt">y =</span> GPA)) <span class="op">+</span></a>
<a class="sourceLine" id="cb984-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb984-3" data-line-number="3"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;fastest speed ever driven (mph)&quot;</span>,</a>
<a class="sourceLine" id="cb984-4" data-line-number="4">       <span class="dt">y =</span> <span class="st">&quot;grade point average&quot;</span>,</a>
<a class="sourceLine" id="cb984-5" data-line-number="5">       <span class="dt">title =</span> <span class="st">&quot;Speed and GPA are not strongly related.&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/impfastestGPA-1.png" alt="Finally:  the data appears!" width="95%" />
<p class="caption">
(#fig:impfastestGPA)Finally: the data appears!
</p>
</div>
</div>
<div id="further-aesthetic-mappings" class="section level4">
<h4><span class="header-section-number">6.2.4.2</span> Further Aesthetic Mappings</h4>
<p>The final step in our first example is to map the <em>color</em> property of points to the variable <code>sex</code>. We do so by a call to <code>aes()</code>. Conventionally a mapping for a glyph is accomplished inside the <code>geom</code>-function that creates the glyph, as in the code below that creates figure @ref(fig:imptargetscatterplot), our target plot:</p>
<div class="sourceCode" id="cb985"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb985-1" data-line-number="1"><span class="kw">ggplot</span>(m111survey, <span class="kw">aes</span>(<span class="dt">x =</span> fastest, <span class="dt">y =</span> GPA)) <span class="op">+</span></a>
<a class="sourceLine" id="cb985-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> sex)) <span class="op">+</span></a>
<a class="sourceLine" id="cb985-3" data-line-number="3"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;fastest speed ever driven (mph)&quot;</span>,</a>
<a class="sourceLine" id="cb985-4" data-line-number="4">       <span class="dt">y =</span> <span class="st">&quot;grade point average&quot;</span>,</a>
<a class="sourceLine" id="cb985-5" data-line-number="5">       <span class="dt">title =</span> <span class="st">&quot;Speed and GPA are not strongly related.&quot;</span>,</a>
<a class="sourceLine" id="cb985-6" data-line-number="6">       <span class="dt">subtitle =</span> <span class="st">&quot;(But guys tend to drive faster, and to have lower GPAs.)&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/imptargetscatterplot-1.png" alt="This is the target plot!" width="95%" />
<p class="caption">
(#fig:imptargetscatterplot)This is the target plot!
</p>
</div>
<p>Points have other perceptual properties in besides their color. <em>Shape</em> is such a property. (From the point of view of the Grammar of Graphics, a point in itself is only an abstract location in space. Only when it assumes all of its perceptual properties does it actually “appear”, and when it does appear its shape may be other than circular, just as its color may be other than, for instance, black.) Thus alternative way to incorporate sex into the graph would have been to map shape to <code>sex</code>,as in the following code that results in Figure @ref(fig:impscatterplotshape):</p>
<div class="sourceCode" id="cb986"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb986-1" data-line-number="1"><span class="kw">ggplot</span>(m111survey, <span class="kw">aes</span>(<span class="dt">x =</span> fastest, <span class="dt">y =</span> GPA)) <span class="op">+</span></a>
<a class="sourceLine" id="cb986-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">shape =</span> sex)) <span class="op">+</span></a>
<a class="sourceLine" id="cb986-3" data-line-number="3"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;fastest speed ever driven (mph)&quot;</span>,</a>
<a class="sourceLine" id="cb986-4" data-line-number="4">       <span class="dt">y =</span> <span class="st">&quot;grade point average&quot;</span>,</a>
<a class="sourceLine" id="cb986-5" data-line-number="5">       <span class="dt">title =</span> <span class="st">&quot;Speed and GPA are not strongly related.&quot;</span>,</a>
<a class="sourceLine" id="cb986-6" data-line-number="6">       <span class="dt">subtitle =</span> <span class="st">&quot;(But guys tend to drive faster, and to have lower GPAs.)&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/impscatterplotshape-1.png" alt="Mapping shape to the variable sex." width="95%" />
<p class="caption">
(#fig:impscatterplotshape)Mapping shape to the variable sex.
</p>
</div>
<p>Passing now from our scatter plot example, we consider how to achieve another of the plots studied in the previous section, namely Figure @ref(fig:ggsexseat). Following the same logic of calls to <code>ggplot()</code> and a <code>geom</code>-function, we see that the bar graph on sex and seating preference can be obtained by mapping the <em>fill</em> property of bars to <code>seat</code> as seen in the following code (results shown again as Figure `@ref(fig:impsexseat))</p>
<div class="sourceCode" id="cb987"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb987-1" data-line-number="1"><span class="kw">ggplot</span>(m111survey, <span class="kw">aes</span>(<span class="dt">x =</span> sex)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb987-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> seat)) <span class="op">+</span></a>
<a class="sourceLine" id="cb987-3" data-line-number="3"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Sex&quot;</span>,</a>
<a class="sourceLine" id="cb987-4" data-line-number="4">       <span class="dt">title =</span> <span class="st">&quot;Males are more likely to prefer the Back!&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/impsexseat-1.png" alt="Seating preference, by sex." width="95%" />
<p class="caption">
(#fig:impsexseat)Seating preference, by sex.
</p>
</div>
<p>Some people don’t like the glyphs “stacked” in bar graphs. In order to mollify them we can set <code>position</code> to “dodge”, as in the code below. The results appear in Figure @ref(fig:impsexseat2).</p>
<div class="sourceCode" id="cb988"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb988-1" data-line-number="1"><span class="kw">ggplot</span>(m111survey, <span class="kw">aes</span>(<span class="dt">x =</span> sex)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb988-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> seat), <span class="dt">position =</span><span class="st">&quot;dodge&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/impsexseat2-1.png" alt="Seating preference, by sex---no stacking of bars.." width="95%" />
<p class="caption">
(#fig:impsexseat2)Seating preference, by sex—no stacking of bars..
</p>
</div>
<p>Note that <em>position</em> is not an aesthetic property: all of the bar dodge each other. Dodginess is not something that varies from glyph to glyph according to values in the data.</p>
</div>
<div id="aesthetic-mappings-vs.fixed-properties" class="section level4">
<h4><span class="header-section-number">6.2.4.3</span> Aesthetic Mappings vs. Fixed Properties</h4>
<p>It is wise to dwell a bit on the distinction between aesthetic mappings on the one and hand and fixed properties of glyphs on the other hand.</p>
<p>The key is this:</p>
<ul>
<li>An aesthetic mapping are always accomplished as an argument in a call to <code>aes()</code>. In this argument, the aesthetic property is the parameter name, and a variable is assigned to it, thus:
<ul>
<li><code>geom_bar(aes(fill = seat))</code></li>
<li><code>geom_point(aes(color = sex))</code></li>
</ul></li>
<li><p>A fixed property is determined by an argument to a <code>geom</code>-function call. The property to be fixed is the name of the parameter, and its constant value is the value supplied, thus:</p>
<table>
<thead>
<tr class="header">
<th align="left">Code</th>
<th align="left">Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>geom_point(color = &quot;blue&quot;)</code></td>
<td align="left">all the points are blue</td>
</tr>
<tr class="even">
<td align="left"><code>geom_point(shape = 22)</code></td>
<td align="left">all points are solid squares</td>
</tr>
<tr class="odd">
<td align="left"><code>geom_point(size = 3)</code></td>
<td align="left">all points are bigger than default size(1)</td>
</tr>
<tr class="even">
<td align="left"><code>geom_bar(fill = &quot;burlywood&quot;)</code></td>
<td align="left">all bars have the burlywood fill-color</td>
</tr>
</tbody>
</table></li>
</ul>
<p>As an example, let’s code up the density plot of fastest speeds that occurred in Figure @ref(fig:ggfastesthistogram). The code is shown below and appears as @ref(fig:impfastesthistogram)</p>
<div class="sourceCode" id="cb989"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb989-1" data-line-number="1"><span class="kw">ggplot</span>(m111survey, <span class="kw">aes</span>(<span class="dt">x =</span> fastest)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb989-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">fill =</span> <span class="st">&quot;burlywood&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb989-3" data-line-number="3"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Fastest speed ever driven (mph)&quot;</span>,</a>
<a class="sourceLine" id="cb989-4" data-line-number="4">             <span class="dt">title =</span> <span class="st">&quot;For most students the fastest speed is around 100 mph&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/impfastesthistogram-1.png" alt="Histogram of the fastest speed ever driven.  The fill-property of the curve is fixed to the ever-popular 'burlywood' color." width="95%" />
<p class="caption">
(#fig:impfastesthistogram)Histogram of the fastest speed ever driven. The fill-property of the curve is fixed to the ever-popular ‘burlywood’ color.
</p>
</div>
</div>
<div id="adjusting-scales" class="section level4">
<h4><span class="header-section-number">6.2.4.4</span> Adjusting Scales</h4>
<p>When we spoke of aesthetic mapping, we stressed that any mapping implies a specific choice of scale, i.e, choices about which values of the property go with which values of the variable to which the property is being mapped. <strong>ggplot2</strong> tries to provide a sensible default scale for any mapping, but if we don’t like its choice then we can change it ourselves through a host of functions with names like these:</p>
<ul>
<li><code>scale_color_manual()</code></li>
<li><code>scale_shape_manual()</code></li>
<li><code>scale_fill_manual()</code></li>
<li><code>scale_size_manual()</code></li>
<li><code>scale_x_continuous()</code> (for setting the scale in the mapping of x-location to a numerical variable)</li>
<li><code>scale_x_discrete()</code> (for setting the scale in the mapping of y-location to a categorical variable)</li>
<li>and many others!</li>
</ul>
<p>Here is one simple example of setting our own scales. The code below produces Figure @ref(fig:impscalemanual), where we have set that “female” should go with pink and “male” with red.</p>
<div class="sourceCode" id="cb990"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb990-1" data-line-number="1"><span class="kw">ggplot</span>(m111survey, <span class="kw">aes</span>(<span class="dt">x =</span> fastest, <span class="dt">y =</span> GPA)) <span class="op">+</span></a>
<a class="sourceLine" id="cb990-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> sex)) <span class="op">+</span></a>
<a class="sourceLine" id="cb990-3" data-line-number="3"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;pink&quot;</span>, <span class="st">&quot;red&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb990-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;fastest speed ever driven (mph)&quot;</span>,</a>
<a class="sourceLine" id="cb990-5" data-line-number="5">       <span class="dt">y =</span> <span class="st">&quot;grade point average&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/impscalemanual-1.png" alt="Color scale adjusted manually." width="95%" />
<p class="caption">
(#fig:impscalemanual)Color scale adjusted manually.
</p>
</div>
</div>
</div>
<div id="layering-adding-another-glyph-type" class="section level3">
<h3><span class="header-section-number">6.2.5</span> Layering: Adding Another Glyph Type</h3>
<p>If you want to add another layer of glyphs, simply add on another call to a <code>geom</code>-function. In order to produce Figure @ref(fig:impviolinfastestseat), for example, we use the code below:</p>
<div class="sourceCode" id="cb991"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb991-1" data-line-number="1"><span class="kw">ggplot</span>(m111survey, <span class="kw">aes</span>(<span class="dt">x =</span> seat, <span class="dt">y =</span> fastest)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb991-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_violin</span>(<span class="dt">fill =</span> <span class="st">&quot;burlywood&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb991-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">width =</span> <span class="fl">0.2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb991-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Seating preference&quot;</span>,</a>
<a class="sourceLine" id="cb991-5" data-line-number="5">       <span class="dt">y =</span> <span class="st">&quot;Fastest speed ever driven (mph)&quot;</span>,</a>
<a class="sourceLine" id="cb991-6" data-line-number="6">             <span class="dt">title =</span> <span class="st">&quot;There aren&#39;t so many back-sitters.&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/impviolinfastestseat-1.png" alt="Violin plot of the fastest speed ever driven." width="95%" />
<p class="caption">
(#fig:impviolinfastestseat)Violin plot of the fastest speed ever driven.
</p>
</div>
<p>Note that the <code>width</code> parameter in the call to <code>geom_jitter()</code> determines how much the points are allowed to jitter horizontally.</p>
<div id="jitter-it-yourself-jiy" class="section level4">
<h4><span class="header-section-number">6.2.5.1</span> Jitter-It-Yourself (JIY)</h4>
<p>“Rug” glyphs are excellent, in especially in conjunction with density curves, but they have a downside. Consider, for example Figure @ref(fig:densityfastestbadrug) produced by the code below. When you examine the plot you will see that there aren’t as many rug-ticks as there are students in the <code>m111survey</code> data. Many students reported driving at the same speed, so their rug-ticks plotted over each other.</p>
<div class="sourceCode" id="cb992"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb992-1" data-line-number="1"><span class="kw">ggplot</span>(m111survey, <span class="kw">aes</span>(<span class="dt">x =</span> fastest)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb992-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&quot;burlywood&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb992-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_rug</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb992-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Fastest speed ever driven (mph)&quot;</span>,</a>
<a class="sourceLine" id="cb992-5" data-line-number="5">             <span class="dt">title =</span> <span class="st">&quot;For most students the fastest speed is around 100 mph&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/densityfastestbadrug-1.png" alt="Density plot of the fastest speed ever driven.  Some rug glyphs overplot each other." width="95%" />
<p class="caption">
(#fig:densityfastestbadrug)Density plot of the fastest speed ever driven. Some rug glyphs overplot each other.
</p>
</div>
<p>It would be nice to solve the problem by jittering the rug-ticks, but unfortunately rug-ticks don’t jitter nicely on their own. One reasonable workaround is to create one’s own randomly-jittered speeds and map the x-location of the rug-ticks to the new variable that holds the jittered values. The code below shows implements this idea, and results in Figure @ref(fig:impdensityfastest).</p>
<div class="sourceCode" id="cb993"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb993-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="kw">nrow</span>(m111survey)</a>
<a class="sourceLine" id="cb993-2" data-line-number="2">m111survey<span class="op">$</span>jitteredSpeeds &lt;-<span class="st"> </span>m111survey<span class="op">$</span>fastest <span class="op">+</span><span class="st"> </span><span class="kw">runif</span>(n, <span class="dv">-1</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb993-3" data-line-number="3"><span class="kw">ggplot</span>(m111survey, <span class="kw">aes</span>(<span class="dt">x =</span> fastest)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb993-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&quot;burlywood&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb993-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_rug</span>(<span class="kw">aes</span>(<span class="dt">x =</span> jitteredSpeeds)) <span class="op">+</span></a>
<a class="sourceLine" id="cb993-6" data-line-number="6"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Fastest speed ever driven (mph)&quot;</span>,</a>
<a class="sourceLine" id="cb993-7" data-line-number="7">             <span class="dt">title =</span> <span class="st">&quot;For most students the fastest speed is around 100 mph&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/impdensityfastest-1.png" alt="Density plot of the fastest speed ever driven.  Rug glyphs are jittered." width="95%" />
<p class="caption">
(#fig:impdensityfastest)Density plot of the fastest speed ever driven. Rug glyphs are jittered.
</p>
</div>
</div>
</div>
<div id="facets" class="section level3">
<h3><span class="header-section-number">6.2.6</span> Facets</h3>
<p>As you will recall, a graph has facets when it is sub-divided into plots with one plot for each of the values of a categorical variable. <strong>ggplot2</strong> has two functions to manage facet-ing:</p>
<ul>
<li><code>facet_grid()</code></li>
<li><code>facet_wrap()</code></li>
</ul>
<p>We’ll examine both of these functions in the context of some data frames from the <strong>mosaicData</strong> package, so you want to make sure to attach it to your search path:</p>
<div class="sourceCode" id="cb994"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb994-1" data-line-number="1"><span class="kw">library</span>(mosaicData)</a></code></pre></div>
<div id="facet_grid" class="section level4">
<h4><span class="header-section-number">6.2.6.1</span> <code>facet_grid()</code></h4>
<p>The data frame <code>mosaicData::RailTrail</code> has information on usage of a converted railroad trail every day from April 5 to November 15, 2005. Study the Help file:</p>
<div class="sourceCode" id="cb995"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb995-1" data-line-number="1"><span class="kw">help</span>(RailTrail)</a></code></pre></div>
<p>Every row in the data frame represents a particular day between April 5 and November 15. Our goal is to study how the season (Spring, summer or Fall) and the time of week (weekday Mon-Fri vs. weekend Sat-Sun) relate to <code>volume</code> the number of people who use the trail on a given day.</p>
<p>Inforomation about the season in which the day occurs is spread over the three 0-1 numerical variables <code>spring</code>, <code>summer</code> and <code>fall</code>. We propose to construct a single factor variable <code>season</code> variable from these three variables, as follows:</p>
<div class="sourceCode" id="cb996"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb996-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="kw">nrow</span>(RailTrail)</a>
<a class="sourceLine" id="cb996-2" data-line-number="2">season &lt;-<span class="st"> </span><span class="kw">character</span>(n)</a>
<a class="sourceLine" id="cb996-3" data-line-number="3"><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n ) {</a>
<a class="sourceLine" id="cb996-4" data-line-number="4">  <span class="cf">if</span> ( RailTrail<span class="op">$</span>spring[i] ) {</a>
<a class="sourceLine" id="cb996-5" data-line-number="5">    season[i] &lt;-<span class="st"> &quot;spring&quot;</span></a>
<a class="sourceLine" id="cb996-6" data-line-number="6">  } <span class="cf">else</span> <span class="cf">if</span> ( RailTrail<span class="op">$</span>summer[i] ) {</a>
<a class="sourceLine" id="cb996-7" data-line-number="7">    season[i] &lt;-<span class="st"> &quot;summer&quot;</span></a>
<a class="sourceLine" id="cb996-8" data-line-number="8">  } <span class="cf">else</span> <span class="cf">if</span> ( RailTrail<span class="op">$</span>fall[i] ) {</a>
<a class="sourceLine" id="cb996-9" data-line-number="9">    season[i] &lt;-<span class="st"> &quot;fall&quot;</span></a>
<a class="sourceLine" id="cb996-10" data-line-number="10">  }</a>
<a class="sourceLine" id="cb996-11" data-line-number="11">}</a>
<a class="sourceLine" id="cb996-12" data-line-number="12">RailTrail<span class="op">$</span>season &lt;-<span class="st"> </span><span class="kw">factor</span>(season,</a>
<a class="sourceLine" id="cb996-13" data-line-number="13">                           <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;spring&quot;</span>, <span class="st">&quot;summer&quot;</span>, <span class="st">&quot;fall&quot;</span>))</a></code></pre></div>
<p>We’ll also make a variant of the “0”-“1” character-based variable <code>weekday</code> that has more informative values:</p>
<div class="sourceCode" id="cb997"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb997-1" data-line-number="1">RailTrail<span class="op">$</span>wkday &lt;-<span class="st"> </span><span class="kw">ifelse</span>(RailTrail<span class="op">$</span>weekday <span class="op">==</span><span class="st"> &quot;1&quot;</span>, </a>
<a class="sourceLine" id="cb997-2" data-line-number="2">                            <span class="st">&quot;Mon-Fri&quot;</span>, <span class="st">&quot;Sat-Sun&quot;</span>)</a></code></pre></div>
<p>We are now ready make our graph. One possibility is to make a separate density plot of <code>volume</code> for each of the six possible combinations of values of the <code>season</code> and <code>wkday</code> variables. With <code>facet_grid()</code> we can arrange the plots in a grid so that the value of <code>season</code> is constant along rows and the value of <code>wkday</code> is constant along columns. This is accomplished by the following code, and the result appears as Figure @ref(fig:impfacetgrid).</p>
<div class="sourceCode" id="cb998"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb998-1" data-line-number="1"><span class="kw">ggplot</span>(RailTrail, <span class="kw">aes</span>(<span class="dt">x =</span> volume)) <span class="op">+</span></a>
<a class="sourceLine" id="cb998-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&quot;burlywood&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb998-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_grid</span>(season <span class="op">~</span><span class="st"> </span>wkday)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/impfacetgrid-1.png" alt="Volume of daily trail usage, by seaon and time of week." width="95%" />
<p class="caption">
(#fig:impfacetgrid)Volume of daily trail usage, by seaon and time of week.
</p>
</div>
<p>Of course our aim is to see how volume varies with season and time of week, but the horizontal orientation of the <code>volume</code> variable in the above graph makes comparison difficult for most human viewers. Perhaps facet-ing in two dimensions was a bit too much, in this situation. In the code below, we produce a one-row, three-column layout in which each facet corresponds to one of the three seasons.<a href="#fn15" class="footnote-ref" id="fnref15"><sup>15</sup></a> Within each facet, the days are broken down by time of week and volumes are compared with boxplots. The result is seen in Figure @ref(fig:impfacetgrid2). In the effort to incorporate the factor variables <code>season</code> and <code>wkday</code> into the graph, this second approach appears to strike a good balance between facet-ing and aesthetic mapping.</p>
<div class="sourceCode" id="cb999"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb999-1" data-line-number="1"><span class="kw">ggplot</span>(RailTrail, <span class="kw">aes</span>(<span class="dt">x =</span> wkday, <span class="dt">y =</span> volume)) <span class="op">+</span></a>
<a class="sourceLine" id="cb999-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> wkday)) <span class="op">+</span></a>
<a class="sourceLine" id="cb999-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_grid</span>( . <span class="op">~</span><span class="st"> </span>season) <span class="op">+</span></a>
<a class="sourceLine" id="cb999-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Time of Week&quot;</span>,</a>
<a class="sourceLine" id="cb999-5" data-line-number="5">       <span class="dt">fill =</span> <span class="st">&quot;Time of Week&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb999-6" data-line-number="6"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;top&quot;</span>, <span class="dt">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/impfacetgrid2-1.png" alt="Striking a good balance between facet-ing and aesthetic mapping." width="95%" />
<p class="caption">
(#fig:impfacetgrid2)Striking a good balance between facet-ing and aesthetic mapping.
</p>
</div>
</div>
<div id="facet_wrap" class="section level4">
<h4><span class="header-section-number">6.2.6.2</span> <code>facet_wrap()</code></h4>
<p>Frequently it happens that one desires to facet by a single categorical variable, and the number of levels of a factor variable is too large for the entire graph to be displayed well along a single row or a single column. In that event, use <code>facet_wrap()</code>.</p>
<p>Consider, for example, the data frame <code>mosaicData::CPS85</code>, and suppose that we want to compare the ages of workers in the eight different sectors of employment. Eight is a rather large number of plots, so we facet in “wrap-style” by means of the code below. The resulting plot appears as Figure @ref(fig:impfacetwrap).</p>
<div class="sourceCode" id="cb1000"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1000-1" data-line-number="1"><span class="kw">ggplot</span>(CPS85, <span class="kw">aes</span>(<span class="dt">x =</span> age)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1000-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&quot;burlywood&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1000-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>sector, <span class="dt">nrow =</span> <span class="dv">3</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/impfacetwrap-1.png" alt="Age by sector." width="95%" />
<p class="caption">
(#fig:impfacetwrap)Age by sector.
</p>
</div>
<p>Once again, though, it may be wise to consider an approach that involves aesthetic mapping. When the number of levels is large, violin plots or boxplots may better approaches for representing a numerical variable such as <code>age</code>, as in the code below. The resulting graph is shown in Figure @ref(fig:impbetterapproach).</p>
<div class="sourceCode" id="cb1001"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1001-1" data-line-number="1"><span class="kw">ggplot</span>(CPS85, <span class="kw">aes</span>(<span class="dt">x =</span> sector, <span class="dt">y =</span> age)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1001-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">fill =</span> <span class="st">&quot;burlywood&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/impbetterapproach-1.png" alt="Aesthetic mapping is probably superior to facetting in this case." width="95%" />
<p class="caption">
(#fig:impbetterapproach)Aesthetic mapping is probably superior to facetting in this case.
</p>
</div>
<p>In the exercises of this Chapter we will meet a case in which “wrap-style” facet-ing is quite useful.</p>
</div>
</div>
<div id="practice-exercises-17" class="section level3">
<h3><span class="header-section-number">6.2.7</span> Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>With <code>mosaicData::SwimRecords</code>, make the following graph:</p>
<img src="r-notes_files/figure-html/unnamed-chunk-778-1.png" width="95%" style="display: block; margin: auto;" /></li>
<li><p>With <code>mosaicData::KidsFeet</code>, make the following graph:</p>
<img src="r-notes_files/figure-html/unnamed-chunk-779-1.png" width="95%" style="display: block; margin: auto;" /></li>
<li><p>With <code>mosaicData::TenMileRace</code>, make the following graph:</p>
<p><img src="r-notes_files/figure-html/unnamed-chunk-780-1.png" width="95%" style="display: block; margin: auto;" />
<strong>Hint:</strong> Make the call <code>geom_point(alpha = 0.2)</code>. The <code>alpha</code> parameter has a default-value of 1. The lower you set it, the more “transparent” the points are. Low values for <code>alpha</code> are helpful to deal with the effects of “over-plotting” when many points are crowded together.</p></li>
<li><p>With <code>mosaicData::Gestation</code> make the following graph. The fill for the boxes is set to <code>&quot;burlywood&quot;</code>. The x-location is mapped to <code>factor(smoke)</code>, rather than to <code>smoke</code>.</p>
<p><img src="r-notes_files/figure-html/unnamed-chunk-781-1.png" width="95%" style="display: block; margin: auto;" /></p></li>
<li><p>With <code>mosaicData::Galton</code>, make the following graph:</p>
<p><img src="r-notes_files/figure-html/unnamed-chunk-782-1.png" width="95%" style="display: block; margin: auto;" />
<strong>Hint</strong>: The fill of the density plot is set to <code>&quot;burlywood&quot;</code>. The rug is made of randomly jittered father-heights.</p></li>
</ol>
</div>
<div id="solutions-to-practice-exercises-13" class="section level3">
<h3><span class="header-section-number">6.2.8</span> Solutions to Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>The call was:</p>
<div class="sourceCode" id="cb1002"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1002-1" data-line-number="1"><span class="kw">ggplot</span>(mosaicData<span class="op">::</span>SwimRecords, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> time)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1002-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> sex)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1002-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> sex)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1002-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;year record was set&quot;</span>,</a>
<a class="sourceLine" id="cb1002-5" data-line-number="5">       <span class="dt">y =</span> <span class="st">&quot;time (seconds)&quot;</span>,</a>
<a class="sourceLine" id="cb1002-6" data-line-number="6">       <span class="dt">title =</span> <span class="st">&quot;100m record times have decreased, for both sexes.&quot;</span>)</a></code></pre></div></li>
<li><p>The call was:</p>
<div class="sourceCode" id="cb1003"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1003-1" data-line-number="1"><span class="kw">ggplot</span>(mosaicData<span class="op">::</span>KidsFeet, <span class="kw">aes</span>(<span class="dt">x =</span> biggerfoot)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1003-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> domhand), <span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1003-3" data-line-number="3"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;the bigger foot&quot;</span>,</a>
<a class="sourceLine" id="cb1003-4" data-line-number="4">       <span class="dt">title =</span> <span class="st">&quot;Foot-size and Handedness for 39 Children&quot;</span>,</a>
<a class="sourceLine" id="cb1003-5" data-line-number="5">       <span class="dt">subtitle =</span> <span class="kw">paste0</span>(<span class="st">&quot;When your right foot is bigger, &quot;</span>,</a>
<a class="sourceLine" id="cb1003-6" data-line-number="6">                         <span class="st">&quot;are you more likely to be right-handed?&quot;</span>))</a></code></pre></div></li>
<li><p>The call was:</p>
<div class="sourceCode" id="cb1004"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1004-1" data-line-number="1"><span class="kw">ggplot</span>(mosaicData<span class="op">::</span>TenMileRace, <span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">y =</span> time)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1004-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1004-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>sex) <span class="op">+</span></a>
<a class="sourceLine" id="cb1004-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;age in years&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;net time to finish (sec)&quot;</span>,</a>
<a class="sourceLine" id="cb1004-5" data-line-number="5">       <span class="dt">title =</span> <span class="st">&quot;Ten-Mile Race Times&quot;</span>)</a></code></pre></div></li>
<li><p>The call was:</p>
<div class="sourceCode" id="cb1005"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1005-1" data-line-number="1"><span class="kw">ggplot</span>(mosaicData<span class="op">::</span>Gestation, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(smoke), <span class="dt">y =</span> wt)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1005-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">fill =</span> <span class="st">&quot;burlywood&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1005-3" data-line-number="3"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;smoking status of mother&quot;</span>,</a>
<a class="sourceLine" id="cb1005-4" data-line-number="4">       <span class="dt">y =</span> <span class="st">&quot;birth weight (ounces)&quot;</span>,</a>
<a class="sourceLine" id="cb1005-5" data-line-number="5">       <span class="dt">title =</span> <span class="st">&quot;Birth Weights&quot;</span>,</a>
<a class="sourceLine" id="cb1005-6" data-line-number="6">       <span class="dt">subtitle =</span> <span class="st">&quot;Children of smoking mothers have lower birth-weights.&quot;</span>)</a></code></pre></div></li>
<li><p>First, make the jittered points. It’s a good idea to load the data set directly, if you haven’t already attached <strong>mosaicData</strong>:</p>
<div class="sourceCode" id="cb1006"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1006-1" data-line-number="1"><span class="kw">data</span>(<span class="st">&quot;Galton&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;mosaicData&quot;</span>)</a></code></pre></div>
<p>Now make the points:</p>
<div class="sourceCode" id="cb1007"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1007-1" data-line-number="1">jitteredFather &lt;-<span class="st"> </span>Galton<span class="op">$</span>father <span class="op">+</span><span class="st"> </span><span class="kw">runif</span>(<span class="kw">nrow</span>(Galton), <span class="fl">-0.5</span>, <span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb1007-2" data-line-number="2">Galton<span class="op">$</span>jitteredFather &lt;-<span class="st"> </span>jitteredFather</a></code></pre></div>
<p>Finally, the graph:</p>
<div class="sourceCode" id="cb1008"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1008-1" data-line-number="1"><span class="kw">ggplot</span>(mosaicData<span class="op">::</span>Galton, <span class="kw">aes</span>(<span class="dt">x =</span> father)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1008-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&quot;burlywood&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1008-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_rug</span>(<span class="dt">x =</span> jitteredFather) <span class="op">+</span></a>
<a class="sourceLine" id="cb1008-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;height of the father (inches)&quot;</span>)</a></code></pre></div></li>
</ol>
</div>
</div>
<div id="a-case-study-us-births" class="section level2">
<h2><span class="header-section-number">6.3</span> A Case Study: US Births</h2>
<p>In Section @ref(idea-data), we made a plot of the number of births in the United States for each day of that year (see Figure @ref(fig:birthsplotframes)). We noticed that there appear to be two clouds of points. What accounts for this phenomenon? By now we have the R-programming chops to take on this question.</p>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/birthsplotframes-1.png" alt="Some of the days have significantly fewer births.  What's going on?" width="95%" />
<p class="caption">
(#fig:birthsplotframes)Some of the days have significantly fewer births. What’s going on?
</p>
</div>
<p>To begin with, look at all of the variables available in the data frame <code>Births78</code>:</p>
<div class="sourceCode" id="cb1009"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1009-1" data-line-number="1"><span class="kw">str</span>(Births78)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    365 obs. of  8 variables:
##  $ date        : Date, format: &quot;1978-01-01&quot; &quot;1978-01-02&quot; ...
##  $ births      : int  7701 7527 8825 8859 9043 9208 8084 7611 9172 9089 ...
##  $ wday        : Ord.factor w/ 7 levels &quot;Sun&quot;&lt;&quot;Mon&quot;&lt;&quot;Tue&quot;&lt;..: 1 2 3 4 5 6 7 1 2 3 ...
##  $ year        : num  1978 1978 1978 1978 1978 ...
##  $ month       : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ day_of_year : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ day_of_month: int  1 2 3 4 5 6 7 8 9 10 ...
##  $ day_of_week : num  1 2 3 4 5 6 7 1 2 3 ...</code></pre>
<p>We see that the variable <code>wday</code> gives the name of the day of the week, for each of the days in the year. On a hunch, we make violin plots of the births for each of the days of the week. The code appears below, and the resulting plot is shown in Figure @ref(fig:violinbirthswday)</p>
<div class="sourceCode" id="cb1011"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1011-1" data-line-number="1"><span class="kw">ggplot</span>(Births78, <span class="kw">aes</span>(<span class="dt">x =</span> wday, <span class="dt">y =</span> births)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_violin</span>(<span class="dt">fill =</span> <span class="st">&quot;burlywood&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1011-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_jitter</span>()</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/violinbirthswday-1.png" alt="Violin plot of births, by day of the week." width="95%" />
<p class="caption">
(#fig:violinbirthswday)Violin plot of births, by day of the week.
</p>
</div>
<p>Aha! There are considerably fewer births on the weekend-days—Saturday and Sunday. Perhaps the <em>entire</em> lower cloud of points is composed of weekends. Let’s check this by re-coding the days according to whether or not they are during the week or at the weekend:</p>
<div class="sourceCode" id="cb1012"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1012-1" data-line-number="1">weekend &lt;-<span class="st"> </span><span class="kw">with</span>(Births78, <span class="kw">ifelse</span>(wday <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Sat&quot;</span>,<span class="st">&quot;Sun&quot;</span>),</a>
<a class="sourceLine" id="cb1012-2" data-line-number="2">                                 <span class="st">&quot;weekend&quot;</span>, <span class="st">&quot;weekday&quot;</span>))</a>
<a class="sourceLine" id="cb1012-3" data-line-number="3">Births78<span class="op">$</span>weekend &lt;-<span class="st"> </span>weekend</a></code></pre></div>
<p>Note that we have added the new variable to the data frame, so that it will be easy in <strong>ggplot2</strong> to use that variable for grouping, as in the code below. The results appear in Figure @ref(fig:birthsplotframesweekend).</p>
<div class="sourceCode" id="cb1013"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1013-1" data-line-number="1"><span class="kw">ggplot</span>(Births78, <span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> births)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> weekend)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1013-2" data-line-number="2"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Day of the Year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Number of U.S. Births&quot;</span>,</a>
<a class="sourceLine" id="cb1013-3" data-line-number="3">       <span class="dt">title =</span> <span class="st">&quot;Daily U.S. Birth-Numbers in 1978&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/birthsplotframesweekend-1.png" alt="The days with fewer births are almost always weekend-days." width="95%" />
<p class="caption">
(#fig:birthsplotframesweekend)The days with fewer births are almost always weekend-days.
</p>
</div>
<p>Well, a <em>few</em> of the points in the lower cloud are weekdays. Is there anything special about them? To find out, we subset the data frame to examine only those points:</p>
<div class="sourceCode" id="cb1014"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1014-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">subset</span>(Births78, weekend <span class="op">!=</span><span class="st"> &quot;weekend&quot;</span> <span class="op">&amp;</span><span class="st"> </span>births <span class="op">&lt;=</span><span class="st"> </span><span class="dv">8500</span>)</a>
<a class="sourceLine" id="cb1014-2" data-line-number="2">df</a></code></pre></div>
<pre><code>##           date births wday year month day_of_year day_of_month day_of_week
## 2   1978-01-02   7527  Mon 1978     1           2            2           2
## 149 1978-05-29   7780  Mon 1978     5         149           29           2
## 185 1978-07-04   8433  Tue 1978     7         185            4           3
## 247 1978-09-04   8481  Mon 1978     9         247            4           2
## 327 1978-11-23   7915  Thu 1978    11         327           23           5
## 359 1978-12-25   7846  Mon 1978    12         359           25           2
##     weekend
## 2   weekday
## 149 weekday
## 185 weekday
## 247 weekday
## 327 weekday
## 359 weekday</code></pre>
<p>If you consult a calendar for the year 1978, you will find that every one of the above days was a major holiday. Apparently doctors prefer not to deliver babies on weekend and holidays. Scheduled births—induced births or births by non-emergency Cesarean section—are not usually set for weekends or holidays. Perhaps this accounts for the two clouds we saw in the original scatter plot.</p>
</div>
<div id="factors-in-plotting" class="section level2">
<h2><span class="header-section-number">6.4</span> Factor Variables in Plotting</h2>
<p>It is worthwhile to reconsider factor variables (see @ref(factor-variables)) and to consider their role in the appearance of plots. We’ll do this by way of an example.</p>
<p>Consider the data frame <code>firesetting</code> in the <strong>tigerData</strong> package:</p>
<div class="sourceCode" id="cb1016"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1016-1" data-line-number="1"><span class="kw">data</span>(<span class="st">&quot;firesetting&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;tigerData&quot;</span>)</a>
<a class="sourceLine" id="cb1016-2" data-line-number="2">?tigerData<span class="op">::</span>firesetting</a></code></pre></div>
<p>As we see from the Help file, fire-setting offers information about a large sample of high-school students. Some of them are known to be arsonists, while of course most are not. The purpose for gathering the data was to determine what characteristics of a child might be risk factors in whether he/she would develop into a fire-setter. Among the variables of interest are:</p>
<ul>
<li><code>race</code>, the ethnicity of the student, a factor with three levels: “white”, “black”, and “other”;</li>
<li><code>school.attitude</code>, a scaled score on a personality inventory in which high scores indicate a poor attitude toward school;</li>
<li><code>fires</code>, a factor variable with levels “0” (does not set fires) and “1” (sets fires).</li>
</ul>
<p>We might study the relationship between these variables with some box-plots via the code below. The results appear as Figure @ref(fig:firesetting1).</p>
<div class="sourceCode" id="cb1017"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1017-1" data-line-number="1"><span class="kw">ggplot</span>(firesetting, <span class="kw">aes</span>(<span class="dt">x =</span> race, <span class="dt">y =</span> school.attitude)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1017-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">fill =</span> <span class="st">&quot;burlywood&quot;</span>, </a>
<a class="sourceLine" id="cb1017-3" data-line-number="3">               <span class="dt">outlier.alpha =</span> <span class="dv">0</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1017-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">width =</span> <span class="fl">0.20</span>, <span class="dt">size =</span> <span class="fl">0.1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1017-5" data-line-number="5"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>fires, <span class="dt">nrow =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1017-6" data-line-number="6"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Ethnicity&quot;</span>,</a>
<a class="sourceLine" id="cb1017-7" data-line-number="7">       <span class="dt">y =</span> <span class="st">&quot;School-Attitude Score&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/firesetting1-1.png" alt="Boxplots with jittered individual values.  School attitudes are generally worse among fire-setters." width="95%" />
<p class="caption">
(#fig:firesetting1)Boxplots with jittered individual values. School attitudes are generally worse among fire-setters.
</p>
</div>
<p>We could improve the appearance of the plot with respect to two of the variables involved:</p>
<ul>
<li><code>fires</code>: We should display values that are more meaningful to a human viewer than 0 and 1.</li>
<li><code>race</code>: Let’s change the names of the values somewhat, keeping their current order along the x-axis.</li>
</ul>
<p>For <code>fires</code>, we simply need to map the current values onto others that we prefer. Currently the levels are:</p>
<div class="sourceCode" id="cb1018"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1018-1" data-line-number="1"><span class="kw">levels</span>(firesetting<span class="op">$</span>fires)</a></code></pre></div>
<pre><code>## [1] &quot;0&quot; &quot;1&quot;</code></pre>
<p>We can re-map as follows:</p>
<div class="sourceCode" id="cb1020"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1020-1" data-line-number="1">betterFires &lt;-<span class="st"> </span>plyr<span class="op">::</span><span class="kw">mapvalues</span>(firesetting<span class="op">$</span>fires, <span class="dt">from =</span> <span class="kw">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;1&quot;</span>),</a>
<a class="sourceLine" id="cb1020-2" data-line-number="2">                         <span class="dt">to =</span> <span class="kw">c</span>(<span class="st">&quot;no fires&quot;</span>, <span class="st">&quot;sets fires&quot;</span>))</a>
<a class="sourceLine" id="cb1020-3" data-line-number="3">firesetting<span class="op">$</span>betterFires &lt;-<span class="st"> </span>betterFires</a></code></pre></div>
<p>For <code>race</code>, we’d like to substitute</p>
<ul>
<li>“White” for “white”;</li>
<li>“AfrAm” for “black”</li>
<li>“Other” for “other”</li>
<li>“Unknown” instead of <code>NA</code></li>
</ul>
<p>We’d like the order along the horizontal axis to remain as it is.</p>
<p>We might begin by replacing the <code>NA</code>-values with “Unknown”, as follows:</p>
<div class="sourceCode" id="cb1021"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1021-1" data-line-number="1">tempRace &lt;-<span class="st"> </span>firesetting<span class="op">$</span>race</a>
<a class="sourceLine" id="cb1021-2" data-line-number="2">tempRace[<span class="kw">is.na</span>(tempRace)] &lt;-<span class="st"> &quot;Unknown&quot;</span></a></code></pre></div>
<p>We get an error! That’s because <code>race</code> is a factor with only three “possible values”, as given by its levels:</p>
<div class="sourceCode" id="cb1022"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1022-1" data-line-number="1"><span class="kw">levels</span>(tempRace)</a></code></pre></div>
<pre><code>## [1] &quot;white&quot; &quot;black&quot; &quot;other&quot;</code></pre>
<p>“Unknown” is not considered a “possible value” for <code>tempRace</code>, any attempt to set that value in any elements of <code>tempRace</code> will be resisted.</p>
<p>We can overcome this resistance by coercing <code>tempRace</code> into a mere character-vector:</p>
<div class="sourceCode" id="cb1024"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1024-1" data-line-number="1">tempRace &lt;-<span class="st"> </span><span class="kw">as.character</span>(tempRace)</a></code></pre></div>
<p>Now <code>tempRace</code> doesn’t come with a limit on its “possible values”. We try again:</p>
<div class="sourceCode" id="cb1025"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1025-1" data-line-number="1">tempRace[<span class="kw">is.na</span>(tempRace)] &lt;-<span class="st"> &quot;Unknown&quot;</span></a></code></pre></div>
<p>This apparently worked. Let’s check:</p>
<div class="sourceCode" id="cb1026"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1026-1" data-line-number="1"><span class="kw">unique</span>(tempRace)</a></code></pre></div>
<pre><code>## [1] &quot;white&quot;   &quot;other&quot;   &quot;Unknown&quot; &quot;black&quot;</code></pre>
<p>So far, so good. Now let’s re-map the other three values:</p>
<div class="sourceCode" id="cb1028"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1028-1" data-line-number="1">tempRace2 &lt;-<span class="st"> </span>plyr<span class="op">::</span><span class="kw">mapvalues</span>(tempRace,</a>
<a class="sourceLine" id="cb1028-2" data-line-number="2">                        <span class="dt">from =</span> <span class="kw">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;other&quot;</span>),</a>
<a class="sourceLine" id="cb1028-3" data-line-number="3">                        <span class="dt">to =</span> <span class="kw">c</span>(<span class="st">&quot;White&quot;</span>, <span class="st">&quot;AfrAm&quot;</span>, <span class="st">&quot;Other&quot;</span>))</a></code></pre></div>
<p>Let’s check that it worked:</p>
<div class="sourceCode" id="cb1029"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1029-1" data-line-number="1"><span class="kw">unique</span>(tempRace2)</a></code></pre></div>
<pre><code>## [1] &quot;White&quot;   &quot;Other&quot;   &quot;Unknown&quot; &quot;AfrAm&quot;</code></pre>
<p>Great. Now let’s add <code>tempRace2</code> as a new variable into <code>firsetting</code>. In that data frame, it will be called <code>betterRace</code>. Here’s the code to do this:</p>
<div class="sourceCode" id="cb1031"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1031-1" data-line-number="1">firesetting<span class="op">$</span>betterRace &lt;-<span class="st"> </span>tempRace2</a></code></pre></div>
<p>Let’s try the graph again. We will need to modify the code a bit, so that we’re using the new and improved variable <code>betterRace</code>, as well as the new variable <code>betterFires</code>. Figure @ref(fig:firesetting2) is the result.</p>
<div class="sourceCode" id="cb1032"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1032-1" data-line-number="1"><span class="kw">ggplot</span>(firesetting, <span class="kw">aes</span>(<span class="dt">x =</span> betterRace, <span class="dt">y =</span> school.attitude)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1032-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">fill =</span> <span class="st">&quot;burlywood&quot;</span>, </a>
<a class="sourceLine" id="cb1032-3" data-line-number="3">               <span class="dt">outlier.alpha =</span> <span class="dv">0</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1032-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">width =</span> <span class="fl">0.20</span>, <span class="dt">size =</span> <span class="fl">0.1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1032-5" data-line-number="5"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>betterFires, <span class="dt">nrow =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1032-6" data-line-number="6"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Ethnicity&quot;</span>,</a>
<a class="sourceLine" id="cb1032-7" data-line-number="7">       <span class="dt">y =</span> <span class="st">&quot;School-Attitude Score&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/firesetting2-1.png" alt="We have re-mapped the fires and race variables." width="95%" />
<p class="caption">
(#fig:firesetting2)We have re-mapped the fires and race variables.
</p>
</div>
<p>This looks better, but now the order along the x-axis isn’t as we desired. Recall that <code>race</code> is now a character vector only. Since it doesn’t have levels that specify a particular order, <strong>ggplot2</strong> uses alphabetical order as the default ordering along the x-axis.</p>
<p>Accordingly we should convert <code>betterRace</code> to a factor variable, and be careful to set the levels in the order that we want:</p>
<div class="sourceCode" id="cb1033"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1033-1" data-line-number="1">tempRace &lt;-<span class="st"> </span>firesetting<span class="op">$</span>betterRace</a>
<a class="sourceLine" id="cb1033-2" data-line-number="2">betterRace2 &lt;-<span class="st"> </span><span class="kw">factor</span>(tempRace,</a>
<a class="sourceLine" id="cb1033-3" data-line-number="3">               <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;White&quot;</span>, <span class="st">&quot;AfrAm&quot;</span>, <span class="st">&quot;Other&quot;</span>, <span class="st">&quot;Unknown&quot;</span>))</a>
<a class="sourceLine" id="cb1033-4" data-line-number="4">firesetting<span class="op">$</span>evenBetterRace &lt;-<span class="st"> </span>betterRace2</a></code></pre></div>
<p>Now try again. Note that in the code below we switch to <code>evenBetterRace</code>. See Figure @ref(fig:firesetting3) for the result.</p>
<div class="sourceCode" id="cb1034"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1034-1" data-line-number="1"><span class="kw">ggplot</span>(firesetting, <span class="kw">aes</span>(<span class="dt">x =</span> evenBetterRace, <span class="dt">y =</span> school.attitude)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1034-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">fill =</span> <span class="st">&quot;burlywood&quot;</span>, </a>
<a class="sourceLine" id="cb1034-3" data-line-number="3">               <span class="dt">outlier.alpha =</span> <span class="dv">0</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1034-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">width =</span> <span class="fl">0.20</span>, <span class="dt">size =</span> <span class="fl">0.1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1034-5" data-line-number="5"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>betterFires, <span class="dt">nrow =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1034-6" data-line-number="6"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Ethnicity&quot;</span>,</a>
<a class="sourceLine" id="cb1034-7" data-line-number="7">       <span class="dt">y =</span> <span class="st">&quot;School-Attitude Score&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/firesetting3-1.png" alt="Now the order of the race-values is correct!" width="95%" />
<p class="caption">
(#fig:firesetting3)Now the order of the race-values is correct!
</p>
</div>
<p>This works!</p>
<div id="practice-exercises-18" class="section level3">
<h3><span class="header-section-number">6.4.1</span> Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>With <code>mosaicData::KidsFeet</code>, make the following graph. (<strong>Hint</strong>: Use <code>plyr::mapvalues()</code>.)</p>
<p><img src="r-notes_files/figure-html/unnamed-chunk-807-1.png" width="95%" style="display: block; margin: auto;" /></p></li>
<li><p>With <code>mosaicData::TenMileRace</code>, make the following graph. (<strong>Hint</strong>: Use <code>cut()</code> to make age groups. The fill for the boxes is the ever-popular <code>&quot;burlywood&quot;</code>.)</p>
<p><img src="r-notes_files/figure-html/unnamed-chunk-808-1.png" width="95%" style="display: block; margin: auto;" /></p></li>
<li><p>With <code>mosaicData::Gestation</code>, make the following graph. (<strong>Hint</strong>: Use <code>!is.na()</code> to select the rows of <code>Gestation</code> where <code>smoke</code> is not <code>NA</code>. Then use <code>plyr::mapvalues()</code> on <code>smoke</code>.)</p>
<p><img src="r-notes_files/figure-html/unnamed-chunk-809-1.png" width="95%" style="display: block; margin: auto;" /></p></li>
</ol>
</div>
<div id="solutions-to-practice-exercises-14" class="section level3">
<h3><span class="header-section-number">6.4.2</span> Solutions to Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Here’s the code:</p>
<div class="sourceCode" id="cb1035"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1035-1" data-line-number="1"><span class="kw">data</span>(<span class="st">&quot;KidsFeet&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;mosaicData&quot;</span>)</a>
<a class="sourceLine" id="cb1035-2" data-line-number="2">tempBiggerfoot &lt;-<span class="st"> </span>KidsFeet<span class="op">$</span>biggerfoot</a>
<a class="sourceLine" id="cb1035-3" data-line-number="3">biggerfoot2 &lt;-<span class="st"> </span>plyr<span class="op">::</span><span class="kw">mapvalues</span>(tempBiggerfoot, <span class="kw">c</span>(<span class="st">&quot;L&quot;</span>, <span class="st">&quot;R&quot;</span>),</a>
<a class="sourceLine" id="cb1035-4" data-line-number="4">                     <span class="dt">to =</span> <span class="kw">c</span>(<span class="st">&quot;left foot&quot;</span>, <span class="st">&quot;right foot&quot;</span>))</a>
<a class="sourceLine" id="cb1035-5" data-line-number="5">KidsFeet<span class="op">$</span>betterBiggerfoot &lt;-<span class="st"> </span>biggerfoot2</a>
<a class="sourceLine" id="cb1035-6" data-line-number="6">tempDomhand &lt;-<span class="st"> </span>KidsFeet<span class="op">$</span>domhand</a>
<a class="sourceLine" id="cb1035-7" data-line-number="7">domhand2 &lt;-<span class="st"> </span>plyr<span class="op">::</span><span class="kw">mapvalues</span>(tempDomhand, <span class="dt">from =</span> <span class="kw">c</span>(<span class="st">&quot;L&quot;</span>, <span class="st">&quot;R&quot;</span>),</a>
<a class="sourceLine" id="cb1035-8" data-line-number="8">                     <span class="dt">to =</span> <span class="kw">c</span>(<span class="st">&quot;left hand&quot;</span>, <span class="st">&quot;right hand&quot;</span>))</a>
<a class="sourceLine" id="cb1035-9" data-line-number="9">KidsFeet<span class="op">$</span>betterDomhand &lt;-<span class="st"> </span>domhand2</a>
<a class="sourceLine" id="cb1035-10" data-line-number="10"><span class="kw">ggplot</span>(KidsFeet, <span class="kw">aes</span>(<span class="dt">x =</span> betterBiggerfoot)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1035-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> betterDomhand), <span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1035-12" data-line-number="12"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;the bigger foot&quot;</span>,</a>
<a class="sourceLine" id="cb1035-13" data-line-number="13">       <span class="dt">title =</span> <span class="st">&quot;Foot-size and Handedness for 39 Children&quot;</span>,</a>
<a class="sourceLine" id="cb1035-14" data-line-number="14">       <span class="dt">subtitle =</span> <span class="kw">paste0</span>(<span class="st">&quot;When your right foot is bigger, &quot;</span>,</a>
<a class="sourceLine" id="cb1035-15" data-line-number="15">                         <span class="st">&quot;are you more likely to be right-handed?&quot;</span>))</a></code></pre></div></li>
<li><p>Here’s the code:</p>
<div class="sourceCode" id="cb1036"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1036-1" data-line-number="1"><span class="kw">data</span>(<span class="st">&quot;TenMileRace&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;mosaicData&quot;</span>)</a>
<a class="sourceLine" id="cb1036-2" data-line-number="2">tempSex &lt;-<span class="st"> </span>TenMileRace<span class="op">$</span>sex</a>
<a class="sourceLine" id="cb1036-3" data-line-number="3">sex2 &lt;-<span class="st"> </span>plyr<span class="op">::</span><span class="kw">mapvalues</span>(tempSex, <span class="dt">from =</span> <span class="kw">c</span>(<span class="st">&quot;F&quot;</span>, <span class="st">&quot;M&quot;</span>),</a>
<a class="sourceLine" id="cb1036-4" data-line-number="4">                       <span class="dt">to =</span> <span class="kw">c</span>(<span class="st">&quot;female&quot;</span>, <span class="st">&quot;male&quot;</span>))</a>
<a class="sourceLine" id="cb1036-5" data-line-number="5">TenMileRace<span class="op">$</span>betterSex &lt;-<span class="st"> </span>sex2</a>
<a class="sourceLine" id="cb1036-6" data-line-number="6">ageGroup &lt;-<span class="st"> </span><span class="kw">cut</span>(TenMileRace<span class="op">$</span>age,</a>
<a class="sourceLine" id="cb1036-7" data-line-number="7">                <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>, <span class="dv">70</span>, <span class="ot">Inf</span>),</a>
<a class="sourceLine" id="cb1036-8" data-line-number="8">                <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;&lt;20&quot;</span>, <span class="st">&quot;20s&quot;</span>, <span class="st">&quot;30s&quot;</span>, <span class="st">&quot;40s&quot;</span>, </a>
<a class="sourceLine" id="cb1036-9" data-line-number="9">                           <span class="st">&quot;50s&quot;</span>, <span class="st">&quot;60s&quot;</span>, <span class="st">&quot;70+&quot;</span>))</a>
<a class="sourceLine" id="cb1036-10" data-line-number="10">TenMileRace<span class="op">$</span>ageGroup &lt;-<span class="st"> </span>ageGroup</a>
<a class="sourceLine" id="cb1036-11" data-line-number="11"><span class="kw">ggplot</span>(TenMileRace, <span class="kw">aes</span>(<span class="dt">x =</span> ageGroup, <span class="dt">y =</span> time)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1036-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">fill =</span> <span class="st">&quot;burlywood&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1036-13" data-line-number="13"><span class="st">  </span><span class="kw">facet_grid</span>(betterSex <span class="op">~</span><span class="st"> </span>.) <span class="op">+</span></a>
<a class="sourceLine" id="cb1036-14" data-line-number="14"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Age Group&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;net time to finish (sec)&quot;</span>,</a>
<a class="sourceLine" id="cb1036-15" data-line-number="15">       <span class="dt">title =</span> <span class="st">&quot;Ten-Mile Race Times&quot;</span>)</a></code></pre></div></li>
<li><p>Here’s the code:</p>
<div class="sourceCode" id="cb1037"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1037-1" data-line-number="1"><span class="kw">data</span>(<span class="st">&quot;Gestation&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;mosaicData&quot;</span>)</a>
<a class="sourceLine" id="cb1037-2" data-line-number="2">Gestation &lt;-<span class="st"> </span><span class="kw">subset</span>(Gestation, <span class="op">!</span><span class="kw">is.na</span>(smoke))</a>
<a class="sourceLine" id="cb1037-3" data-line-number="3">tempSmoke &lt;-<span class="st"> </span>Gestation<span class="op">$</span>smoke</a>
<a class="sourceLine" id="cb1037-4" data-line-number="4">smoke2 &lt;-<span class="st"> </span>plyr<span class="op">::</span><span class="kw">mapvalues</span>(tempSmoke, <span class="dt">from =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb1037-5" data-line-number="5">                         <span class="dt">to =</span> <span class="kw">c</span>(<span class="st">&quot;never&quot;</span>, <span class="st">&quot;smokes now&quot;</span>,</a>
<a class="sourceLine" id="cb1037-6" data-line-number="6">                                <span class="st">&quot;until curr. preg.&quot;</span>,</a>
<a class="sourceLine" id="cb1037-7" data-line-number="7">                                <span class="st">&quot;once smoked&quot;</span>))</a>
<a class="sourceLine" id="cb1037-8" data-line-number="8">Gestation<span class="op">$</span>betterSmoke &lt;-<span class="st"> </span>smoke2</a>
<a class="sourceLine" id="cb1037-9" data-line-number="9"><span class="kw">ggplot</span>(Gestation, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(betterSmoke), <span class="dt">y =</span> wt)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1037-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">fill =</span> <span class="st">&quot;burlywood&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1037-11" data-line-number="11"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;smoking status of mother&quot;</span>,</a>
<a class="sourceLine" id="cb1037-12" data-line-number="12">       <span class="dt">y =</span> <span class="st">&quot;birth weight (ounces)&quot;</span>,</a>
<a class="sourceLine" id="cb1037-13" data-line-number="13">       <span class="dt">title =</span> <span class="st">&quot;Birth Weights&quot;</span>,</a>
<a class="sourceLine" id="cb1037-14" data-line-number="14">       <span class="dt">subtitle =</span> <span class="st">&quot;Children of smoking mothers have lower birth-weights.&quot;</span>)</a></code></pre></div></li>
</ol>
</div>
</div>
<div id="learn-more" class="section level2">
<h2><span class="header-section-number">6.5</span> Learn More</h2>
<p>From time to time we will return to <strong>gplot2</strong> and deepen our study of this remarkable graphing system. If you are impatient to learn more right way, you can explore the package’s <a href="http://docs.ggplot2.org/current/index.html">documentation site</a>. The site teaches the system by way of numerous examples that you can copy and modify.</p>

</div>
<div id="glossary-4" class="section level2 unnumbered">
<h2>Glossary</h2>
<dl>
<dt>Frame </dt>
<dd><p>The aesthetics (usually x and y position) that help locate cases on a plot.</p>
</dd>
<dt>Glyph </dt>
<dd><p>The basic graphical unit that corresponds to a case in the data table.</p>
</dd>
<dt>Aesthetic </dt>
<dd><p>A perceptible property of a glyph that varies from case to case.</p>
</dd>
<dt>Scale </dt>
<dd><p>The relationship between the value of a variable and the graphical attribute to be displayed for that value.</p>
</dd>
<dt>Guide </dt>
<dd><p>An indication, for the human viewer, of the scale being used in an aesthetic mapping.</p>
</dd>
</dl>

</div>
<div id="graphics-exercises" class="section level2 unnumbered">
<h2>Exercises</h2>
<p><img src="images/thinking.png" width="50%" style="display: block; margin: auto;" /></p>
<ol style="list-style-type: decimal">
<li><p>Using the <code>bcscr::m111survey</code> data frame, write the <strong>ggplot2</strong> code necessary to produce the graph in the figure below. (The points are all blue.)</p>
<p><img src="r-notes_files/figure-html/heightideal-1.png" width="95%" style="display: block; margin: auto;" /></p>
<p><strong>Hint</strong>: For the points, map the aesthetic property <code>shape</code> ot the variable <code>sex</code>. On the other hand, color is a fixed property.</p></li>
<li><p>Using the <code>mosaicData::Utilities</code> data frame, write the <strong>ggplot2</strong> code necessary to produce the graph in the figure below.</p>
<p><img src="r-notes_files/figure-html/utilitybills-1.png" width="95%" style="display: block; margin: auto;" /></p>
<p><strong>Hint</strong>: The <code>month</code> variable in <code>Utilities</code> is given numerically: 0 for January, 1 for February, and so on. You’ll need to use <code>plyr::mapvalues()</code> to map the numbers from 1 to 12 to the abbreviated month names. (See section @ref(factors-in-plotting) for a review of this.) The special R-vector <code>month.abb</code> will render the re-mapping task easy:</p>
<div class="sourceCode" id="cb1038"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1038-1" data-line-number="1">month.abb</a></code></pre></div>
<pre><code>##  [1] &quot;Jan&quot; &quot;Feb&quot; &quot;Mar&quot; &quot;Apr&quot; &quot;May&quot; &quot;Jun&quot; &quot;Jul&quot; &quot;Aug&quot; &quot;Sep&quot; &quot;Oct&quot; &quot;Nov&quot;
## [12] &quot;Dec&quot;</code></pre>
<p>In fact, you can create your new variable with abbreviated monnths with this code:</p>
<div class="sourceCode" id="cb1040"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1040-1" data-line-number="1"> monthAbbr &lt;-<span class="st"> </span><span class="kw">with</span>(Utilities, </a>
<a class="sourceLine" id="cb1040-2" data-line-number="2">                  plyr<span class="op">::</span><span class="kw">mapvalues</span>(month, <span class="dt">from =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1040-3" data-line-number="3">                                  <span class="dt">to =</span> month.abb))</a></code></pre></div>
<p>You also need to make sure that the months come in the right order along the x-axis of the graph. To do this consider resetting the levels of your new <code>monthAbbr</code> variable. One way to accomplish this is to convert <code>monthAbbr</code> back to a factor with levels in the order you want, as done in Section @ref(factors-in-plotting), like this:</p>
<div class="sourceCode" id="cb1041"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1041-1" data-line-number="1">monthAbbr &lt;-<span class="st"> </span><span class="kw">factor</span>(monthAbbr, <span class="dt">levels =</span> month.abb)</a></code></pre></div>
<p>Then you can put your new variable into the data frame, naming it anything you like:</p>
<div class="sourceCode" id="cb1042"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1042-1" data-line-number="1">Utilities<span class="op">$</span>monthName &lt;-<span class="st"> </span>monthAbbr</a></code></pre></div></li>
<li><p>The next few exercises pertain to the data frame <code>CPS85</code> from the package <strong>mosaicData</strong>. Learn about it with <code>help(CPS85)</code>. We will use the <strong>ggplot2</strong> graphing package to explore whether men were being paid more than women in 1985.</p>
<p>Make a density plot of the wages of the people in the study. As with all plots you make, it should have well-labelled axes (with units if possible). For a density plot you should label the horizontal axis, but you can let <strong>ggplo2</strong> provide the label for the “density” axis. As always, provide a descriptive title. Also provide a “rug” of individual values along the horizontal axis.</p></li>
<li><p>Look at the plot you made in the previous exercise: you will notice that one person made a wage that was much higher than all the rest. In data analysis, when a value is much higher or lower than the rest of the values we call it an <em>outlier</em>.</p>
<p>Write the code needed to find the age, sex and sector of employment of the person who made this extraoridinarily high wage. Report the age, sex and sector of this person.</p>
<p>Create a new data frame called <code>cpsSmall</code> that is the same as <code>CPS85</code> except that it excludes the row corresponding to the outlier-individual.</p></li>
<li><p>In order to explore the relationship between wage and sex in the CPS study, make violin plots for the wages of men and women. (In this exercise and in subsequent exercises, use the <code>cpsSmall</code> data frame so as to exclude the outlier.) Based on the plot, who tends to earn higher wages: men or women?</p></li>
<li><p>Someone might argue that men don’t earn higher wages because of sex-discrimination in the workplace, but rather because of some other factor. For example, it could be that in 1985 women chose to work in low-wage sectors of the economy, whereas men tended to work in higher-wage sectors. Of course for this explanation to be viable, some sectors of the economy have to pay more on average than other sectors do. In order to verify whether this is the case, make a box plot of wage vs. sector of employment. Use the plot to name a couple of high-wage sectors and a couple of low-wage sectors.</p></li>
<li><p>From the previous exercise you now know that some sectors of the economy pay more than other sectors. Hence in order to investigate properly whether there was wage-discrimination in the workforce based on sex, we would have to compare the wages of men and women who work in the <em>same</em> sector. To this end it would be nice to have eight separate box plots, one for each sector. Each plot would compare the wages of men and women in that sector. Use <code>facet_wrap()</code> to construct a graph that displays all eight plots at once.</p>
Examine your graph.
<ul>
<li>Are there any sectors in which it seems that women typically make more than men. If so, what sectors are they?</li>
<li>On the other hand, are there any sectors where men typically make more than women? If so, what sectors are they?</li>
<li>Based on your analysis, does it seem plausible that women made less than men simply because they chose lower-paying sectors of employment?</li>
</ul></li>
</ol>
<!--chapter:end:080-graphics.Rmd-->
</div>
</div>
<div id="lists" class="section level1">
<h1><span class="header-section-number">7</span> Lists</h1>
<p><img src="images/santa-list.jpg" width="60%" style="display: block; margin: auto;" /></p>
<p>In this Chapter we will study <em>lists</em>, another important data structure in R.</p>

<div id="introduction-to-lists" class="section level2">
<h2><span class="header-section-number">7.1</span> Introduction to Lists</h2>
<p>So far the vectors that we have met have all been <em>atomic</em>, meaning that they can hold only one type of value. Hence we deal with vectors of type <code>integer</code>, or of type <code>double</code>, or of type <code>character</code>, and so on.</p>
<p>A <em>list</em>  is a special kind of vector. Like any other vector it is one-dimensional, but unlike an atomic vector it can contain objects of <em>any</em> sort: atomic vectors, functions—even other lists! We say, therefore, that lists are <em>heterogeneous</em> vectors.</p>
<p>The most direct way to create a list is with the function <code>list()</code> . Let’s make a couple of lists:</p>
<div class="sourceCode" id="cb1043"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1043-1" data-line-number="1">lst1 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">name =</span> <span class="st">&quot;Dorothy&quot;</span>, <span class="dt">age =</span> <span class="dv">12</span>)</a>
<a class="sourceLine" id="cb1043-2" data-line-number="2">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>), <span class="dt">y =</span> letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])</a>
<a class="sourceLine" id="cb1043-3" data-line-number="3">lst2 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">vowels =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;e&quot;</span>, <span class="st">&quot;i&quot;</span>, <span class="st">&quot;o&quot;</span>, <span class="st">&quot;u&quot;</span>),</a>
<a class="sourceLine" id="cb1043-4" data-line-number="4">             <span class="dt">myFrame =</span> df)</a>
<a class="sourceLine" id="cb1043-5" data-line-number="5">lst3 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">nums =</span> <span class="dv">10</span><span class="op">:</span><span class="dv">20</span>,</a>
<a class="sourceLine" id="cb1043-6" data-line-number="6">             <span class="dt">bools =</span> <span class="kw">c</span>(T, F, F),</a>
<a class="sourceLine" id="cb1043-7" data-line-number="7">             <span class="dt">george =</span> lst1)</a></code></pre></div>
<p>Note that the elements of our three lists are not objects of a single data type. Note also that <code>lst3</code> actually contains <code>lst1</code> as one of its elements.</p>
<p>When you call <code>list()</code> to create a list, you have the option to assign a name to one or more of the elements. In the code above we chose, for both of our lists, to assign a name to each element.</p>
<p>Let’s print out a list to the console. We’ll choose <code>lst1</code>, since it’s rather small:</p>
<div class="sourceCode" id="cb1044"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1044-1" data-line-number="1">lst1</a></code></pre></div>
<pre><code>## $name
## [1] &quot;Dorothy&quot;
## 
## $age
## [1] 12</code></pre>
<p>Note that the name of each elements appears before the element itself is printed out, and that the names are preceded by dollar signs. This is a hint that you can access a single member of the list in a way similar to the <code>frame$variable</code> format for data frames:</p>
<div class="sourceCode" id="cb1046"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1046-1" data-line-number="1">lst1<span class="op">$</span>age</a></code></pre></div>
<pre><code>## [1] 12</code></pre>
<p>You can make an empty list, too:</p>
<div class="sourceCode" id="cb1048"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1048-1" data-line-number="1">emptyList &lt;-<span class="st"> </span><span class="kw">list</span>()</a></code></pre></div>
<p>This is useful when you want to build up a list gradually, but you do not yet know what will go into it.</p>
<div id="practice-exercises-19" class="section level3">
<h3><span class="header-section-number">7.1.1</span> Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Make a list called <code>ozStuff</code>. The list should contain three elements:</p>
<ul>
<li>The sequence of even numbers from 4 to 100. Its name should be <code>lion</code>.</li>
<li>The uppercase letters of the alphabet. Its name should be <code>scarecrow</code>.</li>
<li>The data frame <code>alcohol</code> from the <strong>fuel</strong> package. Its name should be <code>wizard</code>.</li>
</ul></li>
<li><p>Suppose that <code>ozStuff</code> has been created in the previous problem. Describe in your own words what the following expression does:</p>
<div class="sourceCode" id="cb1049"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1049-1" data-line-number="1">ozStuff &lt;-<span class="st"> </span><span class="kw">c</span>(ozStuff, <span class="kw">list</span>(<span class="dt">dorothy =</span> <span class="st">&quot;Kansas&quot;</span>))</a></code></pre></div></li>
</ol>
</div>
<div id="solutions-to-the-practice-exercises-7" class="section level3">
<h3><span class="header-section-number">7.1.2</span> Solutions to the Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Here’s one way to do it:</p>
<div class="sourceCode" id="cb1050"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1050-1" data-line-number="1">ozStuff &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">lion =</span> <span class="kw">seq</span>(<span class="dv">4</span>, <span class="dv">100</span>, <span class="dt">by =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb1050-2" data-line-number="2">                <span class="dt">scarecrow =</span> LETTERS,</a>
<a class="sourceLine" id="cb1050-3" data-line-number="3">                <span class="dt">wizard =</span> bcscr<span class="op">::</span>fuel)</a></code></pre></div></li>
<li><p>One way to describe it is as follows: the expression creates a new list consisting of all the elements of <code>ozStuff</code> together with a new element called <code>dorothy</code> (which is the string <code>&quot;Kansas&quot;</code>), and then binds the name “<code>ozStuff</code>” to that new four-element list.</p></li>
</ol>
</div>
</div>
<div id="subsetting-and-accessing" class="section level2">
<h2><span class="header-section-number">7.2</span> Subsetting and Accessing</h2>
<p>You can subset lists in the same way that you subset a vector: simply use the <code>[</code> sub-setting operator. Let’s pick out the first two elements of <code>lst3</code>:</p>
<div class="sourceCode" id="cb1051"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1051-1" data-line-number="1">lst3[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]</a></code></pre></div>
<pre><code>## $nums
##  [1] 10 11 12 13 14 15 16 17 18 19 20
## 
## $bools
## [1]  TRUE FALSE FALSE</code></pre>
<p>We get a new list consisting of the desired two elements.</p>
<p>Suppose we want to access just one element from <code>lst3</code>: the numbers, for instance. We could try this:</p>
<div class="sourceCode" id="cb1053"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1053-1" data-line-number="1">justNumbers &lt;-<span class="st"> </span>lst3[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb1053-2" data-line-number="2">justNumbers</a></code></pre></div>
<pre><code>## $nums
##  [1] 10 11 12 13 14 15 16 17 18 19 20</code></pre>
<p>Now suppose that we want to access the third number in the <code>nums</code> vector. You might think this would work fine:</p>
<div class="sourceCode" id="cb1055"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1055-1" data-line-number="1">justNumbers[<span class="dv">3</span>]</a></code></pre></div>
<pre><code>## $&lt;NA&gt;
## NULL</code></pre>
<p>Wait a minute! The third number in <code>nums</code> is 12: so why are we getting <code>NA</code>?</p>
<p>Look carefully again at the printout for <code>justNumbers</code>:</p>
<div class="sourceCode" id="cb1057"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1057-1" data-line-number="1">justNumbers</a></code></pre></div>
<pre><code>## $nums
##  [1] 10 11 12 13 14 15 16 17 18 19 20</code></pre>
<p>The <code>$nums</code> give us the clue: <code>justNumbers</code> is not just the vector <code>nums</code>—in fact it’s not an atomic vector at all. It is a list whose only element is a vector with the name <code>nums</code>. Another way to see this is to check the length of <code>justNumbers</code>:</p>
<div class="sourceCode" id="cb1059"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1059-1" data-line-number="1"><span class="kw">length</span>(justNumbers)</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>The fact is that the sub-setting operator <code>[</code>, applied to lists, always returns a list. If you want access to an individual element of a list, then you need to use the double-bracket <code>[[</code> operator:</p>
<div class="sourceCode" id="cb1061"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1061-1" data-line-number="1">reallyJustNumbers &lt;-<span class="st"> </span>lst3[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb1061-2" data-line-number="2">reallyJustNumbers</a></code></pre></div>
<pre><code>##  [1] 10 11 12 13 14 15 16 17 18 19 20</code></pre>
<p>Of course if an element of a list is named, then you may also access it with the dollar sign:</p>
<div class="sourceCode" id="cb1063"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1063-1" data-line-number="1">lst3<span class="op">$</span>nums</a></code></pre></div>
<pre><code>##  [1] 10 11 12 13 14 15 16 17 18 19 20</code></pre>
<p>From time to time it’s useful to “flatten out” a list into a vector of values of its elements. This is accomplished by the function <code>unlist()</code> :</p>
<div class="sourceCode" id="cb1065"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1065-1" data-line-number="1"><span class="kw">unlist</span>(lst1)</a></code></pre></div>
<pre><code>##      name       age 
## &quot;Dorothy&quot;      &quot;12&quot;</code></pre>
<p>As the example above shows, you have to exercise caution with <code>unlist()</code>. Since <code>unlist()</code> returns an atomic vector, when it encounters values of different types then it has to coerce them to be of the same type. In the competition between <code>double</code> and <code>character</code> types, <code>character</code> wins, so you end up with a vector of strings.</p>
<div id="practice-exercises-20" class="section level3">
<h3><span class="header-section-number">7.2.1</span> Practice Exercises</h3>
<p>These exercises involve the following list:</p>
<div class="sourceCode" id="cb1067"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1067-1" data-line-number="1">grabBag &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">letters =</span> letters,</a>
<a class="sourceLine" id="cb1067-2" data-line-number="2">                <span class="kw">as.character</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>),</a>
<a class="sourceLine" id="cb1067-3" data-line-number="3">                <span class="dt">df =</span> bcscr<span class="op">::</span>fuel)</a></code></pre></div>
<p>Observe that the second element of this list was NOT given a name.</p>
<ol style="list-style-type: decimal">
<li><p>Describe in words what <code>grabBag[2:3]</code> is.</p></li>
<li><p>Describe in words what <code>grabBag[3]</code> is.</p></li>
<li><p>Describe in words what `grabBag[[3]] is.</p></li>
<li><p>Find two ways to access the letter <code>&quot;d&quot;</code> in the first element of <code>grabBag</code>.</p></li>
<li><p>Find a way to access the last five elements of the second element of <code>grabBag</code>.</p></li>
<li><p>Find two ways to access the variable <code>speed</code> in the data frame in <code>grabBag</code>.</p></li>
</ol>
</div>
<div id="solutions-to-the-practice-exercises-8" class="section level3">
<h3><span class="header-section-number">7.2.2</span> Solutions to the Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p><code>grabBag[2:3]</code> is a list containing two elements: the vector of whole numbers from 1 to 10 turned into strings, and the data frame <code>fuel</code> from the <strong>bcscr</strong> package.</p></li>
<li><p><code>grabBag[3]</code> is a list containing just one element: the data frame <code>fuel</code> from the <strong>bcscr</strong> package.</p></li>
<li><p><code>grabBag[[3]]</code> is the data frame <code>fuel</code> from the <strong>bcscr</strong> package.</p></li>
<li><p>Here are two ways:</p>
<div class="sourceCode" id="cb1068"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1068-1" data-line-number="1">grabBag<span class="op">$</span>letters[<span class="dv">4</span>]</a>
<a class="sourceLine" id="cb1068-2" data-line-number="2">grabBag[[<span class="dv">1</span>]][<span class="dv">4</span>]</a></code></pre></div></li>
<li><p>Try this:</p>
<div class="sourceCode" id="cb1069"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1069-1" data-line-number="1">grabBag[[<span class="dv">2</span>]][<span class="dv">6</span><span class="op">:</span><span class="dv">10</span>]</a></code></pre></div></li>
<li><p>Here are two ways:</p>
<div class="sourceCode" id="cb1070"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1070-1" data-line-number="1">grabBag<span class="op">$</span>df<span class="op">$</span>speed</a>
<a class="sourceLine" id="cb1070-2" data-line-number="2">grabBag[[<span class="dv">3</span>]]<span class="op">$</span>speed</a></code></pre></div></li>
</ol>
</div>
</div>
<div id="lists-splitting" class="section level2">
<h2><span class="header-section-number">7.3</span> Splitting</h2>
<p>Sometimes it is useful to split a vector or data frame into pieces according to the value of a variable. For example, from <code>m111survey</code> we might like to have separate data frames for each of the three seating preferences. We can accomplish this with the <code>split()</code> function: </p>
<div class="sourceCode" id="cb1071"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1071-1" data-line-number="1">bySeat &lt;-<span class="st"> </span><span class="kw">split</span>(m111survey, <span class="dt">f =</span> m111survey<span class="op">$</span>seat)</a></code></pre></div>
<p>If you run the command <code>str(bySeat)</code>, you find that <code>bySeat</code> is a list consisting of three data frames:</p>
<ul>
<li><code>1_front</code>: the frame of all subjects who prefer the Front;</li>
<li><code>2_middle</code>: the frame of all subjects who prefer the Middle;</li>
<li><code>3_back</code>: the frame of all subjects who prefer the Back.</li>
</ul>
<p>Now you can carry on three separate analyses, working with one frame at a time.</p>
<p>There is a pitfall which of you should be aware. If you try to access any one of the frames by its name, you will get an error:</p>
<div class="sourceCode" id="cb1072"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1072-1" data-line-number="1">bySeat<span class="op">$</span><span class="dv">1</span>_front</a></code></pre></div>
<pre><code>## Error: unexpected numeric constant in &quot;bySeat$1&quot;</code></pre>
<p>The reason is that variable names cannot begin with a number! You have two options, here. You could access a single frame by using the name in quotes:</p>
<div class="sourceCode" id="cb1074"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1074-1" data-line-number="1">bySeat[[<span class="st">&quot;1_front&quot;</span>]]</a></code></pre></div>
<p>Your second option is to use the index of the element you want:</p>
<div class="sourceCode" id="cb1075"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1075-1" data-line-number="1">bySeat[[<span class="dv">1</span>]]</a></code></pre></div>
</div>
<div id="returning-multiple-values" class="section level2">
<h2><span class="header-section-number">7.4</span> Returning Multiple Values</h2>
<p>Lists combine many different sorts of objects into one object. This makes them very useful in the context of certain functions.</p>
<p>Consider, for example, the drunken-turtle simulation from Section @ref(drunken-turtle-sim):</p>
<div class="sourceCode" id="cb1076"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1076-1" data-line-number="1">drunkenSim &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">steps =</span> <span class="dv">1000</span>, <span class="dt">reps =</span> <span class="dv">10000</span>, <span class="dt">close =</span> <span class="fl">0.5</span>, </a>
<a class="sourceLine" id="cb1076-2" data-line-number="2">                       <span class="dt">seed =</span> <span class="ot">NULL</span>, <span class="dt">table =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb1076-3" data-line-number="3">  <span class="cf">if</span> ( <span class="op">!</span><span class="kw">is.null</span>(seed) ) {</a>
<a class="sourceLine" id="cb1076-4" data-line-number="4">    <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb1076-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb1076-6" data-line-number="6">  </a>
<a class="sourceLine" id="cb1076-7" data-line-number="7">  returns &lt;-<span class="st"> </span><span class="kw">numeric</span>(reps)</a>
<a class="sourceLine" id="cb1076-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb1076-9" data-line-number="9">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>reps) {</a>
<a class="sourceLine" id="cb1076-10" data-line-number="10">  angle &lt;-<span class="st"> </span><span class="kw">runif</span>(steps, <span class="dv">0</span> , <span class="dv">2</span><span class="op">*</span>pi)</a>
<a class="sourceLine" id="cb1076-11" data-line-number="11">  xSteps &lt;-<span class="st"> </span><span class="kw">cos</span>(angle)</a>
<a class="sourceLine" id="cb1076-12" data-line-number="12">  ySteps &lt;-<span class="st"> </span><span class="kw">sin</span>(angle)</a>
<a class="sourceLine" id="cb1076-13" data-line-number="13">  </a>
<a class="sourceLine" id="cb1076-14" data-line-number="14">  x &lt;-<span class="st"> </span><span class="kw">cumsum</span>(xSteps)</a>
<a class="sourceLine" id="cb1076-15" data-line-number="15">  y &lt;-<span class="st"> </span><span class="kw">cumsum</span>(ySteps)</a>
<a class="sourceLine" id="cb1076-16" data-line-number="16">  </a>
<a class="sourceLine" id="cb1076-17" data-line-number="17">  dist &lt;-<span class="st"> </span><span class="kw">sqrt</span>(x<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>y<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1076-18" data-line-number="18">  closeReturn &lt;-<span class="st"> </span>(dist <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb1076-19" data-line-number="19">  returns[i] &lt;-<span class="st"> </span><span class="kw">sum</span>(closeReturn)</a>
<a class="sourceLine" id="cb1076-20" data-line-number="20">  }</a>
<a class="sourceLine" id="cb1076-21" data-line-number="21">  </a>
<a class="sourceLine" id="cb1076-22" data-line-number="22">  <span class="cf">if</span> ( table ) {</a>
<a class="sourceLine" id="cb1076-23" data-line-number="23">    <span class="kw">cat</span>(<span class="st">&quot;Here is a table of the number of close returns:</span><span class="ch">\n\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb1076-24" data-line-number="24">    tab &lt;-<span class="st"> </span><span class="kw">prop.table</span>(<span class="kw">table</span>(returns))</a>
<a class="sourceLine" id="cb1076-25" data-line-number="25">    <span class="kw">print</span>(tab)</a>
<a class="sourceLine" id="cb1076-26" data-line-number="26">    <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb1076-27" data-line-number="27">  }</a>
<a class="sourceLine" id="cb1076-28" data-line-number="28">  <span class="kw">cat</span>(<span class="st">&quot;The average number of close returns was:  &quot;</span>, </a>
<a class="sourceLine" id="cb1076-29" data-line-number="29">      <span class="kw">mean</span>(returns), <span class="st">&quot;.&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb1076-30" data-line-number="30">}</a></code></pre></div>
<p>Suppose that we would like to store several of the results of the simulation:</p>
<ul>
<li>the vector of the number of close returns on each repetition;</li>
<li>the table made from the close-returns vector;</li>
<li>the mean number of returns.</li>
</ul>
<p>Unfortunately a function can only return <em>one</em> object.</p>
<p>The solution to your problem is to make a list of the three objects we want, and then return the list. We can re-write the function so as to make all output to the console optional. The function will construct the list and return it invisibly.</p>
<div class="sourceCode" id="cb1077"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1077-1" data-line-number="1">drunkenSimList &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">steps =</span> <span class="dv">1000</span>, <span class="dt">reps =</span> <span class="dv">10000</span>, <span class="dt">close =</span> <span class="fl">0.5</span>, </a>
<a class="sourceLine" id="cb1077-2" data-line-number="2">                       <span class="dt">seed =</span> <span class="ot">NULL</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb1077-3" data-line-number="3">  <span class="cf">if</span> ( <span class="op">!</span><span class="kw">is.null</span>(seed) ) {</a>
<a class="sourceLine" id="cb1077-4" data-line-number="4">    <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb1077-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb1077-6" data-line-number="6">  </a>
<a class="sourceLine" id="cb1077-7" data-line-number="7">  <span class="co"># get the returns:</span></a>
<a class="sourceLine" id="cb1077-8" data-line-number="8">  returns &lt;-<span class="st"> </span><span class="kw">numeric</span>(reps)</a>
<a class="sourceLine" id="cb1077-9" data-line-number="9">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>reps) {</a>
<a class="sourceLine" id="cb1077-10" data-line-number="10">  angle &lt;-<span class="st"> </span><span class="kw">runif</span>(steps, <span class="dv">0</span> , <span class="dv">2</span><span class="op">*</span>pi)</a>
<a class="sourceLine" id="cb1077-11" data-line-number="11">  xSteps &lt;-<span class="st"> </span><span class="kw">cos</span>(angle)</a>
<a class="sourceLine" id="cb1077-12" data-line-number="12">  ySteps &lt;-<span class="st"> </span><span class="kw">sin</span>(angle)</a>
<a class="sourceLine" id="cb1077-13" data-line-number="13">  </a>
<a class="sourceLine" id="cb1077-14" data-line-number="14">  x &lt;-<span class="st"> </span><span class="kw">cumsum</span>(xSteps)</a>
<a class="sourceLine" id="cb1077-15" data-line-number="15">  y &lt;-<span class="st"> </span><span class="kw">cumsum</span>(ySteps)</a>
<a class="sourceLine" id="cb1077-16" data-line-number="16">  </a>
<a class="sourceLine" id="cb1077-17" data-line-number="17">  dist &lt;-<span class="st"> </span><span class="kw">sqrt</span>(x<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>y<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1077-18" data-line-number="18">  closeReturn &lt;-<span class="st"> </span>(dist <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb1077-19" data-line-number="19">  returns[i] &lt;-<span class="st"> </span><span class="kw">sum</span>(closeReturn)</a>
<a class="sourceLine" id="cb1077-20" data-line-number="20">  }</a>
<a class="sourceLine" id="cb1077-21" data-line-number="21">  <span class="co"># compute the table and the mean:</span></a>
<a class="sourceLine" id="cb1077-22" data-line-number="22">  tableReturns &lt;-<span class="st"> </span><span class="kw">table</span>(returns)</a>
<a class="sourceLine" id="cb1077-23" data-line-number="23">  meanReturns &lt;-<span class="st"> </span><span class="kw">mean</span>(returns)</a>
<a class="sourceLine" id="cb1077-24" data-line-number="24">  </a>
<a class="sourceLine" id="cb1077-25" data-line-number="25">  <span class="co"># handle output to console if user wants it</span></a>
<a class="sourceLine" id="cb1077-26" data-line-number="26">  <span class="cf">if</span> ( verbose ) {</a>
<a class="sourceLine" id="cb1077-27" data-line-number="27">    <span class="kw">cat</span>(<span class="st">&quot;Here is a table of the number of close returns:</span><span class="ch">\n\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb1077-28" data-line-number="28">    <span class="kw">print</span>(<span class="kw">prop.table</span>(tableReturns))</a>
<a class="sourceLine" id="cb1077-29" data-line-number="29">    <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb1077-30" data-line-number="30">    <span class="kw">cat</span>(<span class="st">&quot;The average number of close returns was:  &quot;</span>, </a>
<a class="sourceLine" id="cb1077-31" data-line-number="31">      meanReturns, <span class="st">&quot;.&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb1077-32" data-line-number="32">  }</a>
<a class="sourceLine" id="cb1077-33" data-line-number="33">  </a>
<a class="sourceLine" id="cb1077-34" data-line-number="34">  <span class="co"># assemble the desired three items into a list</span></a>
<a class="sourceLine" id="cb1077-35" data-line-number="35">  <span class="co"># (for conveneince, name the items)</span></a>
<a class="sourceLine" id="cb1077-36" data-line-number="36">  results &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">tableReturns =</span> tableReturns,</a>
<a class="sourceLine" id="cb1077-37" data-line-number="37">                  <span class="dt">meanReturns =</span> meanReturns,</a>
<a class="sourceLine" id="cb1077-38" data-line-number="38">                  <span class="dt">returns =</span> returns)</a>
<a class="sourceLine" id="cb1077-39" data-line-number="39">  <span class="co"># return the list</span></a>
<a class="sourceLine" id="cb1077-40" data-line-number="40">  <span class="kw">invisible</span>(results)</a>
<a class="sourceLine" id="cb1077-41" data-line-number="41">}</a></code></pre></div>
<p>Now we can run the function simply to acquire the simulation results for later use:</p>
<div class="sourceCode" id="cb1078"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1078-1" data-line-number="1">simResults &lt;-<span class="st"> </span><span class="kw">drunkenSimList</span>(<span class="dt">seed =</span> <span class="dv">3939</span>)</a></code></pre></div>
<p>We can use any of the results at any time and in any way we like:</p>
<div class="sourceCode" id="cb1079"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1079-1" data-line-number="1"><span class="kw">cat</span>(<span class="st">&quot;On the first ten repetitions, the number of close returns were:</span><span class="ch">\n\n\t</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb1079-2" data-line-number="2">    simResults<span class="op">$</span>returns[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>])</a></code></pre></div>
<pre><code>## On the first ten repetitions, the number of close returns were:
## 
##   0 6 4 4 2 0 2 5 2 4</code></pre>
</div>
<div id="iterating-over-a-list" class="section level2">
<h2><span class="header-section-number">7.5</span> Iterating Over a List</h2>
<p>Lists are one-dimensional, so you can loop over them just as you would loop over a atomic vector. Sometimes this can be quite useful.</p>
<p>Here is a toy example. We will write a function that, when given a list of vectors, will return a vector consisting of the means of each of the vectors in the list.</p>
<div class="sourceCode" id="cb1081"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1081-1" data-line-number="1">means &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">vecs =</span> <span class="kw">list</span>(), ...) {</a>
<a class="sourceLine" id="cb1081-2" data-line-number="2">  n &lt;-<span class="st"> </span><span class="kw">length</span>(vecs)</a>
<a class="sourceLine" id="cb1081-3" data-line-number="3">  <span class="cf">if</span> ( n <span class="op">==</span><span class="st"> </span><span class="dv">0</span> ) {</a>
<a class="sourceLine" id="cb1081-4" data-line-number="4">    <span class="kw">stop</span>(<span class="st">&quot;Need some vectors to work with!&quot;</span>)</a>
<a class="sourceLine" id="cb1081-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb1081-6" data-line-number="6">  results &lt;-<span class="st"> </span><span class="kw">numeric</span>()</a>
<a class="sourceLine" id="cb1081-7" data-line-number="7">  <span class="cf">for</span> ( vec <span class="cf">in</span> vecs ) {</a>
<a class="sourceLine" id="cb1081-8" data-line-number="8">    <span class="kw">print</span>(vec)</a>
<a class="sourceLine" id="cb1081-9" data-line-number="9">    results &lt;-<span class="st"> </span><span class="kw">c</span>(results, <span class="kw">mean</span>(vec, ...))</a>
<a class="sourceLine" id="cb1081-10" data-line-number="10">  }</a>
<a class="sourceLine" id="cb1081-11" data-line-number="11">  results</a>
<a class="sourceLine" id="cb1081-12" data-line-number="12">}</a></code></pre></div>
<div class="sourceCode" id="cb1082"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1082-1" data-line-number="1">vec1 &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">5</span></a>
<a class="sourceLine" id="cb1082-2" data-line-number="2">vec2 &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></a>
<a class="sourceLine" id="cb1082-3" data-line-number="3">vec3 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb1082-4" data-line-number="4"><span class="kw">means</span>(<span class="dt">vecs =</span> <span class="kw">list</span>(vec1, vec2, vec3), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 1 2 3 4 5
##  [1]  1  2  3  4  5  6  7  8  9 10
##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 NA</code></pre>
<pre><code>## [1]  3.0  5.5 10.5</code></pre>
<p>Another possibility—and one that will work a bit more quickly—is to iterate over the indices of the list of vectors:</p>
<div class="sourceCode" id="cb1085"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1085-1" data-line-number="1">means2 &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">vecs =</span> <span class="kw">list</span>(), ...) {</a>
<a class="sourceLine" id="cb1085-2" data-line-number="2">  n &lt;-<span class="st"> </span><span class="kw">length</span>(vecs)</a>
<a class="sourceLine" id="cb1085-3" data-line-number="3">  <span class="cf">if</span> ( n <span class="op">==</span><span class="st"> </span><span class="dv">0</span> ) {</a>
<a class="sourceLine" id="cb1085-4" data-line-number="4">    <span class="kw">return</span>(<span class="kw">cat</span>(<span class="st">&quot;Need some vectors to work with!&quot;</span>))</a>
<a class="sourceLine" id="cb1085-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb1085-6" data-line-number="6">  results &lt;-<span class="st"> </span><span class="kw">numeric</span>(n)</a>
<a class="sourceLine" id="cb1085-7" data-line-number="7">  <span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n ) {</a>
<a class="sourceLine" id="cb1085-8" data-line-number="8">    results[i] &lt;-<span class="st"> </span><span class="kw">mean</span>(vecs[[i]], ...)</a>
<a class="sourceLine" id="cb1085-9" data-line-number="9">  }</a>
<a class="sourceLine" id="cb1085-10" data-line-number="10">  results</a>
<a class="sourceLine" id="cb1085-11" data-line-number="11">}</a></code></pre></div>
<div class="sourceCode" id="cb1086"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1086-1" data-line-number="1"><span class="kw">means2</span>(<span class="dt">vecs =</span> <span class="kw">list</span>(vec1, vec2, vec3), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1]  3.0  5.5 10.5</code></pre>
</div>
<div id="a-note-on-ellipses" class="section level2">
<h2><span class="header-section-number">7.6</span> A Note on Ellipses</h2>
<p>The functions of the previous section contained a mysterious <code>...</code> argument in their definitions. This is known in R as the <em>ellipsis</em> argument, and it signals the possibility that one or more additional arguments may be supplied when the function is actually called.</p>
<p>The following function illustrates the operation of the ellipsis argument:</p>
<div class="sourceCode" id="cb1088"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1088-1" data-line-number="1">ellipisDemo &lt;-<span class="st"> </span><span class="cf">function</span>(...) {</a>
<a class="sourceLine" id="cb1088-2" data-line-number="2">  <span class="kw">cat</span>(<span class="st">&quot;I got the following arguments:</span><span class="ch">\n\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb1088-3" data-line-number="3">  <span class="kw">print</span>(<span class="kw">list</span>(...))</a>
<a class="sourceLine" id="cb1088-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb1088-5" data-line-number="5"><span class="kw">ellipisDemo</span>(<span class="dt">x =</span> <span class="dv">3</span>, <span class="dt">y =</span> <span class="st">&quot;cat&quot;</span>, <span class="dt">z =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## I got the following arguments:
## 
## $x
## [1] 3
## 
## $y
## [1] &quot;cat&quot;
## 
## $z
## [1] FALSE</code></pre>
<p>At this point in our study of R, <code>...</code> is useful in two ways.</p>
<div id="use-1-passing-additional-arguments-to-functions-inside" class="section level3">
<h3><span class="header-section-number">7.6.1</span> Use #1: Passing Additional Arguments to Functions “Inside”</h3>
<p>Look again at the code for the function <code>means2()</code>:</p>
<div class="sourceCode" id="cb1090"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1090-1" data-line-number="1">means2 &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">vecs =</span> <span class="kw">list</span>(), ...) {</a>
<a class="sourceLine" id="cb1090-2" data-line-number="2">  n &lt;-<span class="st"> </span><span class="kw">length</span>(vecs)</a>
<a class="sourceLine" id="cb1090-3" data-line-number="3">  <span class="cf">if</span> ( n <span class="op">==</span><span class="st"> </span><span class="dv">0</span> ) {</a>
<a class="sourceLine" id="cb1090-4" data-line-number="4">    <span class="kw">return</span>(<span class="kw">cat</span>(<span class="st">&quot;Need some vectors to work with!&quot;</span>))</a>
<a class="sourceLine" id="cb1090-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb1090-6" data-line-number="6">  results &lt;-<span class="st"> </span><span class="kw">numeric</span>(n)</a>
<a class="sourceLine" id="cb1090-7" data-line-number="7">  <span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n ) {</a>
<a class="sourceLine" id="cb1090-8" data-line-number="8">    results[i] &lt;-<span class="st"> </span><span class="kw">mean</span>(vecs[[i]], ...)</a>
<a class="sourceLine" id="cb1090-9" data-line-number="9">  }</a>
<a class="sourceLine" id="cb1090-10" data-line-number="10">  results</a>
<a class="sourceLine" id="cb1090-11" data-line-number="11">}</a></code></pre></div>
<p>We plan to take the mean of some vectors and therefore the <code>mean()</code> function will be used in the body of <code>means2()</code>. However we would like the user to be able to decide how <code>mean()</code> deals with <code>NA</code>-values. When we include the ellipsis argument in the definition of <code>means2()</code> we have the option to pass its contents into <code>mean()</code>, and we exercise that option in the line:</p>
<div class="sourceCode" id="cb1091"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1091-1" data-line-number="1">results[i] &lt;-<span class="st"> </span><span class="kw">mean</span>(vecs[[i]], ...)</a></code></pre></div>
<p>Now we can see what happens in the call:</p>
<div class="sourceCode" id="cb1092"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1092-1" data-line-number="1"><span class="kw">means2</span>(<span class="dt">vecs =</span> <span class="kw">list</span>(vec1, vec2, vec3), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>The ellipsis argument will consist of the argument <code>na.rm = TRUE</code>, hence the call to <code>mean()</code> inside the loop is equivalent to:</p>
<div class="sourceCode" id="cb1093"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1093-1" data-line-number="1">results[i] &lt;-<span class="st"> </span><span class="kw">mean</span>(vecs[[i]], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Consider, on the other hand, the call:</p>
<div class="sourceCode" id="cb1094"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1094-1" data-line-number="1"><span class="kw">means2</span>(<span class="dt">vecs =</span> <span class="kw">list</span>(vec1, vec2, vec3))</a></code></pre></div>
<p>Now the ellipsis is empty. In this case the code in the loop will be equivalent to:</p>
<div class="sourceCode" id="cb1095"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1095-1" data-line-number="1"><span class="kw">means2</span>(<span class="dt">vecs =</span> <span class="kw">list</span>(vec1, vec2, vec3))</a></code></pre></div>
<pre><code>## [1] 3.0 5.5  NA</code></pre>
<p>As a result, <code>mean()</code> will use the default value of <code>na.rm</code>, which is <code>FALSE</code>. For any input-vector having <code>NA</code>-values, the mean will be computed as <code>NA</code>.</p>
</div>
<div id="use-2-permitting-any-number-of-arguments" class="section level3">
<h3><span class="header-section-number">7.6.2</span> Use #2: Permitting Any Number of Arguments</h3>
<p>Another application of the ellipsis argument is in the writing of functions where the number of “primary” arguments is not determined in advance.</p>
<p>We have seen a few R-functions that can deal with any number of arguments. <code>cat()</code> is an example:</p>
<div class="sourceCode" id="cb1097"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1097-1" data-line-number="1"><span class="kw">cat</span>(<span class="st">&quot;argument one,&quot;</span>, <span class="st">&quot;argument two,&quot;</span>, <span class="st">&quot;and as many more as you like!&quot;</span>)</a></code></pre></div>
<pre><code>## argument one, argument two, and as many more as you like!</code></pre>
<p>With the ellipsis argument we can do this sort of thing ourselves. For example, here is a function that takes any number of vectors as arguments and determines whether the vectors are all of the same length:</p>
<div class="sourceCode" id="cb1099"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1099-1" data-line-number="1">sameLength &lt;-<span class="st"> </span><span class="cf">function</span>(...) {</a>
<a class="sourceLine" id="cb1099-2" data-line-number="2">  vecs &lt;-<span class="st"> </span><span class="kw">list</span>(...)</a>
<a class="sourceLine" id="cb1099-3" data-line-number="3">  numVecs &lt;-<span class="st"> </span><span class="kw">length</span>(vecs)</a>
<a class="sourceLine" id="cb1099-4" data-line-number="4">  <span class="cf">if</span> ( numVecs <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1</span> ) {</a>
<a class="sourceLine" id="cb1099-5" data-line-number="5">    <span class="kw">return</span>(<span class="kw">cat</span>(<span class="st">&quot;Need two or more vectors.&quot;</span>))</a>
<a class="sourceLine" id="cb1099-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb1099-7" data-line-number="7">  allSame &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb1099-8" data-line-number="8">  len &lt;-<span class="st"> </span><span class="kw">length</span>(vecs[[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb1099-9" data-line-number="9">  <span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>numVecs ) {</a>
<a class="sourceLine" id="cb1099-10" data-line-number="10">    <span class="cf">if</span> ( <span class="kw">length</span>(vecs[[i]]) <span class="op">!=</span><span class="st"> </span>len ) {</a>
<a class="sourceLine" id="cb1099-11" data-line-number="11">      allSame &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb1099-12" data-line-number="12">      <span class="cf">break</span></a>
<a class="sourceLine" id="cb1099-13" data-line-number="13">    }</a>
<a class="sourceLine" id="cb1099-14" data-line-number="14">  }</a>
<a class="sourceLine" id="cb1099-15" data-line-number="15">  allSame </a>
<a class="sourceLine" id="cb1099-16" data-line-number="16">}</a></code></pre></div>
<p>We can give this function two or more vectors, as follows:</p>
<div class="sourceCode" id="cb1100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1100-1" data-line-number="1">vec1 &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span></a>
<a class="sourceLine" id="cb1100-2" data-line-number="2">vec2 &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span></a>
<a class="sourceLine" id="cb1100-3" data-line-number="3">vec3 &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span></a>
<a class="sourceLine" id="cb1100-4" data-line-number="4"><span class="kw">sameLength</span>(vec1, vec2, vec3)</a></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
</div>
</div>
<div id="investigate-your-object-str-and-lists" class="section level2">
<h2><span class="header-section-number">7.7</span> Investigate Your Object: <code>str()</code> and Lists</h2>
<p>Let’s reconsider the Meetup Simulation from Section @ref(simulation-connect):</p>
<div class="sourceCode" id="cb1102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1102-1" data-line-number="1">meetupSim &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">reps =</span> <span class="dv">10000</span>, <span class="dt">table =</span> <span class="ot">FALSE</span>, <span class="dt">seed =</span> <span class="ot">NULL</span>) {</a>
<a class="sourceLine" id="cb1102-2" data-line-number="2">  <span class="cf">if</span> ( <span class="op">!</span><span class="kw">is.null</span>(seed) ) {</a>
<a class="sourceLine" id="cb1102-3" data-line-number="3">    <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb1102-4" data-line-number="4">  }</a>
<a class="sourceLine" id="cb1102-5" data-line-number="5">  anna &lt;-<span class="st"> </span><span class="kw">runif</span>(reps, <span class="dv">0</span>, <span class="dv">60</span>)</a>
<a class="sourceLine" id="cb1102-6" data-line-number="6">  raj &lt;-<span class="st"> </span><span class="kw">runif</span>(reps, <span class="dv">0</span>, <span class="dv">60</span>)</a>
<a class="sourceLine" id="cb1102-7" data-line-number="7">  connect &lt;-<span class="st"> </span>(<span class="kw">abs</span>(anna <span class="op">-</span><span class="st"> </span>raj) <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb1102-8" data-line-number="8">  <span class="cf">if</span> ( table ) {</a>
<a class="sourceLine" id="cb1102-9" data-line-number="9">    <span class="kw">cat</span>(<span class="st">&quot;Here is a table of the results:</span><span class="ch">\n\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb1102-10" data-line-number="10">    <span class="kw">print</span>(<span class="kw">table</span>(connect))</a>
<a class="sourceLine" id="cb1102-11" data-line-number="11">    <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb1102-12" data-line-number="12">  }</a>
<a class="sourceLine" id="cb1102-13" data-line-number="13">  <span class="kw">cat</span>(<span class="st">&quot;The proportion of tims they met was &quot;</span>, <span class="kw">mean</span>(connect), <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb1102-14" data-line-number="14">}</a></code></pre></div>
<p>You will recall that when the user asks for a table of results, the function prints out a table that looks like this:</p>
<pre><code>## Here is a table of the results:

## connect
## FALSE  TRUE 
## 69781 30219 </code></pre>
<p>There are a couple of small irritations, here:</p>
<ul>
<li>The name of the table (“connect”) appears in the output, even though it was a name that was given in the code internal to the function. As a name for the output-table, it’s not the most descriptive choice. Besides, we really don’t need a name here, because have just <code>cat</code>-ed out a sentence that introduces the table.</li>
<li>The names for the columns (<code>FALSE</code> and <code>TRUE</code>) again pertain to features internal to the code of the function. The user should see more descriptive names.</li>
</ul>
<p>In order to investigate how we might deal with these issues, let’s create a small table here:</p>
<div class="sourceCode" id="cb1104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1104-1" data-line-number="1">logicalVector &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="ot">TRUE</span>, <span class="dv">6</span>), <span class="kw">rep</span>(<span class="ot">FALSE</span>, <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb1104-2" data-line-number="2">tab &lt;-<span class="st"> </span><span class="kw">table</span>(logicalVector)</a>
<a class="sourceLine" id="cb1104-3" data-line-number="3">tab</a></code></pre></div>
<pre><code>## logicalVector
## FALSE  TRUE 
##     4     6</code></pre>
<p>One way to deal with the column-name issues might be to isolate each table value and then repackage the values. We can access the individual table-values with sub-setting. For example, the first value is:</p>
<div class="sourceCode" id="cb1106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1106-1" data-line-number="1">tab[<span class="dv">1</span>]</a></code></pre></div>
<pre><code>## FALSE 
##     4</code></pre>
<p>Hence we could grab the values, create a vector from them, and then provide names for the vector that we like. Thus:</p>
<div class="sourceCode" id="cb1108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1108-1" data-line-number="1">results &lt;-<span class="st"> </span><span class="kw">c</span>(tab[<span class="dv">1</span>], tab[<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb1108-2" data-line-number="2"><span class="kw">names</span>(results) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;did not meet&quot;</span>, <span class="st">&quot;met&quot;</span>)</a>
<a class="sourceLine" id="cb1108-3" data-line-number="3">results</a></code></pre></div>
<pre><code>## did not meet          met 
##            4            6</code></pre>
<p>Another approach—and this is the more instructive and generally-useful procedure—is to begin by looking carefully at the structure of the problematic object:</p>
<div class="sourceCode" id="cb1110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1110-1" data-line-number="1"><span class="kw">str</span>(tab)</a></code></pre></div>
<pre><code>##  &#39;table&#39; int [1:2(1d)] 4 6
##  - attr(*, &quot;dimnames&quot;)=List of 1
##   ..$ logicalVector: chr [1:2] &quot;FALSE&quot; &quot;TRUE&quot;</code></pre>
<p>We see that</p>
<ul>
<li>the table has an attribute called <code>dimnames</code></li>
<li><code>dimnames</code> is a list of length one.</li>
<li>It is a named list. The name of its only element is <code>logicalVector</code>.</li>
<li>The elements of this vector are the column names for the table.</li>
</ul>
<p>If you would like to see the <code>dimnames</code> attribute all by itself, you can access it with the <code>attr()</code> function :</p>
<div class="sourceCode" id="cb1112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1112-1" data-line-number="1"><span class="kw">attr</span>(tab, <span class="dt">which =</span> <span class="st">&quot;dimnames&quot;</span>)  <span class="co"># &quot;which&quot; says which attribute you want!</span></a></code></pre></div>
<pre><code>## $logicalVector
## [1] &quot;FALSE&quot; &quot;TRUE&quot;</code></pre>
<p>You can also use <code>attr()</code> to <em>set</em> the values of an attribute. Here, we want <code>dimnames</code> to be a list of length one that does not have a name for its sole element. The following should do the trick:</p>
<div class="sourceCode" id="cb1114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1114-1" data-line-number="1"><span class="kw">attr</span>(tab, <span class="dt">which =</span> <span class="st">&quot;dimnames&quot;</span>) &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&quot;did not meet&quot;</span>, <span class="st">&quot;met&quot;</span>))</a></code></pre></div>
<p>Let’s see if this worked:</p>
<div class="sourceCode" id="cb1115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1115-1" data-line-number="1">tab</a></code></pre></div>
<pre><code>## did not meet          met 
##            4            6</code></pre>
<p>It appears to have worked very nicely! Hence we may rewrite <code>meetupSim()</code> as follows:</p>
<div class="sourceCode" id="cb1117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1117-1" data-line-number="1">meetupSim &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">reps =</span> <span class="dv">10000</span>, <span class="dt">table =</span> <span class="ot">FALSE</span>, <span class="dt">seed =</span> <span class="ot">NULL</span>) {</a>
<a class="sourceLine" id="cb1117-2" data-line-number="2">  <span class="cf">if</span> ( <span class="op">!</span><span class="kw">is.null</span>(seed) ) {</a>
<a class="sourceLine" id="cb1117-3" data-line-number="3">    <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb1117-4" data-line-number="4">  }</a>
<a class="sourceLine" id="cb1117-5" data-line-number="5">  anna &lt;-<span class="st"> </span><span class="kw">runif</span>(reps, <span class="dv">0</span>, <span class="dv">60</span>)</a>
<a class="sourceLine" id="cb1117-6" data-line-number="6">  raj &lt;-<span class="st"> </span><span class="kw">runif</span>(reps, <span class="dv">0</span>, <span class="dv">60</span>)</a>
<a class="sourceLine" id="cb1117-7" data-line-number="7">  connect &lt;-<span class="st"> </span>(<span class="kw">abs</span>(anna <span class="op">-</span><span class="st"> </span>raj) <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb1117-8" data-line-number="8">  <span class="cf">if</span> ( table ) {</a>
<a class="sourceLine" id="cb1117-9" data-line-number="9">    <span class="kw">cat</span>(<span class="st">&quot;Here is a table of the results:</span><span class="ch">\n\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb1117-10" data-line-number="10">    tab &lt;-<span class="st"> </span><span class="kw">table</span>(connect)</a>
<a class="sourceLine" id="cb1117-11" data-line-number="11">    <span class="kw">attr</span>(tab, <span class="dt">which =</span> <span class="st">&quot;dimnames&quot;</span>) &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&quot;did not meet&quot;</span>, <span class="st">&quot;met&quot;</span>))</a>
<a class="sourceLine" id="cb1117-12" data-line-number="12">    <span class="kw">print</span>(tab)</a>
<a class="sourceLine" id="cb1117-13" data-line-number="13">    <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb1117-14" data-line-number="14">  }</a>
<a class="sourceLine" id="cb1117-15" data-line-number="15">  <span class="kw">cat</span>(<span class="st">&quot;The proportion of tims they met was &quot;</span>, <span class="kw">mean</span>(connect), <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb1117-16" data-line-number="16">}</a></code></pre></div>
<p>Let’s try it out:</p>
<div class="sourceCode" id="cb1118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1118-1" data-line-number="1"><span class="kw">meetupSim</span>(<span class="dt">reps =</span> <span class="dv">100000</span>, <span class="dt">table =</span> <span class="ot">TRUE</span>, <span class="dt">seed =</span> <span class="dv">3939</span>)</a></code></pre></div>
<pre><code>## Here is a table of the results:
## 
## did not meet          met 
##        69781        30219 
## 
## The proportion of tims they met was 0.30219.</code></pre>
<p>Much better!</p>
<p>The moral of the story is:</p>
<blockquote>
<p>Make a habit of examining your objects with the <code>str()</code> function. Combining <code>str()</code> with your abilities to manipulate lists allows you to access and set pieces of the object in helpful ways.</p>
</blockquote>
<p><strong>Note</strong>: the <code>dimnames</code> attribute for tables and matrices is so frequently used that it has its own special function for accessing and setting: <code>dimnames()</code>. Other popular attributes, such as <code>names</code> for a vector and <code>levels</code> for a factor, also have dedicated access/set functions—<code>names()</code> and <code>levels()</code> respectively. But keep in mind that you can access and set the values for <em>any attribute at all</em> with the <code>attr()</code> function.</p>
<div id="practice-exercises-21" class="section level3">
<h3><span class="header-section-number">7.7.1</span> Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Consider the following matrix:</p>
<div class="sourceCode" id="cb1120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1120-1" data-line-number="1">myMat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">24</span>, <span class="dt">nrow =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb1120-2" data-line-number="2"><span class="kw">rownames</span>(myMat) &lt;-<span class="st"> </span>letters[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]</a>
<a class="sourceLine" id="cb1120-3" data-line-number="3"><span class="kw">colnames</span>(myMat) &lt;-<span class="st"> </span>LETTERS[<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>]</a>
<a class="sourceLine" id="cb1120-4" data-line-number="4">myMat</a></code></pre></div>
<pre><code>##   A B  C  D  E  F
## a 1 5  9 13 17 21
## b 2 6 10 14 18 22
## c 3 7 11 15 19 23
## d 4 8 12 16 20 24</code></pre>
<p>Find a way to change the row names of <code>myMAT</code> to “x”, “y”, “z” and “w”, using the <code>attr()</code> function rather than the <code>rownames()</code> function.</p></li>
</ol>
</div>
<div id="solutions-to-practice-exercises-15" class="section level3">
<h3><span class="header-section-number">7.7.2</span> Solutions to Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>First, run <code>str(myMat)</code>. You find that it has an attribute called <code>dimnames</code> that is a list of length 2. The first element of this list is the vector of row names. Hence you need to assign new row names to this element. You can do so as follows:</p>
<div class="sourceCode" id="cb1122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1122-1" data-line-number="1"><span class="kw">attr</span>(myMat, <span class="dt">which =</span> <span class="st">&quot;dimnames&quot;</span>)[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;z&quot;</span>, <span class="st">&quot;w&quot;</span>)</a>
<a class="sourceLine" id="cb1122-2" data-line-number="2">myMat</a></code></pre></div>
<pre><code>##   A B  C  D  E  F
## x 1 5  9 13 17 21
## y 2 6 10 14 18 22
## z 3 7 11 15 19 23
## w 4 8 12 16 20 24</code></pre>
<p>It worked!</p></li>
</ol>

</div>
</div>
<div id="glossary-5" class="section level2 unnumbered">
<h2>Glossary</h2>
<dl>
<dt>List </dt>
<dd><p>A <em>heterogeneous</em> vector; that is, a vector whose elements can be any sort of R-object.</p>
</dd>
</dl>

</div>
<div id="exercises-3" class="section level2 unnumbered">
<h2>Exercises</h2>
<p><img src="images/thinking.png" width="50%" style="display: block; margin: auto;" /></p>
<ol style="list-style-type: decimal">
<li><p>We are given the following list:</p>
<div class="sourceCode" id="cb1124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1124-1" data-line-number="1">lst &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">yabba =</span> letters,</a>
<a class="sourceLine" id="cb1124-2" data-line-number="2">            <span class="dt">dabba =</span> <span class="kw">list</span>(<span class="dt">x =</span> LETTERS,</a>
<a class="sourceLine" id="cb1124-3" data-line-number="3">                         <span class="dt">y =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>),</a>
<a class="sourceLine" id="cb1124-4" data-line-number="4">            <span class="dt">do =</span> bcscr<span class="op">::</span>m111survey)</a></code></pre></div>
<p>One way to access the letter “b” in the first element of <code>lst</code> is as follows:</p>
<div class="sourceCode" id="cb1125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1125-1" data-line-number="1">lst<span class="op">$</span>yabba[<span class="dv">2</span>]</a></code></pre></div>
<pre><code>## [1] &quot;b&quot;</code></pre>
<p>Another way is:</p>
<div class="sourceCode" id="cb1127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1127-1" data-line-number="1">lst[[<span class="dv">1</span>]][<span class="dv">2</span>]</a></code></pre></div>
<pre><code>## [1] &quot;b&quot;</code></pre>
For each of the following objects, find at least two ways to access it within <code>lst</code>:
<ul>
<li>the vector of letters from “c” to “j”;</li>
<li>the capital letter “F”;</li>
<li>the vector of numbers from 1 to 10;</li>
<li>the heights of the five tallest individuals in <code>m111survey</code>.</li>
</ul></li>
<li>Write a function called <code>goodStats()</code> that, when given a vector of numerical values, computes the mean, median and standard deviation of the values, and returns these values in a list. The function should take two parameters:
<ul>
<li><code>x</code>: the vector of numerical values;</li>
<li><code>...</code>: the ellipses, which allow the user to pass in additional arguments.</li>
</ul>
The list returned should name each of the three quantities:
<ul>
<li>the name of the mean should be <code>mean</code>;</li>
<li>the name of the standard deviation should be <code>sd</code>;</li>
<li>the name of the median should be <code>median</code>.</li>
</ul>
<p>Typical examples of use should look like this:</p>
<div class="sourceCode" id="cb1129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1129-1" data-line-number="1">vec &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">5</span></a>
<a class="sourceLine" id="cb1129-2" data-line-number="2"><span class="kw">goodStats</span>(<span class="dt">x =</span> vec)</a></code></pre></div>
<pre><code>## $mean
## [1] 3
## 
## $sd
## [1] 1.581139
## 
## $median
## [1] 3</code></pre>
<div class="sourceCode" id="cb1131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1131-1" data-line-number="1">vec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">9</span>, <span class="dv">11</span>, <span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb1131-2" data-line-number="2">myStats &lt;-<span class="st"> </span><span class="kw">goodStats</span>(<span class="dt">x =</span> vec, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1131-3" data-line-number="3">myStats<span class="op">$</span>mean</a></code></pre></div>
<pre><code>## [1] 7.5</code></pre></li>
</ol>
<!--chapter:end:090-lists.Rmd-->
</div>
</div>
<div id="part-csc-215" class="section level1 unnumbered">
<h1>(PART) CSC 215</h1>
</div>
<div id="tidyverse-concepts" class="section level1">
<h1><span class="header-section-number">8</span> Basic Tidyverse Concepts</h1>
<div class="figure" style="text-align: center">
<img src="images/pipe.jpeg" alt="The Treachery of Images (Rene Magritte, 1948)." width="40%" />
<p class="caption">
(#fig:magritte-image)The Treachery of Images (Rene Magritte, 1948).
</p>
</div>
<p>In this chapter we will introduce a few tools from the <strong>tidyverse</strong> set of R-packages:</p>
<ul>
<li>the pipe operator <code>%&gt;%</code> for chaining function calls in a convenient and readable way;</li>
<li>the <code>tibble</code> class, a variant of the data frame that is especially suitable for large data sets;</li>
<li>data manipulation functions from the **dplyr* package suitable for use with the pipe operator:
<ul>
<li><code>filter()</code> and <code>select()</code> for sub-setting;</li>
<li><code>mutate()</code> for transforming variables;</li>
<li><code>group_by()</code> and <code>summarise()</code> for numerical summaries of data.</li>
</ul></li>
</ul>

<div id="tidyverse" class="section level2">
<h2><span class="header-section-number">8.1</span> The Tidyverse</h2>
<p>The <strong>tidyverse</strong> isn’t a package, exactly—it’s a collection of packages. Go ahead and attach it:</p>
<div class="sourceCode" id="cb1133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1133-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a></code></pre></div>
<pre><code>## Loading tidyverse: ggplot2
## Loading tidyverse: tibble
## Loading tidyverse: tidyr
## Loading tidyverse: readr
## Loading tidyverse: purrr
## Loading tidyverse: dplyr
## Conflicts with tidy packages -----------------------
## filter(): dplyr, stats
## lag():    dplyr, stats</code></pre>
<p>You get an account of the packages that have been attached. We have worked before with <strong>ggplot</strong> and by the end of CSC 215 we will have worked with all of the others. You need not worry about the fact that <code>filter()</code> and <code>lag()</code> mask functions from the <strong>stats</strong> package.</p>

</div>
<div id="the-pipe-operator" class="section level2">
<h2><span class="header-section-number">8.2</span> The Pipe Operator</h2>
<p>The pipe operator looks like this: <code>%&gt;%</code>. It comes from the <strong>magrittr</strong> package.<a href="#fn16" class="footnote-ref" id="fnref16"><sup>16</sup></a></p>
<p>The pipe operator connects two function calls by making the value returned by the first call the first argument of the second call. Here’s an example:</p>
<div class="sourceCode" id="cb1135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1135-1" data-line-number="1"><span class="st">&quot;hello&quot;</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rep</span>(<span class="dt">times =</span> <span class="dv">4</span>)</a></code></pre></div>
<pre><code>## [1] &quot;hello&quot; &quot;hello&quot; &quot;hello&quot; &quot;hello&quot;</code></pre>
<p>This is the same as the more familiar:</p>
<div class="sourceCode" id="cb1137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1137-1" data-line-number="1"><span class="kw">rep</span>(<span class="st">&quot;hello&quot;</span>, <span class="dt">times =</span> <span class="dv">4</span>)</a></code></pre></div>
<pre><code>## [1] &quot;hello&quot; &quot;hello&quot; &quot;hello&quot; &quot;hello&quot;</code></pre>
<p>Here’s another example:</p>
<div class="sourceCode" id="cb1139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1139-1" data-line-number="1"><span class="co"># same as nrow(bcscr::m111survey)</span></a>
<a class="sourceLine" id="cb1139-2" data-line-number="2">bcscr<span class="op">::</span>m111survey <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>()</a></code></pre></div>
<pre><code>## [1] 71</code></pre>
<p>Here’s two pipes:</p>
<div class="sourceCode" id="cb1141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1141-1" data-line-number="1"><span class="st">&quot;hello&quot;</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rep</span>(<span class="dt">times =</span> <span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">length</span>()</a></code></pre></div>
<pre><code>## [1] 4</code></pre>
<p>By default the value of the left-hand call is piped into the right-hand call as the <em>first</em> argument. You can make it some other argument by referring to it as the dot <code>.</code>, for example:</p>
<div class="sourceCode" id="cb1143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1143-1" data-line-number="1"><span class="dv">4</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;hello&quot;</span>, <span class="dt">times =</span> .)</a></code></pre></div>
<pre><code>## [1] &quot;hello&quot; &quot;hello&quot; &quot;hello&quot; &quot;hello&quot;</code></pre>
<p>Since sub-setting is actually a function call under the hood, you can use the dot there, too:</p>
<div class="sourceCode" id="cb1145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1145-1" data-line-number="1"><span class="co"># gets the third element of the sequence 1, 4, 9, ..., 97:</span></a>
<a class="sourceLine" id="cb1145-2" data-line-number="2"><span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">100</span>, <span class="dt">by =</span> <span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span>.[<span class="dv">3</span>]</a></code></pre></div>
<pre><code>## [1] 9</code></pre>
<p>The pipe operator isn’t all that useful when you only use it once or twice in succession. Its true value becomes apparent in the chaining together of many manipulations involving data frames.</p>
<div id="practice-exercises-22" class="section level3">
<h3><span class="header-section-number">8.2.1</span> Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Rewrite the following call with the pipe operator, in three different ways:</p>
<div class="sourceCode" id="cb1147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1147-1" data-line-number="1"><span class="kw">seq</span>(<span class="dv">2</span>, <span class="dv">22</span>, <span class="dt">by =</span> <span class="dv">4</span>)</a></code></pre></div>
<pre><code>## [1]  2  6 10 14 18 22</code></pre></li>
<li><p>Consider <code>mosaicData::CPS85</code>:</p>
<div class="sourceCode" id="cb1149"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1149-1" data-line-number="1"><span class="kw">data</span>(<span class="st">&quot;CPS85&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;mosaicData&quot;</span>)</a></code></pre></div>
<p>Use the pipe operator with <code>subset()</code> to find the row of <code>mosaicData::CPS85</code> containing the worker who made more than 40 dollars per hour. Display only the sex, age and wage of the worker.</p></li>
</ol>
</div>
<div id="solutions-to-the-practice-exercises-9" class="section level3">
<h3><span class="header-section-number">8.2.2</span> Solutions to the Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Here are three ways:</p>
<div class="sourceCode" id="cb1150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1150-1" data-line-number="1"><span class="dv">2</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">seq</span>(<span class="dv">22</span>, <span class="dt">by =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb1150-2" data-line-number="2"><span class="dv">22</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">seq</span>(<span class="dv">2</span>, ., <span class="dt">by =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb1150-3" data-line-number="3"><span class="dv">4</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">seq</span>(<span class="dv">2</span>, <span class="dv">22</span>, <span class="dt">by =</span> .)</a></code></pre></div></li>
<li><p>Try this:</p>
<div class="sourceCode" id="cb1151"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1151-1" data-line-number="1">CPS85 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1151-2" data-line-number="2"><span class="st">  </span><span class="kw">subset</span>(wage <span class="op">&gt;</span><span class="st"> </span><span class="dv">40</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1151-3" data-line-number="3"><span class="st">  </span>.[, <span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;wage&quot;</span>)]</a></code></pre></div>
<pre><code>##     sex age wage
## 249   F  21 44.5</code></pre></li>
</ol>

</div>
</div>
<div id="tibbles" class="section level2">
<h2><span class="header-section-number">8.3</span> Tibbles</h2>
<p>The <strong>tibble</strong> package gives us tibbles, which are very nearly the same thing as a data frame. Indeed, the name “tibble” is supposed to remind us of a data “table.”</p>
<p>Consider the class of <code>bcscr::m111survey</code>:</p>
<div class="sourceCode" id="cb1153"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1153-1" data-line-number="1"><span class="kw">class</span>(bcscr<span class="op">::</span>m111survey)</a></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<p>Yep, it’s a data frame. But we can convert it to a tibble, as follows:</p>
<div class="sourceCode" id="cb1155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1155-1" data-line-number="1">survey &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(bcscr<span class="op">::</span>m111survey)</a>
<a class="sourceLine" id="cb1155-2" data-line-number="2"><span class="kw">class</span>(survey)</a></code></pre></div>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<p>You can treat tibbles like data frames. For now the primary practical difference is manifest when you print a tibble to the Console:</p>
<div class="sourceCode" id="cb1157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1157-1" data-line-number="1">survey</a></code></pre></div>
<pre><code>## # A tibble: 71 x 12
##    height ideal_ht sleep fastest weight_feel love_first extra_life seat 
##     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;int&gt; &lt;fct&gt;       &lt;fct&gt;      &lt;fct&gt;      &lt;fct&gt;
##  1   76         78   9.5     119 1_underwei… no         yes        1_fr…
##  2   74         76   7       110 2_about_ri… no         yes        2_mi…
##  3   64         NA   9        85 2_about_ri… no         no         2_mi…
##  4   62         65   7       100 1_underwei… no         no         1_fr…
##  5   72         72   8        95 1_underwei… no         yes        3_ba…
##  6   70.8       NA  10       100 3_overweig… no         no         1_fr…
##  7   70         72   4        85 2_about_ri… no         yes        1_fr…
##  8   79         76   6       160 2_about_ri… no         yes        3_ba…
##  9   59         61   7        90 2_about_ri… no         yes        3_ba…
## 10   67         67   7        90 3_overweig… no         no         2_mi…
## # ... with 61 more rows, and 4 more variables: GPA &lt;dbl&gt;,
## #   enough_Sleep &lt;fct&gt;, sex &lt;fct&gt;, diff.ideal.act. &lt;dbl&gt;</code></pre>
<p>The output is automatically truncated, and the number of columns printed is determined by the width of your screen. This is a great convenience when one is dealing with larger data sets.</p>
<p>Many larger data tables in packages will come to you as tibbles.</p>

</div>
<div id="subsetting-with-dplyr" class="section level2">
<h2><span class="header-section-number">8.4</span> Subsetting with dplyr</h2>
<p>The <strong>dplyr</strong> function <code>filter()</code> is the rough equivalent of <code>select()</code>: it picks out rows of a data frame (or similar objects such as a tibble). The <strong>dplyr</strong> function <code>select()</code> subsets for columns.</p>
<p>Thus you can use the two functions together to do perform sub-setting. With the pipe operator, your code can be quite easy to read:</p>
<div class="sourceCode" id="cb1159"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1159-1" data-line-number="1">survey <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1159-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>((sex <span class="op">==</span><span class="st"> &quot;male&quot;</span> <span class="op">&amp;</span><span class="st"> </span>height <span class="op">&gt;</span><span class="st"> </span><span class="dv">70</span>) <span class="op">|</span><span class="st"> </span>(sex <span class="op">==</span><span class="st">&quot;female&quot;</span> <span class="op">&amp;</span><span class="st"> </span>height <span class="op">&lt;</span><span class="st"> </span><span class="dv">55</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1159-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(sex, height, fastest)</a></code></pre></div>
<pre><code>## # A tibble: 22 x 3
##    sex    height fastest
##    &lt;fct&gt;   &lt;dbl&gt;   &lt;int&gt;
##  1 male     76       119
##  2 male     74       110
##  3 male     72        95
##  4 male     70.8     100
##  5 male     79       160
##  6 male     73       110
##  7 male     73       120
##  8 female   54       130
##  9 male     74       119
## 10 male     72       125
## # ... with 12 more rows</code></pre>
<p>Note that <strong>dplyr</strong> data-functions like <code>filter()</code> and <code>select()</code> take a data table as their first argument, and return a data table as well. Hence they may be chained together as we saw in the above example.</p>
<p>With <code>select()</code> it’s easy to leave out columns, too:</p>
<div class="sourceCode" id="cb1161"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1161-1" data-line-number="1">survey <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1161-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>ideal_ht, <span class="op">-</span>love_first)</a></code></pre></div>
<pre><code>## # A tibble: 71 x 10
##    height sleep fastest weight_feel extra_life seat    GPA enough_Sleep
##     &lt;dbl&gt; &lt;dbl&gt;   &lt;int&gt; &lt;fct&gt;       &lt;fct&gt;      &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt;       
##  1   76     9.5     119 1_underwei… yes        1_fr…  3.56 no          
##  2   74     7       110 2_about_ri… yes        2_mi…  2.5  no          
##  3   64     9        85 2_about_ri… no         2_mi…  3.8  no          
##  4   62     7       100 1_underwei… no         1_fr…  3.5  no          
##  5   72     8        95 1_underwei… yes        3_ba…  3.2  no          
##  6   70.8  10       100 3_overweig… no         1_fr…  3.1  yes         
##  7   70     4        85 2_about_ri… yes        1_fr…  3.68 no          
##  8   79     6       160 2_about_ri… yes        3_ba…  2.7  yes         
##  9   59     7        90 2_about_ri… yes        3_ba…  2.8  no          
## 10   67     7        90 3_overweig… no         2_mi… NA    yes         
## # ... with 61 more rows, and 2 more variables: sex &lt;fct&gt;,
## #   diff.ideal.act. &lt;dbl&gt;</code></pre>
<div id="practice-exercises-23" class="section level3">
<h3><span class="header-section-number">8.4.1</span> Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Can you use the pipe to chain <strong>dplyr</strong> functions along with <code>nrow()</code> to find out how many people in <code>survey</code> believe in love at first sight and drove more than 120 miles per hour?</p></li>
<li><p>Find the three largest heights of the males who drove more than 120 miles per hour.</p></li>
<li><p>Use the pipe and <code>filter()</code> to make violin plots of the wages of men and women in <code>CPS85</code>, where the outlier-person (whose wage was more than 40 dollars per hour) has been eliminated prior to making the graph.</p></li>
</ol>
</div>
<div id="solutions-to-practice-exercises-16" class="section level3">
<h3><span class="header-section-number">8.4.2</span> Solutions to Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Try this:</p>
<div class="sourceCode" id="cb1163"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1163-1" data-line-number="1">survey <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1163-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(love_first <span class="op">==</span><span class="st"> &quot;yes&quot;</span> <span class="op">&amp;</span><span class="st"> </span>fastest <span class="op">&gt;</span><span class="st"> </span><span class="dv">120</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1163-3" data-line-number="3"><span class="st">  </span><span class="kw">nrow</span>()</a></code></pre></div>
<pre><code>## [1] 3</code></pre></li>
<li><p>Here’s one way:</p>
<div class="sourceCode" id="cb1165"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1165-1" data-line-number="1">survey <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1165-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(sex <span class="op">==</span><span class="st"> &quot;male&quot;</span> <span class="op">&amp;</span><span class="st"> </span>fastest <span class="op">&gt;</span><span class="st"> </span><span class="dv">120</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1165-3" data-line-number="3"><span class="st">  </span>.<span class="op">$</span>height <span class="op">%&gt;%</span><span class="st">                 </span><span class="co"># this is just a vector</span></a>
<a class="sourceLine" id="cb1165-4" data-line-number="4"><span class="st">  </span><span class="kw">sort</span>(<span class="dt">decreasing =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># so you can sort it ... </span></a>
<a class="sourceLine" id="cb1165-5" data-line-number="5"><span class="st">  </span>.[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]                       <span class="co"># then get its first three elements</span></a></code></pre></div>
<pre><code>## [1] 79 75 75</code></pre></li>
<li><p>Try this code:</p>
<div class="sourceCode" id="cb1167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1167-1" data-line-number="1">CPS85 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1167-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(wage <span class="op">&lt;=</span><span class="st"> </span><span class="dv">40</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1167-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> sex, <span class="dt">y =</span> wage)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1167-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_violin</span>(<span class="dt">fill =</span> <span class="st">&quot;burlywood&quot;</span>)</a></code></pre></div></li>
</ol>

</div>
</div>
<div id="transforming-variables-with-dplyr" class="section level2">
<h2><span class="header-section-number">8.5</span> Transforming Variables with dplyr</h2>
<p>In <strong>dplyr</strong> you transform variables with the function <code>mutate()</code>. Here is an example:</p>
<div class="sourceCode" id="cb1168"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1168-1" data-line-number="1">survey <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1168-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dareDevil =</span> fastest <span class="op">&gt;</span><span class="st"> </span><span class="dv">125</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1168-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(sex, fastest, dareDevil)</a></code></pre></div>
<pre><code>## # A tibble: 71 x 3
##    sex    fastest dareDevil
##    &lt;fct&gt;    &lt;int&gt; &lt;lgl&gt;    
##  1 male       119 FALSE    
##  2 male       110 FALSE    
##  3 female      85 FALSE    
##  4 female     100 FALSE    
##  5 male        95 FALSE    
##  6 male       100 FALSE    
##  7 male        85 FALSE    
##  8 male       160 TRUE     
##  9 female      90 FALSE    
## 10 female      90 FALSE    
## # ... with 61 more rows</code></pre>
<p>In <code>mutate()</code> there is always a variable-name on the left-hand side of the <code>=</code> sign. It could be the same as an existing variable in the table if you are content to overwrite that variable. On the right side of the <code>=</code> is a function that can depend on variables in the data table.</p>
<p>You can transform more than one variable in a single call to <code>mutate()</code>, as in the code below. The output is shown in @ref(fig:mutatefastest).</p>
<div class="sourceCode" id="cb1170"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1170-1" data-line-number="1">survey <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1170-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dareDevil =</span> fastest <span class="op">&gt;</span><span class="st"> </span><span class="dv">125</span>,</a>
<a class="sourceLine" id="cb1170-3" data-line-number="3">         <span class="dt">speedKmHr =</span> fastest <span class="op">*</span><span class="st"> </span><span class="fl">1.60934</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1170-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> dareDevil, <span class="dt">y =</span> GPA)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1170-5" data-line-number="5"><span class="st">    </span><span class="kw">geom_boxplot</span>(<span class="dt">fill =</span> <span class="st">&quot;burlywood&quot;</span>, <span class="dt">out.alpha =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1170-6" data-line-number="6"><span class="st">    </span><span class="kw">geom_jitter</span>(<span class="dt">width =</span> <span class="fl">0.2</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/mutatefastest-1.png" alt="Graph produced after mutation." width="95%" />
<p class="caption">
(#fig:mutatefastest)Graph produced after mutation.
</p>
</div>
<div id="practice-exercises-24" class="section level3">
<h3><span class="header-section-number">8.5.1</span> Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li>In <code>mosaicData::CPS85</code> transform the <code>wage</code> variable to units of dollars per day. (Assume an 8-hour working day.)</li>
</ol>
</div>
<div id="solutions-to-practice-exercises-17" class="section level3">
<h3><span class="header-section-number">8.5.2</span> Solutions to Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Try this:</p>
<div class="sourceCode" id="cb1171"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1171-1" data-line-number="1">CPS85 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1171-2" data-line-number="2"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st">                   </span><span class="co"># for display in Console</span></a>
<a class="sourceLine" id="cb1171-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dailyWage =</span> wage <span class="op">*</span><span class="st"> </span><span class="dv">8</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1171-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(sex, sector, dailyWage)    <span class="co"># for display in Console</span></a></code></pre></div>
<pre><code>## # A tibble: 534 x 3
##    sex   sector   dailyWage
##    &lt;fct&gt; &lt;fct&gt;        &lt;dbl&gt;
##  1 M     const         72  
##  2 M     sales         44  
##  3 F     sales         30.4
##  4 F     clerical      84  
##  5 M     const        120  
##  6 F     clerical      72  
##  7 F     service       76.6
##  8 M     sales        120  
##  9 M     manuf         88  
## 10 F     sales         40  
## # ... with 524 more rows</code></pre></li>
</ol>
</div>
</div>
<div id="grouping-and-summaries" class="section level2">
<h2><span class="header-section-number">8.6</span> Grouping and Summaries</h2>
<p>
</p>
<p>The next two <strong>dplyr</strong> data-functions are useful for generating numerical summaries of data.</p>
<p>Consider, for example, <code>CPS85</code>. We know from graphical studies that the men in the study are paid more than women, but how might we verify this fact numerically? One approach would be to separate the men and the women into two different groups and compute the mean wage for each group. This is accomplished by calling <code>group_by()</code> and <code>summarise()</code> in succession:</p>
<div class="sourceCode" id="cb1173"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1173-1" data-line-number="1">CPS85 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1173-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(sex) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1173-3" data-line-number="3"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">meanWage =</span> <span class="kw">mean</span>(wage))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   sex   meanWage
##   &lt;fct&gt;    &lt;dbl&gt;
## 1 F         7.88
## 2 M         9.99</code></pre>
<p>It’s possible to create more than one summary variable in a single call to <code>summarise()</code>, for example:</p>
<div class="sourceCode" id="cb1175"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1175-1" data-line-number="1">CPS85 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1175-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(sex) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1175-3" data-line-number="3"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">meanWage =</span> <span class="kw">mean</span>(wage),</a>
<a class="sourceLine" id="cb1175-4" data-line-number="4">            <span class="dt">n =</span> <span class="kw">n</span>())</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   sex   meanWage     n
##   &lt;fct&gt;    &lt;dbl&gt; &lt;int&gt;
## 1 F         7.88   245
## 2 M         9.99   289</code></pre>
<p>In the previous example, <code>dplyr::n()</code> was used to count the number of cases in each group.</p>
<p>For a more complete account of a numerical variable, one might consider the <em>five-number summary</em>:</p>
<ul>
<li>the minimum value</li>
<li>the first quartile (Q1)</li>
<li>the median</li>
<li>the third quartile (Q3)</li>
<li>the maximum value</li>
</ul>
<p>These quantities are conveniently computed by R’s <code>fivenum()</code>  function:</p>
<div class="sourceCode" id="cb1177"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1177-1" data-line-number="1">CPS85 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1177-2" data-line-number="2"><span class="st">  </span>.<span class="op">$</span>wage <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1177-3" data-line-number="3"><span class="st">  </span><span class="kw">fivenum</span>()</a></code></pre></div>
<pre><code>## [1]  1.00  5.25  7.78 11.25 44.50</code></pre>
<p>Let’s find the five number summaries for the wages of men and women:</p>
<div class="sourceCode" id="cb1179"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1179-1" data-line-number="1">CPS85 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1179-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(sex) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1179-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb1179-4" data-line-number="4">            <span class="dt">min =</span> <span class="kw">fivenum</span>(wage)[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb1179-5" data-line-number="5">            <span class="dt">Q1 =</span> <span class="kw">fivenum</span>(wage)[<span class="dv">2</span>],</a>
<a class="sourceLine" id="cb1179-6" data-line-number="6">            <span class="dt">median =</span> <span class="kw">fivenum</span>(wage)[<span class="dv">3</span>],</a>
<a class="sourceLine" id="cb1179-7" data-line-number="7">            <span class="dt">Q3 =</span> <span class="kw">fivenum</span>(wage)[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1179-8" data-line-number="8">            <span class="dt">max =</span> <span class="kw">fivenum</span>(wage)[<span class="dv">5</span>])</a></code></pre></div>
<pre><code>## # A tibble: 2 x 7
##   sex       n   min    Q1 median    Q3   max
##   &lt;fct&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 F       245  1.75  4.75   6.8     10  44.5
## 2 M       289  1     6      8.93    13  26.3</code></pre>
<p>It’s also possible to group by more than one variable at a time. For example, suppose that we wish to compare the wages of men and women in the various sectors of employment. All we need to do is group by both <code>sex</code> and <code>sector</code>:</p>
<div class="sourceCode" id="cb1181"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1181-1" data-line-number="1">CPS85 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1181-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(sector, sex) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1181-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb1181-4" data-line-number="4">            <span class="dt">min =</span> <span class="kw">fivenum</span>(wage)[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb1181-5" data-line-number="5">            <span class="dt">Q1 =</span> <span class="kw">fivenum</span>(wage)[<span class="dv">2</span>],</a>
<a class="sourceLine" id="cb1181-6" data-line-number="6">            <span class="dt">median =</span> <span class="kw">fivenum</span>(wage)[<span class="dv">3</span>],</a>
<a class="sourceLine" id="cb1181-7" data-line-number="7">            <span class="dt">Q3 =</span> <span class="kw">fivenum</span>(wage)[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1181-8" data-line-number="8">            <span class="dt">max =</span> <span class="kw">fivenum</span>(wage)[<span class="dv">5</span>])</a></code></pre></div>
<pre><code>## # A tibble: 15 x 8
## # Groups:   sector [?]
##    sector   sex       n   min    Q1 median    Q3   max
##    &lt;fct&gt;    &lt;fct&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 clerical F        76  3     5.1    7     9.55 15.0 
##  2 clerical M        21  3.35  6      7.69  9    12   
##  3 const    M        20  3.75  7.15   9.75 11.8  15   
##  4 manag    F        21  3.64  6.88  10    11.2  44.5 
##  5 manag    M        34  1     8.8   14.0  18.2  26.3 
##  6 manuf    F        24  3     4.36   4.9   6.05 18.5 
##  7 manuf    M        44  3.35  6.58   8.94 11.2  22.2 
##  8 other    F         6  3.75  4      5.62  6.88  8.93
##  9 other    M        62  2.85  5.25   7.5  11.2  26   
## 10 prof     F        52  4.35  7.02  10    12.3  25.0 
## 11 prof     M        53  5     8     12    16.4  25.0 
## 12 sales    F        17  3.35  3.8    4.55  5.65 14.3 
## 13 sales    M        21  3.5   5.56   9.42 12.5  20.0 
## 14 service  F        49  1.75  3.75   5     8    13.1 
## 15 service  M        34  2.01  4.15   5.89  8.75 25</code></pre>
<p>Note that there were no women in the construction sector, so that group did not appear in the summary.</p>
<div id="note-on-binding" class="section level3">
<h3><span class="header-section-number">8.6.1</span> Note on Binding</h3>
<p>Keep in mind that you can always “save” the results of any computation by binding them to a variable name, thus:</p>
<div class="sourceCode" id="cb1183"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1183-1" data-line-number="1">sexSector &lt;-</a>
<a class="sourceLine" id="cb1183-2" data-line-number="2"><span class="st">  </span>CPS85 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1183-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(sector, sex) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1183-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb1183-5" data-line-number="5">            <span class="dt">min =</span> <span class="kw">fivenum</span>(wage)[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb1183-6" data-line-number="6">            <span class="dt">Q1 =</span> <span class="kw">fivenum</span>(wage)[<span class="dv">2</span>],</a>
<a class="sourceLine" id="cb1183-7" data-line-number="7">            <span class="dt">median =</span> <span class="kw">fivenum</span>(wage)[<span class="dv">3</span>],</a>
<a class="sourceLine" id="cb1183-8" data-line-number="8">            <span class="dt">Q3 =</span> <span class="kw">fivenum</span>(wage)[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1183-9" data-line-number="9">            <span class="dt">max =</span> <span class="kw">fivenum</span>(wage)[<span class="dv">5</span>])</a>
<a class="sourceLine" id="cb1183-10" data-line-number="10"><span class="kw">class</span>(sexSector)</a></code></pre></div>
<pre><code>## [1] &quot;grouped_df&quot; &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<p>Note that the result has <code>data.frame</code> as one of its classes, so you may extract components in any of the ways you have learned. The old ways, for instance, are fine:</p>
<div class="sourceCode" id="cb1185"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1185-1" data-line-number="1"><span class="co"># minimum wage among male professionals:</span></a>
<a class="sourceLine" id="cb1185-2" data-line-number="2"><span class="kw">with</span>(sexSector, min[sex <span class="op">==</span><span class="st"> &quot;M&quot;</span> <span class="op">&amp;</span><span class="st"> </span>sector <span class="op">==</span><span class="st"> &quot;prof&quot;</span>])</a></code></pre></div>
<pre><code>## [1] 5</code></pre>
</div>
<div id="practice-exercises-25" class="section level3">
<h3><span class="header-section-number">8.6.2</span> Practice Exercises</h3>
<p>These exercises deal with flight data from the <strong>nycflights13</strong> data frame:</p>
<div class="sourceCode" id="cb1187"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1187-1" data-line-number="1"><span class="kw">data</span>(<span class="st">&quot;flights&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;nycflights13&quot;</span>)</a></code></pre></div>
<ol style="list-style-type: decimal">
<li><p>The <code>flights</code> table gives information about each departure in the year 2013 from one of the three major airports near New York City: John F. Kennedy (JFK), LaGuardia (LGA) or Newark (EWR). The airport from which the plane departed is recorded in the variable <code>origin</code>. The variable <code>dep_delay</code> gives the delay in departure, in minutes. (This is a negative number if the plane left early). Find the number of departures and the mean departure delay for each of the three airports. (Note that <code>dep_delay</code> for cancelled flights will be <code>NA</code>.)</p></li>
<li><p>The variable <code>distance</code> gives the distance, in miles, between an origin and destination airport. For July 26, 2013, make a violin plot of the distances traveled by the departing planes from the each of the three New York airports. Use the pipe and <code>filter()</code> to take <code>flights</code> into the desired plot.</p></li>
<li><p>Examine the plot you made in the previous problem: two of the flights appear to be about 5000 miles. Use the pipe, <code>filter()</code> and <code>select()</code> to display the origin, destination and distance for these two flights.</p></li>
</ol>
</div>
<div id="solutions-to-practice-exercises-18" class="section level3">
<h3><span class="header-section-number">8.6.3</span> Solutions to Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Flights that were cancelled have <code>NA</code> for their departure delay, so we need to filter out these cases first, in order to correctly count the number of flights that actually left the airport. Try this:</p>
<div class="sourceCode" id="cb1188"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1188-1" data-line-number="1">flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1188-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(dep_delay)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1188-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(origin) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1188-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">departures =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb1188-5" data-line-number="5">            <span class="dt">meanDelay =</span> <span class="kw">mean</span>(dep_delay))</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   origin departures meanDelay
##   &lt;chr&gt;       &lt;int&gt;     &lt;dbl&gt;
## 1 EWR        117596      15.1
## 2 JFK        109416      12.1
## 3 LGA        101509      10.3</code></pre></li>
<li><p>Try this:</p>
<div class="sourceCode" id="cb1190"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1190-1" data-line-number="1">flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1190-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(month <span class="op">==</span><span class="st"> </span><span class="dv">6</span> <span class="op">&amp;</span><span class="st"> </span>day <span class="op">==</span><span class="st"> </span><span class="dv">26</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1190-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> origin, <span class="dt">y =</span> distance)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1190-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_violin</span>(<span class="dt">fill =</span> <span class="st">&quot;burlywood&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1190-5" data-line-number="5"><span class="st">    </span><span class="kw">geom_jitter</span>(<span class="dt">width =</span> <span class="fl">0.25</span>, <span class="dt">size =</span> <span class="fl">0.1</span>)</a></code></pre></div></li>
<li><p>Try this:</p>
<div class="sourceCode" id="cb1191"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1191-1" data-line-number="1">flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1191-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(month <span class="op">==</span><span class="st"> </span><span class="dv">6</span> <span class="op">&amp;</span><span class="st"> </span>day <span class="op">==</span><span class="st"> </span><span class="dv">26</span> <span class="op">&amp;</span><span class="st"> </span>distance <span class="op">&gt;</span><span class="st"> </span><span class="dv">4000</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1191-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(origin, dest, distance)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   origin dest  distance
##   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;
## 1 JFK    HNL       4983
## 2 EWR    HNL       4963</code></pre></li>
</ol>

</div>
</div>
<div id="exercises-4" class="section level2 unnumbered">
<h2>Exercises</h2>
<p><img src="images/thinking.png" width="50%" style="display: block; margin: auto;" /></p>
<ol style="list-style-type: decimal">
<li><p>Use the pipe operator to rewrite the following command in three ways:</p>
<div class="sourceCode" id="cb1193"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1193-1" data-line-number="1"><span class="kw">runif</span>(<span class="dv">10</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">5</span>)</a></code></pre></div></li>
<li><p>Rewrite the following command using two pipe operators in succession:</p>
<div class="sourceCode" id="cb1194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1194-1" data-line-number="1"><span class="kw">paste</span>(<span class="st">&quot;hello&quot;</span>, <span class="st">&quot;there&quot;</span>, <span class="st">&quot;Bella&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;hello there Bella&quot;</code></pre></li>
<li><p>Use the pipe operator and <strong>dplyr</strong> functions to rewrite the following command:</p>
<div class="sourceCode" id="cb1196"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1196-1" data-line-number="1"><span class="kw">head</span>(<span class="kw">subset</span>(m111survey, sex <span class="op">==</span><span class="st"> &quot;female&quot;</span>)[, <span class="kw">c</span>(<span class="st">&quot;height&quot;</span>, <span class="st">&quot;fastest&quot;</span>)],<span class="dv">6</span>)</a></code></pre></div>
<blockquote>
<p>The next few exercises are about the <code>babynames</code> data frame from the <strong>babynames</strong> package.</p>
</blockquote></li>
<li><p>Find the names for females born in 2015 that were given to more than 1% of female applicants (i.e., <code>prop</code> is bigger than 0.01).</p></li>
<li><p>Use the pipe operator and <strong>dplyr</strong> functions to produce the following graph of the popularity of “Mary” and “Mia” as girl-names over the years. Note that popularity is given as number per one thousand applicants, i.e., as <code>prop * 1000</code>.</p>
<p><img src="r-notes_files/figure-html/unnamed-chunk-915-1.png" width="95%" style="display: block; margin: auto;" /></p></li>
</ol>
<!--chapter:end:095-tidyverse.Rmd-->
</div>
</div>
<div id="strings" class="section level1">
<h1><span class="header-section-number">9</span> Strings</h1>
<div class="figure" style="text-align: center">
<img src="images/xkcd-rtl.png" alt="RTL, by xkcd." width="40%" />
<p class="caption">
(#fig:xkcd-rtl)RTL, by xkcd.
</p>
</div>
<p>In this chapter we will take a closer look at character-vectors, and in particular at character vectors of length one, which are commonly called “strings.” The ability to manipulate strings is the foundation for all text-processing in computer programming.</p>

<div id="character-vectors-strings" class="section level2">
<h2><span class="header-section-number">9.1</span> Character Vectors: Strings</h2>
<p></p>
<p>Computers work at least as much with text as they do with numbers. In computer science the values that refer to text are called <em>strings</em>.</p>
<p>In R, as in most other programming languages, we use quotes as delimiters, meaning that they mark the beginning and the end of strings. Recall that in R, strings are of type <code>character</code>. For example:</p>
<div class="sourceCode" id="cb1197"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1197-1" data-line-number="1">greeting &lt;-<span class="st"> &quot;hello&quot;</span></a>
<a class="sourceLine" id="cb1197-2" data-line-number="2"><span class="kw">typeof</span>(greeting)</a></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>Of course, a single string does not exist on its own in R. Instead it exists as the only element of a character-vector of length 1.</p>
<div class="sourceCode" id="cb1199"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1199-1" data-line-number="1"><span class="kw">is.vector</span>(greeting)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb1201"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1201-1" data-line-number="1"><span class="kw">length</span>(greeting)</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>To make strings we can use double quotes or single quotes. Since the string-value does not include the quotes themselves but only what appears between them, it does not make any difference which type of quotes we use:</p>
<div class="sourceCode" id="cb1203"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1203-1" data-line-number="1">greeting1 &lt;-<span class="st"> &quot;hello&quot;</span></a>
<a class="sourceLine" id="cb1203-2" data-line-number="2">greeting2 &lt;-<span class="st"> &#39;hello&#39;</span></a>
<a class="sourceLine" id="cb1203-3" data-line-number="3">greeting1 <span class="op">==</span><span class="st"> </span>greeting2</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>When we make a character vector of length greater than one, we can even use both single and double quotes:</p>
<div class="sourceCode" id="cb1205"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1205-1" data-line-number="1">politeWords &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Please?&quot;</span>, <span class="st">&#39;Thank you!&#39;</span>)</a>
<a class="sourceLine" id="cb1205-2" data-line-number="2">politeWords</a></code></pre></div>
<pre><code>## [1] &quot;Please?&quot;    &quot;Thank you!&quot;</code></pre>
<p>Notice that when R prints <code>politeWords</code> to the console it uses double-quotes. Indeed, double-quoting is the recommended and most common way to construct strings in R.</p>
</div>
<div id="characters-and-special-characters" class="section level2">
<h2><span class="header-section-number">9.2</span> Characters and Special Characters</h2>
<p>Strings are made up of characters: that’s why R calls them “character vectors.” From your point of view as a speaker of the English language, characters would seem to be the things you would have entered on a typewriter, and which can be entered from your computer keyboard as well:</p>
<ul>
<li>the lower-case letters a-z;</li>
<li>the upper case letters A-Z;</li>
<li>the digits 0,1, …, 9 (0-9);</li>
<li>the punctuation characters: ., -, ?, !, ;, :, etc. (and of course the comma, too!)</li>
<li>a few other special-use characters: ~, @, #, $, %, _, +, =, and so on;</li>
<li>and the space, too!</li>
</ul>
<p>All of the above can be part of a string.</p>
<p>But quote-marks (used in quotation and as apostrophes) can also be part of a string:</p>
<pre><code>&quot;Welcome&quot;, she said, &quot;the coffee&#39;s on me!&quot;</code></pre>
<p>Since quote-marks are used to <em>delimit</em> strings but can also be part of them, designers of programming languages have to think carefully about how to manage quote-marks. Here’s how it works in R:</p>
<ul>
<li><p>If you choose to delimit a string with double-quotes, then you can put single-quotes anywhere you like within the string and they will be treated by the computer as literal single-quotes, not as string-delimiters. Here is an example:</p>
<div class="sourceCode" id="cb1208"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1208-1" data-line-number="1"><span class="kw">cat</span>(<span class="st">&quot;&#39;Hello&#39;, she said.&quot;</span>)</a></code></pre></div>
<pre><code>## &#39;Hello&#39;, she said.</code></pre></li>
<li><p>If you delimit with double-quotes and you want to place a double-quote in your string, then you have to <em>escape</em> that double-quote with the backslash character <code>\</code>:</p>
<div class="sourceCode" id="cb1210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1210-1" data-line-number="1"><span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\&quot;</span><span class="st">Hello</span><span class="ch">\&quot;</span><span class="st">, she said.&quot;</span>)</a></code></pre></div>
<pre><code>## &quot;Hello&quot;, she said.</code></pre></li>
<li><p>If you choose to delimit a string with single-quotes, then you can put double-quotes anywhere you like within the string and they will be treated by the computer as literal double-quotes, not as string-delimiters.</p>
<div class="sourceCode" id="cb1212"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1212-1" data-line-number="1"><span class="kw">cat</span>(<span class="st">&#39;&quot;Hello&quot;, she said.&#39;</span>)</a></code></pre></div>
<pre><code>## &quot;Hello&quot;, she said.</code></pre></li>
<li><p>If you delimit with single-quotes and you want to place a single-quote in your string, then you have to escape that single-quote:</p>
<div class="sourceCode" id="cb1214"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1214-1" data-line-number="1"><span class="kw">cat</span>(<span class="st">&#39;</span><span class="ch">\&#39;</span><span class="st">Hello</span><span class="ch">\&#39;</span><span class="st">, she said.&#39;</span>)</a></code></pre></div>
<pre><code>## &#39;Hello&#39;, she said.</code></pre></li>
</ul>
<p>In R and in many other programming languages the backslash <code>\</code> permits the following character to “escape” any special meaning that is otherwise assigned to it by the language. When we write <code>\&quot;</code> we say that we are “escaping” the double-quote; more precisely, we are escaping the special role of the double-quote as a delimiter for strings.</p>
<p>Of course the foregoing implies that the backslash character has a special role in the language: as an escaping-device. So what can we do if we want a literal backslash in our string? Well, we simply escape it by preceding it with a backslash:</p>
<div class="sourceCode" id="cb1216"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1216-1" data-line-number="1"><span class="kw">cat</span>(<span class="st">&quot;up</span><span class="ch">\\</span><span class="st">down&quot;</span>)</a></code></pre></div>
<pre><code>## up\down</code></pre>
<p>Another example:</p>
<div class="sourceCode" id="cb1218"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1218-1" data-line-number="1"><span class="kw">cat</span>(<span class="st">&quot;C:</span><span class="ch">\\\\</span><span class="st">Inetpub</span><span class="ch">\\\\</span><span class="st">vhosts</span><span class="ch">\\\\</span><span class="st">example.com&quot;</span>)</a></code></pre></div>
<pre><code>## C:\\Inetpub\\vhosts\\example.com</code></pre>
<p>So much for “ordinary” characters. But there are special characters, too, sometimes called <em>control</em> characters, that do not represent written symbols. We have seen a couple of them already; the newline character <code>\n</code> is one:</p>
<div class="sourceCode" id="cb1220"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1220-1" data-line-number="1">bye &lt;-<span class="st"> &quot;Farewell!</span><span class="ch">\n\n</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb1220-2" data-line-number="2"><span class="kw">cat</span>(bye)</a></code></pre></div>
<pre><code>## Farewell!  # first \n moves us to a new line ...
##            # .. which is empty due the next \n</code></pre>
<p>We have also seen the tab-character <code>\t</code>:</p>
<div class="sourceCode" id="cb1222"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1222-1" data-line-number="1"><span class="kw">cat</span>(<span class="st">&quot;First Name</span><span class="ch">\t</span><span class="st">Last Name&quot;</span>)</a></code></pre></div>
<pre><code>## First Name   Last Name</code></pre>
<p>Notice that the backslash character is used here to allow the <code>n</code> and <code>t</code> to escape their customary roles as the letters “n” and <code>t</code> respectively.</p>
<p>If you ask R, (try <code>help(Quotes)</code>), you will learn that there are several control characters, including:</p>
<table>
<caption>(#tab:control-characters)Some control characters.</caption>
<thead>
<tr class="header">
<th align="left">Character</th>
<th align="left">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">\n</td>
<td align="left">newline</td>
</tr>
<tr class="even">
<td align="left">\r</td>
<td align="left">carriage return</td>
</tr>
<tr class="odd">
<td align="left">\t</td>
<td align="left">tab</td>
</tr>
<tr class="even">
<td align="left">\b</td>
<td align="left">backspace</td>
</tr>
<tr class="odd">
<td align="left">\a</td>
<td align="left">alert (bell)</td>
</tr>
<tr class="even">
<td align="left">\f</td>
<td align="left">form feed</td>
</tr>
<tr class="odd">
<td align="left">\v</td>
<td align="left">vertical tab</td>
</tr>
</tbody>
</table>
<p>It is worth exploring their effects. Here are a couple of examples<a href="#fn17" class="footnote-ref" id="fnref17"><sup>17</sup></a>:</p>
<div class="sourceCode" id="cb1224"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1224-1" data-line-number="1"><span class="kw">cat</span>(<span class="st">&quot;Hell</span><span class="ch">\t</span><span class="st">o&quot;</span>)</a></code></pre></div>
<pre><code>## Hell o</code></pre>
<div class="sourceCode" id="cb1226"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1226-1" data-line-number="1"><span class="kw">cat</span>(<span class="st">&quot;Hell</span><span class="ch">\r</span><span class="st">o&quot;</span>)</a></code></pre></div>
<pre><code>## Hell
o</code></pre>
<p>A number of other non-control characters can be generated with the backslash. Unicode characters, for instance, are generated by <code>\u{nnnn}</code>, where the n’s represent hexadecimal digits. Try the following in your console, and see what you get:</p>
<div class="sourceCode" id="cb1228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1228-1" data-line-number="1"><span class="kw">cat</span>(<span class="st">&quot;\u{2603}&quot;</span>)  <span class="co"># the Snowman</span></a></code></pre></div>
<pre><code>## ☃</code></pre>
<p>Or, for something zanier:</p>
<div class="sourceCode" id="cb1230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1230-1" data-line-number="1"><span class="kw">cat</span>(<span class="st">&quot;Hello\u{202e}there, Friend!&quot;</span>)</a></code></pre></div>
<pre><code>## Hello‮there, Friend!</code></pre>
</div>
<div id="basic-string-operations" class="section level2">
<h2><span class="header-section-number">9.3</span> Basic String Operations</h2>
<p>We now introduce a few basic operations for examining, splitting and combining strings. Some of the functions we discuss come from the <strong>stringer</strong> package, which is installed along with the tidyverse but is not automatically attached. Make sure you attach it when you work with strings:</p>
<div class="sourceCode" id="cb1232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1232-1" data-line-number="1"><span class="kw">library</span>(stringr)</a></code></pre></div>
<div id="is-and-as" class="section level3">
<h3><span class="header-section-number">9.3.1</span> Is and As</h3>
<p>Recall from Chapter @ref(vectors) that <code>as.character()</code> coerces other data types into strings:</p>
<div class="sourceCode" id="cb1233"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1233-1" data-line-number="1"><span class="kw">as.character</span>(<span class="fl">3.14</span>)</a></code></pre></div>
<pre><code>## [1] &quot;3.14&quot;</code></pre>
<div class="sourceCode" id="cb1235"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1235-1" data-line-number="1"><span class="kw">as.character</span>(<span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## [1] &quot;FALSE&quot;</code></pre>
<div class="sourceCode" id="cb1237"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1237-1" data-line-number="1"><span class="kw">as.character</span>(<span class="ot">NULL</span>)</a></code></pre></div>
<pre><code>## character(0)</code></pre>
<p>Also, <code>is.character()</code> tests whether an object is character-vector:</p>
<div class="sourceCode" id="cb1239"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1239-1" data-line-number="1"><span class="kw">is.character</span>(<span class="fl">3.14</span>)</a></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
</div>
<div id="number-of-characters" class="section level3">
<h3><span class="header-section-number">9.3.2</span> Number of Characters</h3>
<p>How many characters are in the word “hello”? Let’s try:</p>
<div class="sourceCode" id="cb1241"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1241-1" data-line-number="1"><span class="kw">length</span>(<span class="st">&quot;hello&quot;</span>)</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>Oh, right, strings don’t exist alone: <code>&quot;hello&quot;</code> is actually a character-vector of length 1. Instead we should use the <code>str_sub()</code> function:</p>
<div class="sourceCode" id="cb1243"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1243-1" data-line-number="1"><span class="kw">str_length</span>(<span class="st">&quot;hello&quot;</span>)</a></code></pre></div>
<pre><code>## [1] 5</code></pre>
</div>
<div id="substrings-and-trimming" class="section level3">
<h3><span class="header-section-number">9.3.3</span> Substrings and Trimming</h3>
<p>We can pull out pieces of a string with the <code>str_sub()</code> function:</p>
<div class="sourceCode" id="cb1245"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1245-1" data-line-number="1">poppins &lt;-<span class="st"> &quot;Supercalifragilisticexpialidocious&quot;</span></a>
<a class="sourceLine" id="cb1245-2" data-line-number="2"><span class="kw">str_sub</span>(poppins, <span class="dt">start =</span> <span class="dv">10</span>, <span class="dt">end =</span> <span class="dv">20</span>)</a></code></pre></div>
<pre><code>## [1] &quot;fragilistic&quot;</code></pre>
<p>One can also use <code>substr()</code> to replace part of a string with some other string<a href="#fn18" class="footnote-ref" id="fnref18"><sup>18</sup></a>:</p>
<div class="sourceCode" id="cb1247"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1247-1" data-line-number="1"><span class="kw">str_sub</span>(poppins, <span class="dt">start =</span> <span class="dv">10</span>, <span class="dt">end =</span> <span class="dv">20</span>) &lt;-<span class="st"> &quot;ABCDEFGHIJK&quot;</span></a>
<a class="sourceLine" id="cb1247-2" data-line-number="2">poppins</a></code></pre></div>
<pre><code>## [1] &quot;SupercaliABCDEFGHIJKexpialidocious&quot;</code></pre>
<p>Don’t forget: “vector-in, vector-out” usually applies:</p>
<div class="sourceCode" id="cb1249"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1249-1" data-line-number="1">words &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Mary&quot;</span>, <span class="st">&quot;Poppins&quot;</span>, <span class="st">&quot;practically&quot;</span>, <span class="st">&quot;perfect&quot;</span>)</a>
<a class="sourceLine" id="cb1249-2" data-line-number="2"><span class="kw">str_length</span>(words)</a></code></pre></div>
<pre><code>## [1]  4  7 11  7</code></pre>
<div class="sourceCode" id="cb1251"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1251-1" data-line-number="1"><span class="kw">str_sub</span>(words, <span class="dv">1</span>, <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Mar&quot; &quot;Pop&quot; &quot;pra&quot; &quot;per&quot;</code></pre>
<p>In practical data-analysis situations you’ll often have to work with strings that include unexpected non-printed characters at the beginning or the end, especially if the string once occurred at the end of a line in a text file. For example, consider:</p>
<div class="sourceCode" id="cb1253"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1253-1" data-line-number="1">lastWord &lt;-<span class="st"> &quot;farewell</span><span class="ch">\r\n</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb1253-2" data-line-number="2"><span class="kw">str_length</span>(lastWord)</a></code></pre></div>
<pre><code>## [1] 10</code></pre>
<div class="sourceCode" id="cb1255"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1255-1" data-line-number="1"><span class="kw">cat</span>(lastWord)</a></code></pre></div>
<pre><code>## farewell</code></pre>
<p>From its display on the console, you might infer that <code>lastWord</code> consists of only the eight characters: f, a, r, e, w, e, l, and l. (You can’t see the carriage return followed by the newline.) But <code>str_length()</code> clearly shows that it’s got two characters after the final “l”, even if you can’t see them.</p>
<p>If you think your strings might contain unnecessary leading or trailing white-space, you can remove it with <code>str_trim()</code>: </p>
<div class="sourceCode" id="cb1257"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1257-1" data-line-number="1"><span class="kw">str_trim</span>(lastWord)</a></code></pre></div>
<pre><code>## [1] &quot;farewell&quot;</code></pre>
</div>
<div id="changing-cases" class="section level3">
<h3><span class="header-section-number">9.3.4</span> Changing Cases</h3>
<p>You can make all of the letters in a string lowercase: </p>
<div class="sourceCode" id="cb1259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1259-1" data-line-number="1"><span class="kw">str_to_lower</span>(<span class="st">&quot;My name is Rhonda.&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;my name is rhonda.&quot;</code></pre>
<p>You can make them all uppercase: </p>
<div class="sourceCode" id="cb1261"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1261-1" data-line-number="1"><span class="kw">str_to_upper</span>(<span class="st">&quot;It makes me wanna holler!&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;IT MAKES ME WANNA HOLLER!&quot;</code></pre>
</div>
<div id="splitting-strings" class="section level3">
<h3><span class="header-section-number">9.3.5</span> Splitting Strings</h3>
<p>Consider the following character vector that records several dates:</p>
<div class="sourceCode" id="cb1263"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1263-1" data-line-number="1">dates &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;3-14-1963&quot;</span>, <span class="st">&quot;04-01-1965&quot;</span>, <span class="st">&quot;12-2-1983&quot;</span>)</a></code></pre></div>
<p>You might want to print them out in some uniform way, using the full name of the month, perhaps. Then you would need to gain access to the elements of each date separately, so that you could transform month-numbers to month-names.</p>
<p><code>str_split()</code> will do the job for you: </p>
<div class="sourceCode" id="cb1264"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1264-1" data-line-number="1"><span class="kw">str_split</span>(dates, <span class="dt">pattern =</span> <span class="st">&quot;-&quot;</span>)</a></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;3&quot;    &quot;14&quot;   &quot;1963&quot;
## 
## [[2]]
## [1] &quot;04&quot;   &quot;01&quot;   &quot;1965&quot;
## 
## [[3]]
## [1] &quot;12&quot;   &quot;2&quot;    &quot;1983&quot;</code></pre>
<p>The result is a list with one element for each date in <code>dates</code>. Each element of the list is a character vector containing the elements—month-number, day-number and year—that were demarcated in the original strings by the hyphen <code>-</code>, the value given to the <code>pattern</code> parameter.</p>
<p>If we wish, we may now access the elements of the list and process them in any way we like. We might report the months, for example:</p>
<div class="sourceCode" id="cb1266"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1266-1" data-line-number="1">dates <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1266-2" data-line-number="2"><span class="st">  </span><span class="kw">str_split</span>(<span class="dt">pattern =</span> <span class="st">&quot;-&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1266-3" data-line-number="3"><span class="st">  </span><span class="kw">unlist</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1266-4" data-line-number="4"><span class="st">  </span>.[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>)] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1266-5" data-line-number="5"><span class="st">  </span><span class="kw">as.numeric</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1266-6" data-line-number="6"><span class="st">  </span>month.name[.]</a></code></pre></div>
<pre><code>## [1] &quot;March&quot;    &quot;April&quot;    &quot;December&quot;</code></pre>
<p>(Note the use in the code above of the <code>months.name</code>  constant provided by R.)</p>
<p>Sometimes it’s handy to split a string word-by-word:</p>
<div class="sourceCode" id="cb1268"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1268-1" data-line-number="1"><span class="st">&quot;you have won the lottery&quot;</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1268-2" data-line-number="2"><span class="st">  </span><span class="kw">str_split</span>(<span class="dt">pattern =</span> <span class="st">&quot; &quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1268-3" data-line-number="3"><span class="st">  </span><span class="kw">unlist</span>()</a></code></pre></div>
<pre><code>## [1] &quot;you&quot;     &quot;have&quot;    &quot;won&quot;     &quot;the&quot;     &quot;lottery&quot;</code></pre>
<p>Of course splitting on the space would not have worked if some of the words had been separated by more than one space:</p>
<div class="sourceCode" id="cb1270"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1270-1" data-line-number="1"><span class="st">&quot;you have won the  lottery&quot;</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># two spaces betwen &#39;the&#39; and &#39;lottery&#39;</span></a>
<a class="sourceLine" id="cb1270-2" data-line-number="2"><span class="st">  </span><span class="kw">str_split</span>(<span class="dt">pattern =</span> <span class="st">&quot; &quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1270-3" data-line-number="3"><span class="st">  </span><span class="kw">unlist</span>()</a></code></pre></div>
<pre><code>## [1] &quot;you&quot;     &quot;have&quot;    &quot;won&quot;     &quot;the&quot;     &quot;&quot;        &quot;lottery&quot;</code></pre>
<p>We’ll address this problem soon.</p>
<p>In order to split a string into its constituent characters, split on the string with no characters:</p>
<div class="sourceCode" id="cb1272"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1272-1" data-line-number="1"><span class="st">&quot;aardvark&quot;</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1272-2" data-line-number="2"><span class="st">  </span><span class="kw">str_split</span>(<span class="dt">pattern =</span> <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1272-3" data-line-number="3"><span class="st">  </span><span class="kw">unlist</span>()</a></code></pre></div>
<pre><code>## [1] &quot;a&quot; &quot;a&quot; &quot;r&quot; &quot;d&quot; &quot;v&quot; &quot;a&quot; &quot;r&quot; &quot;k&quot;</code></pre>
<p>This would be useful if you wanted to, say, count the number of occurrences of “a” in a word:</p>
<div class="sourceCode" id="cb1274"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1274-1" data-line-number="1"><span class="st">&quot;aardvark&quot;</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1274-2" data-line-number="2"><span class="st">  </span><span class="kw">str_split</span>(<span class="dt">pattern =</span> <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1274-3" data-line-number="3"><span class="st">  </span><span class="kw">unlist</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1274-4" data-line-number="4"><span class="st">  </span>.[. <span class="op">==</span><span class="st"> &quot;a&quot;</span>] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1274-5" data-line-number="5"><span class="st">  </span><span class="kw">length</span>()</a></code></pre></div>
<pre><code>## [1] 3</code></pre>
</div>
<div id="pasting-and-joining-strings" class="section level3">
<h3><span class="header-section-number">9.3.6</span> Pasting and Joining Strings</h3>
<p>We are already familiar with <code>paste()</code>, which allows us to paste together the arguments that are passed to it:</p>
<div class="sourceCode" id="cb1276"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1276-1" data-line-number="1"><span class="kw">paste</span>(<span class="st">&quot;Mary&quot;</span>, <span class="st">&quot;Poppins&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Mary Poppins&quot;</code></pre>
<p>By default <code>paste()</code> separates the input strings with a space, but you can control this with the <code>sep</code> parameter:</p>
<div class="sourceCode" id="cb1278"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1278-1" data-line-number="1"><span class="kw">paste</span>(<span class="st">&quot;Mary&quot;</span>, <span class="st">&quot;Poppins&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;:&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Mary:Poppins&quot;</code></pre>
<div class="sourceCode" id="cb1280"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1280-1" data-line-number="1"><span class="kw">paste</span>(<span class="st">&quot;Yabba&quot;</span>,<span class="st">&quot;dabba&quot;</span>,<span class="st">&quot;doo!&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Yabbadabbadoo!&quot;</code></pre>
<p>If you want the separator to be the empty string by default, then you could use <code>paste0()</code>:</p>
<div class="sourceCode" id="cb1282"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1282-1" data-line-number="1"><span class="kw">paste0</span>(<span class="st">&quot;Yabba&quot;</span>,<span class="st">&quot;dabba&quot;</span>,<span class="st">&quot;doo!&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Yabbadabbadoo!&quot;</code></pre>
<p>The <strong>stringr</strong> version of <code>paste0()</code> is <code>str_c()</code>:</p>
<div class="sourceCode" id="cb1284"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1284-1" data-line-number="1"><span class="kw">str_c</span>(<span class="st">&quot;Yabba&quot;</span>,<span class="st">&quot;dabba&quot;</span>,<span class="st">&quot;doo!&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Yabbadabbadoo!&quot;</code></pre>
<p>What if you had a character-vector whose elements you wanted to paste together? For example, consider:</p>
<div class="sourceCode" id="cb1286"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1286-1" data-line-number="1">poppins &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;practically&quot;</span>, <span class="st">&quot;perfect&quot;</span>, <span class="st">&quot;in&quot;</span>,</a>
<a class="sourceLine" id="cb1286-2" data-line-number="2">             <span class="st">&quot;every&quot;</span>, <span class="st">&quot;way&quot;</span>)</a></code></pre></div>
<p>Now suppose you want to paste the elements of <code>poppins</code> together into one string where the words are separated by spaces. <code>str_c()</code> will do the job for you, if you use its <code>collapse</code> parameter:</p>
<div class="sourceCode" id="cb1287"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1287-1" data-line-number="1">poppins <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1287-2" data-line-number="2"><span class="st">  </span><span class="kw">str_c</span>(<span class="dt">collapse =</span> <span class="st">&quot; &quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;practically perfect in every way&quot;</code></pre>
<p>We’ll call this process <em>joining</em>. </p>
<p>In an atomic vector all of the elements have to be of the same data type (all character, all numerical, etc.). What if you want to join objects of different types? If there are only a few, feel free to type them in as separate arguments to <code>paste()</code>:</p>
<div class="sourceCode" id="cb1289"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1289-1" data-line-number="1"><span class="kw">str_c</span>(<span class="st">&quot;March&quot;</span>, <span class="dv">14</span>, <span class="dv">1963</span>, <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;March 14 1963&quot;</code></pre>
<p>If the objects are many, then you could arrange for them appear as the elements of a list:</p>
<div class="sourceCode" id="cb1291"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1291-1" data-line-number="1"><span class="kw">list</span>(<span class="st">&quot;Mary&quot;</span>, <span class="dv">343</span>, <span class="st">&quot;Poppins&quot;</span>, <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1291-2" data-line-number="2"><span class="st">  </span><span class="kw">str_c</span>(<span class="dt">collapse =</span> <span class="st">&quot; &quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Mary 343 Poppins FALSE&quot;</code></pre>
<p>Joining appears to be the opposite of splitting, but in R that’s not quite so. Suppose, for instance, that you have dates where the month, day and year are separated by hyphens and you want to replace the hyphens with forward slashes:</p>
<pre><code>3-14-1963  # you have this
3/14/1963  # you want this</code></pre>
<p>You could try this:</p>
<div class="sourceCode" id="cb1294"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1294-1" data-line-number="1"><span class="st">&quot;3-14-1963&quot;</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1294-2" data-line-number="2"><span class="st">  </span><span class="kw">str_split</span>(<span class="dt">pattern =</span> <span class="st">&quot;-&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1294-3" data-line-number="3"><span class="st">  </span><span class="kw">str_c</span>(<span class="dt">collapse =</span> <span class="st">&quot;/&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;c(\&quot;3\&quot;, \&quot;14\&quot;, \&quot;1963\&quot;)&quot;</code></pre>
<p>That’s not what we want. We have to remember than the result of applying <code>str_split()</code> is a list:</p>
<div class="sourceCode" id="cb1296"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1296-1" data-line-number="1"><span class="st">&quot;3-14-1963&quot;</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1296-2" data-line-number="2"><span class="st">  </span><span class="kw">str_split</span>(<span class="dt">pattern =</span> <span class="st">&quot;-&quot;</span>)</a></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;3&quot;    &quot;14&quot;   &quot;1963&quot;</code></pre>
<p>We need to unlist prior to the join. The correct procedure is:</p>
<div class="sourceCode" id="cb1298"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1298-1" data-line-number="1"><span class="st">&quot;3-14-1963&quot;</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1298-2" data-line-number="2"><span class="st">  </span><span class="kw">str_split</span>(<span class="dt">pattern =</span> <span class="st">&quot;-&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1298-3" data-line-number="3"><span class="st">  </span><span class="kw">unlist</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1298-4" data-line-number="4"><span class="st">  </span><span class="kw">str_c</span>(<span class="dt">collapse =</span> <span class="st">&quot;/&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;3/14/1963&quot;</code></pre>
<p>Now all is well. Soon, though, we’ll learn a superior method for performing substitutions in strings.</p>
</div>
</div>
<div id="formatted-printing" class="section level2">
<h2><span class="header-section-number">9.4</span> Formatted Printing</h2>
<p>Quite often when we are printing out to the console we want each line to follow some uniform format. This can be accomplished with the <code>sprintf()</code> function.<a href="#fn19" class="footnote-ref" id="fnref19"><sup>19</sup></a> Lets begin with an example:</p>
<div class="sourceCode" id="cb1300"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1300-1" data-line-number="1">first &lt;-<span class="st"> &quot;Mary&quot;</span></a>
<a class="sourceLine" id="cb1300-2" data-line-number="2">last &lt;-<span class="st"> &quot;Poppins&quot;</span></a>
<a class="sourceLine" id="cb1300-3" data-line-number="3"><span class="kw">sprintf</span>(<span class="dt">fmt =</span> <span class="st">&quot;%10s%20s&quot;</span>, first, last)</a></code></pre></div>
<pre><code>## [1] &quot;      Mary             Poppins&quot;</code></pre>
<p><code>sprintf()</code> builds a string from the strings <code>first</code> and <code>last</code> that were passed to it. The <code>fmt</code> parameter is a string that encodes the <em>format</em> of the result. In this example, the command comes down to:</p>
<ul>
<li>create a string of width 10, consisting of five spaces followed by the five characters of “Mary”</li>
<li>create a string of width 20, consisting of 13 spaces followed by the seven characters of “Poppins”</li>
<li>The preceding two strings are called <em>fields</em>. We then join the above the fields, with nothing between them.</li>
</ul>
<p>Here is the result, <code>cat</code>ed out:</p>
<div class="sourceCode" id="cb1302"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1302-1" data-line-number="1"><span class="kw">sprintf</span>(<span class="dt">fmt =</span> <span class="st">&quot;%10s%20s&quot;</span>, first, last) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1302-2" data-line-number="2"><span class="st">  </span><span class="kw">cat</span>()</a></code></pre></div>
<pre><code>##       Mary             Poppins</code></pre>
<p>The “s” in the the <code>fmt</code> argument is called a <em>conversion character</em>. It tells <code>sprintf()</code> to expect a string. Each percent sign indicates the beginning of a new field. For each field, the desired field-width should appear between the percent-sign and the conversion character for the field.</p>
<p>In the text above, the names are <em>right-justified</em>, meaning that they appear at the end of their respective fields. If you want a field to be left-justified, insert a hyphen anywhere between the percent sign and the conversion character, like so:</p>
<div class="sourceCode" id="cb1304"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1304-1" data-line-number="1"><span class="co"># left-justify both fields:</span></a>
<a class="sourceLine" id="cb1304-2" data-line-number="2"><span class="kw">sprintf</span>(<span class="dt">fmt =</span> <span class="st">&quot;%-10s%-20s&quot;</span>, first, last) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">cat</span>()</a></code></pre></div>
<pre><code>## Mary      Poppins</code></pre>
<p>Other common conversion characters are:</p>
<ul>
<li><code>d</code>: an integer</li>
<li><code>f</code>: a decimal number (default is 6 digits precision)</li>
<li><code>g</code>: a decimal number where the default precision is determined by the number of significant figures in the given number</li>
</ul>
<p>Here is another example:</p>
<div class="sourceCode" id="cb1306"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1306-1" data-line-number="1"><span class="kw">sprintf</span>(<span class="dt">fmt =</span> <span class="st">&quot;%-10s%-10d%-10f&quot;</span>, <span class="st">&quot;Mary&quot;</span>, <span class="dv">1955</span>, <span class="fl">3.2</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">cat</span>()</a></code></pre></div>
<pre><code>## Mary      1955      3.200000</code></pre>
<p>The following example is the same as above, except that we retain only the significant figures in the 3.2:</p>
<div class="sourceCode" id="cb1308"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1308-1" data-line-number="1"><span class="kw">sprintf</span>(<span class="dt">fmt =</span> <span class="st">&quot;%-10s%-10d%-10g&quot;</span>, <span class="st">&quot;Mary&quot;</span>, <span class="dv">1955</span>, <span class="fl">3.2</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">cat</span>()</a></code></pre></div>
<pre><code>## Mary      1955      3.2</code></pre>
<p>When you are creating a field for a decimal number, you can specify both the total field-width and the precision together if you separate them with a <code>.</code>. Thus, if you want the number 234.5647 to appear right-justified in a field of width 10, showing only the first three decimal places, then try:</p>
<div class="sourceCode" id="cb1310"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1310-1" data-line-number="1"><span class="kw">sprintf</span>(<span class="dt">fmt =</span> <span class="st">&quot;%-10s%-10d%-10.3f&quot;</span>, <span class="st">&quot;Mary&quot;</span>, <span class="dv">1955</span>, <span class="fl">234.5647</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1310-2" data-line-number="2"><span class="st">  </span><span class="kw">cat</span>()</a></code></pre></div>
<pre><code>## Mary      1955      234.565</code></pre>
<p><code>sprintf()</code> comes in handy when you want your output to appear in nicely-aligned, tabular fashion. Consider this example:</p>
<div class="sourceCode" id="cb1312"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1312-1" data-line-number="1"><span class="co"># information for three people:</span></a>
<a class="sourceLine" id="cb1312-2" data-line-number="2">firstName &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Donald&quot;</span>, <span class="st">&quot;Gina&quot;</span>, <span class="st">&quot;Rohini&quot;</span>)</a>
<a class="sourceLine" id="cb1312-3" data-line-number="3">lastName &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Duck&quot;</span>, <span class="st">&quot;Gentorious&quot;</span>, <span class="st">&quot;Lancaster&quot;</span>)</a>
<a class="sourceLine" id="cb1312-4" data-line-number="4">age &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">17</span>, <span class="dv">19</span>, <span class="dv">20</span>)</a>
<a class="sourceLine" id="cb1312-5" data-line-number="5">gpa &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">3.7</span>, <span class="fl">3.9</span>, <span class="fl">3.823</span>)</a>
<a class="sourceLine" id="cb1312-6" data-line-number="6"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>) {</a>
<a class="sourceLine" id="cb1312-7" data-line-number="7">  <span class="kw">sprintf</span>(<span class="st">&quot;%-15s%-20s%-5d%-5.2f</span><span class="ch">\n</span><span class="st">&quot;</span>, </a>
<a class="sourceLine" id="cb1312-8" data-line-number="8">          firstName[i], lastName[i], age[i], gpa[i]) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1312-9" data-line-number="9"><span class="st">    </span><span class="kw">cat</span>()</a>
<a class="sourceLine" id="cb1312-10" data-line-number="10">}</a></code></pre></div>
<pre><code>## Donald         Duck                17   3.70 
## Gina           Gentorious          19   3.90 
## Rohini         Lancaster           20   3.82</code></pre>
<p>Note the use of “\n” in the <code>fmt</code> argument to ensure that the output appears on separate lines.</p>
<p>You could take advantage of vectorization to avoid the loop:</p>
<div class="sourceCode" id="cb1314"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1314-1" data-line-number="1"><span class="kw">sprintf</span>(<span class="st">&quot;%-15s%-20s%5-d%-5.2f</span><span class="ch">\n</span><span class="st">&quot;</span>, </a>
<a class="sourceLine" id="cb1314-2" data-line-number="2">        firstName, lastName, age, gpa) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1314-3" data-line-number="3"><span class="st">  </span><span class="kw">cat</span>()</a></code></pre></div>
<pre><code>## Donald         Duck                17   3.70 
##  Gina           Gentorious          19   3.90 
##  Rohini         Lancaster           20   3.82</code></pre>
<p>Well, that’s not quite right: the second and third lines begin with a space. This happens because <code>cat()</code> separates its input with a space by default. You can prevent this, however, with the <code>sep</code> parameter of <code>cat()</code>:</p>
<div class="sourceCode" id="cb1316"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1316-1" data-line-number="1"><span class="kw">sprintf</span>(<span class="st">&quot;%-15s%-20s%-5d%-5.2f</span><span class="ch">\n</span><span class="st">&quot;</span>, </a>
<a class="sourceLine" id="cb1316-2" data-line-number="2">        firstName, lastName, age, gpa) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1316-3" data-line-number="3"><span class="st">  </span><span class="kw">cat</span>(<span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## Donald         Duck                17   3.70 
## Gina           Gentorious          19   3.90 
## Rohini         Lancaster           20   3.82</code></pre>

</div>
<div id="glossary-6" class="section level2 unnumbered">
<h2>Glossary</h2>
<dl>
<dt>String </dt>
<dd><p>A sequence of characters.</p>
</dd>
<dt>Control Character </dt>
<dd><p>A member of a character set that does not represent a written symbol.</p>
</dd>
<dt>Unicode </dt>
<dd><p>A computing-industry standard for the consistent encoding of text in most of the world’s written languages.</p>
</dd>
</dl>

</div>
<div id="exercises-5" class="section level2 unnumbered">
<h2>Exercises</h2>
<p><img src="images/thinking.png" width="50%" style="display: block; margin: auto;" /></p>
<ol style="list-style-type: decimal">
<li>Write a function called <code>revStr()</code> that reverses the characters of any string that it is given. The function should take a single parameter:
<ul>
<li><code>str</code>: a character-vector of length 1 (a single string).</li>
</ul>
<p>Typical examples of use should look like this:</p>
<div class="sourceCode" id="cb1318"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1318-1" data-line-number="1"><span class="kw">revStr</span>(<span class="dt">str =</span> <span class="st">&quot;goodbye&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;eybdoog&quot;</code></pre></li>
<li>A string is said to be a <em>palindrome</em> if it is the same no matter whether it is spelled backwards or forwards. Write a function called <code>palindromeStr()</code> that determines whether or not a given string is a palindrome. The function should take a single parameter:
<ul>
<li><code>str</code>: a character-vector of length 1 (a single string).</li>
</ul>
<p>It should return <code>TRUE</code> if <code>str</code> is a palindrome, and return <code>FALSE</code> otherwise. Typical example of use should look like this:</p>
<div class="sourceCode" id="cb1320"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1320-1" data-line-number="1"><span class="kw">palindromeStr</span>(<span class="dt">str =</span> <span class="st">&quot;abba&quot;</span>)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb1322"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1322-1" data-line-number="1"><span class="kw">palindromeStr</span>(<span class="st">&quot;hello&quot;</span>)</a></code></pre></div>
<pre><code>## [1] FALSE</code></pre></li>
<li>Write a function called <code>subStrings()</code> that returns a vector of the substrings of a given string that have at least a given number of characters. The function should take two arguments:
<ul>
<li><code>str</code>: a character-vector of length 1 (a single string);</li>
<li><code>n</code>: the minimum number of characters a substring should have in order to be included in the vector.</li>
</ul>
<p>Validate the input: if the argument for <code>n</code> is less than 1 or greater than the number of characters in <code>str</code>, then the function should advise the user and cease execution. Typical examples of use should look like this (although it is OK if your output-vector contains the sub-strings in a different order):</p>
<div class="sourceCode" id="cb1324"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1324-1" data-line-number="1"><span class="kw">subStrings</span>(<span class="st">&quot;hello&quot;</span>, <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## [1] &quot;hello&quot; &quot;hell&quot;  &quot;ello&quot;  &quot;hel&quot;   &quot;ell&quot;   &quot;llo&quot;</code></pre>
<div class="sourceCode" id="cb1326"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1326-1" data-line-number="1"><span class="kw">subStrings</span>(<span class="st">&quot;hello&quot;</span>, <span class="dv">6</span>)</a></code></pre></div>
<pre><code>## n should be at least 1 and no more than the number
## of characters in str.</code></pre></li>
<li>Write a function called <code>subPalindrome()</code> that, for any given string and specified number <span class="math inline">\(n\)</span>, returns a character vector of all the substrings of the string having at least <span class="math inline">\(n\)</span> characters that are also palindromes. The function should take two arguments:
<ul>
<li><code>str</code>: a character-vector of length 1 (a single string);</li>
<li><code>n</code>: the minimum number of characters a substring should have in order to be included in the vector.</li>
</ul>
<p>Validate the input: if the argument for <code>n</code> is less than 1 or greater than the number of characters in <code>str</code>, then the function should advise the user and cease execution. Typical examples of use should look like this (although it is OK if your output-vector contains the palindromes in a different order):</p>
<div class="sourceCode" id="cb1328"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1328-1" data-line-number="1"><span class="kw">subPalindrome</span>(<span class="st">&quot;yabbadabbadoo!&quot;</span>, <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##  [1] &quot;abbadabba&quot; &quot;bbadabb&quot;   &quot;dabbad&quot;    &quot;badab&quot;     &quot;abba&quot;     
##  [6] &quot;abba&quot;      &quot;ada&quot;       &quot;bb&quot;        &quot;bb&quot;        &quot;oo&quot;</code></pre>
<div class="sourceCode" id="cb1330"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1330-1" data-line-number="1"><span class="kw">subPalindrome</span>(<span class="st">&quot;yabbadabbadoo!&quot;</span>, <span class="dv">10</span>)</a></code></pre></div>
<pre><code>## character(0)</code></pre>
<div class="sourceCode" id="cb1332"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1332-1" data-line-number="1"><span class="kw">subPalindrome</span>(<span class="st">&quot;yabbadabbadoo!&quot;</span>, <span class="dv">0</span>)</a></code></pre></div>
<pre><code>## n should be at least 1 and no more than the number
## of characters in str.</code></pre></li>
<li>Write a function called <code>m111Report()</code> that performs formatted printing from the data frame <code>m111survey</code> in the <strong>bcscr</strong> package. Given a vector of row numbers, the function will print out the sex, feeling about weight, and GPA of the corresponding individuals. Thus each row in the printout will correspond to an individual in the study. Each row will consist of three fields:
<ul>
<li>The first field is 10 characters wide, and contains either “male” or “female”, followed by the appropriate number of spaces.</li>
<li>The first field is 15 characters wide, and contains either “underweight” or “about right” or “overweight”, followed by the appropriate number of spaces.</li>
<li>The third field is 5 characters wide, and contains an appropriate number of spaces followed by the grade-point average showing only the first two decimal places. This, if a person’s GPA is recorded as 2.714 then the field will be &quot; 2.71&quot;. (Note that, with the space and the decimal point, the total number of characters is 5, as required.)</li>
</ul>
<p>A typical example of use is as follows:</p>
<div class="sourceCode" id="cb1334"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1334-1" data-line-number="1"><span class="kw">m111Report</span>(<span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">15</span>))</a></code></pre></div>
<pre><code>## male      about right     2.50
## female    overweight        NA
## male      underweight     3.20</code></pre>
<p>Note that you will have to re-code the feelings about weight.</p></li>
</ol>
<!--chapter:end:100-strings.Rmd-->
</div>
</div>
<div id="regex" class="section level1">
<h1><span class="header-section-number">10</span> Regular Expressions</h1>
<div class="figure" style="text-align: center">
<img src="images/xkcd-regex-save-day.png" alt="Regular Expressions, by xkcd." width="60%" />
<p class="caption">
(#fig:xkcd-regular-expressions)Regular Expressions, by xkcd.
</p>
</div>
<p>In this Chapter we introduce the concept of <em>regular expressions</em>, a powerful tool that enables you to search for complex patterns in text. We will continue to use functions from the <strong>stringr</strong> package, so make sure you have it attached.</p>

<div id="motivation" class="section level2">
<h2><span class="header-section-number">10.1</span> Motivation</h2>
<p>Suppose you wish to determine how many times the string “ab” appears within some given string. You could write a function to perform this task.</p>
<div class="sourceCode" id="cb1336"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1336-1" data-line-number="1">occurrences &lt;-<span class="st"> </span><span class="cf">function</span>(string) {</a>
<a class="sourceLine" id="cb1336-2" data-line-number="2">  count &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb1336-3" data-line-number="3">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">str_length</span>(string)) {</a>
<a class="sourceLine" id="cb1336-4" data-line-number="4">    stringPart &lt;-<span class="st"> </span><span class="kw">str_sub</span>(string, i, i<span class="op">+</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1336-5" data-line-number="5">    <span class="cf">if</span> ( stringPart <span class="op">==</span><span class="st"> &quot;ab&quot;</span> ) {</a>
<a class="sourceLine" id="cb1336-6" data-line-number="6">      count &lt;-<span class="st"> </span>count <span class="op">+</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb1336-7" data-line-number="7">    }</a>
<a class="sourceLine" id="cb1336-8" data-line-number="8">  }</a>
<a class="sourceLine" id="cb1336-9" data-line-number="9">  count</a>
<a class="sourceLine" id="cb1336-10" data-line-number="10">}</a></code></pre></div>
<p>Let’s try it out:</p>
<div class="sourceCode" id="cb1337"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1337-1" data-line-number="1"><span class="kw">occurrences</span>(<span class="st">&quot;yabbadabbadoo!&quot;</span>)</a></code></pre></div>
<pre><code>## [1] 2</code></pre>
<p>This looks right, as there are indeed exactly two occurrences of “ab”: one at beginning at the second character and another beginning at the seventh character.</p>
<p>Suppose instead that we are interested in counting occurrences, in some arbitrary given string, of any of the following three strings:</p>
<ul>
<li>“ab”</li>
<li>“Ab”</li>
<li>“foo”</li>
</ul>
<p>How might we handle this task? Again we could write a function. This time we will generalize it a bit, allowing the user to input, along with the string to be searched, a vector of the sub-strings of interest.</p>
<div class="sourceCode" id="cb1339"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1339-1" data-line-number="1"><span class="co"># function to count occurrences of substrings in string.</span></a>
<a class="sourceLine" id="cb1339-2" data-line-number="2"><span class="co"># substrings are given as patterns</span></a>
<a class="sourceLine" id="cb1339-3" data-line-number="3">occurrences2 &lt;-<span class="st"> </span><span class="cf">function</span>(string, patterns) {</a>
<a class="sourceLine" id="cb1339-4" data-line-number="4">  count &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb1339-5" data-line-number="5">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">str_length</span>(string)) {</a>
<a class="sourceLine" id="cb1339-6" data-line-number="6">    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(patterns)) {</a>
<a class="sourceLine" id="cb1339-7" data-line-number="7">      pattern &lt;-<span class="st"> </span>patterns[j]</a>
<a class="sourceLine" id="cb1339-8" data-line-number="8">      len &lt;-<span class="st"> </span><span class="kw">str_length</span>(pattern)</a>
<a class="sourceLine" id="cb1339-9" data-line-number="9">      stringPart &lt;-<span class="st"> </span><span class="kw">str_sub</span>(string, i, i <span class="op">+</span><span class="st"> </span>len <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1339-10" data-line-number="10">      <span class="cf">if</span> ( stringPart <span class="op">==</span><span class="st"> </span>pattern ) {</a>
<a class="sourceLine" id="cb1339-11" data-line-number="11">        count &lt;-<span class="st"> </span>count <span class="op">+</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb1339-12" data-line-number="12">      }</a>
<a class="sourceLine" id="cb1339-13" data-line-number="13">    }</a>
<a class="sourceLine" id="cb1339-14" data-line-number="14">  }</a>
<a class="sourceLine" id="cb1339-15" data-line-number="15">  count</a>
<a class="sourceLine" id="cb1339-16" data-line-number="16">}</a></code></pre></div>
<p>We try out our function on the string “This Labrador is a fool, Abba.”, which matches each of our patterns exactly once, for a total of three matches,</p>
<div class="sourceCode" id="cb1340"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1340-1" data-line-number="1"><span class="kw">occurrences2</span>(<span class="st">&quot;This Labrador is a fool, Abba.&quot;</span>,</a>
<a class="sourceLine" id="cb1340-2" data-line-number="2">           <span class="dt">patterns =</span> <span class="kw">c</span>(<span class="st">&quot;ab&quot;</span>, <span class="st">&quot;Ab&quot;</span>, <span class="st">&quot;foo&quot;</span>))</a></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>Well, and good, but … the coding is beginning to get a bit complex. What if we were searching instead for, say, sub-strings that resemble a phone number with an area code, i.e., strings of the form:</p>
<blockquote>
<p>ddd-ddd-dddd</p>
</blockquote>
<p>(Here the d’s represent digits from 0 to 9.)</p>
<p>There are <span class="math inline">\(10^{10}\)</span> patterns of interest!<a href="#fn20" class="footnote-ref" id="fnref20"><sup>20</sup></a> How would we go about describing them all to R?</p>
<p>Fortunately, regular expressions are there to help us out. A <em>regular expression</em>  is defined as a sequence of characters that represents a pattern that might or might not be present in any given string. A computer will rely on a <em>regular expression engine</em>—a specific implementation of a system of regular expressions—to use a given regular expression to search in text for matches to the pattern that the expression represents.</p>
<p>In practice, regular expressions are like a miniature programming language within a programming language. They are a feature of most major programming languages, including R. With regular expressions we can describe complex string-patterns concisely, and can perform rapid searches for these patterns in a given body of text.</p>
<p>The rules for regular expressions vary a bit from one language to another, but the general idea is essentially the same for all of them. In the remainder of this Chapter we’ll learn enough of the principles of regular expressions to describe basic, useful patterns, and we’ll also study R-functions that make use of them.</p>
<p>First of all, here’s a quick example to show the power of regular expressions. The work done by <code>occurences2()</code> may also be done in one line with the <code>str_count()</code>  function, as follows:</p>
<div class="sourceCode" id="cb1342"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1342-1" data-line-number="1"><span class="kw">str_count</span>(<span class="dt">string =</span> <span class="st">&quot;This Labrador is a fool, Abba.&quot;</span>,</a>
<a class="sourceLine" id="cb1342-2" data-line-number="2">         <span class="dt">pattern =</span> <span class="st">&quot;[Aa]b|foo&quot;</span>)</a></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>Wow, that was quick. But what in the world is that <code>&quot;[Aa]b|foo&quot;</code> argument to the <code>pattern</code> parameter?</p>
<p>It’s a regular expression! It tells R to look for sub-strings that EITHER:</p>
<ul>
<li>start with either “A” or “a”, and are then followed by a “b”, OR</li>
<li>consist of “foo”</li>
</ul>
<p>Clearly it is high time that we learn a bit of regular-expression syntax.</p>
</div>
<div id="regex-practice-sites" class="section level2">
<h2><span class="header-section-number">10.2</span> Regex Practice Sites</h2>
<p>As we introduce regex syntax in the next few sections, it’s a good idea to try them out yourself and to come up with your own variations. The easiest way to do this is not to work directly in R at the outset; instead, consider using an online regex practice site. I especially recommend <a href="http://regexr.com/">RegExr</a>, which has a nice documentation interface. Set the regex flavor to PCRE, as this is the variant of regular expression syntax that is closest to the ICU regex variant used by the <strong>stringr</strong> package. If you go on to Web Programming course then you can switch to the JavaScript flavor.</p>
<p>Bear in mind also that as we learn regex syntax, we’ll focus on the standard, language-independent syntax itself. There are some differences between this standard syntax and the way in which you would actually enter a regex pattern in R.</p>
</div>
<div id="regex-syntax" class="section level2">
<h2><span class="header-section-number">10.3</span> Regex Syntax</h2>
<p>Let’s start learning the syntax.</p>
<div id="matching-a-specific-sequence" class="section level3">
<h3><span class="header-section-number">10.3.1</span> Matching a Specific Sequence</h3>
<p>If you are searching for occurrences of one specific sequence of characters, the regular expression to use is just that sequence of characters.</p>
<p>For example, if your regex is <code>bet</code>, then you’ll get a match whenever the characters “b”, “e”, and “t” occur consecutively in the text you are searching.</p>
<p>In the sample text below, the matches are in italics:</p>
<blockquote>
<p>I <em>bet</em> you are reading <em>bet</em>ween the lines. Better to read the lines themselves.</p>
</blockquote>
<p>We didn’t match “Bet” in “Better” because “B” is uppercase.</p>
<p>The characters “b”, “e” and “t” in the regex “bet” are examples of <em>literal characters</em>. This means that they stand for exactly what they are: the “b” in the expression matches a “b” in the text we are searching, the “e” in the expression matches an “e” in text, and so on.</p>
<p>There are a lot of exceptions to our specific-sequence rule. We’ll get to them soon.</p>
</div>
<div id="character-classes" class="section level3">
<h3><span class="header-section-number">10.3.2</span> Character Classes</h3>
<p>Suppose you want to match either “bet” or “Bet”? One way to do this is to use a <em>character class</em>. A character class  consists of a set of characters surrounded by square brackets, and it tells the regex engine to match any one of the characters in the class.</p>
<p>Consider, for example, the regex <code>[Bb]et</code>. It consists of the character class <code>[Bb]</code> followed by the pair of literal characters <code>et</code>. It matches:</p>
<blockquote>
<p>I <em>bet</em> you are reading <em>bet</em>ween the lines. <em>Bet</em>ter to read the lines themselves.</p>
</blockquote>
<p>Another example: <code>t[aeiou]</code> matches any two-character sequence in which “t” is followed by a lowercase vowel:</p>
<blockquote>
<p>Get thee <em>to</em> a nunnery.</p>
</blockquote>
<div id="ranges" class="section level4">
<h4><span class="header-section-number">10.3.2.1</span> Ranges</h4>
<p>You can match a <em>range</em>  of characters. Inside a character class:</p>
<ul>
<li><code>a-z</code> represents all lowercase letters from a to z;</li>
<li><code>A-Z</code> represents all of the uppercase letters;</li>
<li><code>0-9</code> represents all of the decimal digits: 0, 1, 2, …, 9.</li>
<li>Other ranges are possible, e.g.:
<ul>
<li><code>c-f</code> denotes the lowercase letters from c to f;</li>
<li><code>0-3</code> denotes 9, 1, 2 and 3.</li>
</ul></li>
</ul>
<p>Thus, in order to match any letter followed by two digits, you could use <code>[a-zA-Z][0-9][0-9]</code>:</p>
<blockquote>
<p>Your room number is <em>B43</em>, not C4 or #39.</p>
</blockquote>
</div>
<div id="the-need-to-escape" class="section level4">
<h4><span class="header-section-number">10.3.2.2</span> The Need to Escape</h4>
<p>Perhaps now you can spot the problem with the sequence-specific rule: what happens if one of the characters in the sequence is, say ‘[’ or ’]’? These characters are examples of <em>metacharacters</em>,  which means that in the syntax of regular expressions they don’t match themselves but instead have a special role. In the case of square-brackets, that role is to delimit character classes.</p>
<p>If you want your pattern to include a metacharacter you will have to escape it with the backslash. Thus, the correct way to match the string “[aardvark]” would be with the regular expression: <code>\[aardvark]\]</code>:</p>
<blockquote>
<p>The <em>[aardvark]</em> appears early in the dictionary.</p>
</blockquote>
<p>Actually, you only need to escape a metacharacter when it acts <em>in its role as metacharacter</em>. For example, if you want to match “b-b”, you are fine to use <code>b-b</code>. Because the expression contains no square brackets, it’s not possible for the hyphen to act in its special role to set ranges, so it does not have to be escaped.</p>
<p>Inside of square brackets it can matter whether you escape the hyphen. Thus:</p>
<ul>
<li><code>[a-c]</code> matches a, b, and c;</li>
<li><code>[a\-c]</code> matches a, -, and c (but not b);</li>
<li><code>[a-]</code> matches a and - (the machine can tell that the hyphen was not being used in a range);</li>
<li><code>[a\-]</code> also matches just a and -, not a, \ and -. (Apparently the regex syntax takes into account the fact that some folks will worry that they might have to escape the hyphen).</li>
</ul>
<p>Of course since the backslash plays a role in escaping metacharacters, it too acts as a metacharacter at times. Hence if you want to match a backslash you’ll have to escape <em>it</em>! How? By preceding the black-slash with a backslash! Thus:</p>
<ul>
<li><code>a\\b</code> matches “a\b”;</li>
<li><code>a\\\\b</code> matches “a\\b”.</li>
</ul>
<p>On the other hand:</p>
<ul>
<li><code>a\tb</code> matches a followed by a tab followed by b, because in this case the machine recognizes <code>\t</code> as the control character for a tab;</li>
<li><code>a\ab</code> matches a followed by the bell-alert followed by b, and so on for other control characters.</li>
</ul>
<p>But keep the following in mind:</p>
<ul>
<li><code>a\eb</code> is incorrect regex syntax: <code>\e</code> is not recognized as one of the control characters.</li>
<li>And yet <code>a\wb</code> is <em>correct</em> regex syntax! (It turns out that the token <code>\w</code> is a recognized character class <em>shortcut</em> that means the same as <code>[a-zA-Z0-9]</code>. We’ll get to the shortcuts soon.)</li>
</ul>
</div>
<div id="named-character-classes" class="section level4">
<h4><span class="header-section-number">10.3.2.3</span> Named Character Classes</h4>
<p>Some character classes occur so commonly that they have been granted special names. Table @ref(tab:character-class-names) gives a few that are worth remembering.</p>
<table>
<caption>(#tab:character-class-names)A few character classes worth remembering.</caption>
<thead>
<tr class="header">
<th align="left">Class Name</th>
<th align="left">Represents</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">[:alpha:]</td>
<td align="left">a-zA-Z</td>
</tr>
<tr class="even">
<td align="left">[:alnum:]</td>
<td align="left">a-zA-Z0-9</td>
</tr>
<tr class="odd">
<td align="left">[:word:]</td>
<td align="left">a-zA-Z0-9_ (note the underscore)</td>
</tr>
<tr class="even">
<td align="left">[:space:]</td>
<td align="left">white space</td>
</tr>
<tr class="odd">
<td align="left">[:lower:]</td>
<td align="left">a-z</td>
</tr>
<tr class="even">
<td align="left">[:upper:]</td>
<td align="left">A-Z</td>
</tr>
</tbody>
</table>
<p>Here’s how you would use character class names in a regular expression:</p>
<ul>
<li><code>t[[:alnum:]]t</code> matches t followed by any alphanumeric character followed by t. (The double brackets are needed since, according to the rules, <code>t[:alnum:]t</code> would match t followed by any one of :, a, l, n, u or m, followed by t.)</li>
</ul>
</div>
<div id="character-class-shortcuts" class="section level4">
<h4><span class="header-section-number">10.3.2.4</span> Character Class Shortcuts</h4>
<p>Some character classes are so very common that they merit extra-short shortcuts: most of these shortcuts begin with a backslash. We’ll call them <em>character class shortcuts</em>.  Some of the most common character class shortcuts are shown in Table @ref(tab:character-types)</p>
<table>
<caption>(#tab:character-types)A few character class shortcuts worth remembering.</caption>
<thead>
<tr class="header">
<th align="left">Type</th>
<th align="left">Represents</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">\d</td>
<td align="left">any decimal digit (0-9)</td>
</tr>
<tr class="even">
<td align="left">\D</td>
<td align="left">anything not a decimal digit</td>
</tr>
<tr class="odd">
<td align="left">\s</td>
<td align="left">any white space character</td>
</tr>
<tr class="even">
<td align="left">\S</td>
<td align="left">anything not a white space character</td>
</tr>
<tr class="odd">
<td align="left">\w</td>
<td align="left">any word character (same as [word])</td>
</tr>
<tr class="even">
<td align="left">\W</td>
<td align="left">anything not a word character</td>
</tr>
<tr class="odd">
<td align="left">.</td>
<td align="left">any character except newline</td>
</tr>
</tbody>
</table>
<p>The <code>.</code> requires special care: if you are searching for a literal dot, you’ll have to escape it with a backslash. Thus <code>32\.456</code> matches “32.456”, whereas <code>32.456</code> matches “32a456”, 32b456&quot;, and so on.</p>
</div>
<div id="negation-in-a-character-class" class="section level4">
<h4><span class="header-section-number">10.3.2.5</span> Negation in a Character Class</h4>
<p>Suppose you would like to match any sequence of three characters of this form:</p>
<ul>
<li>t</li>
<li>any character EXCEPT e, x and z</li>
<li>t</li>
</ul>
<p>You can accomplish this by negating within a character class: the regex to use is <code>t[^exz]t</code>. Here the caret <code>^</code> functions as a metacharacter, indicating that any character except the others in the class are permitted. In order to function as a negation, the <code>^</code> must appear immediately after the opening bracket. If it appears elsewhere in the class, then it’s a literal: it just stands for itself. (Outside of a character class the <code>^</code> functions as an <em>anchor</em>—we’ll get to these soon—and as such has to be escaped if you want to act as a literal.)</p>
<p>As another example, <code>t[^a-z]t</code> matches t followed by any character expect a lowercase letter, followed by t.</p>
<p>Negating within a particular class of characters can be tricky. For example, suppose you are looking for 3-character sequences that consist of t, any letter except e or E, and then t. Rather than trying to use a <code>^</code> it’s easiest to work with ranges: <code>t[a-df-zA-DF-Z]t</code>.</p>
</div>
</div>
<div id="quantification" class="section level3">
<h3><span class="header-section-number">10.3.3</span> Quantification</h3>
<p>Suppose you want to match phone numbers, where the area code is included and the groups of digits are separated by hyphens, as in: 202-456-1111. Taking advantage of the character class shortcut for digits, you could use the following <code>regex</code>:</p>
<blockquote>
<p><code>\d\d\d-\d\d\d-\d\d\d\d</code></p>
</blockquote>
<p>But that’s a bit difficult to read. And besides, what if you weren’t working with phone numbers but instead wanted to match sequences like the following (which has 10 digits in succession)?</p>
<blockquote>
<p>A2356737821</p>
</blockquote>
<p>It would be awful to write <code>A\d\d\d\d\d\d\d\d\d\d</code>.</p>
<p>This is where <em>quantifiers</em>  come in. In regular expression syntax a token of the form <code>{n}</code> indicates that we are looking for n consecutive copies of whatever token precedes the <code>{n}</code>. Thus we can write the phone-number regex more concisely and more legibly as:</p>
<blockquote>
<p><code>\d{3}-\d{3}-\d{4}</code></p>
</blockquote>
<p>Note that the curly braces <code>{</code> and <code>}</code> may now function as metacharacters, and as such may have to be escaped if you are looking for them specifically, Thus if you want to search for occurrences of “t{3}b”, you’ll need the regex <code>t\{3\}b</code>. On the other hand if you want to match “t{swim}b” then it’s fine to use the regex <code>t{swim}b</code>: the machine sees here that the braces don’t play a role in quantification.</p>
<p>Quantifiers are quite flexible. Within a quantifier you can use a comma to indicate a range of permissible number of copies of the preceding expression:</p>
<ul>
<li><code>t{3,5}</code> matches 3, 4 or 5 t’s in succession: ttt, tttt, or ttttt;</li>
<li><code>t{3,}</code> matches three or more t’s in succession: ttt, tttt, ttttt, … .</li>
</ul>
<p>Because quantification is so often required, regular expression syntax provides shortcuts for special cases:</p>
<ul>
<li><code>t*</code> matches 0 or more t’s;</li>
<li><code>t+</code> matches one or more t’s;</li>
<li><code>t?</code> matches 0 or 1 t.</li>
</ul>
<p>An example: to match the beginning of a URL, use <code>https?://</code>:</p>
<blockquote>
<p>The URL <em><a href="https://*example.org" class="uri">https://*example.org</a> provides authentication of the site, whereas you should not pay with a credit card on </em><a href="http://*flybynight.com" class="uri">http://*flybynight.com</a>, On the other hand htto://example,org is not a valid URL—it’s probably a typo.</p>
</blockquote>
<p>Note that these shortcuts introduce new metacharacters: <code>*</code>, <code>+</code> and <code>?</code>. You’ll probably need to escape them when you want to search for them as literals outside of a character class.</p>
</div>
<div id="greedy-vs.lazy" class="section level3">
<h3><span class="header-section-number">10.3.4</span> Greedy vs. Lazy</h3>
<p>When it comes to the open-ended quantifiers (<code>{n,}</code> or the shortcuts <code>*</code> and <code>+</code>), the default behavior is to make the longest match possible. This is known as <em>greedy</em>  behavior. Consider the matches reported in the following text for <code>b{3,}</code></p>
<blockquote>
<p>b bb <em>bbb</em> <em>bbbb</em> <em>bbbbb</em></p>
</blockquote>
<p>It is possible, however, to tell a quantifier to be <em>lazy</em>,  meaning that it should give the shortest possible matches. The way to do this is to append a <code>?</code> to the quantifier. Applied to the same text above the regex <code>b{3,}?</code> with the lazy quantifier reports a different set of (sometimes shorter) matches:</p>
<blockquote>
<p>b bb <em>bbb</em> <em>bbb</em>b <em>bbb</em>bb</p>
</blockquote>
</div>
<div id="grouping" class="section level3">
<h3><span class="header-section-number">10.3.5</span> Grouping</h3>
<p>
A quantifier refers to the shortest meaningful item immediately preceding it. Look at these examples:</p>
<ul>
<li><code>ab+</code> matches “a” followed by 1 or more “b”’s;</li>
<li><code>a\d+</code> matches “a” followed by 1 or more digits;</li>
<li><code>a[^bc]+</code> matches “a” followed by 1 or more occurrence of anything other than “b” or “c”;</li>
</ul>
<p>In the examples above, any match begins with “a”. If we want to get “a” into the scope of the quantifier, we have to group it with the item immediately preceding the quantifier. Grouping is accomplished with parentheses. Consider these examples:</p>
<ul>
<li><code>(ab)+</code> matches one or more occurrences of “ab” in succession;</li>
<li><code>(a\d{2,})+</code> matches one or more occurrences of “a” followed by at least two digits. Thus it matches “a23” and “a23a773”. It won’t match “a2a3”. It will match only the “a23” in “a23a6” and it will match only the “a567” in “a4a567”.</li>
</ul>
<p>Grouping is a great help in constructing highly complex patterns. Bear in mind that the grouping symbols <code>(</code> and <code>)</code> function as metacharacters and will have to be escaped outside of character classes when you are searching for them as literals. Inside of character classes they function only as literals. Thus:</p>
<ul>
<li><code>[(ab)*]</code> matches any one of the following characters: “(”, “a”, “b”, “)” and &quot;*&quot;.</li>
<li><code>\(yes\)</code> matches “(yes)”.</li>
</ul>
</div>
<div id="alternation" class="section level3">
<h3><span class="header-section-number">10.3.6</span> Alternation</h3>
<p>
In regex syntax the symbol <code>|</code> (the vertical “pipe”) functions as a metacharacter meaning <em>or</em>. Thus:</p>
<ul>
<li><code>a|b</code> matches “a” and it matches “b”;</li>
<li><code>bed|bath</code> matches “bed” and it matches “bath”;</li>
<li><code>a|b|c</code> matches any one of “a”, “b” and “c”;</li>
<li><code>(aa|bb)+</code> matches one or more occurrence of “aa” or “bb”. Thus it matches “aa”, “bb”, “aaaa”, “aabb”, “bbaa”, “bbbb” and so on.</li>
<li><code>(a(a|b)b)+</code> matches “aab”, “abb”, “aabaab”, “aababb”, and so on.</li>
</ul>
<p>Use of the pipe-symbol is known as <em>alternation</em>.</p>
<p>In most implementations of regular expressions alternation works rather slowly, so use character classes instead whenever you can. For example, <code>[a-e]</code> is preferred over <code>a|b|c|d|e</code>.</p>
</div>
<div id="anchors" class="section level3">
<h3><span class="header-section-number">10.3.7</span> Anchors</h3>
<p>Sometimes we are interested in patterns that occur in specific places in text, such as:</p>
<ul>
<li>at the beginning of a string;</li>
<li>at the end of a string</li>
<li>at the beginning or end of a word.</li>
</ul>
<p><em>Anchors</em> help us accomplish this. The most important anchors to remember are:</p>
<ul>
<li><code>^</code>, which indicates (in technical terms, <em>asserts</em>) the beginning of a string;</li>
<li><code>$</code>, which asserts the end of a string;<a href="#fn21" class="footnote-ref" id="fnref21"><sup>21</sup></a></li>
<li><code>\b</code>, which asserts the presence of any type word-boundary (a space, tab, comma, semicolon, etc.).</li>
</ul>
<p>Here are some examples:</p>
<ul>
<li><p>For <code>^Hello</code>:</p>
<blockquote>
<p><em>Hello</em> got matched, but not the next Hello.</p>
</blockquote></li>
<li><p>For <code>Hello$</code>:</p>
<blockquote>
<p>Hello did not get matched, but there is a match for the next <em>Hello</em></p>
</blockquote></li>
</ul>
<p>One thing that’s important to keep in mind about anchors is that they are <em>assertions</em>. This means that they don’t actually count for characters in a match; they merely assert the presence of something: the beginning or end of a string, the boundary of a a word, etc. Thus, there are six tokens in the regular expression <code>^Hello</code>, but only five characters—the letters in “Hello”—are involved in a match. The<code>^</code> merely asserts that a match must not only involve the given characters but must also occur at the beginning the string.</p>
<p>What does <code>^Hello$</code> match? The rules would say that the string must start with H, continue on with e, l, l and then o, and end there, so you might think that the only possible string containing a match of <code>^Hello$</code> is the string “Hello” itself.</p>
<p>But that’s not quite right:</p>
<ul>
<li>Go your online regex practice site (<a href="https://regex101.com/">Regular Expression 101</a>).</li>
<li>Enter the regex <code>hello$</code>.</li>
<li>Then at the “Set Regex Options” flag (right after the “/g”), ask to enter multiline mode.</li>
<li>You should now see “/gm” at the end.</li>
<li>In the test-text field, enter “I say hello”, press Return, and continue on the next line with “Again I say hello”.</li>
<li>You’ll see that both hello’s match.</li>
</ul>
<p>The reason for this is that in multiline mode <code>$</code> stands for the end of each line, not just the <em>absolute end</em>  of the string. From time to time you may deal with strings that run over multiple lines, so remember that if you want your ending anchors to represent end-of-line rather than the absolute end of the string, you’ll need to ask R to enter multiline mode. (Later on in the Chapter we’ll discuss some common modes and how to enter them in R.</p>
<p>The word-boundary anchor <code>\b</code> is quite useful. Consider the regex <code>bed</code> applied to the string below:</p>
<blockquote>
<p><em>bed</em> <em>bed</em>time pertur<em>bed</em></p>
</blockquote>
<p>There are three matches! With the regex <code>\bbed</code> there are just two matches:</p>
<blockquote>
<p><em>bed</em> <em>bed</em>time pertur<em>bed</em></p>
</blockquote>
<p>With the regex <code>\bbed\b</code> the only match is with the actual word “bed”:</p>
<blockquote>
<p><em>bed</em> bedtime perturbed</p>
</blockquote>
<p>Note that the beginning and the end of a string count as word-boundaries!</p>
</div>
<div id="regex-captures" class="section level3">
<h3><span class="header-section-number">10.3.8</span> Captures</h3>
<p>
How would you detect whether a particular instance of a pattern is repeated? For instance, suppose you are looking for occurrences of a word repeated immediately after itself with only a space in between, for example:</p>
<ul>
<li>“<em>bye bye</em> birdie”</li>
<li>“she said <em>night night</em>”</li>
</ul>
<p>The regex <code>\b\w+\b</code> (word boundary followed by one or more word characters followed by a word boundary) will match words like “bye” and “night”, but if you simply repeated the pattern, say: <code>\b\w+\b \b\w+\b</code>, then you match strings that don’t exhibit repetition, such as “bye hello” and day night&quot;.</p>
<p>What you want is for the first part of the regex to state your pattern—a word of one or more characters—then the space, and then something that represents <em>exactly the match</em> that occurs for the first pattern.</p>
<p>A <em>capture</em> accomplishes this. The regex you want is:</p>
<blockquote>
<p><code>\b(\w+) \1\b</code></p>
</blockquote>
<p>See what it matches in the phrase below:</p>
<blockquote>
<p>now it is time for <em>bed bed</em>, yes it is bed bedtime</p>
</blockquote>
<p>Here’s how the regex works:</p>
<ul>
<li>The leading <code>\b</code> requires the presence of a word-boundary, which is satisfied by the presence, in the string, of the space between “for” and “bed bed”. The second “bed bed” is also OK at this point, due to the space between “is” and the first “bed”.</li>
<li><code>\w+</code> matches the first “bed”, and the parentheses make it a group. By default the regex captures the contents of whatever portion of the string matches a group, and remembers those contents for later use.</li>
<li>The ` ` matches the space between the two “bed” strings.</li>
<li>The <code>\1</code> is a <em>back-reference</em>: it represents precisely what was matched in the earlier group. For the regex as a whole to produce a match, <code>\1</code> has to see an exact repetition of whatever string matched the first parenthesis-group in the regex, so it has to see “bed”. At this point both occurrences of “bed bed”&quot; are still in the running to be matches for the entire regex.</li>
<li>The final <code>\b</code> asserts a word-boundary. This is satisfied by the comma after the first “bed bed”, but not by the “t” after the second “bed bed”. Thus only the first “bed bed” matches the regular expression as a whole.</li>
</ul>
<p>Back-references are denoted <code>\1</code>, <code>\2</code>, and so on, and you can use several of them in the same regex. For example, if you want to match expressions such as “big boat big boat” then use:</p>
<blockquote>
<p><code>\b(\w+) (\w+) \1 \2\b</code></p>
</blockquote>
<p>Think about how the above regex works:</p>
<ul>
<li>To start, it requires the presence of a word-boundary.</li>
<li>It sets up a capture-group consisting of one or more word characters. Since this is the first set of parentheses, the group can be referenced later on by <code>\1</code>.</li>
<li>It then sets up a second capture-group that may be referenced later on by <code>\2</code>.</li>
<li>We then must see a space …</li>
<li>… followed by the contents of the first group …</li>
<li>… followed by the contents of the second group …</li>
<li>… at a word-boundary.</li>
</ul>
<p>If you want to match a palindrome<a href="#fn22" class="footnote-ref" id="fnref22"><sup>22</sup></a>consisting of five characters (“abcba”, “x444x”, etc.) then use:</p>
<blockquote>
<p><code>\b(\w)(\w)\w\2\1\b</code></p>
</blockquote>
</div>
<div id="looking-around" class="section level3">
<h3><span class="header-section-number">10.3.9</span> Looking Around</h3>
<p>Suppose that you have a string containing a number of words involving “bed”, and you would like to find all occurrences of “bed” that begin a word, except for the word “bedtime”. With the tools we have so far this is a difficult task. Fortunately there are <em>look-aheads</em>  to simplify our work.</p>
<p>The regex <code>\bbed(?!time\b)</code> will do the job. Here’s how it works:</p>
<ul>
<li>It begins by asserting a word-boundary.</li>
<li>It continues with the characters to match “bed”.</li>
<li>It concludes a look-ahead group. The parentheses mark out the group. The initial <code>?</code> indicates that we plan to look ahead. The <code>!</code> may be thought of as “not equals”; it means that if we find the pattern that follows the <code>!</code> we will not have a match.</li>
</ul>
<p>Note the matches in the text below:</p>
<blockquote>
<p>bedtime <em>bed</em>rock <em>bed</em>rocking <em>bed</em>sheets <em>bed</em>ding embedding</p>
</blockquote>
<p>Note that only “bed” is included in the match. Just like the anchor <code>\b</code>, the look-ahead is an assertion: it does not add any characters to the match.</p>
<p>If we want only the occurrences of “bed” where the word begins in “bed” and ends in either “rock” and “time”, then we could use the regex:</p>
<blockquote>
<p><code>\bbed(?=rock\b|time\b)</code></p>
</blockquote>
<p>Note the matches in the following text:</p>
<blockquote>
<p><em>bed</em>time <em>bed</em>rock bedrocking bedsheets bedding embedding</p>
</blockquote>
<p>Of course we could locate the same occurrences with <code>\bbed(rock|time)\b</code>, but the matches would be the entire words, not just the “bed” portion.</p>
<p>There are four types of look-around groups: </p>
<ul>
<li><em>Positive look-ahead</em>: regex1<code>(?=regex2)</code>. Match when you find an instance of <code>regex2</code> right after an instance of <code>regex1</code>.</li>
<li><em>Negative look-ahead</em>: <code>regex1(?!regex)</code>. Match EXCEPT when you find an instance of <code>regex2</code> right after an instance of <code>regex1</code>.</li>
<li><em>Positive look-behind</em>: <code>(?&lt;=regex2)regex1</code>. Match when you find an instance of <code>regex2</code> right before an instance of <code>regex1</code>.</li>
<li><em>Negative look-behind</em>: <code>(?&lt;!regex2)regex1</code>. Match EXCEPT when you find an instance of <code>regex2</code> right before an instance of <code>regex1</code>.</li>
</ul>
<p>The <code>regex2</code> expression in look-aheads can be any regex at all. For look-behinds, though, there are some important limitations. The precise restrictions differ from one flavor of regular expressions to another, but roughly the rule is that the machine has to be able to figure out in advance how many characters it might have to look behind. A group like <code>(?&lt;=time\w*sheets)</code>, for instance, would not be permitted, as the quantifier <code>*</code> allows matching strings of arbitrary length.</p>
</div>
<div id="more-to-learn" class="section level3">
<h3><span class="header-section-number">10.3.10</span> More to Learn</h3>
<p>We have not come near to exhausting the syntax of regular expressions. Readers who would like to delve into the subject more deeply should next consult online tutorials on the topics of non-capture groups, conditionals and more. It would also be good to look at the brief overview of the ICU regex engine provide in <code>stringi-search-regex</code> in the documentation for the <strong>stringi</strong> package on which <strong>stringr</strong> is based. However, we now have enough background to express some fairly complex patterns quite concisely, so it is now time to learn how to work with them in R.</p>
</div>
</div>
<div id="entering-a-regex-in-r" class="section level2">
<h2><span class="header-section-number">10.4</span> Entering a Regex in R</h2>
<p>We now return to the R-language and consider how to apply regular expressions within it.</p>
<div id="string-to-regex" class="section level3">
<h3><span class="header-section-number">10.4.1</span> String to Regex</h3>
<p>Regular expressions actually play a role in one of the functions you already know, namely the function <code>strsplit()</code>. Recall that you can use the <code>split</code> parameter to specify the sub-string that separates the strings you want to split up. It works like this:</p>
<div class="sourceCode" id="cb1344"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1344-1" data-line-number="1"><span class="st">&quot;hello there Mary Poppins&quot;</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1344-2" data-line-number="2"><span class="st">  </span><span class="kw">str_split</span>(<span class="dt">pattern =</span> <span class="st">&quot; &quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1344-3" data-line-number="3"><span class="st">  </span><span class="kw">unlist</span>()</a></code></pre></div>
<pre><code>## [1] &quot;hello&quot;   &quot;there&quot;   &quot;Mary&quot;    &quot;Poppins&quot;</code></pre>
<p>The task of splitting would appear to a quite challenging if the words are separated in more complex ways, with any amount of white-space. Consider, for example:</p>
<div class="sourceCode" id="cb1346"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1346-1" data-line-number="1">myString &lt;-<span class="st"> &quot;hello</span><span class="ch">\t\t</span><span class="st">there</span><span class="ch">\n\n</span><span class="st">Mary  </span><span class="ch">\t</span><span class="st"> Poppins&quot;</span></a>
<a class="sourceLine" id="cb1346-2" data-line-number="2"><span class="kw">cat</span>(myString)</a></code></pre></div>
<pre><code>## hello        there
## 
## Mary      Poppins</code></pre>
<p>But really it’s not any more difficult, because the <code>split</code> parameter actually takes the string it is given and converts it to a regular expression, splitting on anything that matches. Watch this:</p>
<div class="sourceCode" id="cb1348"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1348-1" data-line-number="1">myString <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1348-2" data-line-number="2"><span class="st">  </span><span class="kw">str_split</span>(<span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">s+&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1348-3" data-line-number="3"><span class="st">  </span><span class="kw">unlist</span>()</a></code></pre></div>
<pre><code>## [1] &quot;hello&quot;   &quot;there&quot;   &quot;Mary&quot;    &quot;Poppins&quot;</code></pre>
<p>We can almost see how this works. Recall from the last section that the regex <code>\s</code> is a character class shortcut for any white-space character, so <code>\s+</code> stands for one or more white-spaces in succession: precisely the mixtures of tab, spaces and newlines that separated the words in our string. <code>str_split()</code> must be splitting on matches to the regex <code>\s+</code>.</p>
<p>So why did we set <code>pattern = &quot;\\s+&quot;</code>? What’s with the extra backslash?</p>
<p>The reason is that the argument passed with <code>pattern</code> is a string, not a regular expression object. It starts out life, as if were, as a string, and R converts it to a regular expression, then hands the regex over to its regular expression engine to locate the matches in <code>myString</code> that in turn determine how <code>myString</code> is to be split up. Since in R’s string-world “\s” is not a recognized character in the way that newline (“\n”), tab (“\t”) and other control-characters are, R won’t accept “\s+” as a valid string. Try it for your self:</p>
<div class="sourceCode" id="cb1350"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1350-1" data-line-number="1">myString <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1350-2" data-line-number="2"><span class="st">  </span><span class="kw">str_split</span>(<span class="dt">pattern =</span> <span class="st">&quot;\s+&quot;</span>)</a></code></pre></div>
<pre><code>## Error: &#39;\s&#39; is an unrecognized escape in character string starting &quot;&quot;\s&quot;</code></pre>
<p>It follows that when you enter regular expressions as strings in R, you’ll have to remember to escape the back-slashed tokens that are used in a regular expression. Table @ref(tab:regex-string-escape-examples) gives several examples of this.</p>
<table>
<caption>(#tab:regex-string-escape-examples)Examples of entry of regular expressions as strings, in R.</caption>
<thead>
<tr class="header">
<th align="left">Regular Expression</th>
<th align="left">Entered as String</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">\s+</td>
<td align="left">“\\s+”</td>
</tr>
<tr class="even">
<td align="left">find\.dot</td>
<td align="left">“find\\.dot”</td>
</tr>
<tr class="odd">
<td align="left">^\w*\d{1,3}$</td>
<td align="left">&quot;^\\w*\\d{1,3}$&quot;</td>
</tr>
</tbody>
</table>
<p>Keeping in mind the need for an occasional additional escape, it should not be too difficult for you to enter regular expressions in R.</p>
</div>
<div id="regex-substitution" class="section level3">
<h3><span class="header-section-number">10.4.2</span> Substitution</h3>
<p>One of the most useful applications of regular expressions is in substitution. Suppose that we have a vector of dates:</p>
<div class="sourceCode" id="cb1352"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1352-1" data-line-number="1">dates &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;3 - 14 - 1963&quot;</span>, <span class="st">&quot;4/13/ 2005&quot;</span>,</a>
<a class="sourceLine" id="cb1352-2" data-line-number="2">           <span class="st">&quot;12-1-1997&quot;</span>, <span class="st">&quot;11 / 11 / 1918&quot;</span>)</a></code></pre></div>
<p>It seems that the folks who entered the dates were not consistent in how to format them. In order to make analysis easier, it would be better if all the dates had exactly the same format. With the function <code>str_replace_all()</code> and regular expressions, this is not difficult:</p>
<div class="sourceCode" id="cb1353"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1353-1" data-line-number="1">dates <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1353-2" data-line-number="2"><span class="st">  </span><span class="kw">str_replace_all</span>(<span class="dt">pattern =</span> <span class="st">&quot;[- /]+&quot;</span>,</a>
<a class="sourceLine" id="cb1353-3" data-line-number="3">              <span class="dt">replacement =</span> <span class="st">&quot;/&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;3/14/1963&quot;  &quot;4/13/2005&quot;  &quot;12/1/1997&quot;  &quot;11/11/1918&quot;</code></pre>
<p>Here:</p>
<ul>
<li><code>pattern</code> is the regex that for the type of sub-string we want to replace;</li>
<li><code>replacment</code> is what we want to replace matches of the pattern with;</li>
<li><code>x</code> is the text in which the substitution occurs.</li>
</ul>
<p>The <code>all</code> in the name of the function means that we want to replace <em>all</em> occurrences of the pattern with the replacement text. There is also a <code>str_replace()</code> function that performs replacement only with the <em>first</em> match (if any) that it finds:</p>
<div class="sourceCode" id="cb1355"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1355-1" data-line-number="1">dates <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1355-2" data-line-number="2"><span class="st">  </span><span class="kw">str_replace</span>(<span class="dt">pattern =</span> <span class="st">&quot;[- /]+&quot;</span>,</a>
<a class="sourceLine" id="cb1355-3" data-line-number="3">              <span class="dt">replacement =</span> <span class="st">&quot;/&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;3/14 - 1963&quot;  &quot;4/13/ 2005&quot;   &quot;12/1-1997&quot;    &quot;11/11 / 1918&quot;</code></pre>
<p>In our application, that’s certainly NOT what we need. However, in cases where you happen to know that there will be at most one match, <code>str_replace()</code> gets the job done faster than <code>str_replace_all()</code>, which is forced to search through the entire string.</p>
</div>
<div id="patterned-replacement" class="section level3">
<h3><span class="header-section-number">10.4.3</span> Patterned Replacement</h3>
<p>In the dates example from Section @ref(regex-substitution) the replacement string (the argument for the parameter <code>replacement</code>) was constant: no matter what sort of match we found for the pattern <code>[- /]+</code>, we replaced it with the string “/”. It is important to note, however, that the argument provided for <code>replacement</code> can cause the replacement to vary depending upon the match found. In particular:</p>
<ul>
<li>It can include the back-references <code>\1</code>, <code>\2</code>, …, <code>\9</code>.</li>
<li>It can be a defined function of the match.</li>
</ul>
<p>Let’s look at an example. Here is a function that, given a string, will double all of the vowels that it finds:</p>
<div class="sourceCode" id="cb1357"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1357-1" data-line-number="1">doubleVowels &lt;-<span class="st"> </span><span class="cf">function</span>(str) {</a>
<a class="sourceLine" id="cb1357-2" data-line-number="2">  str <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1357-3" data-line-number="3"><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="dt">pattern =</span> <span class="st">&quot;([aeiou])&quot;</span>, </a>
<a class="sourceLine" id="cb1357-4" data-line-number="4">                    <span class="dt">replacement =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1</span><span class="ch">\\</span><span class="st">1&quot;</span>)</a>
<a class="sourceLine" id="cb1357-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb1357-6" data-line-number="6"><span class="kw">doubleVowels</span>(<span class="st">&quot;Far and away the best!&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Faar aand aawaay thee beest!&quot;</code></pre>
<p>Note that the pattern <code>[aeiou]</code> for vowels had to be enclosed in parentheses so that it could be captured and referred to by the back-reference <code>\1</code>. Also note that, since R converts the replacement string into a pattern, extra backslash escapes are required, just as in regular expressions.</p>
<p>Here is a function to capitalize every vowel found:</p>
<div class="sourceCode" id="cb1359"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1359-1" data-line-number="1">capVowels &lt;-<span class="st"> </span><span class="cf">function</span>(str) {</a>
<a class="sourceLine" id="cb1359-2" data-line-number="2">  str <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1359-3" data-line-number="3"><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="dt">pattern =</span> <span class="st">&quot;[aeiou]&quot;</span>, </a>
<a class="sourceLine" id="cb1359-4" data-line-number="4">                    <span class="dt">replacement =</span> <span class="cf">function</span>(x) <span class="kw">str_to_upper</span>(x))</a>
<a class="sourceLine" id="cb1359-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb1359-6" data-line-number="6"><span class="kw">capVowels</span>(<span class="st">&quot;Far and away the best!&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;FAr And AwAy thE bEst!&quot;</code></pre>
<p>Here is another function that searches for repeated words and encloses each pair in asterisks:</p>
<div class="sourceCode" id="cb1361"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1361-1" data-line-number="1">starRepeats &lt;-<span class="st"> </span><span class="cf">function</span>(str) {</a>
<a class="sourceLine" id="cb1361-2" data-line-number="2">  str <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1361-3" data-line-number="3"><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="dt">pattern =</span> <span class="st">&quot;(</span><span class="ch">\\</span><span class="st">b(</span><span class="ch">\\</span><span class="st">w+) </span><span class="ch">\\</span><span class="st">2</span><span class="ch">\\</span><span class="st">b)&quot;</span>,</a>
<a class="sourceLine" id="cb1361-4" data-line-number="4">                    <span class="dt">replacement =</span> <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1361-5" data-line-number="5">                      <span class="kw">str_c</span>(<span class="st">&quot;*&quot;</span>, x, <span class="st">&quot;*&quot;</span>)</a>
<a class="sourceLine" id="cb1361-6" data-line-number="6">                    }</a>
<a class="sourceLine" id="cb1361-7" data-line-number="7">                    )</a>
<a class="sourceLine" id="cb1361-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb1361-9" data-line-number="9"><span class="kw">starRepeats</span>(<span class="st">&quot;I have a boo boo on my knee knee.&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;I have a *boo boo* on my *knee knee*.&quot;</code></pre>
<p>The above substitution is tricky, and merits step-by-step analysis:</p>
<ul>
<li><p>In order to get a repeated word, you would start with the regex</p>
<blockquote>
<p><code>\b(\w+) \1\b</code>.</p>
</blockquote></li>
<li><p>In order to enter the regex into R as a string, you would need some escapes:</p>
<blockquote>
<p><code>\\b(\\w+) \\1\\b</code></p>
</blockquote></li>
<li><p>You need to wrap the whole expression in parentheses in order to capture it and refer to it in the replacement expression:</p>
<blockquote>
<p><code>(\\b(\\w+) \\1\\b)</code></p>
</blockquote></li>
<li><p>But now you have a problem: the back-reference <code>\1</code> applies to the <em>first</em> captured expression, which is the expression determined by the first opening parenthesis encountered. Hence it refers to the whole expression, which doesn’t make sense. We want to refer to the first word in the pair (the <code>(\\w+)</code>) so we need to back-reference it with <code>\2</code>:</p>
<blockquote>
<p><code>(\\b(\\w+) \\2\\b)</code></p>
</blockquote></li>
<li>Meanwhile, in the replacement string, we want to refer to the entire repeated-word pair, so we refer to it with <code>\1</code>.</li>
<li><p>And of course we have to do the extra backslash escaping, so the replacement string ends up as:</p>
<blockquote>
<p><code>*\\1*</code></p>
</blockquote></li>
</ul>
<p>Whew!</p>
<p>A function-replacement version is also possible:</p>
<div class="sourceCode" id="cb1363"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1363-1" data-line-number="1">starRepeats &lt;-<span class="st"> </span><span class="cf">function</span>(str) {</a>
<a class="sourceLine" id="cb1363-2" data-line-number="2">  str <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1363-3" data-line-number="3"><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="dt">pattern =</span> <span class="st">&quot;(</span><span class="ch">\\</span><span class="st">b(</span><span class="ch">\\</span><span class="st">w+) </span><span class="ch">\\</span><span class="st">2</span><span class="ch">\\</span><span class="st">b)&quot;</span>,</a>
<a class="sourceLine" id="cb1363-4" data-line-number="4">                    <span class="dt">replacement =</span> <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1363-5" data-line-number="5">                      <span class="kw">str_c</span>(<span class="st">&quot;*&quot;</span>, x, <span class="st">&quot;*&quot;</span>)</a>
<a class="sourceLine" id="cb1363-6" data-line-number="6">                    }</a>
<a class="sourceLine" id="cb1363-7" data-line-number="7">                    )</a>
<a class="sourceLine" id="cb1363-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb1363-9" data-line-number="9"><span class="kw">starRepeats</span>(<span class="st">&quot;I have a boo boo on my knee knee.&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;I have a *boo boo* on my *knee knee*.&quot;</code></pre>
</div>
<div id="detecting-matches" class="section level3">
<h3><span class="header-section-number">10.4.4</span> Detecting Matches</h3>
<p>If you have many strings—in a character-vector, say—and you want to know which of them contain a match to a particular pattern, then you want to use <code>str_subset()</code>. </p>
<p>Consider, for example, the vector of strings:</p>
<div class="sourceCode" id="cb1365"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1365-1" data-line-number="1">sentences &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;My name is Tom, Sir&quot;</span>,</a>
<a class="sourceLine" id="cb1365-2" data-line-number="2">               <span class="st">&quot;And I&#39;m Tulip!&quot;</span>,</a>
<a class="sourceLine" id="cb1365-3" data-line-number="3">               <span class="st">&quot;Whereas my name is Lester.&quot;</span>)</a></code></pre></div>
<p>If we would like to find the strings that contain a word beginning with capital T, we could proceed as follows:</p>
<div class="sourceCode" id="cb1366"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1366-1" data-line-number="1">sentences <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1366-2" data-line-number="2"><span class="st">  </span><span class="kw">str_subset</span>(<span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">bT</span><span class="ch">\\</span><span class="st">w*</span><span class="ch">\\</span><span class="st">b&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;My name is Tom, Sir&quot; &quot;And I&#39;m Tulip!&quot;</code></pre>
<p><code>str_subset()</code> returns a vector consisting of the elements of the vector <code>sentences</code> where the string contains at least one word beginning with “T”.</p>
<p>A related function is <code>str_detect()</code>: </p>
<div class="sourceCode" id="cb1368"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1368-1" data-line-number="1">sentences <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1368-2" data-line-number="2"><span class="st">  </span><span class="kw">str_detect</span>(<span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">bT</span><span class="ch">\\</span><span class="st">w*</span><span class="ch">\\</span><span class="st">b&quot;</span>)</a></code></pre></div>
<pre><code>## [1]  TRUE  TRUE FALSE</code></pre>
<p><code>str_detect()</code> returns a logical vector with <code>TRUE</code> where <code>sentences</code> has a capital-T word, <code>FALSE</code> otherwise.</p>
<p>Finally, <code>str_locate()</code>  gives the <em>positions</em> in each string where a match begins:</p>
<div class="sourceCode" id="cb1370"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1370-1" data-line-number="1">sentences <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1370-2" data-line-number="2"><span class="st">  </span><span class="kw">str_locate</span>(<span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">bT</span><span class="ch">\\</span><span class="st">w*</span><span class="ch">\\</span><span class="st">b&quot;</span>)</a></code></pre></div>
<pre><code>##      start end
## [1,]    12  14
## [2,]     9  13
## [3,]    NA  NA</code></pre>
</div>
<div id="extracting-matches" class="section level3">
<h3><span class="header-section-number">10.4.5</span> Extracting Matches</h3>
<p>If you require what is actually matched within each string you are processing, then you should look into <code>str_extract()</code> and <code>str_extract_all()</code>.

</p>
<p>As an example, let’s extract pairs of words beginning with the same letter in <code>sentences2</code> defined below:</p>
<div class="sourceCode" id="cb1372"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1372-1" data-line-number="1">sentences2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;The big bad wolf is walking warily to the cottage.&quot;</span>,</a>
<a class="sourceLine" id="cb1372-2" data-line-number="2">                <span class="st">&quot;He huffs and he puffs peevishly.&quot;</span>,</a>
<a class="sourceLine" id="cb1372-3" data-line-number="3">                <span class="st">&quot;He wears gnarly gargantuan bell bottoms!&quot;</span>)</a>
<a class="sourceLine" id="cb1372-4" data-line-number="4">sentences2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1372-5" data-line-number="5"><span class="st">  </span><span class="kw">str_extract</span>(<span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">b(</span><span class="ch">\\</span><span class="st">w)</span><span class="ch">\\</span><span class="st">w*</span><span class="ch">\\</span><span class="st">W+</span><span class="ch">\\</span><span class="st">1</span><span class="ch">\\</span><span class="st">w*&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;big bad&quot;           &quot;puffs peevishly&quot;   &quot;gnarly gargantuan&quot;</code></pre>
<p>The results are returned as a character vector, in which each element is the first matching pair in the corresponding sentence.</p>
<p>If we want all of the matches in each sentence, then we use <code>str_extract_all()</code>:</p>
<div class="sourceCode" id="cb1374"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1374-1" data-line-number="1">sentences2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1374-2" data-line-number="2"><span class="st">  </span><span class="kw">str_extract_all</span>(<span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">b(</span><span class="ch">\\</span><span class="st">w)</span><span class="ch">\\</span><span class="st">w*</span><span class="ch">\\</span><span class="st">W+</span><span class="ch">\\</span><span class="st">1</span><span class="ch">\\</span><span class="st">w*&quot;</span>)</a></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;big bad&quot;        &quot;walking warily&quot; &quot;to the&quot;        
## 
## [[2]]
## [1] &quot;puffs peevishly&quot;
## 
## [[3]]
## [1] &quot;gnarly gargantuan&quot; &quot;bell bottoms&quot;</code></pre>
<p>Sometimes we want even more information. Suppose, for example, that we want not only the first matching word-pair, but also the repeated initial letter that permitted the match in the first place. In that case we need <code>str_match()</code>:
</p>
<div class="sourceCode" id="cb1376"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1376-1" data-line-number="1">sentences2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1376-2" data-line-number="2"><span class="st">  </span><span class="kw">str_match</span>(<span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">b(</span><span class="ch">\\</span><span class="st">w)</span><span class="ch">\\</span><span class="st">w*</span><span class="ch">\\</span><span class="st">W+</span><span class="ch">\\</span><span class="st">1</span><span class="ch">\\</span><span class="st">w*&quot;</span>)</a></code></pre></div>
<pre><code>##      [,1]                [,2]
## [1,] &quot;big bad&quot;           &quot;b&quot; 
## [2,] &quot;puffs peevishly&quot;   &quot;p&quot; 
## [3,] &quot;gnarly gargantuan&quot; &quot;g&quot;</code></pre>
<p><code>str_match()</code> returns a matrix, each row of which corresponds to an element of <code>sentences</code>. The first column gives the value of the entire match, and the second column gives value of the capture-group in the regular expression. If the regular expression had used more capture groups, then the matrix would have had additional columns showing the values of the captures, in order.</p>
<p>If you want an analysis of all the matches in a string, then use <code>str_match_all()</code>:
</p>
<div class="sourceCode" id="cb1378"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1378-1" data-line-number="1">sentences2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1378-2" data-line-number="2"><span class="st">  </span><span class="kw">str_match_all</span>(<span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">b(</span><span class="ch">\\</span><span class="st">w)</span><span class="ch">\\</span><span class="st">w*</span><span class="ch">\\</span><span class="st">W+</span><span class="ch">\\</span><span class="st">1</span><span class="ch">\\</span><span class="st">w*&quot;</span>)</a></code></pre></div>
<pre><code>## [[1]]
##      [,1]             [,2]
## [1,] &quot;big bad&quot;        &quot;b&quot; 
## [2,] &quot;walking warily&quot; &quot;w&quot; 
## [3,] &quot;to the&quot;         &quot;t&quot; 
## 
## [[2]]
##      [,1]              [,2]
## [1,] &quot;puffs peevishly&quot; &quot;p&quot; 
## 
## [[3]]
##      [,1]                [,2]
## [1,] &quot;gnarly gargantuan&quot; &quot;g&quot; 
## [2,] &quot;bell bottoms&quot;      &quot;b&quot;</code></pre>
<p>The returned structure is a list and hence more complex, but you can query it for the values you need.</p>
</div>
<div id="extraction-in-data-frames" class="section level3">
<h3><span class="header-section-number">10.4.6</span> Extraction in Data Frames</h3>
<p>Quite often you will want to manipulate strings in the context of working with a data frame. For this regex functions we have examined so far will be quite useful, but you should also know about the <code>extract()</code> function from the <strong>tidyr</strong> package, which is among the packages attached by the tidy-verse.</p>
<p>Imagine a data table that contains some names and phone numbers:</p>
<div class="sourceCode" id="cb1380"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1380-1" data-line-number="1">people &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb1380-2" data-line-number="2">  <span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;Lauf, Bettina&quot;</span>, <span class="st">&quot;Bachchan, Abhishek&quot;</span>, <span class="st">&quot;Jones,  Jenna&quot;</span>),</a>
<a class="sourceLine" id="cb1380-3" data-line-number="3">  <span class="dt">phone =</span> <span class="kw">c</span>(<span class="st">&quot;(202) 415-3785&quot;</span>, <span class="st">&quot;4133372100&quot;</span>, <span class="st">&quot;310-231-4453&quot;</span>)</a>
<a class="sourceLine" id="cb1380-4" data-line-number="4">)</a></code></pre></div>
<p>Each person has a standard ten-digit phone number, consisting of:</p>
<ul>
<li>the three-digit <em>area code</em>;</li>
<li>the three digit <em>central office</em> number;</li>
<li>the four-digit <em>line</em> number.</li>
</ul>
<p>Suppose we would like to create three new variables in the data table, one for each of the three components of the phone number. For this, <code>tidyr::extract()</code> comes in handy: </p>
<div class="sourceCode" id="cb1381"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1381-1" data-line-number="1">people <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1381-2" data-line-number="2"><span class="st">  </span>tidyr<span class="op">::</span><span class="kw">extract</span>(<span class="dt">col =</span> phone,</a>
<a class="sourceLine" id="cb1381-3" data-line-number="3">          <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;area&quot;</span>, <span class="st">&quot;office&quot;</span>, <span class="st">&quot;line&quot;</span>),</a>
<a class="sourceLine" id="cb1381-4" data-line-number="4">          <span class="dt">regex =</span> <span class="st">&quot;(?x)        # for comments</span></a>
<a class="sourceLine" id="cb1381-5" data-line-number="5"><span class="st">                  .*           # in case of opening paren, etc.</span></a>
<a class="sourceLine" id="cb1381-6" data-line-number="6"><span class="st">                  (</span><span class="ch">\\</span><span class="st">d{3})     # capture 1:  area code</span></a>
<a class="sourceLine" id="cb1381-7" data-line-number="7"><span class="st">                  .*           # possible separators</span></a>
<a class="sourceLine" id="cb1381-8" data-line-number="8"><span class="st">                  (</span><span class="ch">\\</span><span class="st">d{3})     # capture 2:  central office</span></a>
<a class="sourceLine" id="cb1381-9" data-line-number="9"><span class="st">                  .*           # possible separators</span></a>
<a class="sourceLine" id="cb1381-10" data-line-number="10"><span class="st">                  (</span><span class="ch">\\</span><span class="st">d{4})     # capture 3:  line number</span></a>
<a class="sourceLine" id="cb1381-11" data-line-number="11"><span class="st">                  &quot;</span>)</a></code></pre></div>
<pre><code>##                 name area office line
## 1      Lauf, Bettina  202    415 3785
## 2 Bachchan, Abhishek  413    337 2100
## 3      Jones,  Jenna  310    231 4453</code></pre>
<p>By default <code>extract()</code> removes the original column, but you can preserve it with <code>remove = FALSE</code>. (For the format of the regular expression in the above call, see the next sub-section.)</p>
</div>
<div id="counting-matches" class="section level3">
<h3><span class="header-section-number">10.4.7</span> Counting Matches</h3>
<p>The function <code>str_count()</code> provides a very convenient way to tally up the <em>number</em> of matches that a given regex has in a string. Here we use it to count the number of wrods in a string that begin with a lower or uppercase <code>p</code>.</p>
<div class="sourceCode" id="cb1383"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1383-1" data-line-number="1">strings &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Mary Poppins is practically perfect in every way!&quot;</span>,</a>
<a class="sourceLine" id="cb1383-2" data-line-number="2">             <span class="st">&quot;The best-laid plans of mice and men gang oft astray.&quot;</span>,</a>
<a class="sourceLine" id="cb1383-3" data-line-number="3">             <span class="st">&quot;Peter Piper picked a peck of pickled peppers.&quot;</span>)</a>
<a class="sourceLine" id="cb1383-4" data-line-number="4">strings <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1383-5" data-line-number="5"><span class="st">  </span><span class="kw">str_count</span>(<span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">b[Pp]</span><span class="ch">\\</span><span class="st">w*</span><span class="ch">\\</span><span class="st">b&quot;</span>)</a></code></pre></div>
<pre><code>## [1] 3 1 6</code></pre>
<p>How might we find the words in a string that contain three or more of the same letter? In this case <code>str_count()</code> would not be useful. However we could try something like this:</p>
<div class="sourceCode" id="cb1385"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1385-1" data-line-number="1"><span class="st">&quot;In Patagonia, the peerless Peter Piper picked a peck of pickled peppers.&quot;</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1385-2" data-line-number="2"><span class="st">  </span><span class="kw">str_split</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">W+&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1385-3" data-line-number="3"><span class="st">  </span><span class="kw">unlist</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1385-4" data-line-number="4"><span class="st">  </span><span class="kw">str_subset</span>(<span class="dt">pattern =</span> <span class="st">&quot;([[:alpha:]]).*</span><span class="ch">\\</span><span class="st">1.*</span><span class="ch">\\</span><span class="st">1&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Patagonia&quot; &quot;peerless&quot;  &quot;peppers&quot;</code></pre>
</div>
<div id="regex-modes" class="section level3">
<h3><span class="header-section-number">10.4.8</span> Regex Modes</h3>
<p>
If you have been practicing consistently with an online regex site, you will have noticed by now that a regex can be accompanied by various options. In most implementations they appear as letters after the closing regex delimiter, like this:</p>
<blockquote>
<p><code>/regex/gm</code></p>
</blockquote>
<p>Some of the most popular options are:</p>
<ul>
<li><code>g</code>: “global”, looking for all possible matches in the string;</li>
<li><code>i</code>: “case-insensitive” mode, so that letter-characters in the regex match both their upper and lower-case versions;</li>
<li><code>m</code>: “multiline” mode, so that the anchors <code>^</code> and <code>$</code> are attached to newlines <em>within</em> the string rather than to the absolute beginning and end of the string;</li>
<li><code>x</code>: “white-space” mode, where white-spaces in the regex are ignored unless they are escaped (useful for lining out the regex and inserting comments to explain its operation).</li>
</ul>
<p>Since <strong>stringr</strong> has both global and non-global versions of regex functions you probably will not bother with <code>g</code>, but the other options—known technically as <em>modes</em>—can sometimes be useful.</p>
<p>If you would like to set modes to apply to your entire regex, insert it (or them) like this at the beginning of the expression:</p>
<blockquote>
<p><code>(?im)t[aeiou]{1,3}$</code></p>
</blockquote>
<p>In the example above, we are in both case-insensitive and multiline mode, and we are looking for t or T followed by 1, 2 or 3 vowels (upper or lower) at the end of any line in a (possibly) multiline string.</p>
<p>Following is an example of the mode to ignore white-space and to ignore case:</p>
<div class="sourceCode" id="cb1387"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1387-1" data-line-number="1">myPattern &lt;-</a>
<a class="sourceLine" id="cb1387-2" data-line-number="2"><span class="st">  &quot;(?xi)       # ignore whitespace (x) and ignore case (i)</span></a>
<a class="sourceLine" id="cb1387-3" data-line-number="3"><span class="st">  </span><span class="ch">\\</span><span class="st">b          # assert a word-boundary</span></a>
<a class="sourceLine" id="cb1387-4" data-line-number="4"><span class="st">  (</span><span class="ch">\\</span><span class="st">w)        # capture the first letter of the first word</span></a>
<a class="sourceLine" id="cb1387-5" data-line-number="5"><span class="st">  </span><span class="ch">\\</span><span class="st">w*         # rest of the first word</span></a>
<a class="sourceLine" id="cb1387-6" data-line-number="6"><span class="st">  </span><span class="ch">\\</span><span class="st">W+         # one or more non-word characters</span></a>
<a class="sourceLine" id="cb1387-7" data-line-number="7"><span class="st">  </span><span class="ch">\\</span><span class="st">1          # repeat the letter captured previously</span></a>
<a class="sourceLine" id="cb1387-8" data-line-number="8"><span class="st">  </span><span class="ch">\\</span><span class="st">w*         # rest of the second word</span></a>
<a class="sourceLine" id="cb1387-9" data-line-number="9"><span class="st">  &quot;</span></a>
<a class="sourceLine" id="cb1387-10" data-line-number="10">sentences2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1387-11" data-line-number="11"><span class="st">  </span><span class="kw">str_match_all</span>(<span class="dt">pattern =</span> myPattern)</a></code></pre></div>
<pre><code>## [[1]]
##      [,1]             [,2]
## [1,] &quot;big bad&quot;        &quot;b&quot; 
## [2,] &quot;walking warily&quot; &quot;w&quot; 
## [3,] &quot;to the&quot;         &quot;t&quot; 
## 
## [[2]]
##      [,1]              [,2]
## [1,] &quot;He huffs&quot;        &quot;H&quot; 
## [2,] &quot;puffs peevishly&quot; &quot;p&quot; 
## 
## [[3]]
##      [,1]                [,2]
## [1,] &quot;gnarly gargantuan&quot; &quot;g&quot; 
## [2,] &quot;bell bottoms&quot;      &quot;b&quot;</code></pre>
<p>Due to the presence of <code>x</code>-flag at the very beginning of the regex, the regex engine knows to ignore white-space throughout, and it will also ignore hash-tags and whatever comes after them on a line. This permits the placement of comments within the regular expression. The <code>i</code>-flag directs the regex engine to ignore case when looking for matches. Accordingly, in the example we pick up the extra match “he huffs”.</p>
<p>Some people prefer to control regular-expression modes by means of <strong>stringr</strong>’s <code>regex()</code> function: </p>
<div class="sourceCode" id="cb1389"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1389-1" data-line-number="1">myPattern &lt;-<span class="st"> </span><span class="kw">regex</span>(</a>
<a class="sourceLine" id="cb1389-2" data-line-number="2">  <span class="dt">pattern =</span> <span class="st">&quot;</span></a>
<a class="sourceLine" id="cb1389-3" data-line-number="3"><span class="st">  </span><span class="ch">\\</span><span class="st">b          # assert a word-boundary</span></a>
<a class="sourceLine" id="cb1389-4" data-line-number="4"><span class="st">  (</span><span class="ch">\\</span><span class="st">w)        # capture the first letter of the first word</span></a>
<a class="sourceLine" id="cb1389-5" data-line-number="5"><span class="st">  </span><span class="ch">\\</span><span class="st">w*         # rest of the first word</span></a>
<a class="sourceLine" id="cb1389-6" data-line-number="6"><span class="st">  </span><span class="ch">\\</span><span class="st">W+         # one or more non-word characters</span></a>
<a class="sourceLine" id="cb1389-7" data-line-number="7"><span class="st">  </span><span class="ch">\\</span><span class="st">1          # repeat the letter captured previously</span></a>
<a class="sourceLine" id="cb1389-8" data-line-number="8"><span class="st">  </span><span class="ch">\\</span><span class="st">w*         # rest of the second word</span></a>
<a class="sourceLine" id="cb1389-9" data-line-number="9"><span class="st">  &quot;</span>,</a>
<a class="sourceLine" id="cb1389-10" data-line-number="10">  <span class="dt">comments =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb1389-11" data-line-number="11">  <span class="dt">ignore_case =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb1389-12" data-line-number="12">)</a>
<a class="sourceLine" id="cb1389-13" data-line-number="13">sentences2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1389-14" data-line-number="14"><span class="st">  </span><span class="kw">str_match_all</span>(<span class="dt">pattern =</span> myPattern)</a></code></pre></div>
<pre><code>## [[1]]
##      [,1]             [,2]
## [1,] &quot;big bad&quot;        &quot;b&quot; 
## [2,] &quot;walking warily&quot; &quot;w&quot; 
## [3,] &quot;to the&quot;         &quot;t&quot; 
## 
## [[2]]
##      [,1]              [,2]
## [1,] &quot;He huffs&quot;        &quot;H&quot; 
## [2,] &quot;puffs peevishly&quot; &quot;p&quot; 
## 
## [[3]]
##      [,1]                [,2]
## [1,] &quot;gnarly gargantuan&quot; &quot;g&quot; 
## [2,] &quot;bell bottoms&quot;      &quot;b&quot;</code></pre>
</div>
<div id="practice-exercises-26" class="section level3">
<h3><span class="header-section-number">10.4.9</span> Practice Exercises</h3>
<p>The <strong>stringr</strong> package comes with <code>fruit</code>, a character-vector of giving the names of 80 fruits.</p>
<ol style="list-style-type: decimal">
<li><p>Determine how many fruit-names consist of exactly two words.</p></li>
<li><p>Find the two-word fruit-names.</p></li>
<li><p>Find the indices of the two-word fruit names.</p></li>
<li><p>Find the one-word fruit-names that end in “berry”.</p></li>
<li><p>Find the fruit-names that contain more than three vowels.</p></li>
<li><p>In the word “banana” the string “an” appears twice in succession, as does the string “na”. Find the fruit-names containing at least one string of length two or more that appears twice in succession.</p></li>
<li><p>To the <code>people</code> data frame from this section, add two new variables: <code>first</code> for the first name and <code>last</code> for the last name. The original <code>name</code> variable should be removed.</p></li>
</ol>
</div>
<div id="solutions-to-the-practice-exercises-10" class="section level3">
<h3><span class="header-section-number">10.4.10</span> Solutions to the Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Try this:</p>
<div class="sourceCode" id="cb1391"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1391-1" data-line-number="1">wordCount &lt;-<span class="st"> </span>fruit <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_count</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">w+&quot;</span>)</a>
<a class="sourceLine" id="cb1391-2" data-line-number="2"><span class="kw">sum</span>(wordCount <span class="op">==</span><span class="st"> </span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] 11</code></pre></li>
<li><p>Try this:</p>
<div class="sourceCode" id="cb1393"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1393-1" data-line-number="1">fruit <span class="op">%&gt;%</span><span class="st"> </span>.[<span class="kw">str_count</span>(., <span class="st">&quot;</span><span class="ch">\\</span><span class="st">w+&quot;</span>) <span class="op">==</span><span class="st"> </span><span class="dv">2</span>]</a></code></pre></div>
<pre><code>##  [1] &quot;bell pepper&quot;       &quot;blood orange&quot;      &quot;canary melon&quot;     
##  [4] &quot;chili pepper&quot;      &quot;goji berry&quot;        &quot;kiwi fruit&quot;       
##  [7] &quot;purple mangosteen&quot; &quot;rock melon&quot;        &quot;salal berry&quot;      
## [10] &quot;star fruit&quot;        &quot;ugli fruit&quot;</code></pre>
<p>Another way is as follows:</p>
<div class="sourceCode" id="cb1395"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1395-1" data-line-number="1">fruit <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1395-2" data-line-number="2"><span class="st">  </span><span class="kw">str_subset</span>(<span class="st">&quot;^</span><span class="ch">\\</span><span class="st">w+</span><span class="ch">\\</span><span class="st">s+</span><span class="ch">\\</span><span class="st">w+$&quot;</span>)</a></code></pre></div>
<pre><code>##  [1] &quot;bell pepper&quot;       &quot;blood orange&quot;      &quot;canary melon&quot;     
##  [4] &quot;chili pepper&quot;      &quot;goji berry&quot;        &quot;kiwi fruit&quot;       
##  [7] &quot;purple mangosteen&quot; &quot;rock melon&quot;        &quot;salal berry&quot;      
## [10] &quot;star fruit&quot;        &quot;ugli fruit&quot;</code></pre></li>
<li><p>Try this:</p>
<div class="sourceCode" id="cb1397"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1397-1" data-line-number="1">fruit <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1397-2" data-line-number="2"><span class="st">  </span><span class="kw">str_detect</span>(<span class="st">&quot;^</span><span class="ch">\\</span><span class="st">w+</span><span class="ch">\\</span><span class="st">s+</span><span class="ch">\\</span><span class="st">w+$&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1397-3" data-line-number="3"><span class="st">  </span><span class="kw">which</span>()</a></code></pre></div>
<pre><code>##  [1]  5  9 13 17 32 42 66 72 73 75 79</code></pre></li>
<li><p>Try this:</p>
<div class="sourceCode" id="cb1399"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1399-1" data-line-number="1">fruit <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1399-2" data-line-number="2"><span class="st">  </span><span class="kw">str_subset</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">w+berry$&quot;</span>)</a></code></pre></div>
<pre><code>##  [1] &quot;bilberry&quot;    &quot;blackberry&quot;  &quot;blueberry&quot;   &quot;boysenberry&quot; &quot;cloudberry&quot; 
##  [6] &quot;cranberry&quot;   &quot;elderberry&quot;  &quot;gooseberry&quot;  &quot;huckleberry&quot; &quot;mulberry&quot;   
## [11] &quot;raspberry&quot;   &quot;strawberry&quot;</code></pre></li>
<li><p>Try this:</p>
<div class="sourceCode" id="cb1401"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1401-1" data-line-number="1">vowelCount &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1401-2" data-line-number="2"><span class="st">  </span>fruit <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1401-3" data-line-number="3"><span class="st">  </span><span class="kw">str_count</span>(<span class="st">&quot;[aeiou]&quot;</span>)</a>
<a class="sourceLine" id="cb1401-4" data-line-number="4">fruit[vowelCount <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span>]</a></code></pre></div>
<pre><code>##  [1] &quot;avocado&quot;           &quot;blood orange&quot;      &quot;breadfruit&quot;       
##  [4] &quot;canary melon&quot;      &quot;cantaloupe&quot;        &quot;cherimoya&quot;        
##  [7] &quot;chili pepper&quot;      &quot;clementine&quot;        &quot;dragonfruit&quot;      
## [10] &quot;feijoa&quot;            &quot;gooseberry&quot;        &quot;grapefruit&quot;       
## [13] &quot;kiwi fruit&quot;        &quot;mandarine&quot;         &quot;nectarine&quot;        
## [16] &quot;passionfruit&quot;      &quot;pineapple&quot;         &quot;pomegranate&quot;      
## [19] &quot;purple mangosteen&quot; &quot;tamarillo&quot;         &quot;tangerine&quot;        
## [22] &quot;ugli fruit&quot;        &quot;watermelon&quot;</code></pre></li>
<li><p>Try this:</p>
<div class="sourceCode" id="cb1403"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1403-1" data-line-number="1">fruit <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1403-2" data-line-number="2"><span class="st">  </span><span class="kw">str_subset</span>(<span class="st">&quot;(</span><span class="ch">\\</span><span class="st">w{2,})</span><span class="ch">\\</span><span class="st">1&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;banana&quot;      &quot;coconut&quot;     &quot;cucumber&quot;    &quot;jujube&quot;      &quot;papaya&quot;     
## [6] &quot;salal berry&quot;</code></pre></li>
<li><p>Try this:</p>
<div class="sourceCode" id="cb1405"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1405-1" data-line-number="1">people <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1405-2" data-line-number="2"><span class="st">  </span>tidyr<span class="op">::</span><span class="kw">extract</span>(<span class="dt">col =</span> name,</a>
<a class="sourceLine" id="cb1405-3" data-line-number="3">          <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;last&quot;</span>, <span class="st">&quot;first&quot;</span>),</a>
<a class="sourceLine" id="cb1405-4" data-line-number="4">          <span class="dt">regex =</span> <span class="st">&quot;(</span><span class="ch">\\</span><span class="st">w+)</span><span class="ch">\\</span><span class="st">W+(</span><span class="ch">\\</span><span class="st">w+)&quot;</span>)</a></code></pre></div>
<pre><code>##       last    first          phone
## 1     Lauf  Bettina (202) 415-3785
## 2 Bachchan Abhishek     4133372100
## 3    Jones    Jenna   310-231-4453</code></pre></li>
</ol>
</div>
</div>
<div id="application-amazon-book-reviews" class="section level2">
<h2><span class="header-section-number">10.5</span> Application: Amazon Book Reviews</h2>
<p>The R-package <strong>tigerData</strong> <span class="citation">(White <a href="#ref-R-tigerData">2017</a>)</span> contains the data set <code>reviews</code>, a collection of user-reviews on <a href="https://www.amazon.com">Amazon</a> for seven bestsellers. Learn more about the data set as follows:</p>
<div class="sourceCode" id="cb1407"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1407-1" data-line-number="1"><span class="kw">library</span>(tigerData)</a>
<a class="sourceLine" id="cb1407-2" data-line-number="2"><span class="kw">help</span>(reviews)</a></code></pre></div>
<p>Each row of the data frame contains:</p>
<ul>
<li>the 1-5 rating that the reviewer assigned to the book</li>
<li>a URL fragment that locates the review online;</li>
<li>the summary-title of the review;</li>
<li>the content of the review itself.</li>
</ul>
<p>Let’s focus on reviews for <em>Hunger Games</em> series. The following code creates a new data frame that contains only those reviews:</p>
<div class="sourceCode" id="cb1408"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1408-1" data-line-number="1">hunger &lt;-<span class="st"> </span><span class="kw">subset</span>(reviews, book <span class="op">==</span><span class="st"> &quot;hunger&quot;</span>)</a></code></pre></div>
<p>That’s still a lot of reviews! We can tell by asking for the number of rows in the <code>hunger</code> data frame:</p>
<div class="sourceCode" id="cb1409"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1409-1" data-line-number="1"><span class="kw">nrow</span>(hunger)</a></code></pre></div>
<pre><code>## [1] 24027</code></pre>
<p>We are looking at 24,027 reviews—some of which, by the way, are quite long.</p>
<p>Explore the plain-text of some of the reviews. For example, the text of the second review can be viewed with:</p>
<div class="sourceCode" id="cb1411"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1411-1" data-line-number="1">hunger<span class="op">$</span>content[<span class="dv">2</span>]</a></code></pre></div>
<pre><code>## # A single long string.  We will show just the first few characters:
## [1] &quot;\&quot;&lt;span class=\&quot;\&quot;a-size-base review-text\&quot;\&quot;&gt;Clearly ...</code></pre>
<p>Perusing this review, we come upon the following passage:</p>
<blockquote>
<p>There is a certain strain of book that can hypnotize you into believing that you are in another time and place roughly 2.3 seconds after you put that book down. &lt;a class=\“\”a-link-normal\“\” href=&quot;&quot;/Life-As-We-Knew-It/dp/0152061541\“\”&gt;Life As We Knew It</a> by Susan Beth Pfeffer could convince me that there were simply not enough canned goods in my home.</p>
</blockquote>
<p>The author has linked to another book sold on Amazon, Susan Beth Pfeffer’s <em>Life As We Knew It</em>. The Amazon.com URL for the book is found by prepending the company’s domain to the URL-fragment seen in the excerpt above, resulting in the link:</p>
<blockquote>
<p><a href="http://www.amazon.com/Life-As-We-Knew-It/dp/0152061541" class="uri">http://www.amazon.com/Life-As-We-Knew-It/dp/0152061541</a></p>
</blockquote>
<p>We might be curious to know what other books on Amazon our reviewers link to when they are discussing the <em>Hunger Games</em>. Regular expressions can help us to extract the links from the mass of text in <code>hunger$content</code>.</p>
<p>All of the Amazon links are generated for the user by the computer, so they will all have the same format. Hence we can use a look-behind and a look-ahead to construct a regex that will be matched by any URL-fragment within such an anchor:</p>
<blockquote>
<p>(?&lt;=&lt;a class=\“\”a-link-normal\“\” href=\“\”/)(.+?)(?=\“\”&gt;)</p>
</blockquote>
<p>Checking carefully, we see that none of the tokens require extra escaping: we can use this text as our pattern in regex function in R:</p>
<div class="sourceCode" id="cb1413"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1413-1" data-line-number="1">linkPattern &lt;-<span class="st"> &quot;(?&lt;=&lt;a class=</span><span class="ch">\&quot;\&quot;</span><span class="st">a-link-normal</span><span class="ch">\&quot;\&quot;</span><span class="st"> href=</span><span class="ch">\&quot;\&quot;</span><span class="st">/)(.+?)(?=</span><span class="ch">\&quot;\&quot;</span><span class="st">&gt;)&quot;</span></a></code></pre></div>
<div class="sourceCode" id="cb1414"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1414-1" data-line-number="1">hungerLinks &lt;-</a>
<a class="sourceLine" id="cb1414-2" data-line-number="2"><span class="st">  </span>hunger <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1414-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">linkCount =</span> <span class="kw">str_count</span>(content, linkPattern))</a></code></pre></div>
<div class="sourceCode" id="cb1415"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1415-1" data-line-number="1">hungerLinks <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1415-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(linkCount) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1415-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>())</a></code></pre></div>
<pre><code>## # A tibble: 10 x 2
##    linkCount     n
##        &lt;int&gt; &lt;int&gt;
##  1         0 23854
##  2         1   110
##  3         2    34
##  4         3    15
##  5         4     7
##  6         5     3
##  7         6     1
##  8         7     1
##  9         8     1
## 10         9     1</code></pre>
<p>If you are generating a report with R Markdown, then a better-looking table (see Table @ref(tab:tabulated-link-numbers) can be produced as follows:</p>
<div class="sourceCode" id="cb1417"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1417-1" data-line-number="1">hungerLinks <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1417-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(linkCount) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1417-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1417-4" data-line-number="4"><span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="dt">caption=</span><span class="kw">str_c</span>(<span class="st">&quot;Table showing number of links &quot;</span>,</a>
<a class="sourceLine" id="cb1417-5" data-line-number="5">                             <span class="st">&quot;made by reviewers of the Hunger &quot;</span>,</a>
<a class="sourceLine" id="cb1417-6" data-line-number="6">                             <span class="st">&quot;Games series.&quot;</span>))</a></code></pre></div>
<table>
<caption>(#tab:tabulated-link-numbers)Table showing number of links made by reviewers of the Hunger Games series.</caption>
<thead>
<tr class="header">
<th align="right">linkCount</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">23854</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">110</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">34</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">15</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="right">6</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">7</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">8</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">9</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Most of the reviewers didn’t link at all, but 173 of them did provide at least one link. One reviewer linked to nine books! Let’s find them and add the base URL <code>http://www.amazon.com/</code>:</p>
<div class="sourceCode" id="cb1418"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1418-1" data-line-number="1">hungerLinks <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1418-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(linkCount <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(linkCount)) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># get the case having most links</span></a>
<a class="sourceLine" id="cb1418-3" data-line-number="3"><span class="st">  </span>.<span class="op">$</span>content <span class="op">%&gt;%</span><span class="st">    </span><span class="co"># get just the content of the review,</span></a>
<a class="sourceLine" id="cb1418-4" data-line-number="4"><span class="st">                   </span><span class="co"># a character vector (of length 1 since there</span></a>
<a class="sourceLine" id="cb1418-5" data-line-number="5"><span class="st">                   </span><span class="co"># is only one review with the max number of lengths)</span></a>
<a class="sourceLine" id="cb1418-6" data-line-number="6"><span class="st">  </span><span class="kw">str_extract_all</span>(<span class="dt">pattern =</span> linkPattern) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># get the matches,</span></a>
<a class="sourceLine" id="cb1418-7" data-line-number="7"><span class="st">                                             </span><span class="co"># but this is a list of</span></a>
<a class="sourceLine" id="cb1418-8" data-line-number="8"><span class="st">                                             </span><span class="co"># length 1 ...</span></a>
<a class="sourceLine" id="cb1418-9" data-line-number="9"><span class="st">  </span><span class="kw">unlist</span>() <span class="op">%&gt;%</span><span class="st">     </span><span class="co"># ... so unlist it into a character vector</span></a>
<a class="sourceLine" id="cb1418-10" data-line-number="10"><span class="st">  </span><span class="kw">str_c</span>(<span class="st">&quot;http://www.amazon.com/&quot;</span>, .)  <span class="co"># prepend the base URL to each link</span></a></code></pre></div>
<pre><code>## [1] &quot;http://www.amazon.com/Harry-Potter-Paperback-Box-Set-Books-1-7/dp/0545162076&quot;     
## [2] &quot;http://www.amazon.com/The-Dark-Tower-Boxed-Set-Books-1-4/dp/0451211243&quot;           
## [3] &quot;http://www.amazon.com/The-Long-Walk/dp/0451196716&quot;                                
## [4] &quot;http://www.amazon.com/Battle-Royale-The-Novel/dp/1421527723&quot;                      
## [5] &quot;http://www.amazon.com/Battle-Royale-The-Complete-Collection-Blu-ray/dp/B006L4MX4A&quot;
## [6] &quot;http://www.amazon.com/The-Dark-Tower-Boxed-Set-Books-1-4/dp/0451211243&quot;           
## [7] &quot;http://www.amazon.com/Harry-Potter-Paperback-Box-Set-Books-1-7/dp/0545162076&quot;     
## [8] &quot;http://www.amazon.com/Abarat/dp/0062094106&quot;                                       
## [9] &quot;http://www.amazon.com/lord-of-the-flies/dp/B0073SQWWC&quot;</code></pre>
<p>As we learn more about R’s data-analysis functions we’ll be able to explore a wide variety of interesting questions about the attitudes and practices of Amazon reviewers. This will involve plowing through a lot more text, but now that we know regular expressions we are sure to “save the day”!</p>
<div id="practice-exercises-27" class="section level3">
<h3><span class="header-section-number">10.5.1</span> Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Use <code>reviews</code> to generate a table of the the number of Amazon links in reviews of John Greene’s book <em>The Fault in our Stars</em>.</p></li>
<li><p>How many times did a reviewer link to <em>Looking for Alaska</em> (another well-known book by John Greene)?</p></li>
<li><p>From <code>reviews</code>, make a data frame called shades that contains the reviews of <em>Fifty Shades of Gray</em>. This bestseller received an unusually high proportion of low ratings. Think of a few choice words that might show up in a negative review and create a logical variable called <code>dislikes</code> that is <code>TRUE</code> when one or more of these words appears in the review, and is <code>FALSE</code> otherwise. Convert the numerical variable <code>rating</code> to a factor variable. Make a bar graph that shows the relation between <code>dislikes</code> and <code>rating</code>.</p></li>
</ol>
</div>
<div id="solutions-to-the-practice-exercises-11" class="section level3">
<h3><span class="header-section-number">10.5.2</span> Solutions to the Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Try this:</p>
<div class="sourceCode" id="cb1420"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1420-1" data-line-number="1">linkPattern &lt;-<span class="st"> &quot;(?&lt;=&lt;a class=</span><span class="ch">\&quot;\&quot;</span><span class="st">a-link-normal</span><span class="ch">\&quot;\&quot;</span><span class="st"> href=</span><span class="ch">\&quot;\&quot;</span><span class="st">/)(.+?)(?=</span><span class="ch">\&quot;\&quot;</span><span class="st">&gt;)&quot;</span></a>
<a class="sourceLine" id="cb1420-2" data-line-number="2">fault &lt;-</a>
<a class="sourceLine" id="cb1420-3" data-line-number="3"><span class="st">  </span>reviews <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1420-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(book <span class="op">==</span><span class="st"> &quot;fault&quot;</span>)</a>
<a class="sourceLine" id="cb1420-5" data-line-number="5">fault <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1420-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">linkCount =</span> <span class="kw">str_count</span>(content, linkPattern)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1420-7" data-line-number="7"><span class="st">  </span><span class="kw">group_by</span>(linkCount) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1420-8" data-line-number="8"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>())</a></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   linkCount     n
##       &lt;int&gt; &lt;int&gt;
## 1         0 35827
## 2         1    10
## 3         2     3
## 4         3     2
## 5         6     1
## 6         7     1</code></pre></li>
<li><p>Try this:</p>
<div class="sourceCode" id="cb1422"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1422-1" data-line-number="1">fault <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1422-2" data-line-number="2"><span class="st">  </span>.<span class="op">$</span>content <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1422-3" data-line-number="3"><span class="st">  </span><span class="kw">str_extract_all</span>(<span class="dt">pattern =</span> linkPattern) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1422-4" data-line-number="4"><span class="st">  </span><span class="kw">unlist</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1422-5" data-line-number="5"><span class="st">  </span><span class="kw">str_detect</span>(<span class="st">&quot;(?i)Looking-For-Alaska&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1422-6" data-line-number="6"><span class="st">  </span><span class="kw">sum</span>()</a></code></pre></div>
<pre><code>## [1] 5</code></pre></li>
<li><p>Here is one possibility:</p>
<div class="sourceCode" id="cb1424"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1424-1" data-line-number="1">reviews <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1424-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(book <span class="op">==</span><span class="st"> &quot;shades&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1424-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dislikes =</span> <span class="kw">str_detect</span>(content, </a>
<a class="sourceLine" id="cb1424-4" data-line-number="4">                               <span class="st">&quot;bad|awful|terrible|waste&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1424-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rating =</span> <span class="kw">factor</span>(rating)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1424-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rating)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1424-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> dislikes), <span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>)</a></code></pre></div>
<p><img src="r-notes_files/figure-html/unnamed-chunk-1028-1.png" width="95%" style="display: block; margin: auto;" /></p></li>
</ol>

</div>
</div>
<div id="glossary-7" class="section level2 unnumbered">
<h2>Glossary</h2>
<dl>
<dt>Regular Expression </dt>
<dd><p>A sequence of characters that represents a pattern.</p>
</dd>
<dt>Regular Expression Engine </dt>
<dd><p>A specific implementation of regular expressions used by a specific programming language.</p>
</dd>
<dt>Literal Character </dt>
<dd><p>A character in a regular expression that matches itself.</p>
</dd>
<dt>Character Class </dt>
<dd><p>A set of characters enclosed in brackets. It matches any one of the characters in the set.</p>
</dd>
<dt>Metacharacter (also called “Special Character”) </dt>
<dd><p>A character in a regular expression that does not match itself, but instead has a special role in specifying the overall pattern.</p>
</dd>
</dl>

</div>
<div id="exercises-6" class="section level2 unnumbered">
<h2>Exercises</h2>
<p><img src="images/thinking.png" width="50%" style="display: block; margin: auto;" /></p>
<ol style="list-style-type: decimal">
<li><p>Write a function called <code>findMister()</code> that, when given any string, will return a character vector of the words that immediately follow the string “Mister”, with exactly one space in between. The function should take a single argument called <code>str</code>, the string to search. A typical example of use is as follows:</p>
<div class="sourceCode" id="cb1425"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1425-1" data-line-number="1">text &lt;-<span class="st"> &quot;Here are Mister Tom, MisterJerry, Mister Mister, and Mister</span><span class="ch">\t</span><span class="st">Joe.&quot;</span></a>
<a class="sourceLine" id="cb1425-2" data-line-number="2"><span class="kw">findMister</span>(text)</a></code></pre></div>
<pre><code>## [1] &quot;Tom&quot;    &quot;Mister&quot;</code></pre></li>
<li><p>Write a function called <code>findMr()</code> that, when given any string, will return a character vector of all words following the string “Mr.”, with exactly one space in between. The function should take a single argument called <code>str</code>, the string to search. A typical example of use is as follows:</p>
<div class="sourceCode" id="cb1427"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1427-1" data-line-number="1">text &lt;-<span class="st"> &quot;Here are Mr. Tom, Mr Jerry, Mr. Mister, and Mr.</span><span class="ch">\t</span><span class="st">Joe.&quot;</span></a>
<a class="sourceLine" id="cb1427-2" data-line-number="2"><span class="kw">findMr</span>(text)</a></code></pre></div>
<pre><code>## [1] &quot;Tom&quot;    &quot;Mister&quot;</code></pre></li>
<li>For each of the following expressions, write a regular expression to test whether any of the sub-string(s) described occur in a given string. The regular expression should match any of the sub-strings described, and should not match any other sub-string. Try to make the regular expression as short as possible. Write the regular expression as a string that could be used in one of R’s regex functions (i.e. extra backslash escapes as needed). The first item is done for you, as an example.
<ul>
<li><em>bot</em> and <em>bat</em>. Regex string: <code>&quot;b[oa]t&quot;</code>. (This is the one to submit, because it’s shorter than other alternatives such as<code>&quot;box|bat&quot;</code>).</li>
<li><em>cart</em> and <em>cars</em> and <em>carp</em>.</li>
<li><em>slick</em> and <em>sick</em></li>
<li>Any word ending in <em>ity</em> (such as <em>velocity</em> and <em>ferocity</em>). Be sure to pay attention to word-boundaries. You should match <em>velocity</em> but not <em> velocity</em> (includes a space before the “v”) or <em>velocity;</em>.</li>
<li>A whole number consisting of more than six digits.</li>
<li>A word that is between 3 and 6 characters long. Pay attention to word-boundaries.</li>
<li>One or more white-space characters, followed by a hyphen or a semicolon or a colon.</li>
</ul></li>
<li>Write a function called <code>findTitled()</code> that, when given any string, will return a character vector of all words following any one of these titles:
<ul>
<li>“Mr.”</li>
<li>“Mister”</li>
<li>“Missus”</li>
<li>“Mrs.”</li>
<li>“Miss”</li>
<li>“Ms.”</li>
</ul>
<p>There should be exactly one space between the title and the following word. The function should take a single argument called <code>str</code>, the string to search. A typical example of use is as follows:</p>
<div class="sourceCode" id="cb1429"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1429-1" data-line-number="1">text &lt;-<span class="st"> &quot;Here are Mr. Tom, Ms. Thatcher, Miss Ellen, and Helen.&quot;</span></a>
<a class="sourceLine" id="cb1429-2" data-line-number="2"><span class="kw">findTitled</span>(text)</a></code></pre></div>
<pre><code>## [1] &quot;Tom&quot;      &quot;Thatcher&quot; &quot;Ellen&quot;</code></pre></li>
<li><p>Write a function called <code>capRepeats()</code> that, when given a string, searches for all repeated-word pairs (with at least one character of white-space in between) and replaces them with the same pair where all letters are capitalized. The function should take a single argument called <code>str</code>, the string to be searched. A typical example of use would be as follows:</p>
<div class="sourceCode" id="cb1431"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1431-1" data-line-number="1"><span class="kw">capRepeats</span>(<span class="st">&quot;I have a boo boo on my knee    </span><span class="ch">\t</span><span class="st">knee!&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;I have a BOO BOO on my KNEE    \tKNEE!&quot;</code></pre></li>
<li><p>Use <code>str_subset()</code> to write a function called <code>longWord()</code> that, when given a character vector of strings, returns a vector consisting of the strings that contain a word at least eight characters long. The function should take a single argument called <code>strs</code>. An example of use would be:</p>
<div class="sourceCode" id="cb1433"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1433-1" data-line-number="1">myText &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Very short words.&quot;</span>, <span class="st">&quot;Got a gargantuan word.&quot;</span>, <span class="st">&quot;More short words!&quot;</span>)</a>
<a class="sourceLine" id="cb1433-2" data-line-number="2"><span class="kw">longWord</span>(<span class="dt">strs =</span> myText)</a></code></pre></div>
<pre><code>## [1] &quot;Got a gargantuan word.&quot;</code></pre></li>
<li><p>Write a function called <code>longWord2()</code> that, when given a character vector of strings, returns a list of character vectors, where each vector consists of the words in the corresponding string that are at least eight characters long. The function should take a single argument called <code>strs</code>. An example of use would be:</p>
<div class="sourceCode" id="cb1435"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1435-1" data-line-number="1">myText &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Very short words.&quot;</span>, <span class="st">&quot;Got a gargantuan word.&quot;</span>, <span class="st">&quot;More short words!&quot;</span>)</a>
<a class="sourceLine" id="cb1435-2" data-line-number="2"><span class="kw">longWord2</span>(<span class="dt">strs =</span> myText)</a></code></pre></div>
<pre><code>## [[1]]
## character(0)
## 
## [[2]]
## [1] &quot;gargantuan&quot;
## 
## [[3]]
## character(0)</code></pre></li>
<li><p>Write a function called <code>phoneNumber()</code> that, when given a vector of strings returns a logical vector indicating which of the strings contain a valid phone number. For our purposes a valid phone number shall be any string of the form</p>
<blockquote>
<p>xxx-xxx-xxxx</p>
</blockquote>
<p>or</p>
<blockquote>
<p>xxx.xxx.xxx</p>
</blockquote>
<p>Thus, 502-863-8111 is valid and so is 502.863.8111, but not 502-863.8111.</p>
<p>In the code for the function, specify the pattern using <code>(?x)</code> so you can ignore whitespace and leave detailed comments for each portion of the regular expression.</p>
<p>The function should take a single parameter called <code>strs</code>. A typical example of use would be:</p>
<div class="sourceCode" id="cb1437"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1437-1" data-line-number="1">sentences &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Ted&#39;s number is 606-255-3143.&quot;</span>,</a>
<a class="sourceLine" id="cb1437-2" data-line-number="2">               <span class="st">&quot;Rhonda&#39;s number is 403-28-1259.&quot;</span>,</a>
<a class="sourceLine" id="cb1437-3" data-line-number="3">               <span class="st">&quot;Lydia&#39;s number is 502.255.3921.&quot;</span>,</a>
<a class="sourceLine" id="cb1437-4" data-line-number="4">               <span class="st">&quot;Raj&#39;s number is 502.367-4432.&quot;</span>)</a>
<a class="sourceLine" id="cb1437-5" data-line-number="5"><span class="kw">phoneNumber</span>(<span class="dt">strs =</span> sentences)</a></code></pre></div>
<pre><code>## [1]  TRUE FALSE  TRUE FALSE</code></pre></li>
</ol>
<!--chapter:end:110-regex.Rmd-->
</div>
</div>
<div id="files" class="section level1">
<h1><span class="header-section-number">11</span> Files</h1>
<div class="figure" style="text-align: center">
<img src="images/wizardoz.jpg" alt="Scarecrow, Tin Man, Dorothy, Toto and the Cowardly Lion wearing Emerald City Specticals:  an original llustration from *The Wonderful Wizard of Oz*, by L. Frank Bloom." width="60%" />
<p class="caption">
(#fig:wizard-oz)Scarecrow, Tin Man, Dorothy, Toto and the Cowardly Lion wearing Emerald City Specticals: an original llustration from <em>The Wonderful Wizard of Oz</em>, by L. Frank Bloom.
</p>
</div>

<p>Most computer programming tasks involve the processing or analysis of data, and unless we are doing a simulation, that data has not been created within the program that is supposed to process it. This Chapter covers some basic techniques for importing data into R, saving it for future use, and exporting it for use by others.</p>
<div id="downloading-files" class="section level2">
<h2><span class="header-section-number">11.1</span> Downloading Files</h2>
<p>First we’ll deal with the situation in which the data we want is in a file somewhere on the Internet. In this case we need only download the file to our computer.</p>
<p>It’s a good idea to keep one’s work organized. Since we plan to begin downloading data files, we might as well create a directory dedicated to them. It’s easy to use the R Studio IDE to create the directory, but we might as well learn how the same task could be accomplished with an R-command. We will use the function <code>dir.create()</code>. </p>
<div class="sourceCode" id="cb1439"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1439-1" data-line-number="1"><span class="kw">dir.create</span>(<span class="st">&quot;downloads&quot;</span>)</a></code></pre></div>
<p>We are ready to begin downloading. Let’s begin with a file<a href="#fn23" class="footnote-ref" id="fnref23"><sup>23</sup></a> at the URL:</p>
<blockquote>
<p><a href="https://homerhanumat.github.io/r-notes/downloads/words.zip" class="uri">https://homerhanumat.github.io/r-notes/downloads/words.zip</a></p>
</blockquote>
<p>The relevant function is <code>download.file()</code>:</p>
<div class="sourceCode" id="cb1440"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1440-1" data-line-number="1"><span class="kw">download.file</span>(<span class="dt">url =</span> <span class="st">&quot;https://github.com/homerhanumat/r-notes/blob/master/downloads/words.zip?raw=true&quot;</span>, <span class="dt">destfile =</span> <span class="st">&quot;downloads/words.zip&quot;</span>)</a></code></pre></div>
<p>The file should now be in the <code>downloads</code> folder of your Home directory.</p>
<p>We see that it’s a zip-file. R can unzip it for us:</p>
<div class="sourceCode" id="cb1441"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1441-1" data-line-number="1"><span class="kw">unzip</span>(<span class="dt">zipfile =</span> <span class="st">&quot;downloads/words.zip&quot;</span>)</a></code></pre></div>
<p>We now have the text-file <code>words.txt</code> in our <code>downloads</code> directory. In R Studio you can examine the contents of the file if you click on the file-name in your <strong>Files</strong> tab. You see something like this:</p>
<pre><code>aa
aah
aahed
aahing
aahs
aal
...</code></pre>
<p>The file is a fairly comprehensive list of words in the English language—all in lowercase, one word per line.</p>
</div>
<div id="reading-text-files-with-readlines" class="section level2">
<h2><span class="header-section-number">11.2</span> Reading Text Files with <code>readLines()</code></h2>
<p>Let’s transfer the contents of <code>words.txt</code> to a character vector in R. The function for this is <code>readLines()</code>: </p>
<div class="sourceCode" id="cb1443"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1443-1" data-line-number="1">words &lt;-<span class="st"> </span><span class="kw">readLines</span>(<span class="dt">con =</span> <span class="st">&quot;downloads/words.txt&quot;</span>)</a></code></pre></div>
<p><code>readLines()</code> is similar to <code>readline()</code>, which we have used in the past to get a single line of input from the user. <code>readLines()</code> can also read from the console—this is called <em>standard input</em>—but it can also make a <em>connection</em><a href="#fn24" class="footnote-ref" id="fnref24"><sup>24</sup></a> with any file. In the code above, we set the connection to be the file <code>words.txt</code>. By default <code>readLines()</code> reads the file—one line at a time as a string. The resulting character vector is named <code>words</code>.<a href="#fn25" class="footnote-ref" id="fnref25"><sup>25</sup></a></p>
<p>Let’s look at words to see if it came out the way we expected. The <code>head()</code> function  works not only on data frames but also on vectors:</p>
<div class="sourceCode" id="cb1444"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1444-1" data-line-number="1"><span class="kw">head</span>(words)</a></code></pre></div>
<pre><code>## [1] &quot;aa&quot;     &quot;aah&quot;    &quot;aahed&quot;  &quot;aahing&quot; &quot;aahs&quot;   &quot;aal&quot;</code></pre>
<p>Yes, it looks like we got one word into each element of the vector. The total number of words is:</p>
<div class="sourceCode" id="cb1446"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1446-1" data-line-number="1"><span class="kw">length</span>(words)</a></code></pre></div>
<pre><code>## [1] 113809</code></pre>
</div>
<div id="reading-text-files-with-readr" class="section level2">
<h2><span class="header-section-number">11.3</span> Reading Text Files with <strong>readr</strong></h2>
<p><code>words.txt</code> was unusually simple—just one piece of data per line. It made sense to read it into a vector. Most of the files that we encounter have a more complex structure. In many cases it is best to incorporate them into R as data frames.</p>
<p>R has several tools for reading data into data frames. One of the most convenient—and most popular—is the set of functions in the <strong>readr</strong> package <span class="citation">(Wickham, Hester, and Francois <a href="#ref-R-readr">2017</a>)</span>. It’s attached automatically when you load the tidy-verse, but you can also attach it separately:</p>
<div class="sourceCode" id="cb1448"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1448-1" data-line-number="1"><span class="kw">library</span>(readr)</a></code></pre></div>
<p>Let’s practice reading in a file from the Internet. The URL is:</p>
<blockquote>
<p><a href="https://query.data.world/s/b6plbxp3ym20s5a5iey36geul" class="uri">https://query.data.world/s/b6plbxp3ym20s5a5iey36geul</a></p>
</blockquote>
<p>The file is taken from <a href="https://data.world/jonloyens/alcohol-and-life-expectancy">data.world</a>, a site very much worth exploring, and it addresses part of a study on alcohol consumption and life-expectancy in the nations of the world. (The file-extension <code>.csv</code> indicates that the it is expected to use commas to separate data values.)</p>
<p>The easiest way to learn the functions of <strong>readr</strong> is to use a widget supplied by the R Studio IDE:</p>
<ul>
<li>In the <strong>Environment</strong> Pane, find the drop-down menu <strong>Import Dataset</strong>,</li>
<li>Ask to <strong>Import CSV …</strong>.</li>
<li>You will be taken to a dialog box. Enter the above URL in the <strong>File/URL</strong> field and press the <strong>Update</strong> button.</li>
<li>A preview of the data is shown.</li>
<li>At the bottom left there are a number of Import Options. The most important one at this point is the Name. Instead of the messy name that is shown, type something descriptive. (We’ll choose <code>alcGDP</code>.)</li>
<li>Note the Code Preview box at the bottom right. It contains the R-commands needed to download and read the text-file <code>alcGDP</code> into R as a data frame.</li>
<li>You should copy the code and save it somewhere (in an R script or R Markdown document) in order to keep a record of your work.</li>
<li>You may then press the <strong>Import</strong> button.</li>
</ul>
<p>The data is read into <code>alcGDP</code> according to the <code>read_csv()</code> call below:</p>
<div class="sourceCode" id="cb1449"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1449-1" data-line-number="1">alcGDP &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://query.data.world/s/b6plbxp3ym20s5a5iey36geul&quot;</span>)</a></code></pre></div>
<p>If you pressed the <strong>Import</strong> button, then you can see <code>alcGDP</code> in the Editor window. Notice that is has five variables. Two of them have only <code>NA</code> values, and the final two of them have names that are simply too long to be practical. Go ahead and fix this:</p>
<div class="sourceCode" id="cb1450"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1450-1" data-line-number="1"><span class="kw">names</span>(alcGDP)[<span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">5</span>)] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;liters&quot;</span>, <span class="st">&quot;gdp&quot;</span>)</a>
<a class="sourceLine" id="cb1450-2" data-line-number="2">alcGDP<span class="op">$</span>YearDisplay &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb1450-3" data-line-number="3">alcGDP<span class="op">$</span>SexDisplay &lt;-<span class="st"> </span><span class="ot">NULL</span></a></code></pre></div>
<p>Now take a look at the frame:</p>
<div class="sourceCode" id="cb1451"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1451-1" data-line-number="1"><span class="kw">head</span>(alcGDP)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country     liters    gdp
##   &lt;chr&gt;        &lt;dbl&gt;  &lt;int&gt;
## 1 Afghanistan    0    20842
## 2 Albania        4.9  13370
## 3 Azerbaijan     1.3  75198
## 4 Madagascar     0.8  10593
## 5 Malawi         1.5   4258
## 6 Malaysia       0.3 326933</code></pre>
<p><code>liters</code> gives the mean total liters of alcohol consumed per person in each country, and <code>GDP</code> is the country’s Gross Domestic Product in millions of dollars.</p>
<p>From the Console output you can tell that <code>alcGDP</code> is a tibble rather than a data frame. (The default behavior for <code>read_csv()</code> is to import data as tibbles.)</p>
<p>We won’t analyze <code>alcGDP</code> here, but you might want to look at it later. You can save it permanently to your Home directory with the <code>save()</code> function:</p>
<p></p>
<div class="sourceCode" id="cb1453"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1453-1" data-line-number="1"><span class="kw">save</span>(alcGDP, <span class="dt">file =</span> <span class="st">&quot;downloads/alcGDP.rda&quot;</span>)</a></code></pre></div>
<p><code>alcGDP</code> is still in your Global Environment. If you clear the environment later on, you can reload <code>alcGDP</code> as follows:</p>
<p></p>
<div class="sourceCode" id="cb1454"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1454-1" data-line-number="1"><span class="kw">load</span>(<span class="st">&quot;downloads/alcGDP.rda&quot;</span>)</a></code></pre></div>
</div>
<div id="writing-to-files" class="section level2">
<h2><span class="header-section-number">11.4</span> Writing to Files</h2>
<p>If you would like to send the data in a data frame to a colleague who does not use R, then you should convert it to a common text-file format such as CSV. For this purpose <strong>readr</strong> provides the <code>write_csv()</code> command. The following code writes <code>m11survey</code> to a CSV file in your Home directory.</p>
<p></p>
<div class="sourceCode" id="cb1455"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1455-1" data-line-number="1"><span class="kw">write_csv</span>(bcscr<span class="op">::</span>m111survey, <span class="dt">path =</span> <span class="st">&quot;m111survey.csv&quot;</span>)</a></code></pre></div>
<p>You may now transmit the file to your colleague.</p>
</div>
<div id="application-making-a-lexicon" class="section level2">
<h2><span class="header-section-number">11.5</span> Application: Making a Lexicon</h2>
<p>A <em>lexicon</em> is any list of words—usually the words of a language or of some body of texts produced in that language. In this Section we’ll combine our file-handling skills with regular expressions to create a lexicon for L. Frank Bloom’s classic <em>The Wizard of Oz</em>.</p>
<p>First you need to get hold of the text itself. <em>The Wizrd of Oz</em> has been in the public domain for many years now, and is available from the <a href="https://www.gutenberg.org/">Gutenberg Project</a>. You could look it up there and find the URL for download:</p>
<blockquote>
<p><a href="http://www.gutenberg.org/cache/epub/55/pg55.txt" class="uri">http://www.gutenberg.org/cache/epub/55/pg55.txt</a></p>
</blockquote>
<p>Go ahead and download the file: </p>
<div class="sourceCode" id="cb1456"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1456-1" data-line-number="1">ozURL &lt;-<span class="st"> &quot;http://www.gutenberg.org/cache/epub/55/pg55.txt&quot;</span></a>
<a class="sourceLine" id="cb1456-2" data-line-number="2"><span class="cf">if</span> ( <span class="op">!</span>(<span class="kw">file.exists</span>(<span class="st">&quot;downloads/oz.txt&quot;</span>)) ) {</a>
<a class="sourceLine" id="cb1456-3" data-line-number="3">  <span class="kw">download.file</span>(<span class="dt">url =</span> ozURL,</a>
<a class="sourceLine" id="cb1456-4" data-line-number="4">                <span class="dt">destfile =</span> <span class="st">&quot;downloads/oz.txt&quot;</span>)</a>
<a class="sourceLine" id="cb1456-5" data-line-number="5">}</a></code></pre></div>
<p>Next, read in the file, line by line: </p>
<div class="sourceCode" id="cb1457"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1457-1" data-line-number="1">oz &lt;-<span class="st"> </span><span class="kw">readLines</span>(<span class="dt">con =</span> <span class="st">&quot;downloads/oz.txt&quot;</span>)</a></code></pre></div>
<p>Take some time to look through <code>oz.txt</code>. If we plan to make a lexicon for the book, then we probably don’t want to include Gutenberg’s header material or their discussion of licensing at the end. We’ll need to cut this material out of <code>oz</code>:</p>
<p></p>
<div class="sourceCode" id="cb1458"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1458-1" data-line-number="1"><span class="co"># a helper function</span></a>
<a class="sourceLine" id="cb1458-2" data-line-number="2">findIndex &lt;-<span class="st"> </span><span class="cf">function</span>(pattern, text) {</a>
<a class="sourceLine" id="cb1458-3" data-line-number="3">  <span class="kw">str_detect</span>(text, <span class="dt">pattern =</span> pattern) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">which</span>()</a>
<a class="sourceLine" id="cb1458-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb1458-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1458-6" data-line-number="6"><span class="co"># now find lines to start and end at:</span></a>
<a class="sourceLine" id="cb1458-7" data-line-number="7">firstLine &lt;-<span class="st"> </span><span class="kw">findIndex</span>(<span class="st">&quot;^</span><span class="ch">\\</span><span class="st">*</span><span class="ch">\\</span><span class="st">*</span><span class="ch">\\</span><span class="st">* START OF THIS PROJECT GUTENBERG&quot;</span>, oz) <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb1458-8" data-line-number="8">lastLine &lt;-<span class="st"> </span><span class="kw">findIndex</span>(<span class="st">&quot;^End of Project Gutenberg&#39;s&quot;</span>, oz)  <span class="op">-</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb1458-9" data-line-number="9"></a>
<a class="sourceLine" id="cb1458-10" data-line-number="10"><span class="co"># trim oz to the desired text:</span></a>
<a class="sourceLine" id="cb1458-11" data-line-number="11">oz2 &lt;-<span class="st"> </span>oz[firstLine<span class="op">:</span>lastLine]</a></code></pre></div>
<p>Let us now take a first pass at splitting the text into all of its “words.” Our first thought is that words are the parts of the text that are separated by one or more white-space characters, so we might try this:</p>
<p>
</p>
<div class="sourceCode" id="cb1459"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1459-1" data-line-number="1">ozwds &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1459-2" data-line-number="2"><span class="st">  </span>oz2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1459-3" data-line-number="3"><span class="st">  </span><span class="kw">str_split</span>(<span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">s+&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1459-4" data-line-number="4"><span class="st">  </span><span class="kw">unlist</span>()</a></code></pre></div>
<p>Next, let’s convert all of the words to lowercase, then make a new word-list with no repeats, then sort that list:</p>
<p>

</p>
<div class="sourceCode" id="cb1460"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1460-1" data-line-number="1">ozWords &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1460-2" data-line-number="2"><span class="st">  </span>ozwds <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1460-3" data-line-number="3"><span class="st">  </span><span class="kw">str_to_lower</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1460-4" data-line-number="4"><span class="st">  </span><span class="kw">unique</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1460-5" data-line-number="5"><span class="st">  </span><span class="kw">str_sort</span>()</a></code></pre></div>
<p>It’s time now to examine our prospective lexicon. Look around a bit in <code>ozWords</code>.</p>
<ul>
<li>There are some numbers. We’ll get rid of them.</li>
<li>There are an awful lot of strings that begin or end with punctuation. This should not be difficult to remove with <code>str_replace()</code>.</li>
<li>There are plenty of contractions, like <code>&quot;aren't&quot;</code>. It seems reasonable to count these as words, so we’ll leave them alone.</li>
<li><p>There are hyphenated words. What should we do with them? In a book for grown-ups you’ll find lots of hyphenated words where the components words are meaningful in themselves. That’s because of a grown-up grammar rule that says we should “hyphenate two or more words when they come before a noun they modify and act as a single idea.” This is important: after all,“short-listed candidates” refers to candidates who appear on our short list, whereas “short listed candidates” appears to refer to short candidates who appear on our list. If this were a grown-up text then I’d want to split on hyphens in order to capture the meaningful word-components. In <em>The Wizard of Oz</em>, though, it seems that hyphenation is used mainly to create interesting new words out nonsense sound-fragments, as in:</p>
<blockquote>
<p>So the Wicked Witch took the Golden Cap from her cupboard and placed it
upon her head. Then she stood upon her left foot and said slowly:</p>
</blockquote>
<blockquote>
<p>“Ep-pe, pep-pe, kak-ke!”</p>
</blockquote>
<blockquote>
<p>Next she stood upon her right foot and said:</p>
</blockquote>
<blockquote>
<p>“Hil-lo, hol-lo, hel-lo!”</p>
</blockquote>
<blockquote>
<p>After this she stood upon both feet and cried in a loud voice:</p>
</blockquote>
<blockquote>
<p>“Ziz-zy, zuz-zy, zik!”</p>
</blockquote>
<p>It would seem that (for example) “zuz-zy” should count as a word, but its parts “zuz” and “zy” should not count as words.</p></li>
<li><p>On the other hand, we often find <em>pairs</em> of hyphens that appear to act as the <em>emdash</em> character (—):</p>
<blockquote>
<p>The cyclone had set the house down very gently--for a cyclone--in the
midst of a country of marvelous beauty.</p>
</blockquote>
<p>This causes such strings as “gently--for” and “cyclone--in” to appear in our lexicon. We don’t want that, so we need to split on double-hyphens.</p></li>
</ul>
<p>Let’s go back and try the splitting again:
</p>
<div class="sourceCode" id="cb1461"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1461-1" data-line-number="1">ozwds &lt;-</a>
<a class="sourceLine" id="cb1461-2" data-line-number="2"><span class="st">  </span>oz2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1461-3" data-line-number="3"><span class="st">  </span><span class="kw">str_split</span>(<span class="dt">pattern =</span> <span class="st">&quot;(?x)    # allow comments</span></a>
<a class="sourceLine" id="cb1461-4" data-line-number="4"><span class="st">                      (-{2,})  # two or more hyphens</span></a>
<a class="sourceLine" id="cb1461-5" data-line-number="5"><span class="st">                      |        # or</span></a>
<a class="sourceLine" id="cb1461-6" data-line-number="6"><span class="st">                      (</span><span class="ch">\\</span><span class="st">s+)   # whitespace</span></a>
<a class="sourceLine" id="cb1461-7" data-line-number="7"><span class="st">                      &quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1461-8" data-line-number="8"><span class="st">  </span><span class="kw">unlist</span>()</a></code></pre></div>
<p>Now let’s strip off any leading or trailing punctuation. In ICU Unicode, <code>\p{P}</code> is a shortcut for any punctuation character:</p>
<p></p>
<div class="sourceCode" id="cb1462"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1462-1" data-line-number="1">ozWords &lt;-</a>
<a class="sourceLine" id="cb1462-2" data-line-number="2"><span class="st">  </span>ozwds <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1462-3" data-line-number="3"><span class="st">  </span><span class="kw">str_replace</span>(<span class="dt">pattern =</span> <span class="st">&quot;^</span><span class="ch">\\</span><span class="st">p{P}+&quot;</span>,</a>
<a class="sourceLine" id="cb1462-4" data-line-number="4">              <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st">   </span><span class="co"># strip leading punctuation</span></a>
<a class="sourceLine" id="cb1462-5" data-line-number="5"><span class="st">  </span><span class="kw">str_replace</span>(<span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">p{P}+$&quot;</span>,</a>
<a class="sourceLine" id="cb1462-6" data-line-number="6">              <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st">   </span><span class="co"># strip trailing punctuation</span></a>
<a class="sourceLine" id="cb1462-7" data-line-number="7"><span class="st">  </span><span class="kw">str_to_lower</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1462-8" data-line-number="8"><span class="st">  </span><span class="kw">unique</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1462-9" data-line-number="9"><span class="st">  </span><span class="kw">str_sort</span>()</a></code></pre></div>
<p>Taking a second look at <code>ozWords</code>, we see that we need to get rid of some numbers and a spurious empty string:</p>
<p></p>
<div class="sourceCode" id="cb1463"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1463-1" data-line-number="1">isNumber &lt;-<span class="st"> </span><span class="kw">str_detect</span>(ozWords, <span class="dt">pattern =</span> <span class="st">&quot;^</span><span class="ch">\\</span><span class="st">d+&quot;</span>)</a>
<a class="sourceLine" id="cb1463-2" data-line-number="2">isEmpty &lt;-<span class="st"> </span>ozWords <span class="op">==</span><span class="st"> &quot;&quot;</span></a>
<a class="sourceLine" id="cb1463-3" data-line-number="3">validWord &lt;-<span class="st"> </span><span class="op">!</span>isNumber <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span>isEmpty</a>
<a class="sourceLine" id="cb1463-4" data-line-number="4">ozWords &lt;-<span class="st"> </span>ozWords[validWord]</a></code></pre></div>
<p>A final check of <code>ozWords</code> appears not turn up any serious problems. We’ll take it as our lexicon for <em>The Wizard of Oz</em>.</p>
<p>For fun, let’s make an index to the book. First, a little helper function:</p>
<p></p>
<div class="sourceCode" id="cb1464"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1464-1" data-line-number="1">indexFactory &lt;-<span class="st"> </span><span class="cf">function</span>(lexicon, fn) {</a>
<a class="sourceLine" id="cb1464-2" data-line-number="2">  index &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb1464-3" data-line-number="3">  fileLines &lt;-<span class="st"> </span><span class="kw">readLines</span>(<span class="dt">con =</span> fn)</a>
<a class="sourceLine" id="cb1464-4" data-line-number="4">  <span class="cf">for</span> ( i <span class="cf">in</span> <span class="kw">seq_len</span>(<span class="kw">length</span>(lexicon)) ) {</a>
<a class="sourceLine" id="cb1464-5" data-line-number="5">    word &lt;-<span class="st"> </span>lexicon[i]</a>
<a class="sourceLine" id="cb1464-6" data-line-number="6">    pattern &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;(?i)&quot;</span>, word)</a>
<a class="sourceLine" id="cb1464-7" data-line-number="7">    hasWord &lt;-<span class="st"> </span><span class="kw">str_detect</span>(fileLines, <span class="dt">pattern =</span> pattern)</a>
<a class="sourceLine" id="cb1464-8" data-line-number="8">    index[[word]] &lt;-<span class="st"> </span><span class="kw">which</span>(hasWord)</a>
<a class="sourceLine" id="cb1464-9" data-line-number="9">  }</a>
<a class="sourceLine" id="cb1464-10" data-line-number="10">  index</a>
<a class="sourceLine" id="cb1464-11" data-line-number="11">}</a></code></pre></div>
<p>Now we call our helper function to create the index:</p>
<div class="sourceCode" id="cb1465"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1465-1" data-line-number="1">ozIndex &lt;-<span class="st"> </span><span class="kw">indexFactory</span>(ozWords, <span class="st">&quot;downloads/oz.txt&quot;</span>)</a></code></pre></div>
<p>We can use the index to look up words in the original text, without having to use regular expressions explicitly. First we make a convenience-function for looking up words::</p>
<div class="sourceCode" id="cb1466"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1466-1" data-line-number="1">ozLookup &lt;-<span class="st"> </span><span class="cf">function</span>(word) {</a>
<a class="sourceLine" id="cb1466-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb1466-3" data-line-number="3">  fn &lt;-<span class="st"> &quot;downloads/oz.txt&quot;</span></a>
<a class="sourceLine" id="cb1466-4" data-line-number="4">  lexicon &lt;-<span class="st"> </span>ozWords</a>
<a class="sourceLine" id="cb1466-5" data-line-number="5">  index &lt;-<span class="st"> </span>ozIndex</a>
<a class="sourceLine" id="cb1466-6" data-line-number="6">  </a>
<a class="sourceLine" id="cb1466-7" data-line-number="7">  file &lt;-<span class="st"> </span><span class="kw">readLines</span>(<span class="dt">con =</span> fn)</a>
<a class="sourceLine" id="cb1466-8" data-line-number="8">  <span class="cf">if</span> ( <span class="op">!</span>(word <span class="op">%in%</span><span class="st"> </span>lexicon ) ) {</a>
<a class="sourceLine" id="cb1466-9" data-line-number="9">    message &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\&quot;</span><span class="st">&quot;</span>, word, <span class="st">&quot;</span><span class="ch">\&quot;</span><span class="st"> is not in the lexicon!</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb1466-10" data-line-number="10">    <span class="kw">return</span>(<span class="kw">cat</span>(message))</a>
<a class="sourceLine" id="cb1466-11" data-line-number="11">  }</a>
<a class="sourceLine" id="cb1466-12" data-line-number="12">  matchLines &lt;-<span class="st"> </span>index[[word]]</a>
<a class="sourceLine" id="cb1466-13" data-line-number="13">  number &lt;-<span class="st"> </span><span class="kw">length</span>(matchLines)</a>
<a class="sourceLine" id="cb1466-14" data-line-number="14">  <span class="kw">cat</span>(<span class="st">&quot;There are &quot;</span>, number, <span class="st">&quot;lines that contain your request.</span><span class="ch">\n\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb1466-15" data-line-number="15">  hrule &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;-&quot;</span>, <span class="dt">times =</span> <span class="dv">30</span>)</a>
<a class="sourceLine" id="cb1466-16" data-line-number="16">  <span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>number ) {</a>
<a class="sourceLine" id="cb1466-17" data-line-number="17">    lineNum &lt;-<span class="st"> </span>matchLines[i]</a>
<a class="sourceLine" id="cb1466-18" data-line-number="18">    <span class="kw">cat</span>(hrule, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb1466-19" data-line-number="19">    <span class="kw">cat</span>(lineNum, <span class="st">&quot;:  &quot;</span>, file[lineNum], <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb1466-20" data-line-number="20">  }</a>
<a class="sourceLine" id="cb1466-21" data-line-number="21">}</a></code></pre></div>
<p>Now we give it a try:</p>
<div class="sourceCode" id="cb1467"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1467-1" data-line-number="1"><span class="kw">ozLookup</span>(<span class="st">&quot;lolliop&quot;</span>)</a></code></pre></div>
<pre><code>## &quot;lolliop&quot; is not in the lexicon!</code></pre>
<p>And another try:</p>
<div class="sourceCode" id="cb1469"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1469-1" data-line-number="1"><span class="kw">ozLookup</span>(<span class="st">&quot;humbug&quot;</span>)</a></code></pre></div>
<pre><code>## There are  10 lines that contain your request.
## 
## - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
## 61 :     16.  The Magic Art of the Great Humbug 
## - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
## 3421 :   a humbug.&quot; 
## - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
## 3424 :   it pleased him.  &quot;I am a humbug.&quot; 
## - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
## 3438 :   &quot;Doesn&#39;t anyone else know you&#39;re a humbug?&quot; asked Dorothy. 
## - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
## 3472 :   being such a humbug.&quot; 
## - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
## 3603 :   one I am a humbug.&quot; 
## - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
## 3607 :   Terrible Humbug,&quot; as she called him, would find a way to send her back 
## - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
## 3613 :     16.  The Magic Art of the Great Humbug 
## - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
## 3738 :   they wanted.  &quot;How can I help being a humbug,&quot; he said, &quot;when all these 
## - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
## 3802 :   &quot;Yes, of course,&quot; replied Oz.  &quot;I am tired of being such a humbug.  If</code></pre>

</div>
<div id="glossary-8" class="section level2 unnumbered">
<h2>Glossary</h2>
<dl>
<dt>Connection (also called a “Generalized File”) </dt>
<dd><p>An interface with the world outside of the R-session, for the purpose of sending or receiving data.</p>
</dd>
</dl>

</div>
<div id="exercises-7" class="section level2 unnumbered">
<h2>Exercises</h2>
<p><img src="images/thinking.png" width="50%" style="display: block; margin: auto;" /></p>
<ol style="list-style-type: decimal">
<li><p>The word “caracara” is in <code>words</code>. Note that it in this word a sequence of four letters is immediately repeated. Write a function that uses a regular expression to find all of the words in <code>words</code> that contain a doublet like this: specifically, a sequence of <em>four or more</em> letters that are immediately repeated. (The repeated sequence need NOT make up the entire word, as in the case of “caracara.”) The program should <code>cat()</code> the words to the console, one per line.</p></li>
<li><p>Write a program that uses a regular expression to find all of the words in <code>words</code> that contain a “q” that is not immediately followed by a “u”. The program should <code>cat()</code> the words to the console, one per line.</p></li>
<li><p>Write a program that uses a regular expression to find all of the words in <code>words</code> that are 4-letter or 5-letter palindromes. The program should <code>cat()</code> the words to the console, one per line. (<strong>Hint:</strong> consult Section @ref(regex-captures).)</p></li>
<li><p>It can be proven mathematically that there is no regular expression, no matter how complex, that matches all and only the palindromes. We can write regular expressions to match all and only the palindromes that are less than some fixed number of characters, but we can’t match palindromes of arbitrary length. Write a program to find all of the palindromes in <code>words</code>. Obviously this program won’t have to use a regular expression!</p></li>
<li><p>(*) Gutenburg’s version of Jane Austin’s classic novel <em>Pride and Prejudice</em> may be downloaded from the URL:</p>
<blockquote>
<p><a href="https://www.gutenberg.org/files/1342/1342-0.txt" class="uri">https://www.gutenberg.org/files/1342/1342-0.txt</a></p>
</blockquote>
<p>Your mission is to create a lexicon for Austin’s novel. Follow the pattern of the work done in the text to make a lexicon for <em>The Wizard of Oz</em>. You will have to make different choices, though, about what constitutes a “word”. For example, Austin’s prose is complex and “grown-up”in comparison to the prose of <em>Oz</em>, so the parts of hyphenated words probably constitute valid words in and of themselves. Austin has a habit of concealing certain place-names with dashes, and occasionally in letters to each other Austin’s characters will refer to a person by an initial. Should initials and sequences of dashes count as words? And what about “12th” as in “the 12th of December”? As you examine the text and your initial word list you will have to make decisions about these and other matters.</p>
<p>Write a report in R Markdown in which you create the lexicon. Include the code for all of your work—beginning from the file-download—so that a person who runs all of the code in the document will create the very same lexicon you made. As you develop the lexicon, explain your code and the rationale for your choices about what counts as a “word” in Austin’s novel.</p>
<p>Conclude the report with a data frame of the twenty most common words in Austin’s novel that are more than eight letters long. The frame should have two variables: one for the words and another for the number of occurrences. The frame should be sorted so that the words appear in decreasing order of frequency (i.e., most common word comes first).</p></li>
<li><p>(*) Install the <strong>tidytext</strong> and <strong>gutenbergr</strong> packages. <strong>gutenbergr</strong> simplifies the task of downloading a Project Gutenberg text, stripping off the spurious leading and trailing material. <strong>tidytext</strong> automates a number of basic text-analysis tasks. Read the Vignette in the <strong>gutenberg</strong> packages and learn how to find the words in a text. Find the unique words in <em>The Wizard of Oz</em> as determined by <strong>tidytext</strong>, and use the <code>setdiff()</code> function to compare the <code>ozWords</code> in this Chapter with the word-list according to <strong>tidytext</strong>. What are the primary differences?</p></li>
</ol>
<!--chapter:end:120-files.Rmd-->
</div>
</div>
<div id="functional" class="section level1">
<h1><span class="header-section-number">12</span> Functional Programming in R</h1>

<div class="leadquote">
<p><em>It was simple, but you know, it’s always simple when you’ve done it.</em></p>
—Simone Gabbriellini
</div>

<p>In this Chapter we aren’t going to cover any fundamentally new R powers. Instead we’ll get acquainted with just one aspect of a computer programming paradigm known as <em>functional programming</em>. We will examine a set of R-functions for which functions themselves are supplied as arguments. These functions allow us to accomplish a great deal of computation in rather concise and expressive code. Not only are they useful in R itself, but they help you to reason abstractly about computation and prepare you for functional-programming aspects of other programming languages.</p>

<div id="programming-paradigms" class="section level2">
<h2><span class="header-section-number">12.1</span> Programming Paradigms</h2>
<p>Let us begin by exploring the notion of a <em>programming paradigm</em> in general. We will go on in this Chapter to consider two programming paradigms for which R provides considerable support. In the next Chapter we will consider a third programming paradigm that exists in R.</p>
<p>A <em>programming paradigm</em>  is a way to describe some of the features of programming languages. Often a paradigm includes principles concerning the use of these features, or embodies a view that these features have special importance and utility in good programming practice.</p>
<div id="procedural-programming" class="section level3">
<h3><span class="header-section-number">12.1.1</span> Procedural Programming</h3>
<p>One of the older programming paradigms in existence is <em>procedural programming</em>. It is supported in many popular languages and is often the first paradigm within which beginners learn to program. In fact, if one’s programming does not progress beyond a rudimentary level, one may never become aware that one is working within the procedural paradigm—or any paradigm at all, for that matter.</p>
<p>Before we define procedural programming, let’s illustrate it with an example. Almost any of the programs we have written so far would do as examples; for specificity, let’s consider the following snippet of code that produces from the data frame <code>m111survey</code> a new, smaller frame consisting of just the numerical variables:</p>
<div class="sourceCode" id="cb1471"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1471-1" data-line-number="1"><span class="kw">library</span>(bcscr)</a></code></pre></div>
<div class="sourceCode" id="cb1472"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1472-1" data-line-number="1"><span class="co"># find the numer of columns in the data frame:</span></a>
<a class="sourceLine" id="cb1472-2" data-line-number="2">cols &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">names</span>(m111survey))</a>
<a class="sourceLine" id="cb1472-3" data-line-number="3"><span class="co">#set up a logical vector of length equal to the number of columns:</span></a>
<a class="sourceLine" id="cb1472-4" data-line-number="4">isNumerical &lt;-<span class="st"> </span><span class="kw">logical</span>(cols)</a>
<a class="sourceLine" id="cb1472-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1472-6" data-line-number="6"><span class="co"># loop through.  For each variable, say if it is numerical:</span></a>
<a class="sourceLine" id="cb1472-7" data-line-number="7"><span class="cf">for</span> ( i <span class="cf">in</span> <span class="kw">seq_along</span>(isNumerical) ) {</a>
<a class="sourceLine" id="cb1472-8" data-line-number="8">  isNumerical[i] &lt;-<span class="st"> </span><span class="cf">if</span> (<span class="kw">is.numeric</span>(m111survey[, i])) <span class="ot">TRUE</span> <span class="cf">else</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb1472-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb1472-10" data-line-number="10"></a>
<a class="sourceLine" id="cb1472-11" data-line-number="11"><span class="co"># pick the numerical variables from the data frame</span></a>
<a class="sourceLine" id="cb1472-12" data-line-number="12">numsm111 &lt;-<span class="st"> </span>m111survey[, isNumerical]</a>
<a class="sourceLine" id="cb1472-13" data-line-number="13"><span class="co"># have a look at the result:</span></a>
<a class="sourceLine" id="cb1472-14" data-line-number="14"><span class="kw">str</span>(numsm111)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    71 obs. of  6 variables:
##  $ height         : num  76 74 64 62 72 70.8 70 79 59 67 ...
##  $ ideal_ht       : num  78 76 NA 65 72 NA 72 76 61 67 ...
##  $ sleep          : num  9.5 7 9 7 8 10 4 6 7 7 ...
##  $ fastest        : int  119 110 85 100 95 100 85 160 90 90 ...
##  $ GPA            : num  3.56 2.5 3.8 3.5 3.2 3.1 3.68 2.7 2.8 NA ...
##  $ diff.ideal.act.: num  2 2 NA 3 0 NA 2 -3 2 0 ...</code></pre>
<p>By now there is nothing mysterious about the above code-snippet. What we want to become conscious of is the <em>approach</em> we have taken to the problem of selecting the numerical variables. In particular, observe that:</p>
<ul>
<li>We worked throughout with <em>data</em>, some of which, like <code>m111survey</code>, was given to us and some of which we created on our own to help solve the problem. For example, we created the variable <code>cols</code>. Note also the very helpful index-variable <code>i</code> in the <code>for</code>-loop. We set up the data structure <code>isNumerical</code> in order to hold a set of data (<code>TRUE</code>s and <code>FALSE</code>s).</li>
<li>We relied on various <em>procedures</em> to create data and to manipulate that data in order to produce the desired result. Some of the procedures appeared as special blocks of code—most notably the <code>for</code>-loop, but also the <code>if-else</code> construct within the loop. Other procedures took the form of functions. As we know, a function encapsulates a useful procedure so that it can be easily reused in a wide variety of circumstances, without the user having to know the details of how it works. We know that <code>names()</code> will give us the vector of names of the columns of <code>m111survey</code>, that <code>length()</code> will tell us how many names, there are, that <code>is.numeric()</code> will tell us whether or not a given variable in <code>m111survey</code> is a numerical variable, and so on. The procedures embodied in these functions were written by other folks and we could examine them if we had the time and interest, but for the most part we are content simply to know how to access them.</li>
</ul>
<p><em>Procedural programming</em> is a paradigm that solves problems with programs that can be broken up into collections of variables, data structures and procedures. In this paradigm, there is a sharp distinction between variables and data structures on the one hand and procedures on the other. Variables and data structures are <em>data</em>—they are the “stuff” that a program manipulates to produce other data, other “stuff.” Procedures do the manipulating, turning stuff into other stuff.</p>
</div>
</div>
<div id="the-functional-programming-paradigm" class="section level2">
<h2><span class="header-section-number">12.2</span> The Functional Programming Paradigm</h2>
<p>Let us now turn to the second of the two major programming paradigms that we study in this Chapter: Functional Programming.</p>
<div id="the-ubiquity-of-functions-in-r" class="section level3">
<h3><span class="header-section-number">12.2.1</span> The Ubiquity of Functions in R</h3>
<p>Let’s a bit more closely at our code snippet. Notice how prominently functions figure into it, on nearly every line. In fact, <em>every</em> line calls at least one function! This might seem unbelievable: after all, consider the line below:</p>
<div class="sourceCode" id="cb1474"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1474-1" data-line-number="1">numsm111 &lt;-<span class="st"> </span>m111survey[, isNumerical]</a></code></pre></div>
<p>There don’t appear to be any functions being called, here! But in fact <strong>two</strong> functions get called:</p>
<ol style="list-style-type: decimal">
<li><p>The so-called <em>assignment operator</em> <code>&lt;-</code> is actually a function in disguise: the more official—albeit less readable—form of <code>variable &lt;- value</code> is:</p>
<div class="sourceCode" id="cb1475"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1475-1" data-line-number="1"><span class="st">`</span><span class="dt">&lt;-</span><span class="st">`</span>(variable, value)</a></code></pre></div>
<p>Thus, to assign the value 3 to that variable <code>a</code> one could write:</p>
<div class="sourceCode" id="cb1476"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1476-1" data-line-number="1"><span class="st">`</span><span class="dt">&lt;-</span><span class="st">`</span>(a, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb1476-2" data-line-number="2">a   <span class="co"># check that a is really 3</span></a></code></pre></div>
<pre><code>## [1] 3</code></pre></li>
<li><p>The sub-setting operator for vectors <code>[</code>, more formally known as <em>extraction</em> (see <code>help(Extract)</code>) is also a function. The expression <code>m111survey[, isNumerical]</code> is actually the following function-call in disguise:</p>
<div class="sourceCode" id="cb1478"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1478-1" data-line-number="1"><span class="st">`</span><span class="dt">[</span><span class="st">`</span>(m111survey, isNumerical)</a></code></pre></div></li>
</ol>
<p>Indeed functions are ubiquitous in R. This is part of the significance of the following well-known remark by a developer of S, the precursor-language of R:</p>
<blockquote>
<p>“To understand computations in R, two slogans are helpful:</p>
</blockquote>
<blockquote>
<ul>
<li>Everything that exists is an object.</li>
<li>Everything that happens is a function call.&quot;</li>
</ul>
</blockquote>
<blockquote>
<p>—John Chambers</p>
</blockquote>
<p>The second slogan indicates that functions are everywhere in R. It also corresponds to the first principle of the <em>functional programming</em> paradigm, namely:</p>
<blockquote>
<p>Computation is regarded as the evaluation of functions.</p>
</blockquote>
</div>
<div id="functions-as-first-class-citizens" class="section level3">
<h3><span class="header-section-number">12.2.2</span> Functions as First-Class Citizens</h3>
<p>So functions are ubiquitous in R. Another interesting thing about them is that even though they seem to be associated with procedures—after all, they make things happen—they are, nevertheless, also objects. They are data, or “stuff” if you like.</p>
<p>This may not seem obvious at first. But look at the following code, where you can ask what type of thing a function is:</p>
<div class="sourceCode" id="cb1479"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1479-1" data-line-number="1"><span class="kw">typeof</span>(is.numeric)</a></code></pre></div>
<pre><code>## [1] &quot;builtin&quot;</code></pre>
<p>The so-called “primitive” functions of R—the functions written not in R but in C-code—are “built in” objects. On the other hand, consider this user-defined function:</p>
<div class="sourceCode" id="cb1481"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1481-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="cf">function</span>(x) x<span class="op">+</span><span class="dv">3</span></a>
<a class="sourceLine" id="cb1481-2" data-line-number="2"><span class="kw">typeof</span>(f)</a></code></pre></div>
<pre><code>## [1] &quot;closure&quot;</code></pre>
<p>Functions other than primitive functions are objects of type “closure.”<a href="#fn26" class="footnote-ref" id="fnref26"><sup>26</sup></a></p>
<p>If a function can be a certain type of thing, then it must be a “thing”—an object, something you can manipulate. For example, you can put functions in a list:</p>
<div class="sourceCode" id="cb1483"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1483-1" data-line-number="1">lst &lt;-<span class="st"> </span><span class="kw">list</span>(is.numeric, f)</a>
<a class="sourceLine" id="cb1483-2" data-line-number="2">lst</a></code></pre></div>
<pre><code>## [[1]]
## function (x)  .Primitive(&quot;is.numeric&quot;)
## 
## [[2]]
## function (x) 
## x + 3</code></pre>
<p>Very importantly, you can make functions serve as argument for other functions, and functions can return other functions as their results. The following example demonstrates both of these possibilities.</p>
<div class="sourceCode" id="cb1485"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1485-1" data-line-number="1">cuber &lt;-<span class="st"> </span><span class="cf">function</span>(f) {</a>
<a class="sourceLine" id="cb1485-2" data-line-number="2">  g &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">f</span>(x)<span class="op">^</span><span class="dv">3</span></a>
<a class="sourceLine" id="cb1485-3" data-line-number="3">  g</a>
<a class="sourceLine" id="cb1485-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb1485-5" data-line-number="5">h &lt;-<span class="st"> </span><span class="kw">cuber</span>(abs)</a>
<a class="sourceLine" id="cb1485-6" data-line-number="6"><span class="kw">h</span>(<span class="op">-</span><span class="dv">2</span>)  <span class="co"># returns |-2|^3 = 2^3 = 8</span></a></code></pre></div>
<pre><code>## [1] 8</code></pre>
<p>In fact, in R functions can be treated just like any variable. In computer programming, we say that such functions are <em>first-class citizens</em>.</p>
<p>Although it is not often stated as a separate principle of the functional programming paradigm it is true that in languages that provide support for functional programming, the following principle holds true:</p>
<blockquote>
<p>Functions are first-class citizens.</p>
</blockquote>
</div>
<div id="minimize-side-effects" class="section level3">
<h3><span class="header-section-number">12.2.3</span> Minimize Side Effects</h3>
<p>In the code-snippet under consideration, we note that there are two types of functions:</p>
<ul>
<li>functions that return a value;</li>
<li>functions that provide output to the console or make a change in the Global Environment.</li>
</ul>
<p>Example of the first type of function included:</p>
<ul>
<li><code>length()</code></li>
<li><code>names()</code></li>
<li><code>seq_along()</code></li>
<li><code>is.numeric()</code></li>
<li>the extraction-function <code>`[`()</code></li>
</ul>
<p>A function that produced output to the console was <code>str()</code>.</p>
<p>The assignment function <code>`&lt;-`()</code> added <code>cols</code>, <code>isNumerical</code> and <code>numsm111</code> to the Global Environment, and also made changes to <code>isNumerical</code> in the course of the <code>for</code>-loop.</p>
<p>Of course we have seen examples of functions that do two of these things at once, for example:</p>
<div class="sourceCode" id="cb1487"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1487-1" data-line-number="1">myFun &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1487-2" data-line-number="2">  <span class="kw">cat</span>(<span class="st">&quot;myFun is running!</span><span class="ch">\n</span><span class="st">&quot;</span>)  <span class="co"># output to console</span></a>
<a class="sourceLine" id="cb1487-3" data-line-number="3">  x <span class="op">+</span><span class="st"> </span><span class="dv">3</span>                       <span class="co"># return a value</span></a>
<a class="sourceLine" id="cb1487-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb1487-5" data-line-number="5"><span class="kw">myFun</span>(<span class="dv">6</span>)</a></code></pre></div>
<pre><code>## myFun is running!</code></pre>
<pre><code>## [1] 9</code></pre>
<p>In computer programming, output to the console, along with changes of <em>state</em>—changes to the Global Environment or to the file structure of your computer—are called <em>side-effects</em>. Functions that only return values and do not produce side-effects are called <em>pure</em> functions. </p>
<p>A third principle of the functional programming paradigm is:</p>
<blockquote>
<p>Functions should be pure.</p>
</blockquote>
<p>Now this principle is difficult to adhere to, and in fact if you were to adhere strictly to it in R then your programs would never “do” anything. There do exist quite practical programming languages in which all of the functions are pure—and this leads to some very interesting features such as that the order in which operations are evaluated doesn’t affect what the function returns—but these “purely functional” languages manage purity by having other objects besides functions produce the necessary side-effects. In R we happily let our functions have side-effects: we certainly want to do some assignment, and print things out to the console from time to time.</p>
<p>One way that R does support the third principle of functional programming is that it makes it easy to avoid having your functions modify the Global Environment. To see this consider the following example:</p>
<div class="sourceCode" id="cb1490"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1490-1" data-line-number="1">addThree &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1490-2" data-line-number="2">  heavenlyHash &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb1490-3" data-line-number="3">  x<span class="op">+</span><span class="dv">3</span>  <span class="co"># returns this value</span></a>
<a class="sourceLine" id="cb1490-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb1490-5" data-line-number="5">result &lt;-<span class="st"> </span><span class="kw">addThree</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb1490-6" data-line-number="6">result</a>
<a class="sourceLine" id="cb1490-7" data-line-number="7">heavenlyHash</a></code></pre></div>
<pre><code>## [1] 13
## Error: object &#39;heavenlyHash&#39; not found</code></pre>
<p>This is as we expect: the variable <code>heavenlyHash</code> exists only in the run-time environment that is created in the call to <code>addThree()</code>. As soon as the function finishes execution that environment dies, and <code>heavenlyHash</code> dies long with it. In particular, it never becomes part of the Global Environment.</p>
<p>If you really want you functions to modify the Global Environment—or any environment other than its run-time environment, for that matter—then you have to take special measures. You could, for example, use the super-assignment operator <code>&lt;&lt;-</code>: </p>
<div class="sourceCode" id="cb1492"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1492-1" data-line-number="1">addThreeSideEffect &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1492-2" data-line-number="2">  heavenlyHash &lt;&lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb1492-3" data-line-number="3">  x<span class="op">+</span><span class="dv">3</span>  <span class="co"># returns this value</span></a>
<a class="sourceLine" id="cb1492-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb1492-5" data-line-number="5">result &lt;-<span class="st"> </span><span class="kw">addThreeSideEffect</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb1492-6" data-line-number="6">result</a></code></pre></div>
<pre><code>## [1] 13</code></pre>
<div class="sourceCode" id="cb1494"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1494-1" data-line-number="1">heavenlyHash</a></code></pre></div>
<pre><code>## [1] 5</code></pre>
<p>The super-assignment operator looks for the name <code>heavenlyHash</code> in the parent environment of the run-time environment, If if finds <code>heavenlyHash</code> there then it changes its value to 5 and stops. Otherwise it looks in the next parent up, and so on until it reaches the Global Environment, at which point if it doesn’t find a <code>heavenlyHash</code> it creates one and gives it the value. In the example above, assuming you ran the function from the console, the parent environment is the Global Environment and the function has made a change to it: a side-effect.</p>
<p>Except in the case of explicit assignment functions like <code>`&lt;-`()</code>, changes made by functions to the Global Environment can be quite problematic. After all, we are used to using functions without having to look inside them to see how they do their work. Even if we once wrote the function ourselves, we may not remember how it works, so if it creates side effects we may not remember that it does, and calling them could interfere with other important work that the program is doing. (If the program already has <code>heavenlyHash</code> in the Global Environment and the we call a function that changes it value, we could be in for big trouble.) Accordingly, R supports the third principle of functional programming to the extent of making it easy for you to avoid function calls that change your Global Environment.</p>
</div>
<div id="procedures-as-higher-order-function-calls" class="section level3">
<h3><span class="header-section-number">12.2.4</span> Procedures as Higher-Order Function Calls</h3>
<p>The last principle of the functional programming paradigms that we will state here isn’t really a formal principle: it is really more an indication of the programming style that prevails in languages where functions are first-class objects and that provide other support for functional programming. The final principle is:</p>
<blockquote>
<p>As much as possible, procedures should be accomplished by function calls, In particular, loops should be replaced by calls to higher-order functions.</p>
</blockquote>
<p>A higher-order function is simply a function that takes other functions as arguments. R provides a nice set of higher-order functions, many of which substitute for iterative procedures such as loops. In subsequent sections we will study the some of the most important higher-order functions, and see how they allow us to express some fairly complex procedures in a concise and readable way. You will also see how this style really blurs the distinction—so fundamental to procedural programming—between data and procedures. In functional programming, functions ARE data, and procedures are just function calls.</p>
</div>
<div id="functional-programming-a-summary" class="section level3">
<h3><span class="header-section-number">12.2.5</span> Functional Programming: A Summary</h3>
<p>For our purposes, the principles of the functional programming paradigm are as follows:</p>
<ul>
<li>Computation consists in the evaluation of functions.</li>
<li>Functions are first-class citizens in the language.</li>
<li>Functions should only return values; they should not produce side-effects. (At the very least they should not modify the Global Environment unless they are dedicated to assignment in the first place.)</li>
<li>As much as possible, procedures should be written in terms of function calls. In particular, loops should be replaced by calls to higher-order functions.</li>
</ul>
</div>
</div>
<div id="purrr-higher-order-functions-for-iteration" class="section level2">
<h2><span class="header-section-number">12.3</span> <strong>purrr</strong> Higher-Order Functions for Iteration</h2>
<p>In the remainder of the Chapter we will study important higher-order functions: functions that take a function as an argument and apply that function to each element of another data structure. As we have said previously, such functions often serve as alternatives to loops.</p>
<p>The higher-order functions we study come from the package <strong>purrr</strong>, which is attached whenever we load the tidy-verse.</p>
<div id="map-and-variations" class="section level3">
<h3><span class="header-section-number">12.3.1</span> <code>map()</code> and Variations</h3>
<p>Suppose that we want to generate five vectors, each of which consists of ten numbers randomly chosen between 0 and 1. We accomplish the task with a loop, as follows:</p>
<div class="sourceCode" id="cb1496"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1496-1" data-line-number="1"><span class="co"># set up a list of length 10:</span></a>
<a class="sourceLine" id="cb1496-2" data-line-number="2">lst &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="dt">mode =</span> <span class="st">&quot;list&quot;</span>, <span class="dt">length =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb1496-3" data-line-number="3"><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span> ) {</a>
<a class="sourceLine" id="cb1496-4" data-line-number="4">  lst[[i]] &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb1496-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb1496-6" data-line-number="6"><span class="kw">str</span>(lst)</a></code></pre></div>
<pre><code>## List of 5
##  $ : num [1:10] 0.546 0.271 0.189 0.267 0.956 ...
##  $ : num [1:10] 0.0384 0.5677 0.9629 0.5131 0.0181 ...
##  $ : num [1:10] 0.184 0.268 0.477 0.263 0.107 ...
##  $ : num [1:10] 0.9318 0.2411 0.3267 0.0647 0.1426 ...
##  $ : num [1:10] 0.573 0.364 0.524 0.604 0.119 ...</code></pre>
<p>If we wanted the vectors to have length <span class="math inline">\(1, 4, 9, 16,\)</span> and 25, then we could write:</p>
<div class="sourceCode" id="cb1498"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1498-1" data-line-number="1">lst &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="dt">mode =</span> <span class="st">&quot;list&quot;</span>, <span class="dt">length =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb1498-2" data-line-number="2"><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span> ) {</a>
<a class="sourceLine" id="cb1498-3" data-line-number="3">  lst[[i]] &lt;-<span class="st"> </span><span class="kw">runif</span>(i<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1498-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb1498-5" data-line-number="5"><span class="kw">str</span>(lst)</a></code></pre></div>
<pre><code>## List of 5
##  $ : num 0.647
##  $ : num [1:4] 0.394 0.619 0.477 0.136
##  $ : num [1:9] 0.06738 0.12915 0.39312 0.00258 0.62021 ...
##  $ : num [1:16] 0.409 0.54 0.961 0.654 0.547 ...
##  $ : num [1:25] 0.96407 0.07147 0.95581 0.94798 0.00119 ...</code></pre>
<p>In the first example, the elements in the vector <code>1:5</code> didn’t matter—we wanted a vector of length ten each time—and in the second case the elements in the <code>1:5</code> <em>did</em> matter, in that they determined the lengths of the five vectors produced. Of course in general we could apply <code>runif()</code> to each element of <em>any</em> vector at all, like this:</p>
<div class="sourceCode" id="cb1500"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1500-1" data-line-number="1">vec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">2</span>, <span class="dv">9</span>)</a>
<a class="sourceLine" id="cb1500-2" data-line-number="2">lst &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="dt">mode =</span> <span class="st">&quot;list&quot;</span>, <span class="dt">length =</span> <span class="kw">length</span>(vec))</a>
<a class="sourceLine" id="cb1500-3" data-line-number="3"><span class="cf">for</span> ( i <span class="cf">in</span> <span class="kw">seq_along</span>(vec) ) {</a>
<a class="sourceLine" id="cb1500-4" data-line-number="4">  lst[[i]] &lt;-<span class="st"> </span><span class="kw">runif</span>(vec[i])</a>
<a class="sourceLine" id="cb1500-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb1500-6" data-line-number="6"><span class="kw">str</span>(lst)</a></code></pre></div>
<pre><code>## List of 5
##  $ : num [1:5] 0.647 0.394 0.619 0.477 0.136
##  $ : num [1:7] 0.06738 0.12915 0.39312 0.00258 0.62021 ...
##  $ : num [1:8] 0.826 0.423 0.409 0.54 0.961 ...
##  $ : num [1:2] 0.1968 0.0779
##  $ : num [1:9] 0.818 0.942 0.884 0.166 0.355 ...</code></pre>
<p>If we can apply <code>runif()</code> to each element of a vector, why not apply <em>an arbitrary function</em> to each element? That’s what the function <code>map()</code>  will do for us. The general form of <code>map()</code> is:</p>
<div class="sourceCode" id="cb1502"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1502-1" data-line-number="1"><span class="kw">map</span>(.x, .f, ...)</a></code></pre></div>
<p>In the template above:</p>
<ul>
<li><code>.x</code> can be a list or any atomic vector;</li>
<li><code>.f</code> is a function that is to be applied to each element of <code>.x</code>. In the default operation of <code>map()</code>, each element of <code>.x</code> becomes in turn the <em>first</em> argument of <code>.f</code>.</li>
<li><code>...</code> consists of other arguments that are supplied as arguments for the <code>.f</code> function, in case you have to set other parameters of the function in order to get it to perform in the way you would like.</li>
</ul>
<p>The result is always a list.</p>
<p>With <code>map()</code> we can get the list in our second example as follows:</p>
<div class="sourceCode" id="cb1503"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1503-1" data-line-number="1">howMany &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">2</span>, <span class="dv">9</span>)</a>
<a class="sourceLine" id="cb1503-2" data-line-number="2">lst &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1503-3" data-line-number="3"><span class="st">  </span>howMany <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1503-4" data-line-number="4"><span class="st">  </span><span class="kw">map</span>(runif)</a>
<a class="sourceLine" id="cb1503-5" data-line-number="5"><span class="kw">str</span>(lst)</a></code></pre></div>
<pre><code>## List of 5
##  $ : num [1:5] 0.647 0.394 0.619 0.477 0.136
##  $ : num [1:7] 0.06738 0.12915 0.39312 0.00258 0.62021 ...
##  $ : num [1:8] 0.826 0.423 0.409 0.54 0.961 ...
##  $ : num [1:2] 0.1968 0.0779
##  $ : num [1:9] 0.818 0.942 0.884 0.166 0.355 ...</code></pre>
<p>If we had wanted the random numbers to be between—say—4 and 8, then we would supply extra arguments to <code>runif()</code> as follows:</p>
<div class="sourceCode" id="cb1505"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1505-1" data-line-number="1">lst &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1505-2" data-line-number="2"><span class="st">  </span>howMany <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1505-3" data-line-number="3"><span class="st">  </span><span class="kw">map</span>(runif, <span class="dt">min =</span> <span class="dv">4</span>, <span class="dt">max =</span> <span class="dv">8</span>)</a>
<a class="sourceLine" id="cb1505-4" data-line-number="4"><span class="kw">str</span>(lst)</a></code></pre></div>
<pre><code>## List of 5
##  $ : num [1:5] 6.59 5.58 6.47 5.91 4.54
##  $ : num [1:7] 4.27 4.52 5.57 4.01 6.48 ...
##  $ : num [1:8] 7.3 5.69 5.64 6.16 7.84 ...
##  $ : num [1:2] 4.79 4.31
##  $ : num [1:9] 7.27 7.77 7.54 4.66 5.42 ...</code></pre>
<p>The default behavior of <code>map()</code> is that the <code>.x</code> vector supplies the first argument of <code>.f</code>. However, if some <code>...</code> parameters are supplied then <code>.x</code> substitutes for the first parameter that is not mentioned in <code>...</code>. In the above example, the <code>min</code> and <code>max</code>parameters are the second and third parameters for <code>runif()</code> so <code>.x</code> substitutes for the first parameter—the one that determines how many random numbers will be generated. In the example below, the vector <code>lowerBounds</code> substitutes for <code>min</code>, the second parameter of <code>runif()</code>:</p>
<div class="sourceCode" id="cb1507"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1507-1" data-line-number="1">lowerBounds &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span></a>
<a class="sourceLine" id="cb1507-2" data-line-number="2">lowerBounds <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1507-3" data-line-number="3"><span class="st">  </span><span class="kw">map</span>(runif, <span class="dt">n =</span> <span class="dv">2</span>, <span class="dt">max =</span> <span class="dv">8</span>)</a></code></pre></div>
<pre><code>## [[1]]
## [1] 3.008575 5.964877
## 
## [[2]]
## [1] 6.514459 6.282105
## 
## [[3]]
## [1] 6.688118 7.431739</code></pre>
<p>Sometimes we wish to vary two or more of the parameters of function. In that case we use <code>pmap()</code>. The first parameter of <code>pmap()</code> is named <code>.l</code> and takes a list of vectors (or lists). For example:</p>
<div class="sourceCode" id="cb1509"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1509-1" data-line-number="1">howMany &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb1509-2" data-line-number="2">upperBounds &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb1509-3" data-line-number="3"><span class="kw">list</span>(howMany, upperBounds) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1509-4" data-line-number="4"><span class="st">  </span><span class="kw">pmap</span>(runif, <span class="dt">min =</span> <span class="dv">0</span>)</a></code></pre></div>
<pre><code>## [[1]]
## [1] 0.4142409 0.5140328 0.6190231
## 
## [[2]]
## [1] 0.193564
## 
## [[3]]
## [1] 3.0889976 7.4509632 3.6170952 0.2348365</code></pre>
<p>Observe that <code>pmap()</code> knows to interpret the first element of the input-list—the vector <code>howmany</code> as giving the values of the first argument of <code>runif()</code>. The second parameter of <code>runif()</code> (<code>min</code>) is set at 0, so <code>pmap()</code> deduces that <code>upperBounds</code>—the second element of the input-list—gives the values for the next next parameter in line, the parameter <code>max</code>.</p>
<p>One might just as well use <code>pmap()</code> to vary all three parameters:</p>
<div class="sourceCode" id="cb1511"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1511-1" data-line-number="1">howMany &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb1511-2" data-line-number="2">lowerBounds &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb1511-3" data-line-number="3">upperBounds &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb1511-4" data-line-number="4">args &lt;-<span class="st"> </span><span class="kw">list</span>(howMany, lowerBounds, upperBounds)</a>
<a class="sourceLine" id="cb1511-5" data-line-number="5">args <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1511-6" data-line-number="6"><span class="st">  </span><span class="kw">pmap</span>(runif) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1511-7" data-line-number="7"><span class="st">  </span><span class="kw">str</span>()</a></code></pre></div>
<pre><code>## List of 3
##  $ : num [1:3] -0.00743 -2.35882 -3.90104
##  $ : num 1.01
##  $ : num [1:4] 5.38 9.16 8.45 9.67</code></pre>
<p>The <code>.f</code> parameter can be any function, including one that you define yourself. Here’s an example:</p>
<div class="sourceCode" id="cb1513"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1513-1" data-line-number="1">rLetters &lt;-<span class="st"> </span><span class="cf">function</span>(n, upper) {</a>
<a class="sourceLine" id="cb1513-2" data-line-number="2">  <span class="cf">if</span> ( upper ) {</a>
<a class="sourceLine" id="cb1513-3" data-line-number="3">    <span class="kw">sample</span>(LETTERS, <span class="dt">size =</span> n, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1513-4" data-line-number="4">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb1513-5" data-line-number="5">    <span class="kw">sample</span>(letters, <span class="dt">size =</span> n, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1513-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb1513-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb1513-8" data-line-number="8">n &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>)                <span class="co"># vary number of letters to pick</span></a>
<a class="sourceLine" id="cb1513-9" data-line-number="9">upper &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>)  <span class="co"># vary the case (upper, lower)</span></a>
<a class="sourceLine" id="cb1513-10" data-line-number="10"><span class="kw">list</span>(n, upper) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1513-11" data-line-number="11"><span class="st">  </span><span class="kw">pmap</span>(rLetters)</a></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;U&quot; &quot;D&quot; &quot;C&quot;
## 
## [[2]]
## [1] &quot;j&quot; &quot;a&quot; &quot;s&quot; &quot;d&quot; &quot;m&quot; &quot;k&quot;
## 
## [[3]]
## [1] &quot;S&quot; &quot;S&quot; &quot;R&quot; &quot;A&quot; &quot;V&quot; &quot;P&quot; &quot;A&quot; &quot;N&quot; &quot;B&quot;</code></pre>
<p>You could also set <code>f</code> to be a function that you write on the spot, without even bothering to give it a name:</p>
<div class="sourceCode" id="cb1515"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1515-1" data-line-number="1"><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1515-2" data-line-number="2"><span class="st">  </span><span class="kw">map</span>(<span class="cf">function</span>(x) <span class="kw">runif</span>(<span class="dv">3</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> x))</a></code></pre></div>
<pre><code>## [[1]]
## [1] 0.4170589 0.5614115 0.6146708
## 
## [[2]]
## [1] 1.0992127 0.4576997 0.6006109
## 
## [[3]]
## [1] 1.134999 2.752574 2.083488</code></pre>
<p>In computer programming a function is called <em>anonymous</em> when it is not the value bound to some name. .</p>
<p><code>map()</code> allows a shortcut for defining anonymous functions. The above call could have been written as:</p>
<div class="sourceCode" id="cb1517"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1517-1" data-line-number="1"><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1517-2" data-line-number="2"><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="kw">runif</span>(<span class="dv">3</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> .))</a></code></pre></div>
<pre><code>## [[1]]
## [1] 0.1435887 0.8404723 0.9722919
## 
## [[2]]
## [1] 1.217995 1.631378 1.481980
## 
## [[3]]
## [1] 4.475972 3.900816 4.272925</code></pre>
<p>The <code>~</code> indicates that the body of the function is about to be begin. The <code>.</code> stands for the parameter of the function.</p>
<p>When we introduced <code>map()</code> we said that <code>.x</code> was a vector or a list, In fact <code>.x</code> could be an object that can be coerced into a list. Hence it is quite common to use <code>map()</code> with the data frames: the frame is turned into a list, each element of which is a column of the frame. Here is an example:</p>
<div class="sourceCode" id="cb1519"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1519-1" data-line-number="1"><span class="kw">data</span>(<span class="st">&quot;m111survey&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;bcscr&quot;</span>)</a>
<a class="sourceLine" id="cb1519-2" data-line-number="2">numberNA &lt;-</a>
<a class="sourceLine" id="cb1519-3" data-line-number="3"><span class="st">  </span>m111survey <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1519-4" data-line-number="4"><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="kw">sum</span>(<span class="kw">is.na</span>(.)))</a>
<a class="sourceLine" id="cb1519-5" data-line-number="5"><span class="kw">str</span>(numberNA)</a></code></pre></div>
<pre><code>## List of 12
##  $ height         : int 0
##  $ ideal_ht       : int 2
##  $ sleep          : int 0
##  $ fastest        : int 0
##  $ weight_feel    : int 0
##  $ love_first     : int 0
##  $ extra_life     : int 0
##  $ seat           : int 0
##  $ GPA            : int 1
##  $ enough_Sleep   : int 0
##  $ sex            : int 0
##  $ diff.ideal.act.: int 2</code></pre>
<p>Note that the elements of the returned list inherit the names of the input data frame. This holds for any named input:</p>
<div class="sourceCode" id="cb1521"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1521-1" data-line-number="1">numbers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb1521-2" data-line-number="2"><span class="kw">names</span>(numbers) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;three&quot;</span>, <span class="st">&quot;five&quot;</span>)</a>
<a class="sourceLine" id="cb1521-3" data-line-number="3">numbers <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1521-4" data-line-number="4"><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="kw">runif</span>(<span class="dv">3</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> .))</a></code></pre></div>
<pre><code>## $one
## [1] 0.2331179 0.9318823 0.9580263
## 
## $three
## [1] 2.9757873 1.5267223 0.6133808
## 
## $five
## [1] 0.07197437 4.77782735 3.19760884</code></pre>
<p>When the result can take on a form more simple than a list, it is possible to use variants of <code>map()</code> such as:</p>
<ul>
<li><code>map_int()</code></li>
<li><code>map_dbl()</code></li>
<li><code>map_lgl()</code></li>
<li><code>map_chr()</code></li>
</ul>
<p>Thus we could obtain a named integer vector of the number of <code>NA</code>-values for each variable in <code>m11survey</code> as follows:</p>
<div class="sourceCode" id="cb1523"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1523-1" data-line-number="1">numberNA &lt;-</a>
<a class="sourceLine" id="cb1523-2" data-line-number="2"><span class="st">  </span>m111survey <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1523-3" data-line-number="3"><span class="st">  </span><span class="kw">map_int</span>(<span class="op">~</span><span class="kw">sum</span>(<span class="kw">is.na</span>(.)))</a>
<a class="sourceLine" id="cb1523-4" data-line-number="4">numberNA</a></code></pre></div>
<pre><code>##          height        ideal_ht           sleep         fastest 
##               0               2               0               0 
##     weight_feel      love_first      extra_life            seat 
##               0               0               0               0 
##             GPA    enough_Sleep             sex diff.ideal.act. 
##               1               0               0               2</code></pre>
<p>Here are the types of each variable:</p>
<div class="sourceCode" id="cb1525"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1525-1" data-line-number="1">m111survey <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1525-2" data-line-number="2"><span class="st">  </span><span class="kw">map_chr</span>(typeof)</a></code></pre></div>
<pre><code>##          height        ideal_ht           sleep         fastest 
##        &quot;double&quot;        &quot;double&quot;        &quot;double&quot;       &quot;integer&quot; 
##     weight_feel      love_first      extra_life            seat 
##       &quot;integer&quot;       &quot;integer&quot;       &quot;integer&quot;       &quot;integer&quot; 
##             GPA    enough_Sleep             sex diff.ideal.act. 
##        &quot;double&quot;       &quot;integer&quot;       &quot;integer&quot;        &quot;double&quot;</code></pre>
<p>Here is a statement of whether or not each variable is a factor:</p>
<div class="sourceCode" id="cb1527"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1527-1" data-line-number="1">m111survey <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1527-2" data-line-number="2"><span class="st">  </span><span class="kw">map_lgl</span>(is.factor)</a></code></pre></div>
<pre><code>##          height        ideal_ht           sleep         fastest 
##           FALSE           FALSE           FALSE           FALSE 
##     weight_feel      love_first      extra_life            seat 
##            TRUE            TRUE            TRUE            TRUE 
##             GPA    enough_Sleep             sex diff.ideal.act. 
##           FALSE            TRUE            TRUE           FALSE</code></pre>
</div>
<div id="walk-and-variations" class="section level3">
<h3><span class="header-section-number">12.3.2</span> <code>walk()</code> and Variations</h3>
<p><code>walk()</code> is similar to <code>map()</code>, but is used when we are interested in producing side-effects. It applies its <code>.f</code> argument to each element of <code>.x</code> is was given, but also returns the <code>.x</code> in case we want to pipe it int some other function.</p>
<p>Here we use <code>walk()</code> only for its side-effect: we re-write a familiar function to print a pattern to the Console without using a loop.</p>
<div class="sourceCode" id="cb1529"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1529-1" data-line-number="1">pattern &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">char =</span> <span class="st">&quot;*&quot;</span>, <span class="dt">n =</span> <span class="dv">5</span>) {</a>
<a class="sourceLine" id="cb1529-2" data-line-number="2">  lineLength &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span>n, (n<span class="dv">-1</span>)<span class="op">:</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1529-3" data-line-number="3">  theLine &lt;-<span class="st"> </span><span class="cf">function</span>(char, n) {</a>
<a class="sourceLine" id="cb1529-4" data-line-number="4">    <span class="kw">cat</span>(<span class="kw">rep</span>(char, <span class="dt">times =</span> n), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb1529-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb1529-6" data-line-number="6">  lineLength <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">walk</span>(theLine, <span class="dt">char =</span> char)</a>
<a class="sourceLine" id="cb1529-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb1529-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1529-9" data-line-number="9"><span class="kw">pattern</span>(<span class="dt">char =</span> <span class="st">&quot;a&quot;</span>, <span class="dt">n =</span> <span class="dv">7</span>)</a></code></pre></div>
<pre><code>## a
## aa
## aaa
## aaaa
## aaaaa
## aaaaaa
## aaaaaaa
## aaaaaa
## aaaaa
## aaaa
## aaa
## aa
## a</code></pre>
<p>The next example illustrates the use of the return-value of <code>walk()</code>. We would like to save plots of all numerical variables from the data frame <code>m111survey</code>, and also print summaries of them to the Console.</p>
<p>First we create a directory to hold the plots:</p>
<div class="sourceCode" id="cb1531"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1531-1" data-line-number="1"><span class="cf">if</span> ( <span class="op">!</span><span class="kw">dir.exists</span>(<span class="st">&quot;plots&quot;</span>) ) <span class="kw">dir.create</span>(<span class="st">&quot;plots&quot;</span>)</a></code></pre></div>
<p>Next, we get the names of the numerical variables in <code>m111survey</code>:</p>
<div class="sourceCode" id="cb1532"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1532-1" data-line-number="1">numNames &lt;-</a>
<a class="sourceLine" id="cb1532-2" data-line-number="2"><span class="st">  </span>m111survey <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1532-3" data-line-number="3"><span class="st">  </span><span class="kw">keep</span>(is.numeric) <span class="op">%&gt;%</span><span class="st">   </span><span class="co"># purrr::keep()</span></a>
<a class="sourceLine" id="cb1532-4" data-line-number="4"><span class="st">  </span><span class="kw">names</span>()</a></code></pre></div>
<p>We used <code>purrr::keep()</code>, which retains only the elements of its input <code>.x</code> such that the <code>.f</code> function returns <code>TRUE</code>.</p>
<p>We need a function to save the density plot of a single numerical variable:</p>
<div class="sourceCode" id="cb1533"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1533-1" data-line-number="1">saveGraph &lt;-<span class="st"> </span><span class="cf">function</span>(var, varname) {</a>
<a class="sourceLine" id="cb1533-2" data-line-number="2">  p &lt;-</a>
<a class="sourceLine" id="cb1533-3" data-line-number="3"><span class="st">    </span><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="ot">NULL</span>, <span class="kw">aes</span>(<span class="dt">x =</span> var)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1533-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&quot;burlywood&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1533-5" data-line-number="5"><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="kw">paste0</span>(<span class="st">&quot;Density plot for &quot;</span>,</a>
<a class="sourceLine" id="cb1533-6" data-line-number="6">                        varname, <span class="st">&quot;.&quot;</span>))</a>
<a class="sourceLine" id="cb1533-7" data-line-number="7">  <span class="kw">ggsave</span>(<span class="dt">filename =</span> <span class="kw">paste0</span>(<span class="st">&quot;plots/density_&quot;</span>, varname, <span class="st">&quot;.png&quot;</span>),</a>
<a class="sourceLine" id="cb1533-8" data-line-number="8">         <span class="dt">plot =</span> p, <span class="dt">device =</span> <span class="st">&quot;png&quot;</span>)</a>
<a class="sourceLine" id="cb1533-9" data-line-number="9">}</a></code></pre></div>
<p>We also need a function to produce a summary of a single numerical variable:</p>
<div class="sourceCode" id="cb1534"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1534-1" data-line-number="1">makeSummary &lt;-<span class="st"> </span><span class="cf">function</span>(x, varname) {</a>
<a class="sourceLine" id="cb1534-2" data-line-number="2">  five &lt;-<span class="st"> </span><span class="kw">fivenum</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1534-3" data-line-number="3">  <span class="kw">list</span>(<span class="dt">variable =</span> varname,</a>
<a class="sourceLine" id="cb1534-4" data-line-number="4">       <span class="dt">min =</span> five[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb1534-5" data-line-number="5">       <span class="dt">Q1 =</span> five[<span class="dv">2</span>],</a>
<a class="sourceLine" id="cb1534-6" data-line-number="6">       <span class="dt">median =</span> five[<span class="dv">3</span>],</a>
<a class="sourceLine" id="cb1534-7" data-line-number="7">       <span class="dt">Q3 =</span> five[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1534-8" data-line-number="8">       <span class="dt">max =</span> five[<span class="dv">5</span>])</a>
<a class="sourceLine" id="cb1534-9" data-line-number="9">}</a></code></pre></div>
<p>Now we walk through the process. We will actually use the function<code>walk2()</code>, which takes the following inputs:</p>
<ul>
<li><code>.x</code> (the data frame consisting of the numerical variables) and</li>
<li><code>.y</code> (the names of these variables)</li>
<li><code>.f</code> (the function <code>saveGraph</code>, to make and save a density plot)</li>
</ul>
<p>We also use <code>pmap_dfr()</code>, which takes a list consisting of the data frame and variable-names and constructs a data frame row-by-row, with each row summarizing one of the variables.</p>
<div class="sourceCode" id="cb1535"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1535-1" data-line-number="1">m111survey <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1535-2" data-line-number="2"><span class="st">  </span><span class="kw">keep</span>(is.numeric) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1535-3" data-line-number="3"><span class="st">  </span><span class="kw">walk2</span>(<span class="dt">.y =</span> numNames,</a>
<a class="sourceLine" id="cb1535-4" data-line-number="4">        <span class="dt">.f =</span> saveGraph) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># returns the df of numerical variables</span></a>
<a class="sourceLine" id="cb1535-5" data-line-number="5"><span class="st">  </span><span class="kw">list</span>(., numNames) <span class="op">%&gt;%</span><span class="st">      </span><span class="co"># creating the list (df, numNames)</span></a>
<a class="sourceLine" id="cb1535-6" data-line-number="6"><span class="st">  </span><span class="kw">pmap_dfr</span>(makeSummary)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##          variable   min    Q1  median     Q3   max
##             &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1          height  51.0  65.0  68.000  71.75    79
## 2        ideal_ht  54.0  67.0  68.000  75.00    90
## 3           sleep   2.0   5.0   7.000   7.00    10
## 4         fastest  60.0  90.5 102.000 119.50   190
## 5             GPA   1.9   2.9   3.225   3.56     4
## 6 diff.ideal.act.  -4.0   0.0   2.000   3.00    18</code></pre>
<p>Check the <code>plots</code> directory; it should contain these files:</p>
<ul>
<li><code>density_diff.ideal.act.png</code></li>
<li><code>density_fastest.png</code></li>
<li><code>density.GPA.png</code></li>
<li><code>density_height.png</code></li>
<li><code>density_ideal_ht.png</code></li>
<li><code>density_sleep.png</code></li>
</ul>
</div>
<div id="practice-exercises-28" class="section level3">
<h3><span class="header-section-number">12.3.3</span> Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Use <code>map()</code> to produce a list of the squares of the whole numbers from 1 to 10.</p></li>
<li><p>Use <code>map_dbl()</code> to produce a numerical vector of the squares of the whole numbers from 1 to 10.</p></li>
<li><p>Use <code>map_chr</code> to state the type of each element of the following list:</p>
<div class="sourceCode" id="cb1537"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1537-1" data-line-number="1">lst &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb1537-2" data-line-number="2">  letters,</a>
<a class="sourceLine" id="cb1537-3" data-line-number="3">  <span class="kw">seq</span>(<span class="dv">2</span>, <span class="dv">20</span>, <span class="dt">by =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb1537-4" data-line-number="4">  <span class="kw">c</span>(1L, 5L, 7L),</a>
<a class="sourceLine" id="cb1537-5" data-line-number="5">  <span class="dv">1</span><span class="op">:</span><span class="dv">10</span> <span class="op">&gt;</span><span class="st"> </span><span class="fl">5.5</span></a>
<a class="sourceLine" id="cb1537-6" data-line-number="6">)</a></code></pre></div></li>
<li><p>Here are some people:</p>
<div class="sourceCode" id="cb1538"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1538-1" data-line-number="1">people &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Bettina&quot;</span>, <span class="st">&quot;Raj&quot;</span>, <span class="st">&quot;Isabella&quot;</span>, <span class="st">&quot;Khalil&quot;</span>)</a></code></pre></div>
<p>The following vector tells whether or not each person is a Grand Poo-Bah:</p>
<div class="sourceCode" id="cb1539"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1539-1" data-line-number="1">status &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;humble&quot;</span>, <span class="st">&quot;poobah&quot;</span>, <span class="st">&quot;poobah&quot;</span>, <span class="st">&quot;humble&quot;</span>)</a></code></pre></div>
<p>Use <code>pwalk()</code> to properly greet each person. The result in the console should be as follows:</p>
<pre><code>## Yo, dawg.
## Hail, O Grand Poo-Bah Raj!
## Hail, O Grand Poo-Bah Isabella!
## Yo, dawg.</code></pre></li>
</ol>
</div>
<div id="solutions-to-the-practice-exercises-12" class="section level3">
<h3><span class="header-section-number">12.3.4</span> Solutions to the Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Try this:</p>
<div class="sourceCode" id="cb1541"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1541-1" data-line-number="1"><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="op">~</span>.<span class="op">^</span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [[1]]
## [1] 1
## 
## [[2]]
## [1] 4
## 
## [[3]]
## [1] 9
## 
## [[4]]
## [1] 16
## 
## [[5]]
## [1] 25
## 
## [[6]]
## [1] 36
## 
## [[7]]
## [1] 49
## 
## [[8]]
## [1] 64
## 
## [[9]]
## [1] 81
## 
## [[10]]
## [1] 100</code></pre>
<p>This is more verbose, but works just as well:</p>
<div class="sourceCode" id="cb1543"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1543-1" data-line-number="1"><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="cf">function</span>(x) x<span class="op">^</span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [[1]]
## [1] 1
## 
## [[2]]
## [1] 4
## 
## [[3]]
## [1] 9
## 
## [[4]]
## [1] 16
## 
## [[5]]
## [1] 25
## 
## [[6]]
## [1] 36
## 
## [[7]]
## [1] 49
## 
## [[8]]
## [1] 64
## 
## [[9]]
## [1] 81
## 
## [[10]]
## [1] 100</code></pre></li>
<li><p>Try this:</p>
<div class="sourceCode" id="cb1545"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1545-1" data-line-number="1"><span class="kw">map_dbl</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="op">~</span>.<span class="op">^</span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>##  [1]   1   4   9  16  25  36  49  64  81 100</code></pre>
<p>Again the more verbose approach works just as well:</p>
<div class="sourceCode" id="cb1547"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1547-1" data-line-number="1"><span class="kw">map_dbl</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="cf">function</span>(x) x<span class="op">^</span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>##  [1]   1   4   9  16  25  36  49  64  81 100</code></pre></li>
<li><p>Try this:</p>
<div class="sourceCode" id="cb1549"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1549-1" data-line-number="1"><span class="kw">map_chr</span>(lst, typeof)</a></code></pre></div>
<pre><code>## [1] &quot;character&quot; &quot;double&quot;    &quot;integer&quot;   &quot;logical&quot;</code></pre></li>
<li><p>Try this:</p>
<div class="sourceCode" id="cb1551"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1551-1" data-line-number="1"><span class="kw">list</span>(people, status) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1551-2" data-line-number="2"><span class="st">  </span><span class="kw">pwalk</span>(<span class="cf">function</span>(person, type) {</a>
<a class="sourceLine" id="cb1551-3" data-line-number="3">    <span class="cf">if</span> ( type <span class="op">==</span><span class="st"> &quot;poobah&quot;</span> ) {</a>
<a class="sourceLine" id="cb1551-4" data-line-number="4">      <span class="kw">cat</span>(<span class="st">&quot;Hail, O Grand Poo-Bah &quot;</span>,</a>
<a class="sourceLine" id="cb1551-5" data-line-number="5">          person, <span class="st">&quot;!</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb1551-6" data-line-number="6">    } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb1551-7" data-line-number="7">      <span class="kw">cat</span>(<span class="st">&quot;Yo, dawg.</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb1551-8" data-line-number="8">    }</a>
<a class="sourceLine" id="cb1551-9" data-line-number="9">  })</a></code></pre></div></li>
</ol>
</div>
</div>
<div id="other-purr-higher-order-functions" class="section level2">
<h2><span class="header-section-number">12.4</span> Other <strong>purr</strong> Higher-Order Functions</h2>
<div id="keep-and-discard" class="section level3">
<h3><span class="header-section-number">12.4.1</span> <code>keep()</code> and <code>discard()</code></h3>
<p><code>keep()</code> is similar to <strong>dplyr</strong>’s <code>filter()</code>, but whereas <code>filter()</code> chooses rows of a data frame based on a given conditions, <code>keep()</code> chooses the elements of the input list or vector <code>.x</code> based on a condition named <code>.p</code>.</p>
<p>Examples:</p>
<div class="sourceCode" id="cb1552"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1552-1" data-line-number="1"><span class="co"># keep the numbers that are 1 more than a multiple of 3</span></a>
<a class="sourceLine" id="cb1552-2" data-line-number="2"><span class="dv">1</span><span class="op">:</span><span class="dv">20</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1552-3" data-line-number="3"><span class="st">  </span><span class="kw">keep</span>(<span class="dt">.p =</span> <span class="op">~</span><span class="st"> </span>. <span class="op">%%</span><span class="st"> </span><span class="dv">3</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1]  1  4  7 10 13 16 19</code></pre>
<div class="sourceCode" id="cb1554"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1554-1" data-line-number="1"><span class="co"># keep the factors in m111survey</span></a>
<a class="sourceLine" id="cb1554-2" data-line-number="2">m111survey <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1554-3" data-line-number="3"><span class="st">  </span><span class="kw">keep</span>(is.factor) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1554-4" data-line-number="4"><span class="st">  </span><span class="kw">str</span>()</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    71 obs. of  6 variables:
##  $ weight_feel : Factor w/ 3 levels &quot;1_underweight&quot;,..: 1 2 2 1 1 3 2 2 2 3 ...
##  $ love_first  : Factor w/ 2 levels &quot;no&quot;,&quot;yes&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ extra_life  : Factor w/ 2 levels &quot;no&quot;,&quot;yes&quot;: 2 2 1 1 2 1 2 2 2 1 ...
##  $ seat        : Factor w/ 3 levels &quot;1_front&quot;,&quot;2_middle&quot;,..: 1 2 2 1 3 1 1 3 3 2 ...
##  $ enough_Sleep: Factor w/ 2 levels &quot;no&quot;,&quot;yes&quot;: 1 1 1 1 1 2 1 2 1 2 ...
##  $ sex         : Factor w/ 2 levels &quot;female&quot;,&quot;male&quot;: 2 2 1 1 2 2 2 2 1 1 ...</code></pre>
<p><code>discard(.x,, . p = condition)</code> is equivalent to <code>keep(.x, .p = !condition)</code>. Thus:</p>
<div class="sourceCode" id="cb1556"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1556-1" data-line-number="1"><span class="co"># discard numbers that are 1 more than a multiple of 3</span></a>
<a class="sourceLine" id="cb1556-2" data-line-number="2"><span class="dv">1</span><span class="op">:</span><span class="dv">20</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1556-3" data-line-number="3"><span class="st">  </span><span class="kw">discard</span>(<span class="dt">.p =</span> <span class="op">~</span><span class="st"> </span>. <span class="op">%%</span><span class="st"> </span><span class="dv">3</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>##  [1]  2  3  5  6  8  9 11 12 14 15 17 18 20</code></pre>
<div class="sourceCode" id="cb1558"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1558-1" data-line-number="1"><span class="co"># discard the factors in m111survey</span></a>
<a class="sourceLine" id="cb1558-2" data-line-number="2">m111survey <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1558-3" data-line-number="3"><span class="st">  </span><span class="kw">discard</span>(is.factor) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1558-4" data-line-number="4"><span class="st">  </span><span class="kw">str</span>()</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    71 obs. of  6 variables:
##  $ height         : num  76 74 64 62 72 70.8 70 79 59 67 ...
##  $ ideal_ht       : num  78 76 NA 65 72 NA 72 76 61 67 ...
##  $ sleep          : num  9.5 7 9 7 8 10 4 6 7 7 ...
##  $ fastest        : int  119 110 85 100 95 100 85 160 90 90 ...
##  $ GPA            : num  3.56 2.5 3.8 3.5 3.2 3.1 3.68 2.7 2.8 NA ...
##  $ diff.ideal.act.: num  2 2 NA 3 0 NA 2 -3 2 0 ...</code></pre>
</div>
<div id="reduce" class="section level3">
<h3><span class="header-section-number">12.4.2</span> <code>reduce()</code></h3>
<p>Another important member of the <strong>purrr</strong> family is <code>reduce()</code> . Given a vector <code>.x</code> and a function <code>.f</code> that takes two inputs, <code>reduce()</code> does the following:</p>
<ul>
<li>applies <code>f</code> to elements 1 and 2 of <code>.x</code>, getting a result;</li>
<li>applies <code>f</code> to the result and to element 3 of <code>.x</code>, getting another result;</li>
<li>applies <code>f</code> to this new result and to element 4 of <code>.x</code>, getting yet another result …</li>
<li>… and so on until all of the elements of <code>.x</code> have been exhausted.</li>
<li>then <code>reduce()</code> returns the final result in the above series of operations.</li>
</ul>
<p>For example, suppose that you want to add up the elements of the vector:</p>
<div class="sourceCode" id="cb1560"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1560-1" data-line-number="1">vec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">6</span>)</a></code></pre></div>
<p>Of course you could just use:</p>
<div class="sourceCode" id="cb1561"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1561-1" data-line-number="1"><span class="kw">sum</span>(vec)</a></code></pre></div>
<pre><code>## [1] 14</code></pre>
<p>After all, <code>sum()</code> has been written to apply to many elements at once. But what if addition could only be done two numbers at a time? How might you proceed? You could:</p>
<ul>
<li>add the 3 and 1 of (the first two elements of <code>vec</code>), getting 4;</li>
<li>then add 4 to 4, the third element of <code>vec</code>, getting 8;</li>
<li>then add 8 to 6, the final element of <code>vec</code>, getting 14;</li>
<li>then return 14.</li>
</ul>
<p><code>reduce()</code> operates in this way.</p>
<div class="sourceCode" id="cb1563"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1563-1" data-line-number="1">vec <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1563-2" data-line-number="2"><span class="st">  </span><span class="kw">reduce</span>(<span class="dt">.f =</span> sum)</a></code></pre></div>
<pre><code>## [1] 14</code></pre>
<p>Hence a common application of <code>reduce</code> is to take an operation that is defined on only two items and extend it to operate on any number of items. Consider, for example, the function <code>intersect()</code>, , which will find the intersection of any two vectors of the same type:</p>
<div class="sourceCode" id="cb1565"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1565-1" data-line-number="1">vec1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb1565-2" data-line-number="2">vec2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">-4</span>)</a>
<a class="sourceLine" id="cb1565-3" data-line-number="3"><span class="kw">intersect</span>(vec1, vec2)</a></code></pre></div>
<pre><code>## [1] 4 6</code></pre>
<p>You cannot intersect three or more vectors at once:</p>
<div class="sourceCode" id="cb1567"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1567-1" data-line-number="1"><span class="kw">intersect</span>(vec1, vec2, <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">9</span>))</a></code></pre></div>
<pre><code>## Error in base::intersect(x, y, ...) : unused argument (c(4, 7, 9))</code></pre>
<p>With <code>reduce()</code> you can intersect as many vectors as you like, provided that they are first stored in a list.</p>
<div class="sourceCode" id="cb1569"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1569-1" data-line-number="1">lst &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&quot;Akash&quot;</span>, <span class="st">&quot;Bipan&quot;</span>, <span class="st">&quot;Chandra&quot;</span>, <span class="st">&quot;Devadatta&quot;</span>, <span class="st">&quot;Raj&quot;</span>),</a>
<a class="sourceLine" id="cb1569-2" data-line-number="2">            <span class="kw">c</span>(<span class="st">&quot;Raj&quot;</span>, <span class="st">&quot;Vikram&quot;</span>, <span class="st">&quot;Sita&quot;</span>, <span class="st">&quot;Akash&quot;</span>, <span class="st">&quot;Chandra&quot;</span>),</a>
<a class="sourceLine" id="cb1569-3" data-line-number="3">            <span class="kw">c</span>(<span class="st">&quot;Akash&quot;</span>, <span class="st">&quot;Raj&quot;</span>, <span class="st">&quot;Chandra&quot;</span>, <span class="st">&quot;Bipan&quot;</span>, <span class="st">&quot;Lila&quot;</span>),</a>
<a class="sourceLine" id="cb1569-4" data-line-number="4">            <span class="kw">c</span>(<span class="st">&quot;Akash&quot;</span>, <span class="st">&quot;Vikram&quot;</span>, <span class="st">&quot;Devadata&quot;</span>, <span class="st">&quot;Raj&quot;</span>, <span class="st">&quot;Lila&quot;</span>))</a>
<a class="sourceLine" id="cb1569-5" data-line-number="5">lst <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1569-6" data-line-number="6"><span class="st">  </span><span class="kw">reduce</span>(intersect)</a></code></pre></div>
<pre><code>## [1] &quot;Akash&quot; &quot;Raj&quot;</code></pre>
<p><code>reduce()</code> can take an argument called <code>.init</code>. When this argument is given a value, operation begins by applying to <code>.f</code> to <code>.init</code> and the first element of <code>.x</code>.</p>
<p>Let’s apply <code>reduce()</code> with <code>.init</code> to the task of making a <em>truth table</em>: the set of all <span class="math inline">\(2^n\)</span> logical vectors of a given length <span class="math inline">\(n\)</span>.</p>
<p>The set <span class="math inline">\(S_1\)</span> of vectors of length <span class="math inline">\(n = 1\)</span> consists of only two vectors:</p>
<pre><code>##           
## vec1  TRUE
## vec2 FALSE</code></pre>
<p>Now consider a systematic way to construct the set <span class="math inline">\(S_2\)</span> of all the vectors of length two. We know that there are four such vectors:</p>
<pre><code>##                 
## vec1  TRUE  TRUE
## vec2  TRUE FALSE
## vec3 FALSE  TRUE
## vec4 FALSE FALSE</code></pre>
<p>Observe that the first two of them begin with <code>TRUE</code> and end with the set <span class="math inline">\(S_1\)</span> of vectors of length one:</p>
<pre><code>##                
## vec1 TRUE  TRUE
## vec2 TRUE FALSE</code></pre>
<p>The last two of them begin with <code>FALSE</code> and <em>also</em> end with <span class="math inline">\(S_1\)</span>:</p>
<pre><code>##                 
## vec3 FALSE  TRUE
## vec4 FALSE FALSE</code></pre>
<p>Now consider <span class="math inline">\(S_3\)</span>, the set of all eight vectors of length three:</p>
<pre><code>##                       
## vec1  TRUE  TRUE  TRUE
## vec2  TRUE  TRUE FALSE
## vec3  TRUE FALSE  TRUE
## vec4  TRUE FALSE FALSE
## vec5 FALSE  TRUE  TRUE
## vec6 FALSE  TRUE FALSE
## vec7 FALSE FALSE  TRUE
## vec8 FALSE FALSE FALSE</code></pre>
<p>Observe that the first four of them end begin with <code>TRUE</code> and and with the vectors of <span class="math inline">\(S_2\)</span>:</p>
<pre><code>##                      
## vec1 TRUE  TRUE  TRUE
## vec2 TRUE  TRUE FALSE
## vec3 TRUE FALSE  TRUE
## vec4 TRUE FALSE FALSE</code></pre>
<p>The last four of them begin with <code>FALSE</code> and <em>also</em> end with the vectors of <span class="math inline">\(S_2\)</span>:</p>
<pre><code>##                       
## vec5 FALSE  TRUE  TRUE
## vec6 FALSE  TRUE FALSE
## vec7 FALSE FALSE  TRUE
## vec8 FALSE FALSE FALSE</code></pre>
<p>The pattern is now clear. If for any <span class="math inline">\(m \ge 1\)</span> you are in possession of the <span class="math inline">\(2^m \times m\)</span> matrix <span class="math inline">\(S_m\)</span> of all possible vectors of length <span class="math inline">\(m\)</span>, then to obtain the <span class="math inline">\(2^{m+1} \times (m+1)\)</span> matrix <span class="math inline">\(S_{m+1}\)</span> of all possible vectors of length <span class="math inline">\(m+1\)</span> you should:</p>
<ul>
<li>stack <span class="math inline">\(2^m\)</span> <code>TRUE</code>s on top of <span class="math inline">\(2^m\)</span> <code>FALSE</code>s, creating a <span class="math inline">\(2^{m+1} \times 1\)</span> matrix <span class="math inline">\(U\)</span>;</li>
<li>stack the <span class="math inline">\(S_m\)</span> underneath itself, creating a <span class="math inline">\(2^{m+1} \times m\)</span> matrix <span class="math inline">\(V\)</span>;</li>
<li>place <span class="math inline">\(U\)</span> next to <span class="math inline">\(V\)</span>.</li>
</ul>
<p><code>reduce()</code> with <code>.init</code> set to <span class="math inline">\(S_1\)</span> is appropriate for this iterative building process. Here is an implementation:</p>
<div class="sourceCode" id="cb1578"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1578-1" data-line-number="1">makeTable &lt;-<span class="st"> </span><span class="cf">function</span>(n, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb1578-2" data-line-number="2">  <span class="co"># make .init (S_1)</span></a>
<a class="sourceLine" id="cb1578-3" data-line-number="3">  s1 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>), <span class="dt">nrow =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1578-4" data-line-number="4">  <span class="kw">rownames</span>(s1) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;vec1&quot;</span>, <span class="st">&quot;vec2&quot;</span>)</a>
<a class="sourceLine" id="cb1578-5" data-line-number="5">  <span class="kw">colnames</span>(s1) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb1578-6" data-line-number="6">  </a>
<a class="sourceLine" id="cb1578-7" data-line-number="7">  <span class="co"># make .f</span></a>
<a class="sourceLine" id="cb1578-8" data-line-number="8">  buildNext &lt;-<span class="st"> </span><span class="cf">function</span>(accum, value) {</a>
<a class="sourceLine" id="cb1578-9" data-line-number="9">    <span class="cf">if</span> ( verbose ) {</a>
<a class="sourceLine" id="cb1578-10" data-line-number="10">      <span class="kw">cat</span>(<span class="st">&quot;On value &quot;</span>, value, </a>
<a class="sourceLine" id="cb1578-11" data-line-number="11">          <span class="st">&quot; with accumalated material:&quot;</span>,</a>
<a class="sourceLine" id="cb1578-12" data-line-number="12">          <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb1578-13" data-line-number="13">      <span class="kw">print</span>(accum)</a>
<a class="sourceLine" id="cb1578-14" data-line-number="14">    }</a>
<a class="sourceLine" id="cb1578-15" data-line-number="15">    <span class="cf">if</span> ( value <span class="op">==</span><span class="st"> </span><span class="dv">1</span> ) <span class="kw">return</span>(accum)</a>
<a class="sourceLine" id="cb1578-16" data-line-number="16">    r &lt;-<span class="st"> </span><span class="kw">nrow</span>(accum)</a>
<a class="sourceLine" id="cb1578-17" data-line-number="17">    u &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="ot">TRUE</span>, <span class="dt">times =</span> r),</a>
<a class="sourceLine" id="cb1578-18" data-line-number="18">           <span class="kw">rep</span>(<span class="ot">FALSE</span>, <span class="dt">times =</span> r))</a>
<a class="sourceLine" id="cb1578-19" data-line-number="19">    v &lt;-<span class="st"> </span><span class="kw">rbind</span>(accum, accum)</a>
<a class="sourceLine" id="cb1578-20" data-line-number="20">    nextMatrix &lt;-<span class="st"> </span><span class="kw">cbind</span>(u, v)</a>
<a class="sourceLine" id="cb1578-21" data-line-number="21">    <span class="kw">colnames</span>(nextMatrix) &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;&quot;</span>, <span class="dt">times =</span> value)</a>
<a class="sourceLine" id="cb1578-22" data-line-number="22">    <span class="kw">rownames</span>(nextMatrix) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;vec&quot;</span>, <span class="dv">1</span><span class="op">:</span>(<span class="dv">2</span><span class="op">^</span>value), <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb1578-23" data-line-number="23">    <span class="cf">if</span> ( verbose ) {</a>
<a class="sourceLine" id="cb1578-24" data-line-number="24">      <span class="kw">cat</span>(<span class="st">&quot;Finishing value&quot;</span>, value, </a>
<a class="sourceLine" id="cb1578-25" data-line-number="25">          <span class="st">&quot;, and I&#39;ve built:&quot;</span>,</a>
<a class="sourceLine" id="cb1578-26" data-line-number="26">          <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb1578-27" data-line-number="27">      <span class="kw">print</span>(nextMatrix)</a>
<a class="sourceLine" id="cb1578-28" data-line-number="28">      <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb1578-29" data-line-number="29">    }</a>
<a class="sourceLine" id="cb1578-30" data-line-number="30">    nextMatrix</a>
<a class="sourceLine" id="cb1578-31" data-line-number="31">  }</a>
<a class="sourceLine" id="cb1578-32" data-line-number="32">  </a>
<a class="sourceLine" id="cb1578-33" data-line-number="33">  <span class="co"># build from .init to the final product S_n</span></a>
<a class="sourceLine" id="cb1578-34" data-line-number="34">  <span class="kw">reduce</span>(<span class="dt">.x =</span> <span class="dv">1</span><span class="op">:</span>n, <span class="dt">.f =</span> buildNext, <span class="dt">.init =</span> s1)</a>
<a class="sourceLine" id="cb1578-35" data-line-number="35">}</a></code></pre></div>
<p>We have included a <code>verbose</code> option so we can watch the process as it unfolds.</p>
<p>Note also that the parameters for the <code>.f</code> function are named:</p>
<ul>
<li><code>acc</code> (what has been “accumulated” up to the current step), and</li>
<li><code>value</code> (the value of <code>.x</code> at the current step).</li>
</ul>
<p>It’s conventional to give these or similar names to the parameters of the building-function.</p>
<p>Let’s try it out:</p>
<div class="sourceCode" id="cb1579"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1579-1" data-line-number="1"><span class="kw">makeTable</span>(<span class="dv">3</span>, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## On value 1 with accumalated material:          
## vec1  TRUE
## vec2 FALSE
## On value 2 with accumalated material:          
## vec1  TRUE
## vec2 FALSE
## Finishing value2, and I&#39;ve built:                
## vec1  TRUE  TRUE
## vec2  TRUE FALSE
## vec3 FALSE  TRUE
## vec4 FALSE FALSE
## 
## 
## On value 3 with accumalated material:                
## vec1  TRUE  TRUE
## vec2  TRUE FALSE
## vec3 FALSE  TRUE
## vec4 FALSE FALSE
## Finishing value3, and I&#39;ve built:                      
## vec1  TRUE  TRUE  TRUE
## vec2  TRUE  TRUE FALSE
## vec3  TRUE FALSE  TRUE
## vec4  TRUE FALSE FALSE
## vec5 FALSE  TRUE  TRUE
## vec6 FALSE  TRUE FALSE
## vec7 FALSE FALSE  TRUE
## vec8 FALSE FALSE FALSE</code></pre>
<pre><code>##                       
## vec1  TRUE  TRUE  TRUE
## vec2  TRUE  TRUE FALSE
## vec3  TRUE FALSE  TRUE
## vec4  TRUE FALSE FALSE
## vec5 FALSE  TRUE  TRUE
## vec6 FALSE  TRUE FALSE
## vec7 FALSE FALSE  TRUE
## vec8 FALSE FALSE FALSE</code></pre>
<p>Of course in practice we would not turn on the <code>verbose</code> option:</p>
<div class="sourceCode" id="cb1582"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1582-1" data-line-number="1"><span class="kw">makeTable</span>(<span class="dv">4</span>)</a></code></pre></div>
<pre><code>##                              
## vec1   TRUE  TRUE  TRUE  TRUE
## vec2   TRUE  TRUE  TRUE FALSE
## vec3   TRUE  TRUE FALSE  TRUE
## vec4   TRUE  TRUE FALSE FALSE
## vec5   TRUE FALSE  TRUE  TRUE
## vec6   TRUE FALSE  TRUE FALSE
## vec7   TRUE FALSE FALSE  TRUE
## vec8   TRUE FALSE FALSE FALSE
## vec9  FALSE  TRUE  TRUE  TRUE
## vec10 FALSE  TRUE  TRUE FALSE
## vec11 FALSE  TRUE FALSE  TRUE
## vec12 FALSE  TRUE FALSE FALSE
## vec13 FALSE FALSE  TRUE  TRUE
## vec14 FALSE FALSE  TRUE FALSE
## vec15 FALSE FALSE FALSE  TRUE
## vec16 FALSE FALSE FALSE FALSE</code></pre>
</div>
<div id="practice-exercises-29" class="section level3">
<h3><span class="header-section-number">12.4.3</span> Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>The operator <code>*</code> (multiplication) is really a function:</p>
<div class="sourceCode" id="cb1584"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1584-1" data-line-number="1"><span class="st">`</span><span class="dt">*</span><span class="st">`</span>(<span class="dv">3</span>,<span class="dv">5</span>)</a></code></pre></div>
<pre><code>## [1] 15</code></pre>
<p>But it can only multiply two numbers at once. The R-function <code>prod()</code> cna handle as many numbers as you like:</p>
<div class="sourceCode" id="cb1586"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1586-1" data-line-number="1"><span class="kw">prod</span>(<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">2</span>,<span class="dv">7</span>)</a></code></pre></div>
<pre><code>## [1] 210</code></pre>
<p>Use <code>reduce()</code> and <code>*</code> to write your own function <code>product()</code> that takes a numerical vector <code>vec</code> and returns the product of the elements of the vector. It should work liek this:</p>
<div class="sourceCode" id="cb1588"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1588-1" data-line-number="1"><span class="kw">product</span>(<span class="dt">vec =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>))</a></code></pre></div>
<pre><code>## [1] 60</code></pre>
<p>(<strong>Hint</strong>: in the call to <code>reduce()</code> you will have to the refer to the <code>*</code>-function as <code>`*`</code>.)</p></li>
<li><p>Modify the function <code>product()</code> so that it in a single call to <code>reduce()</code> it multiplies the number 2 by the product of the elements of <code>vec</code>. (<strong>Hint</strong>: set <code>.init</code> to an appropriate value.)</p></li>
<li><p>The data frame <strong>iris</strong> gives information on 150 irises. Use <code>keep()</code> to create a new data frame that includes only the numerical variables having a mean greater than 3.5.</p></li>
</ol>
</div>
<div id="solutions-to-the-practice-exercises-13" class="section level3">
<h3><span class="header-section-number">12.4.4</span> Solutions to the Practice Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Try this:</p>
<div class="sourceCode" id="cb1590"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1590-1" data-line-number="1">product &lt;-<span class="st"> </span><span class="cf">function</span>(vec) {</a>
<a class="sourceLine" id="cb1590-2" data-line-number="2">  <span class="kw">reduce</span>(vec, <span class="dt">.f =</span> <span class="st">`</span><span class="dt">*</span><span class="st">`</span>)</a>
<a class="sourceLine" id="cb1590-3" data-line-number="3">}</a></code></pre></div></li>
<li><p>Try this:</p>
<div class="sourceCode" id="cb1591"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1591-1" data-line-number="1">product &lt;-<span class="st"> </span><span class="cf">function</span>(vec) {</a>
<a class="sourceLine" id="cb1591-2" data-line-number="2">  <span class="kw">reduce</span>(vec, <span class="dt">.f =</span> <span class="st">`</span><span class="dt">*</span><span class="st">`</span>, <span class="dt">.init =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1591-3" data-line-number="3">}</a></code></pre></div></li>
<li><p>Try this:</p>
<div class="sourceCode" id="cb1592"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1592-1" data-line-number="1">bigIris &lt;-</a>
<a class="sourceLine" id="cb1592-2" data-line-number="2"><span class="st">  </span>iris <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1592-3" data-line-number="3"><span class="st">  </span><span class="kw">keep</span>(is.numeric) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1592-4" data-line-number="4"><span class="st">  </span><span class="kw">keep</span>(<span class="op">~</span><span class="kw">mean</span>(.) <span class="op">&gt;</span><span class="st"> </span><span class="fl">3.5</span>)</a>
<a class="sourceLine" id="cb1592-5" data-line-number="5"><span class="kw">str</span>(bigIris)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    150 obs. of  2 variables:
##  $ Sepal.Length: num  5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...
##  $ Petal.Length: num  1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...</code></pre>
<p>The following does not work. Why?</p>
<div class="sourceCode" id="cb1594"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1594-1" data-line-number="1">bigIris &lt;-</a>
<a class="sourceLine" id="cb1594-2" data-line-number="2"><span class="st">  </span>iris <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1594-3" data-line-number="3"><span class="st">  </span><span class="kw">keep</span>(<span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1594-4" data-line-number="4">    <span class="kw">is.numeric</span>(x) <span class="op">&amp;</span><span class="st"> </span><span class="kw">mean</span>(x) <span class="op">&gt;</span><span class="st"> </span><span class="fl">3.5</span></a>
<a class="sourceLine" id="cb1594-5" data-line-number="5">  })</a>
<a class="sourceLine" id="cb1594-6" data-line-number="6"><span class="er">}</span></a></code></pre></div></li>
</ol>
</div>
</div>
<div id="functionals-vs.loops" class="section level2">
<h2><span class="header-section-number">12.5</span> Functionals vs. Loops</h2>
<p>The higher-order functions we have studied in this chapter are often called <em>functionals.</em> As we pointed out earlier, they deliver results that could have been produced by a writing a loop of some sort.</p>
<p>Once you get used to functionals, you will find that they are often more “expressive” than loops—easier for others to read and to understand, and less prone to bugs. Also, many of them are optimized by the developers of R to run a bit faster than an ordinary loop written in R.</p>
<p>For example, consider the following list. It consists of ten thousand vectors, each of which contains 100 randomly-generated numbers.</p>
<div class="sourceCode" id="cb1595"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1595-1" data-line-number="1">lst &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="kw">rep</span>(<span class="dv">100</span>, <span class="dv">10000</span>), runif)</a></code></pre></div>
<p>If we want the mean of each vector, we could write a loop:</p>
<div class="sourceCode" id="cb1596"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1596-1" data-line-number="1">means &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="dv">10000</span>)</a>
<a class="sourceLine" id="cb1596-2" data-line-number="2"><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10000</span> ) {</a>
<a class="sourceLine" id="cb1596-3" data-line-number="3">  means[i] &lt;-<span class="st"> </span><span class="kw">mean</span>(lst[[i]])</a>
<a class="sourceLine" id="cb1596-4" data-line-number="4">}</a></code></pre></div>
<p>Or we could use <code>map_dbl()</code>:</p>
<div class="sourceCode" id="cb1597"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1597-1" data-line-number="1">means &lt;-<span class="st"> </span><span class="kw">map_dbl</span>(lst, mean)</a></code></pre></div>
<p>Comparing the two using <code>system.time()</code> , on my machine I got:</p>
<div class="sourceCode" id="cb1598"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1598-1" data-line-number="1"><span class="kw">system.time</span>(means &lt;-<span class="st"> </span><span class="kw">map_dbl</span>(lst, mean))</a></code></pre></div>
<pre><code>##   user  system elapsed 
##  1.557   0.073   1.630 </code></pre>
<p>For the loop, I get:</p>
<div class="sourceCode" id="cb1600"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1600-1" data-line-number="1"><span class="kw">system.time</span>({</a>
<a class="sourceLine" id="cb1600-2" data-line-number="2">  means &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="dv">10000</span>)</a>
<a class="sourceLine" id="cb1600-3" data-line-number="3">  <span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10000</span> ) {</a>
<a class="sourceLine" id="cb1600-4" data-line-number="4">    means[i] &lt;-<span class="st"> </span><span class="kw">mean</span>(lst[[i]])</a>
<a class="sourceLine" id="cb1600-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb1600-6" data-line-number="6">})</a></code></pre></div>
<pre><code>##   user  system elapsed 
##  1.653   0.075   1.730 </code></pre>
<p>The map-function is a bit faster, but the difference is small.</p>
<p>Remember also that vectorization is <em>much</em> faster than looping, and is also usually quite expressive, so don’t struggle to take a functional approach when vectorization is possible. (This advice applies to a several examples from this Chapter, in which the desired computations had already been accomplished in earlier chapters by some form of vectorization.)</p>
</div>
<div id="conclusion" class="section level2">
<h2><span class="header-section-number">12.6</span> Conclusion</h2>
<p>In this Chapter we have concentrated on only a single aspect of the Functional Programming paradigm: exploiting the fact that functions are first-class citizens in R, we studied a number of higher-order functions that can substitute for loops. There is certainly a great deal more to Functional Programming than the mere avoidance of loops, but we’ll end our study at this point. Familiarity with higher-order functions will stand you in good stead when you begin, in subsequent courses on web programming, to learn the JavaScript language. JavaScript makes constant use of higher-order functions!</p>

</div>
<div id="glossary-9" class="section level2 unnumbered">
<h2>Glossary</h2>
<dl>
<dt>Programming Paradigm </dt>
<dd><p>A <em>programming paradigm</em> is a way to describe some of the features of programming languages. Often a paradigm includes principles concerning the use of these features, or embodies a view that these features have special importance and utility in good programming practice.</p>
</dd>
<dt>Procedural Programming </dt>
<dd><p>A programming paradigm that solves problems with programs that can be broken up into collections of variables, data structures and procedures. This paradigm, tends to draw a sharp distinction between variables and data structures on the one hand and procedures on the other.</p>
</dd>
<dt>Functional Programming </dt>
<dd><p>A programming paradigm that stresses the central role of functions. Some of its basic principles are:</p>
<ul>
<li>Computation consists in the evaluation of functions.</li>
<li>Functions are first-class citizens in the language.</li>
<li>Functions should only return values; they should not produce side-effects.</li>
<li>As much as possible, procedures should be written in terms of function calls.</li>
</ul>
</dd>
<dt>Pure Function </dt>
<dd><p>A function that does not produce side-effects.</p>
</dd>
<dt>Side Effect </dt>
<dd><p>A change in the state of the program (i.e., a change in the Global Environment) or any interaction external to the program (i.e., printing to the console).</p>
</dd>
<dt>Higher-Order Function </dt>
<dd><p>A function that takes another function as an argument.</p>
</dd>
<dt>Anonymous Function </dt>
<dd><p>A function that does not have a name.</p>
</dd>
<dt>Refactoring </dt>
<dd><p>The act of rewriting computer code so that it performs the same task as before, but in a different way. (This is usually done to make the code more human-readable or to make it perform the task more quickly.)</p>
</dd>
</dl>

</div>
<div id="exercises-8" class="section level2 unnumbered">
<h2>Exercises</h2>
<p><img src="images/thinking.png" width="50%" style="display: block; margin: auto;" /></p>
<ol style="list-style-type: decimal">
<li><p>Explain in words what the following line of code produces when given a numerical vector <code>y</code>:</p>
<div class="sourceCode" id="cb1602"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1602-1" data-line-number="1"><span class="kw">map</span>(y, <span class="cf">function</span>(x) x<span class="op">^</span><span class="dv">3</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<p>In the course of your explanation, say whether the result is a vector or a list.</p></li>
<li><p>Which do you think works faster for a given numerical vector <code>y</code>? This code:</p>
<div class="sourceCode" id="cb1603"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1603-1" data-line-number="1"><span class="kw">map</span>(y, <span class="cf">function</span>(x) <span class="kw">sqrt</span>(x))</a></code></pre></div>
<p>Or this code?</p>
<div class="sourceCode" id="cb1604"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1604-1" data-line-number="1">  <span class="kw">sqrt</span>(y)</a></code></pre></div>
<p>Justify your answer with a convincing example, using <code>system.time()</code>. What moral do you draw from this?</p></li>
<li><p>To <em>refactor</em> computer code is to rewrite the code so that it does the same thing, but in a different way. We might refactor code in order to make it more readable by humans, or to make it perform its task more quickly.</p>
<p>Refactor the following code so that it uses <code>keep()</code> instead of a loop:</p>
<div class="sourceCode" id="cb1605"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1605-1" data-line-number="1">df &lt;-<span class="st"> </span>bcscr<span class="op">::</span>m111survey</a>
<a class="sourceLine" id="cb1605-2" data-line-number="2">keepVariable &lt;-<span class="st"> </span><span class="kw">logical</span>(<span class="kw">length</span>(<span class="kw">names</span>(df)))</a>
<a class="sourceLine" id="cb1605-3" data-line-number="3"><span class="cf">for</span> ( col <span class="cf">in</span> <span class="kw">seq_along</span>(keepVariable) ) {</a>
<a class="sourceLine" id="cb1605-4" data-line-number="4">  var &lt;-<span class="st"> </span>df[, col]</a>
<a class="sourceLine" id="cb1605-5" data-line-number="5">  isNumeric &lt;-<span class="st"> </span><span class="kw">is.numeric</span>(var)</a>
<a class="sourceLine" id="cb1605-6" data-line-number="6">  allThere &lt;-<span class="st"> </span><span class="op">!</span><span class="kw">any</span>(<span class="kw">is.na</span>(var))</a>
<a class="sourceLine" id="cb1605-7" data-line-number="7">  keepVariable[col] &lt;-<span class="st"> </span>isNumeric <span class="op">&amp;&amp;</span><span class="st"> </span>allThere</a>
<a class="sourceLine" id="cb1605-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb1605-9" data-line-number="9">newFrame &lt;-<span class="st"> </span>df[, keepVariable]</a>
<a class="sourceLine" id="cb1605-10" data-line-number="10"><span class="kw">head</span>(newFrame)</a></code></pre></div></li>
<li><p>The following function produces a list of vectors of uniform random numbers, where the lower and upper bounds of the numbers are given by the arguments to the parameters <code>lower</code> and <code>upper</code> respectively, and the number of vectors in the list and the number of random numbers in each vector are given by a vector supplied to the parameter <code>vecs</code>.</p>
<div class="sourceCode" id="cb1606"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1606-1" data-line-number="1">randomSims &lt;-<span class="st"> </span><span class="cf">function</span>(vecs, <span class="dt">lower =</span> <span class="dv">0</span>, <span class="dt">upper=</span> <span class="dv">1</span>, <span class="dt">seed =</span> <span class="ot">NULL</span>) {</a>
<a class="sourceLine" id="cb1606-2" data-line-number="2">  <span class="co"># set seed if none is provided by the user</span></a>
<a class="sourceLine" id="cb1606-3" data-line-number="3">  <span class="cf">if</span> ( <span class="op">!</span><span class="kw">is.null</span>(seed) ) {</a>
<a class="sourceLine" id="cb1606-4" data-line-number="4">    <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb1606-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb1606-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1606-7" data-line-number="7">  lst &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="dt">mode =</span> <span class="st">&quot;list&quot;</span>, <span class="dt">length =</span> <span class="kw">length</span>(vecs))</a>
<a class="sourceLine" id="cb1606-8" data-line-number="8">  <span class="cf">for</span> ( i <span class="cf">in</span> <span class="kw">seq_along</span>(vecs) ) {</a>
<a class="sourceLine" id="cb1606-9" data-line-number="9">    lst[[i]] &lt;-<span class="st"> </span><span class="kw">runif</span>(vecs[i], <span class="dt">min =</span> lower, <span class="dt">max =</span> upper)</a>
<a class="sourceLine" id="cb1606-10" data-line-number="10">  }</a>
<a class="sourceLine" id="cb1606-11" data-line-number="11">  lst</a>
<a class="sourceLine" id="cb1606-12" data-line-number="12">}</a></code></pre></div>
<p>Refactor the code for <code>randomSims()</code> so that it uses <code>map()</code> instead of a loop.</p></li>
<li><p>The following enhanced version of <code>randomSims()</code> is even more flexible, as it allows both the upper and lower limits for the randomly-generated numbers to vary with each vector of numbers that is produced.</p>
<div class="sourceCode" id="cb1607"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1607-1" data-line-number="1">randomSims2 &lt;-<span class="st"> </span><span class="cf">function</span>(vecs, lower, upper, <span class="dt">seed =</span> <span class="ot">NULL</span>) {</a>
<a class="sourceLine" id="cb1607-2" data-line-number="2">  <span class="co"># validate input</span></a>
<a class="sourceLine" id="cb1607-3" data-line-number="3">  <span class="cf">if</span> (<span class="op">!</span>(<span class="kw">length</span>(vecs) <span class="op">==</span><span class="st"> </span><span class="kw">length</span>(upper) <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">length</span>(upper) <span class="op">==</span><span class="st"> </span><span class="kw">length</span>(lower)) ) {</a>
<a class="sourceLine" id="cb1607-4" data-line-number="4">    <span class="kw">return</span>(<span class="kw">cat</span>(<span class="st">&quot;All vectors entered must have the same length.&quot;</span>))</a>
<a class="sourceLine" id="cb1607-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb1607-6" data-line-number="6">  <span class="cf">if</span> ( <span class="kw">any</span>(upper <span class="op">&lt;</span><span class="st"> </span>lower) ) {</a>
<a class="sourceLine" id="cb1607-7" data-line-number="7">    <span class="kw">return</span>(<span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot;Every upper bound must be at least as &quot;</span>,</a>
<a class="sourceLine" id="cb1607-8" data-line-number="8">                      <span class="st">&quot;big as the corresponding lower bound.&quot;</span>)))</a>
<a class="sourceLine" id="cb1607-9" data-line-number="9">  }</a>
<a class="sourceLine" id="cb1607-10" data-line-number="10">  <span class="co"># set seed if none is provided by the user</span></a>
<a class="sourceLine" id="cb1607-11" data-line-number="11">  <span class="cf">if</span> ( <span class="op">!</span><span class="kw">is.null</span>(seed) ) {</a>
<a class="sourceLine" id="cb1607-12" data-line-number="12">    <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb1607-13" data-line-number="13">  }</a>
<a class="sourceLine" id="cb1607-14" data-line-number="14"></a>
<a class="sourceLine" id="cb1607-15" data-line-number="15">  lst &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="dt">mode =</span> <span class="st">&quot;list&quot;</span>, <span class="dt">length =</span> <span class="kw">length</span>(vecs))</a>
<a class="sourceLine" id="cb1607-16" data-line-number="16">  <span class="cf">for</span> ( i <span class="cf">in</span> <span class="kw">seq_along</span>(vecs) ) {</a>
<a class="sourceLine" id="cb1607-17" data-line-number="17">    lst[[i]] &lt;-<span class="st"> </span><span class="kw">runif</span>(vecs[i], <span class="dt">min =</span> lower[i], <span class="dt">max =</span> upper[i])</a>
<a class="sourceLine" id="cb1607-18" data-line-number="18">  }</a>
<a class="sourceLine" id="cb1607-19" data-line-number="19">  lst</a>
<a class="sourceLine" id="cb1607-20" data-line-number="20">}</a></code></pre></div>
<p>Use <code>pmap()</code> to refactor the code for <code>randomSims2()</code> so as to avoid using the loop.</p></li>
<li><p>Supposing that <code>y</code> is a numerical vector, explain in words what the following code produces:</p>
<div class="sourceCode" id="cb1608"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1608-1" data-line-number="1">y <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">keep</span>(<span class="cf">function</span>(x) x <span class="op">&gt;=</span><span class="st"> </span><span class="dv">4</span>)</a></code></pre></div></li>
<li><p>Write a line of code using the sub-setting operator <code>[</code> that produces the same result as the code in the previous problem.</p></li>
<li><p>Use <code>keep()</code> to write a function called <code>oddMembers()</code> that, given any numerical vector, returns a vector containing the odd numbers of the given vector. Your function should take a single argument called <code>vec</code>, the given vector. A typical example of use would be as follows:</p>
<div class="sourceCode" id="cb1609"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1609-1" data-line-number="1"><span class="kw">oddMembers</span>(<span class="dt">vec =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</a></code></pre></div>
<pre><code>## [1] 1 3 5 7 9</code></pre></li>
<li><p>You are given the following list of character vectors:</p>
<div class="sourceCode" id="cb1611"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1611-1" data-line-number="1">   lst &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&quot;Akash&quot;</span>, <span class="st">&quot;Bipan&quot;</span>, <span class="st">&quot;Chandra&quot;</span>, <span class="st">&quot;Devadatta&quot;</span>, <span class="st">&quot;Raj&quot;</span>),</a>
<a class="sourceLine" id="cb1611-2" data-line-number="2">        <span class="kw">c</span>(<span class="st">&quot;Raj&quot;</span>, <span class="st">&quot;Vikram&quot;</span>, <span class="st">&quot;Sita&quot;</span>, <span class="st">&quot;Akash&quot;</span>, <span class="st">&quot;Chandra&quot;</span>),</a>
<a class="sourceLine" id="cb1611-3" data-line-number="3">        <span class="kw">c</span>(<span class="st">&quot;Akash&quot;</span>, <span class="st">&quot;Raj&quot;</span>, <span class="st">&quot;Chandra&quot;</span>, <span class="st">&quot;Bipan&quot;</span>, <span class="st">&quot;Lila&quot;</span>),</a>
<a class="sourceLine" id="cb1611-4" data-line-number="4">        <span class="kw">c</span>(<span class="st">&quot;Akash&quot;</span>, <span class="st">&quot;Vikram&quot;</span>, <span class="st">&quot;Devadatta&quot;</span>, <span class="st">&quot;Raj&quot;</span>, <span class="st">&quot;Lila&quot;</span>))</a></code></pre></div>
<p>Use <code>reduce()</code> and the <code>union()</code> function to obtain a character vector that is the union of all the vectors in <code>lst</code>.</p></li>
<li><p>Remember the function <code>subStrings()</code> from the exercises of the Chapter on Strings? Refactor it so that it does EXACTLY the same thing but makes no use of loops.</p></li>
<li><p>(*) Run the following code to see what it does. Then analyse the code and explain in detail how it works. Along the way you will have to study some unfamiliar R-functions.</p>
<div class="sourceCode" id="cb1612"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1612-1" data-line-number="1">dataDir &lt;-<span class="st"> &quot;datafiles&quot;</span></a>
<a class="sourceLine" id="cb1612-2" data-line-number="2"><span class="cf">if</span> ( <span class="op">!</span><span class="kw">dir.exists</span>(dataDir) ) <span class="kw">dir.create</span>(dataDir)</a>
<a class="sourceLine" id="cb1612-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1612-4" data-line-number="4">urls &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb1612-5" data-line-number="5">  <span class="st">&quot;https://data.cityofnewyork.us/api/views/25th-nujf/rows.csv&quot;</span>,</a>
<a class="sourceLine" id="cb1612-6" data-line-number="6">  <span class="st">&quot;https://data.seattle.gov/api/views/cf52-s8er/rows.csv&quot;</span>,</a>
<a class="sourceLine" id="cb1612-7" data-line-number="7">  <span class="st">&quot;https://data.ct.gov/api/views/kbxi-4ia7/rows.csv&quot;</span></a>
<a class="sourceLine" id="cb1612-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb1612-9" data-line-number="9"></a>
<a class="sourceLine" id="cb1612-10" data-line-number="10">fileNameFrags &lt;-</a>
<a class="sourceLine" id="cb1612-11" data-line-number="11"><span class="st">  </span>urls <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1612-12" data-line-number="12"><span class="st">  </span><span class="kw">str_match</span>(<span class="st">&quot;data</span><span class="ch">\\</span><span class="st">.(</span><span class="ch">\\</span><span class="st">w+)</span><span class="ch">\\</span><span class="st">.&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1612-13" data-line-number="13"><span class="st">  </span>.[, <span class="dv">2</span>]</a>
<a class="sourceLine" id="cb1612-14" data-line-number="14"></a>
<a class="sourceLine" id="cb1612-15" data-line-number="15">processFiles &lt;-<span class="st"> </span><span class="cf">function</span>(url, frag) {</a>
<a class="sourceLine" id="cb1612-16" data-line-number="16">  csvDest &lt;-<span class="st"> </span><span class="kw">file.path</span>(dataDir,</a>
<a class="sourceLine" id="cb1612-17" data-line-number="17">                       <span class="kw">paste0</span>(frag, <span class="st">&quot;.csv&quot;</span>))</a>
<a class="sourceLine" id="cb1612-18" data-line-number="18">  <span class="kw">download.file</span>(url, csvDest)</a>
<a class="sourceLine" id="cb1612-19" data-line-number="19">  <span class="kw">assign</span>(frag, <span class="kw">read_csv</span>(csvDest))</a>
<a class="sourceLine" id="cb1612-20" data-line-number="20">  <span class="kw">do.call</span>(</a>
<a class="sourceLine" id="cb1612-21" data-line-number="21">    save,</a>
<a class="sourceLine" id="cb1612-22" data-line-number="22">    <span class="dt">args =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb1612-23" data-line-number="23">      frag,</a>
<a class="sourceLine" id="cb1612-24" data-line-number="24">      <span class="dt">file =</span> <span class="kw">file.path</span>(</a>
<a class="sourceLine" id="cb1612-25" data-line-number="25">        dataDir,</a>
<a class="sourceLine" id="cb1612-26" data-line-number="26">        <span class="kw">paste0</span>(frag, <span class="st">&quot;.rda&quot;</span>))))</a>
<a class="sourceLine" id="cb1612-27" data-line-number="27">}</a>
<a class="sourceLine" id="cb1612-28" data-line-number="28"></a>
<a class="sourceLine" id="cb1612-29" data-line-number="29"><span class="kw">list</span>(urls, fileNameFrags) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1612-30" data-line-number="30"><span class="st">  </span><span class="kw">pwalk</span>(processFiles)</a></code></pre></div></li>
</ol>
<!--chapter:end:130-functional.Rmd-->
</div>
</div>
<div id="oo" class="section level1">
<h1><span class="header-section-number">13</span> Object-Oriented Programming in R</h1>

<div class="leadquote">
<p>repeat {</p>
<p>    coffeeMug$drinkFrom()</p>
<p>    workTask$execute()</p>
<p>    if ( coffeeMug$empty() ) {</p>
<p>        if ( coffeePot$empty() ) {</p>
<p>            coffeePot$make()</p>
<p>        }</p>
<p>        coffeeMug$fill()</p>
<p>    }</p>
<p>    if ( workTask$done() ) {</p>
<p>        break</p>
<p>    }</p>
<p>}</p>
</div>

<p>Our journey with R began in the Procedural Programming paradigm. In the last Chapter we learned about R’s extensive support for the more modern paradigm known as Functional Programming. In the present Chapter we will explore the ways in which R supports a third modern programming paradigm: Object-Oriented Programming.</p>

<div id="the-object-oriented-programming-paradigm" class="section level2">
<h2><span class="header-section-number">13.1</span> The Object-Oriented Programming Paradigm</h2>
<p>We started out with Procedural Programming, which draws a distinction between data and procedures. Data provides our information, and procedures solve problems by manipulating data into new forms. </p>
<p>Functional Programming puts functions at the center of attention.  As much as possible, procedures are wrapped up in function calls, and by their status as first-class citizens (data) functions become king. Everything that happens is a result of function calls on data–where the data can include other functions.</p>
<p>You could say that Object-Oriented Programming  reverses the point of view, attempting to put objects–conceived as complex forms of data–at the center of attention.</p>
<p>There are two major types of Object-Oriented (OO) Programming:</p>
<ul>
<li><strong>Message-Passing OO</strong></li>
<li><strong>Generic-Function OO</strong></li>
</ul>
<p>Message-Passing OO is the type of OO Programming that programmers usually associate with the term “object-oriented”, and since it is the type that you will meet most frequently in other languages that support OO-programming we will discuss it first. Generic-Function OO is actually the older type of OO Programming. Although it is very important for understanding some aspects of how R works, it is met with less frequently in other major programming languages, so we will defer discussion of it until Section @ref(generic-function-oo). Accordingly, the following introductory remarks pertain only to message-passing OO.</p>
<p>Objects in the world about us are indeed complex entities: they have particular features. Some of these features they have in virtue of the kind of object that they are, and others are features–<em>attributes</em>–that they have on their own, as individuals. And they can do various things. Again, some of the things they do are things that they do simply because of the kind of thing they are, and others things they do might be unique to them. </p>
<p>Consider a typical object: my dog, for example. He has various attributes: his name is Beau, he has four legs, he weighs about 50 pounds, his hair is black. And he does various things—he has various <em>methods</em>, let’s say, for making his way through life. For example, when we are out of the house he lies in the sofa, when we are home he lies on the floor. He barks. He eats. He annoys cats. </p>
<p>Some of his attributes and methods Beau has simply in virtue of being the kind of thing that he is. He is, after all, a dog—a member of the class Dog, let’s say—and so like all other dogs he will have four legs and he will be able to bark and to annoy cats. Of course all dogs are animals—members of the more general class Animal, let’s say—and all animals eat, so as an animal Beau <em>inherits</em> the method known as eating. Of course all animals are material beings—members of the even-more general class Being, let’s say—and all beings have a weight, and thus Beau has a weight, but the particular value of that weight—50 pounds—is determined by the way he has lived his life thus far. Other dogs, animals and material beings have a weight, but they won’t necessarily have the same weight as Beau.</p>
<p>What emerges from this discussion is an (admittedly oversimplified) view of the world as a collection of complex objects. These objects are related to one another in systematic ways–related closely when they are, for instance, both Dogs, and more more distantly, as when one is a Dog and another is a Cat. And these objects can act on themselves and on each other in various ways, through their methods.</p>
<p>The idea of Object-Oriented Programming is that since we are so used to viewing the <em>world</em> as a collection of objects that are constituted of various attributes and methods and that are related to one another through membership in classes of varying levels of generality, then it might help us to be able to view a <em>computer program</em> similarly—as a collection of objects thus constituted and thus related to one another.</p>
<p>Like many other modern programming languages, R provides considerable support for the Object-Oriented paradigm. In fact it provides that support in two different formats:</p>
<ul>
<li>Reference Classes</li>
<li>R6 Classes</li>
</ul>
<p>Reference Classes are a relatively recent introduction to R. R6 Classes are a simple and lightweight version of Reference Classes. They are not a part of the core of R—they are enabled by a contributed R-package—but they are quite useful as an introduction to object-oriented programming. Accordingly, we will work with them in this Chapter.</p>
</div>
<div id="reference-classes-with-package-r6" class="section level2">
<h2><span class="header-section-number">13.2</span> Reference Classes with Package R6</h2>
<p>The package <strong>R6</strong> <span class="citation">(Chang <a href="#ref-R-R6">2017</a>)</span> provides access to R6 classes. You will need to attach it:</p>
<div class="sourceCode" id="cb1613"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1613-1" data-line-number="1"><span class="kw">library</span>(R6)</a></code></pre></div>
<p>We’ll get started by creating a miniature computerized world of objects that is based on characters from the Wizard of Oz.</p>
<div id="defining-a-class" class="section level3">
<h3><span class="header-section-number">13.2.1</span> Defining a Class</h3>
<p>Construction of the object-world begins with the definition of classes. A <em>class</em> is simply a general prototype on the basis of which actual objects may be created.</p>
<p>Let’s define the class <code>Person</code>. This is accomplished with the <code>R6Class()</code> function: </p>
<div class="sourceCode" id="cb1614"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1614-1" data-line-number="1">Person &lt;-<span class="st"> </span><span class="kw">R6Class</span>(<span class="dt">classname =</span> <span class="st">&quot;Person&quot;</span>,</a>
<a class="sourceLine" id="cb1614-2" data-line-number="2">                  <span class="dt">public =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb1614-3" data-line-number="3">                    <span class="dt">name =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb1614-4" data-line-number="4">                    <span class="dt">age =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb1614-5" data-line-number="5">                    <span class="dt">desire =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb1614-6" data-line-number="6">                    <span class="dt">initialize =</span> <span class="cf">function</span>(<span class="dt">name =</span> <span class="ot">NA</span>, <span class="dt">age =</span> <span class="ot">NA</span>, <span class="dt">desire =</span> <span class="ot">NA</span>) {</a>
<a class="sourceLine" id="cb1614-7" data-line-number="7">                      self<span class="op">$</span>name &lt;-<span class="st"> </span>name</a>
<a class="sourceLine" id="cb1614-8" data-line-number="8">                      self<span class="op">$</span>age &lt;-<span class="st"> </span>age</a>
<a class="sourceLine" id="cb1614-9" data-line-number="9">                      self<span class="op">$</span>desire &lt;-<span class="st"> </span>desire</a>
<a class="sourceLine" id="cb1614-10" data-line-number="10">                      self<span class="op">$</span><span class="kw">greet</span>()</a>
<a class="sourceLine" id="cb1614-11" data-line-number="11">                    },</a>
<a class="sourceLine" id="cb1614-12" data-line-number="12">                    <span class="dt">set_age =</span> <span class="cf">function</span>(val) {</a>
<a class="sourceLine" id="cb1614-13" data-line-number="13">                      self<span class="op">$</span>age &lt;-<span class="st"> </span>val</a>
<a class="sourceLine" id="cb1614-14" data-line-number="14">                      <span class="kw">cat</span>(<span class="st">&quot;Age of &quot;</span>, self<span class="op">$</span>name, <span class="st">&quot; is:  &quot;</span>, val, <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb1614-15" data-line-number="15">                    },</a>
<a class="sourceLine" id="cb1614-16" data-line-number="16">                    <span class="dt">set_desire =</span> <span class="cf">function</span>(val) {</a>
<a class="sourceLine" id="cb1614-17" data-line-number="17">                      self<span class="op">$</span>desire &lt;-<span class="st"> </span>val</a>
<a class="sourceLine" id="cb1614-18" data-line-number="18">                      <span class="kw">cat</span>(<span class="st">&quot;Desire of &quot;</span>, self<span class="op">$</span>name, <span class="st">&quot; is:  &quot;</span>, val, <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb1614-19" data-line-number="19">                    },</a>
<a class="sourceLine" id="cb1614-20" data-line-number="20">                    <span class="dt">greet =</span> <span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb1614-21" data-line-number="21">                      <span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot;Hello, my name is &quot;</span>, self<span class="op">$</span>name, <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>))</a>
<a class="sourceLine" id="cb1614-22" data-line-number="22">                    }</a>
<a class="sourceLine" id="cb1614-23" data-line-number="23">                  )</a>
<a class="sourceLine" id="cb1614-24" data-line-number="24">)</a></code></pre></div>
<p>Let’s analyze the above code. The function <code>R6Class()</code> has a quite a few parameters, but the two with which we will concern ourselves the most are:</p>
<ul>
<li><code>classname</code>: the name we propose to give to the class;</li>
<li><code>public</code>: a list of members of the class that are “public” in the sense that they can be accessed and used outside of the class.<a href="#fn27" class="footnote-ref" id="fnref27"><sup>27</sup></a> Members are of two types:
<ul>
<li><em>attributes</em>: the objects <code>name</code>, <code>age</code> and <code>desire</code>. Currently these have value <code>NULL</code>, but they can be given other values later on. What makes then attributes, though, is that they will not be given a function as a value.</li>
<li><em>methods</em>: these are members of the class that are functions. You can think of a “method” as a particular way of performing a common task that could be performed in many different ways. The four methods you see in <code>Person</code> are:</li>
<li><code>initialize</code>: This is a function that will be run whenever a new object of class Person is created. As we can see from its arguments, it will be possible to give values to the attributes <code>name</code>. <code>age</code> and <code>desire</code> when this function is called.</li>
<li><code>set_age</code> and <code>set_desire</code> are functions that allow a user to set or to change the value of <code>age</code> and <code>desire</code> for an object of class Person.</li>
<li><code>greet</code>: a function that will permit an object of class Person to issue a greeting.</li>
</ul></li>
</ul>
<p>Note the use of the term <code>self</code> in the code for the methods of the class. When a method is called on an object, the term <code>self</code> will refer to the object on which the method is being called. Hence, for example, in the code for <code>greet</code> the term <code>self$name</code> will evaluate to the name of the person who issues the greeting.</p>
</div>
<div id="instantiation-initializing-objects" class="section level3">
<h3><span class="header-section-number">13.2.2</span> Instantiation: Initializing Objects</h3>
<p>On its own there is not much that a class can <em>do</em>. For anything to happen we need to create a particular individual: an object of class Person. Creation of an object having a particular class is called <em>instantiation</em>. </p>
<p>Every class comes with a method—not mentioned in the definition of the class—called <code>new()</code>. This method, when called on the Class, instantiates an object of the class by running the <code>initialize()</code> function. Let’s create a person named Dorothy and store this new object in the variable <code>dorothy</code>:</p>
<div class="sourceCode" id="cb1615"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1615-1" data-line-number="1">dorothy &lt;-<span class="st"> </span>Person<span class="op">$</span><span class="kw">new</span>(<span class="dt">name =</span> <span class="st">&quot;Dorothy&quot;</span>, <span class="dt">age =</span> <span class="dv">12</span>, </a>
<a class="sourceLine" id="cb1615-2" data-line-number="2">                      <span class="dt">desire =</span> <span class="st">&quot;Kansas&quot;</span>)</a></code></pre></div>
<pre><code>## Hello, my name is Dorothy.</code></pre>
<p>Note how the dollar-sign is used to indicate the calling of the <code>new()</code> method on the class Person. Note also that the arguments of <code>new()</code> are the arguments of <code>initialize()</code>: that’s because the <code>new()</code> method actually runs <code>initialize()</code> as part of its object-creation process.</p>
<p>We can get a look at <code>dorothy</code> by printing her to the console:</p>
<div class="sourceCode" id="cb1617"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1617-1" data-line-number="1">dorothy</a></code></pre></div>
<pre><code>## &lt;Person&gt;
##   Public:
##     age: 12
##     clone: function (deep = FALSE) 
##     desire: Kansas
##     greet: function () 
##     initialize: function (name = NA, age = NA, desire = NA) 
##     name: Dorothy
##     set_age: function (val) 
##     set_desire: function (val)</code></pre>
<p>We get the basic information on Dorothy, including also an indication that she can be cloned (copied). We’ll discuss cloning later.</p>
<p>We can instantiate as many people as we like. The code below for example, establishes <code>scarecrow</code> as a new instance of Person:</p>
<div class="sourceCode" id="cb1619"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1619-1" data-line-number="1">scarecrow &lt;-<span class="st"> </span>Person<span class="op">$</span><span class="kw">new</span>(<span class="dt">name =</span> <span class="st">&quot;Scarecrow&quot;</span>, <span class="dt">age =</span> <span class="fl">0.038</span>, </a>
<a class="sourceLine" id="cb1619-2" data-line-number="2">                      <span class="dt">desire =</span> <span class="st">&quot;Brains&quot;</span>)</a></code></pre></div>
<pre><code>## Hello, my name is Scarecrow.</code></pre>
<p>In <em>The Wizard of Oz</em>, Scarecrow is only two weeks old when Dorothy meets him, so his age is set at <span class="math inline">\(2/52 = 0.38\)</span> years.</p>
</div>
<div id="getting-and-setting-attributes" class="section level3">
<h3><span class="header-section-number">13.2.3</span> Getting and Setting Attributes</h3>
<p>If we would like to change Dorothy’s age, we can do so by calling the <code>set_age()</code> method on her:</p>
<div class="sourceCode" id="cb1621"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1621-1" data-line-number="1">dorothy<span class="op">$</span><span class="kw">set_age</span>(<span class="dv">13</span>)</a></code></pre></div>
<pre><code>## Age of Dorothy is:  13.</code></pre>
<div class="sourceCode" id="cb1623"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1623-1" data-line-number="1">dorothy<span class="op">$</span>age</a></code></pre></div>
<pre><code>## [1] 13</code></pre>
<p>We can also set Dorothy’s age directly, by regular assignment:</p>
<div class="sourceCode" id="cb1625"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1625-1" data-line-number="1">dorothy<span class="op">$</span>age &lt;-<span class="st"> </span><span class="dv">14</span></a></code></pre></div>
<div class="sourceCode" id="cb1626"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1626-1" data-line-number="1">dorothy<span class="op">$</span>age</a></code></pre></div>
<pre><code>## [1] 14</code></pre>
<p>The effect is the same as when we use <code>set_age()</code> except that we don’t get a report to the console.</p>
</div>
<div id="calling-methods" class="section level3">
<h3><span class="header-section-number">13.2.4</span> Calling Methods</h3>
<p>We have seen that in order to call a method on an object, you follow the format:</p>
<div class="sourceCode" id="cb1628"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1628-1" data-line-number="1">object<span class="op">$</span><span class="kw">method</span>()</a></code></pre></div>
<p>Thus, we can ask <code>dorothy</code> to issue a greeting:</p>
<div class="sourceCode" id="cb1629"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1629-1" data-line-number="1">dorothy<span class="op">$</span><span class="kw">greet</span>()</a></code></pre></div>
<pre><code>## Hello, my name is Dorothy.</code></pre>
<p>In the syntax for calling methods, we see one aspect of “message-passing”: <code>dorothy$greet()</code> essentially passes a message to <code>dorothy</code>: “Please call your <code>greet()</code> method!”</p>
</div>
<div id="holding-a-reference-not-a-value" class="section level3">
<h3><span class="header-section-number">13.2.5</span> Holding a Reference, not a Value</h3>
<p>
</p>
<p>R6 objects operate by what are known in computer programming as <em>reference semantics</em>. This means that when the assignment operator is used to assign an R6 object to a variable, the new variable holds a <em>reference</em> to that object, not a copy of the new object. This is in contrast <em>value semantics</em>, which is the way assignment usually works in R. In value semantics, R a distinct copy of the value of the assigned object is created, and the new variable refers to that copy.</p>
<p>Below is an example of the familiar value semantics in action:</p>
<div class="sourceCode" id="cb1631"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1631-1" data-line-number="1">a &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb1631-2" data-line-number="2">b &lt;-<span class="st"> </span>a</a>
<a class="sourceLine" id="cb1631-3" data-line-number="3">b &lt;-<span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb1631-4" data-line-number="4">a</a></code></pre></div>
<pre><code>## [1] 10</code></pre>
<p><code>b</code> has been changed to 20, but that change did not affect <code>a</code>, which keeps its initial value of 10.</p>
<p>We can use the function <code>address()</code>  from the package <strong>pryr</strong> <span class="citation">(Wickham <a href="#ref-R-pryr">2018</a>)</span> to track what is happening behind the scenes. <code>address()</code> will tell us the current location in memory of the value corresponding to a name. Let’s repeat the above process, but use <code>address()</code> to see where the values are stored:</p>
<div class="sourceCode" id="cb1633"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1633-1" data-line-number="1">a &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb1633-2" data-line-number="2">pryr<span class="op">::</span><span class="kw">address</span>(a)</a></code></pre></div>
<pre><code>## [1] &quot;0x7fbe476152e8&quot;</code></pre>
<p>The value 10 is stored in the memory address given above. Next, let’s create <code>b</code> by assignment from <code>a</code>:</p>
<div class="sourceCode" id="cb1635"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1635-1" data-line-number="1">b &lt;-<span class="st"> </span>a</a>
<a class="sourceLine" id="cb1635-2" data-line-number="2">pryr<span class="op">::</span><span class="kw">address</span>(b)</a></code></pre></div>
<pre><code>## [1] &quot;0x7fbe476152e8&quot;</code></pre>
<p>For the moment <code>b</code> points to the same place in memory as <code>a</code> does, so it will yield 10:</p>
<div class="sourceCode" id="cb1637"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1637-1" data-line-number="1">b</a></code></pre></div>
<pre><code>## [1] 10</code></pre>
<p>We can use <code>b</code> for other operations; for example, we can add 30 to it:</p>
<div class="sourceCode" id="cb1639"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1639-1" data-line-number="1">b <span class="op">+</span><span class="st"> </span><span class="dv">30</span></a></code></pre></div>
<pre><code>## [1] 40</code></pre>
<p>But for now <code>b</code> still points to the same place in memory that <code>a</code> does:</p>
<div class="sourceCode" id="cb1641"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1641-1" data-line-number="1">pryr<span class="op">::</span><span class="kw">address</span>(b)</a></code></pre></div>
<pre><code>## [1] &quot;0x7fbe476152e8&quot;</code></pre>
<p>But now let’s assign a new value to <code>b</code>:</p>
<div class="sourceCode" id="cb1643"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1643-1" data-line-number="1">b &lt;-<span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb1643-2" data-line-number="2">pryr<span class="op">::</span><span class="kw">address</span>(b)</a></code></pre></div>
<pre><code>## [1] &quot;0x7fbe469b8698&quot;</code></pre>
<p>Aha! <code>b</code> now points to a <strong>new</strong> location in the computer’s memory! That’s because R saw that the assignment operator was going to change the value of <code>b</code>. Since <code>b</code> has value semantics, R knows to set aside a new spot in memory to contain the value 20, and to associate the name <code>b</code> with that spot. That way, the new <code>b</code> won’t interfere with <code>a</code>, which points to the same old spot in memory and thus remains 10:</p>
<div class="sourceCode" id="cb1645"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1645-1" data-line-number="1">pryr<span class="op">::</span><span class="kw">address</span>(a)</a></code></pre></div>
<pre><code>## [1] &quot;0x7fbe476152e8&quot;</code></pre>
<div class="sourceCode" id="cb1647"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1647-1" data-line-number="1">a</a></code></pre></div>
<pre><code>## [1] 10</code></pre>
<p>On the other hand, R6 objects have <em>reference semantics</em>. We can see this in action with the following example. First, let’s check on <code>dorothy</code>’s age:</p>
<div class="sourceCode" id="cb1649"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1649-1" data-line-number="1">dorothy<span class="op">$</span>age</a></code></pre></div>
<pre><code>## [1] 14</code></pre>
<p>Let’s now create <code>dorothy2</code> by assignment from <code>dorothy</code>:</p>
<div class="sourceCode" id="cb1651"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1651-1" data-line-number="1">dorothy2 &lt;-<span class="st"> </span>dorothy</a></code></pre></div>
<p>Let’s check the memory locations:</p>
<div class="sourceCode" id="cb1652"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1652-1" data-line-number="1"><span class="kw">c</span>(pryr<span class="op">::</span><span class="kw">address</span>(dorothy), pryr<span class="op">::</span><span class="kw">address</span>(dorothy2))</a></code></pre></div>
<pre><code>## [1] &quot;0x7fbe475002a8&quot; &quot;0x7fbe475002a8&quot;</code></pre>
<p>As with <code>a</code> and <code>b</code>, the two names initially point to the same place in memory.</p>
<p>Now let’s change the age of <code>dorothy2</code> to 30:</p>
<div class="sourceCode" id="cb1654"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1654-1" data-line-number="1">dorothy2<span class="op">$</span>age &lt;-<span class="st"> </span><span class="dv">30</span></a></code></pre></div>
<p>Let’s check the age of <code>dorothy</code>:</p>
<div class="sourceCode" id="cb1655"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1655-1" data-line-number="1">dorothy<span class="op">$</span>age</a></code></pre></div>
<pre><code>## [1] 30</code></pre>
<p>Whoa! Changing the age of <code>dorothy2</code> changed the age of <code>dorothy</code>! That’s because of the reference semantics: <code>dorothy2</code> continues to be associated with the same spot in memory as <code>dorothy</code>, <em>even after</em> we begin to make changes to it:</p>
<div class="sourceCode" id="cb1657"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1657-1" data-line-number="1"><span class="kw">c</span>(pryr<span class="op">::</span><span class="kw">address</span>(dorothy), pryr<span class="op">::</span><span class="kw">address</span>(dorothy2))</a></code></pre></div>
<pre><code>## [1] &quot;0x7fbe475002a8&quot; &quot;0x7fbe475002a8&quot;</code></pre>
</div>
<div id="cloning-an-object" class="section level3">
<h3><span class="header-section-number">13.2.6</span> Cloning an Object</h3>
<p></p>
<p>For the sorts of complex objects created by R6 classes, reference semantics can be a useful feature. But what if we want a new and truly distinct copy of an R6 object? For this we need the <code>clone()</code> method that was alluded to earlier:</p>
<div class="sourceCode" id="cb1659"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1659-1" data-line-number="1">dorothy2 &lt;-<span class="st"> </span>dorothy<span class="op">$</span><span class="kw">clone</span>()</a>
<a class="sourceLine" id="cb1659-2" data-line-number="2">dorothy2</a></code></pre></div>
<pre><code>## &lt;Person&gt;
##   Public:
##     age: 30
##     clone: function (deep = FALSE) 
##     desire: Kansas
##     greet: function () 
##     initialize: function (name = NA, age = NA, desire = NA) 
##     name: Dorothy
##     set_age: function (val) 
##     set_desire: function (val)</code></pre>
<p><code>dorothy2</code> looks just like <code>dorothy</code>. However, the name <code>dorothy2</code> does not point to the same place in memory:</p>
<div class="sourceCode" id="cb1661"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1661-1" data-line-number="1"><span class="kw">c</span>(pryr<span class="op">::</span><span class="kw">address</span>(dorothy), pryr<span class="op">::</span><span class="kw">address</span>(dorothy2))</a></code></pre></div>
<pre><code>## [1] &quot;0x7fbe475002a8&quot; &quot;0x7fbe3ef6dc78&quot;</code></pre>
<p>Accordingly, changes to <code>dorothy2</code> will no longer result in changes to <code>dorothy</code>:</p>
<div class="sourceCode" id="cb1663"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1663-1" data-line-number="1">dorothy2<span class="op">$</span>age &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb1663-2" data-line-number="2">dorothy<span class="op">$</span>age</a></code></pre></div>
<pre><code>## [1] 30</code></pre>
<p>You should know that if one or more of the members of an object is itself an object with reference semantics (such as an instance of an R6 class), then a copy produced by <code>clone()</code> will hold a reference to that same member-object, not a separate copy of the member-object. In such a case if you still want a totally separate copy, you will have to consult the R6 manual on the topic of “deep cloning.”</p>
</div>
</div>
<div id="inheritance" class="section level2">
<h2><span class="header-section-number">13.3</span> Inheritance</h2>
<p></p>
<p>Earlier we mentioned that in the real world an object may possess a property in virtue of being the particular kind of thing that it is, or it may possess that property in virtue of being a member of some more general class of things. Thus a dog can eat, not because it is a dog <em>per se</em>, but because it is an animal. You could say that dogs “inherit” the capacity to eat from the class Animal.</p>
<p>Most object-oriented frameworks allow for some type of inheritance between classes, and R6 is no exception. In the <em>Wizard of Oz</em> lions appear to be a special type of person: after all, they can speak, and they have desires. Accordingly, we should create a new class Lion that inherits from the class Person:</p>
<div class="sourceCode" id="cb1665"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1665-1" data-line-number="1">Lion &lt;-<span class="st"> </span><span class="kw">R6Class</span>(<span class="st">&quot;Lion&quot;</span>,</a>
<a class="sourceLine" id="cb1665-2" data-line-number="2">                <span class="dt">inherit =</span> Person,</a>
<a class="sourceLine" id="cb1665-3" data-line-number="3">                <span class="dt">public =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb1665-4" data-line-number="4">                  <span class="dt">weight =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb1665-5" data-line-number="5">                  <span class="dt">set_weight =</span> <span class="cf">function</span>(val) {</a>
<a class="sourceLine" id="cb1665-6" data-line-number="6">                    self<span class="op">$</span>weight &lt;-<span class="st"> </span>val</a>
<a class="sourceLine" id="cb1665-7" data-line-number="7">                    <span class="kw">cat</span>(self<span class="op">$</span>name, <span class="st">&quot; has weight:  &quot;</span>, val, <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb1665-8" data-line-number="8">                  },</a>
<a class="sourceLine" id="cb1665-9" data-line-number="9">                  <span class="dt">greet =</span> <span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb1665-10" data-line-number="10">                    <span class="kw">cat</span>(<span class="st">&quot;Grr!  My name is &quot;</span>, self<span class="op">$</span>name, <span class="st">&quot;!&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb1665-11" data-line-number="11">                    }</a>
<a class="sourceLine" id="cb1665-12" data-line-number="12">                  )</a>
<a class="sourceLine" id="cb1665-13" data-line-number="13">                )</a></code></pre></div>
<p>The key to inheritance is the new argument in the code above:</p>
<blockquote>
<p><code>inherit = Person</code></p>
</blockquote>
<p>The impact of this additional argument is that any instance of the class Lion will possess by default all of the attributes and methods of class Person, in addition to the new attributes and methods (<code>weight</code>, <code>set_weight</code>, and <code>greet</code>) specified explicitly in the definition of class Lion. Of these three explicitly-defined members:</p>
<ul>
<li><code>weight</code> and <code>set_weight</code>were not already in Person, so they are simply added on as members of Lion;<a href="#fn28" class="footnote-ref" id="fnref28"><sup>28</sup></a></li>
<li><code>greet</code> was already a member of Person, but the new specification of <code>greet</code> in the definition of Lion <em>overrides</em> the old one. Any instance of class Lion will greet us according to the code for <code>greet()</code> given in the definition of Lion. (Objects that are instances of the class Person, however, will go on greeting us just as they always have done.)</li>
</ul>
<p>Let’s verify all of this by making an instance of class Lion:</p>
<div class="sourceCode" id="cb1666"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1666-1" data-line-number="1">cowardlyLion &lt;-<span class="st"> </span>Lion<span class="op">$</span><span class="kw">new</span>(<span class="dt">name =</span> <span class="st">&quot;Cowardly Lion&quot;</span>, </a>
<a class="sourceLine" id="cb1666-2" data-line-number="2">                         <span class="dt">age =</span> <span class="dv">18</span>, <span class="dt">desire =</span> <span class="st">&quot;courage&quot;</span>)</a></code></pre></div>
<pre><code>## Grr!  My name is Cowardly Lion!</code></pre>
<p>Since the definition of class Lion did not specify a new method of initialization—we could have asked for this, but chose not to—the instantiation of a lion won’t set its weight. We will have to do that separately:</p>
<div class="sourceCode" id="cb1668"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1668-1" data-line-number="1">cowardlyLion<span class="op">$</span><span class="kw">set_weight</span>(<span class="dv">350</span>)</a></code></pre></div>
<pre><code>## Cowardly Lion has weight:  350.</code></pre>
<p>Inheritance is an very effective way to re-use code and to keep code for a particular function in one place. Once we have written methods for some class X, those methods will be available to any objects that are instances of classes that inherit from class X. Hence there is no need to repeat the code in the definition of the inheriting classes. Later on if we need to modify one of of the class X methods, we need only make the change in class X: we don’t have to worry about changing it in all of the classes that inherit from X.</p>
<p>Let’s ask <code>cowardlyLion</code> to greet us:</p>
<div class="sourceCode" id="cb1670"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1670-1" data-line-number="1">cowardlyLion<span class="op">$</span><span class="kw">greet</span>()</a></code></pre></div>
<pre><code>## Grr!  My name is Cowardly Lion!</code></pre>
<p>As expected, the greeting includes a growl, since the <code>greet()</code> method for class Lion overrides the growl-less <code>greet()</code> method that it would have otherwise inherited from class Person. We also see a fundamental aspect of message-passing OO at work:</p>
<blockquote>
<p>The method used for determining how a particular task is performed is determined by the class of the object that is asked to perform the task.</p>
</blockquote>
<p>Here we have the task of greeting, which is common to objects of class Person and to objects of class Lion. That task may be performed with or without a growl. Precisely how it is performed—the method that is selected for carrying out the task—depends upon the class of the object that performs the greeting: an object of class Person will greet you without a growl, whereas an object of class Lion will greet you with a growl.</p>
<p>The common task of greeting may be performed in different ways, depending upon the class of the object involved in the task. This is an example of what programmers call <em>polymorphism</em>. The term “polymorphism” comes from a Greek word that means “many forms”, and it refers to a task being performed differently depending on the class of the object involved. Polymorphism makes programming a bit easier: you only have to remember the name of the one common task. Invoke it on an object and you can rest assured that the task will be performed in the way that is right and proper to that object.</p>
</div>
<div id="adding-members-to-a-class" class="section level2">
<h2><span class="header-section-number">13.4</span> Adding Members to a Class</h2>
<p>Sometimes we need to add or to modify a member of a class, after we have defined that class. Every class comes with a <code>set()</code> method that allows us to do this. For example, suppose that we would like our people to have a favorite color:</p>
<div class="sourceCode" id="cb1672"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1672-1" data-line-number="1">Person<span class="op">$</span><span class="kw">set</span>(<span class="st">&quot;public&quot;</span>, <span class="st">&quot;color&quot;</span>, <span class="ot">NA</span>, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>We now see that <code>color</code> is now one of the public members of class Person:</p>
<div class="sourceCode" id="cb1673"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1673-1" data-line-number="1">Person</a></code></pre></div>
<pre><code>## &lt;Person&gt; object generator
##   Public:
##     name: NULL
##     age: NULL
##     desire: NULL
##     color: NA
##     initialize: function (name = NA, age = NA, desire = NA) 
##     set_age: function (val) 
##     set_desire: function (val) 
##     greet: function () 
##     clone: function (deep = FALSE) 
##   Parent env: &lt;environment: R_GlobalEnv&gt;
##   Locked objects: TRUE
##   Locked class: FALSE
##   Portable: TRUE</code></pre>
<p>In the above call to set, the argument <code>overwrite = TRUE</code> was not strictly necessary, since <code>color</code> did not previously exist as a member of Person. If you are developing a program, though, and you find yourself repeatedly running a piece of code that sets a new member for a class, it’s useful to have overwriting turned on.</p>
<p>While we are at it. let’s write a special <code>set_color()</code> method:</p>
<div class="sourceCode" id="cb1675"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1675-1" data-line-number="1">Person<span class="op">$</span><span class="kw">set</span>(<span class="st">&quot;public&quot;</span>, <span class="st">&quot;set_color&quot;</span>, <span class="cf">function</span>(val) {</a>
<a class="sourceLine" id="cb1675-2" data-line-number="2">  self<span class="op">$</span>color &lt;-<span class="st"> </span>val</a>
<a class="sourceLine" id="cb1675-3" data-line-number="3">  <span class="kw">cat</span>(self<span class="op">$</span>name, <span class="st">&quot; has favorite color: &quot;</span>, val, <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb1675-4" data-line-number="4">  }, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>You might think that we can now set a favorite color for <code>dorothy</code>:</p>
<div class="sourceCode" id="cb1676"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1676-1" data-line-number="1">dorothy<span class="op">$</span><span class="kw">set_color</span>(<span class="st">&quot;blue&quot;</span>)</a></code></pre></div>
<pre><code>Error: attempt to apply non-function</code></pre>
<p>Why did this not work? It turns out that when you add a new member to a class it is only available to instances of the class that are created <strong>after</strong> the new member is added to that class. If we create a new instance of Person, the Good Witch Glinda, let’s say, then we should be able to give her a favorite color:</p>
<div class="sourceCode" id="cb1678"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1678-1" data-line-number="1">glinda &lt;-<span class="st"> </span>Person<span class="op">$</span><span class="kw">new</span>(<span class="st">&quot;Glinda&quot;</span>, <span class="st">&quot;500&quot;</span>, <span class="st">&quot;the good of all&quot;</span>)</a></code></pre></div>
<pre><code>## Hello, my name is Glinda.</code></pre>
<div class="sourceCode" id="cb1680"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1680-1" data-line-number="1">glinda<span class="op">$</span><span class="kw">set_color</span>(<span class="st">&quot;blue&quot;</span>)</a></code></pre></div>
<pre><code>## Glinda has favorite color: blue.</code></pre>
</div>
<div id="method-chaining" class="section level2">
<h2><span class="header-section-number">13.5</span> Method Chaining</h2>
<p>In this Section we will explore a concise and convenient device for calling multiple methods on an object. The device is known as <em>method chaining</em>. </p>
<p>In order to illustrate method chaining, we’ll extend the class Lion a bit, with some new attributes and new methods. First of all, we’d like to add a data frame consisting of possible animals on which a lion might prey. The data frame will contain the name of each type of animal, and an associated weight.</p>
<div class="sourceCode" id="cb1682"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1682-1" data-line-number="1">animal &lt;-<span class="st">  </span><span class="kw">c</span>(<span class="st">&quot;zebra&quot;</span>, <span class="st">&quot;giraffe&quot;</span>, <span class="st">&quot;pig&quot;</span>, </a>
<a class="sourceLine" id="cb1682-2" data-line-number="2">             <span class="st">&quot;cape buffalo&quot;</span>, <span class="st">&quot;antelope&quot;</span>, <span class="st">&quot;wildebeast&quot;</span>)</a>
<a class="sourceLine" id="cb1682-3" data-line-number="3">mass &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">25</span>, <span class="dv">60</span>, <span class="dv">45</span>, <span class="dv">55</span>)</a>
<a class="sourceLine" id="cb1682-4" data-line-number="4">prey &lt;-<span class="st"> </span><span class="kw">data.frame</span>(animal, mass, <span class="dt">stringsAsFactors =</span><span class="ot">FALSE</span>)</a></code></pre></div>
<p>Let’s now add <code>prey</code> as a new attribute to class Lion. We will also add an attribute <code>eaten</code>: a character vector—initially empty—that will contain a record of all the animals that the lion has eaten.</p>
<div class="sourceCode" id="cb1683"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1683-1" data-line-number="1">Lion<span class="op">$</span><span class="kw">set</span>(<span class="st">&quot;public&quot;</span>, <span class="st">&quot;prey&quot;</span>, prey, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1683-2" data-line-number="2">Lion<span class="op">$</span><span class="kw">set</span>(<span class="st">&quot;public&quot;</span>, <span class="st">&quot;eaten&quot;</span>, <span class="kw">character</span>(), <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Let us now endow our lions with the capacity to eat a beast of prey, by adding the method <code>eat()</code>:</p>
<div class="sourceCode" id="cb1684"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1684-1" data-line-number="1">Lion<span class="op">$</span><span class="kw">set</span>(<span class="st">&quot;public&quot;</span>, <span class="st">&quot;eat&quot;</span>, <span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb1684-2" data-line-number="2">  n &lt;-<span class="st"> </span><span class="kw">nrow</span>(self<span class="op">$</span>prey)</a>
<a class="sourceLine" id="cb1684-3" data-line-number="3">  item &lt;-<span class="st"> </span>self<span class="op">$</span>prey[<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span>n, <span class="dt">size =</span> <span class="dv">1</span>), ]</a>
<a class="sourceLine" id="cb1684-4" data-line-number="4">  initLetter &lt;-<span class="st"> </span><span class="kw">substr</span>(item<span class="op">$</span>animal, <span class="dv">1</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1684-5" data-line-number="5">  article &lt;-<span class="st"> </span><span class="kw">ifelse</span>(initLetter <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;e&quot;</span>, <span class="st">&quot;i&quot;</span>, <span class="st">&quot;o&quot;</span>, <span class="st">&quot;u&quot;</span>), <span class="st">&quot;An &quot;</span>, <span class="st">&quot;A &quot;</span>)</a>
<a class="sourceLine" id="cb1684-6" data-line-number="6">  <span class="kw">cat</span>(article, item<span class="op">$</span>animal, <span class="st">&quot; was eaten just now ...</span><span class="ch">\n\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb1684-7" data-line-number="7">  self<span class="op">$</span>eaten &lt;-<span class="st"> </span><span class="kw">c</span>(self<span class="op">$</span>eaten, item<span class="op">$</span>animal)</a>
<a class="sourceLine" id="cb1684-8" data-line-number="8">  self<span class="op">$</span>weight &lt;-<span class="st"> </span>self<span class="op">$</span>weight <span class="op">+</span><span class="st"> </span>item<span class="op">$</span>mass</a>
<a class="sourceLine" id="cb1684-9" data-line-number="9">  <span class="kw">return</span>(<span class="kw">invisible</span>(self))</a>
<a class="sourceLine" id="cb1684-10" data-line-number="10">}, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>When it eats an animal—randomly selected from the <code>prey</code> data frame—the lion gains the amount of weight that is associated with its unfortunate victim, and the victim is added to the lion’s <code>eaten</code> attribute.</p>
<p>Note that the <code>eat()</code> method returns <code>self</code> invisibly. When the method is called on a lion, that very lion itself is returned as a value, but since it is returned invisibly it won’t be printed to the console. The usefulness of returning <code>self</code> will soon become apparent.</p>
<p>Lions enjoy talking about what they have eaten recently, and for some reason they monitor their weight obsessively. The new method <code>report()</code> accounts for these characteristics of lions:</p>
<div class="sourceCode" id="cb1685"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1685-1" data-line-number="1">Lion<span class="op">$</span><span class="kw">set</span>(<span class="st">&quot;public&quot;</span>, <span class="st">&quot;report&quot;</span>, <span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb1685-2" data-line-number="2">  n &lt;-<span class="st"> </span><span class="kw">length</span>(self<span class="op">$</span>eaten)</a>
<a class="sourceLine" id="cb1685-3" data-line-number="3">  <span class="cf">if</span> ( n <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1</span> ) {</a>
<a class="sourceLine" id="cb1685-4" data-line-number="4">    <span class="kw">cat</span>(<span class="st">&quot;My name is &quot;</span>, self<span class="op">$</span>name, <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb1685-5" data-line-number="5">    <span class="kw">cat</span>(<span class="st">&quot;My most recent meal consisted of: &quot;</span>, self<span class="op">$</span>eaten[n], <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb1685-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb1685-7" data-line-number="7">  <span class="kw">cat</span>(<span class="st">&quot;I now weigh &quot;</span>, self<span class="op">$</span>weight, <span class="st">&quot; pounds.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb1685-8" data-line-number="8">  <span class="kw">return</span>(<span class="kw">invisible</span>(self))</a>
<a class="sourceLine" id="cb1685-9" data-line-number="9">}, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Note that <code>report()</code> also returns the lion invisibly.</p>
<p>Let us now instantiate a new lion named Simba:</p>
<div class="sourceCode" id="cb1686"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1686-1" data-line-number="1">simba &lt;-<span class="st"> </span>Lion<span class="op">$</span><span class="kw">new</span>(<span class="dt">name =</span> <span class="st">&quot;Simba&quot;</span>, <span class="dt">age =</span> <span class="dv">10</span>, </a>
<a class="sourceLine" id="cb1686-2" data-line-number="2">                  <span class="dt">desire =</span> <span class="st">&quot;Hakuna Matata&quot;</span>)</a></code></pre></div>
<pre><code>## Grr!  My name is Simba!</code></pre>
<div class="sourceCode" id="cb1688"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1688-1" data-line-number="1">simba<span class="op">$</span><span class="kw">set_weight</span>(<span class="dv">300</span>)</a></code></pre></div>
<pre><code>## Simba has weight:  300.</code></pre>
<p>Having been created after the addition of the <code>prey</code> and <code>eaten</code> attributes and the <code>eat()</code> and <code>report()</code> methods, <code>simba</code> has access to all of them. in particular, he can eat a random beast of prey:</p>
<div class="sourceCode" id="cb1690"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1690-1" data-line-number="1">simba<span class="op">$</span><span class="kw">eat</span>()</a></code></pre></div>
<pre><code>## A cape buffalo was eaten just now ...</code></pre>
<p><code>simba</code> has eaten, and he has presumably gained some weight as a result. Let’s see verify this by asking for his report:</p>
<div class="sourceCode" id="cb1692"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1692-1" data-line-number="1">simba<span class="op">$</span><span class="kw">report</span>()</a></code></pre></div>
<pre><code>## My name is Simba.
## My most recent meal consisted of: cape buffalo.
## I now weigh 360 pounds.</code></pre>
<p>Let’s now have <code>simba</code> eat twice more, and then report. Because <code>eat()</code> and <code>report()</code> both return <code>simba</code>, we can</p>
<ul>
<li>call <code>eat()</code> on `simba,</li>
<li>and then immediately call <code>eat()</code> on the result,</li>
<li>and finally call <code>report()</code> on the result of our second call.</li>
</ul>
<p>All of this can be accomplished in one line of calls, in which the three method-calls are “chained” together with dollar-signs:</p>
<div class="sourceCode" id="cb1694"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1694-1" data-line-number="1">simba<span class="op">$</span><span class="kw">eat</span>()<span class="op">$</span><span class="kw">eat</span>()<span class="op">$</span><span class="kw">report</span>()</a></code></pre></div>
<pre><code>## A pig was eaten just now ...
## 
## A cape buffalo was eaten just now ...
## 
## My name is Simba.
## My most recent meal consisted of: cape buffalo.
## I now weigh 445 pounds.</code></pre>
<p>In object-oriented programming languages you will see method-chaining used quite frequently.</p>
</div>
<div id="application-whales-in-an-ocean" class="section level2">
<h2><span class="header-section-number">13.6</span> Application: Whales in an Ocean</h2>
<p>Let’s now write a more elaborate program in the object-oriented style. Our program will simulate the population growth for whales in a ocean. In our model:</p>
<ul>
<li>Whales are mostly solitary: they move randomly about the ocean, happily feeding upon plankton.</li>
<li>When a male and female whale are sufficiently close together the female whale will check out the male to see if he is mature enough to mate. If she herself is fertile, then she will mate with him and a child will be produced.</li>
<li>That child will be either male or female, with equal likelihood for either option.</li>
<li>After mating, the female will be infertile for a period of time.</li>
<li>Whales have a set maximum lifetime.</li>
<li>In any given time period, it is possible for a whale to starve, causing it to die before reaches its lifespan. The probability of starvation is low when the whale population is small (presumably there is plenty of plankton available then) but the starvation-probability increases in direct proportion to the population.</li>
</ul>
<p>From the above conditions you can see that if the whale population is small then there is low probability of starvation, but on the other hand whales are liable to be spread thinly throughout the ocean. As a result males and females are relatively unlikely to run across each other, and hence births are less likely to occur. With a low enough population there is a strong possibility that the whales will die off before they can reproduce. (This is why biologists worry about some whale populations: if the whales are hunted to the point where the population is below a certain critical threshold, then they can go extinct on their own, even if hunting ceases.) On the other hand, if the whale population grows large then males and female meet frequently, and there are plenty of births. On the other hand there is a general shortage of food, resulting in high starvation rates. At some point birth and starvation balance each other out, resulting in a long-term equilibrium population-level.</p>
<p>We will implement our simulation with various objects:</p>
<ul>
<li>an ocean</li>
<li>whales of two types:
<ul>
<li>male whales</li>
<li>female whales</li>
</ul></li>
</ul>
<p>We will begin by defining the class Whale:</p>
<div class="sourceCode" id="cb1696"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1696-1" data-line-number="1">Whale &lt;-<span class="st"> </span><span class="kw">R6Class</span>(<span class="st">&quot;Whale&quot;</span>,</a>
<a class="sourceLine" id="cb1696-2" data-line-number="2">                 <span class="dt">public =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb1696-3" data-line-number="3">                   <span class="dt">position =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb1696-4" data-line-number="4">                   <span class="dt">age =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb1696-5" data-line-number="5">                   <span class="dt">lifespan =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb1696-6" data-line-number="6">                   <span class="dt">range =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb1696-7" data-line-number="7">                   <span class="dt">maturity =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb1696-8" data-line-number="8">                   <span class="dt">stepSize =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb1696-9" data-line-number="9">                   <span class="dt">initialize =</span> <span class="cf">function</span>(<span class="dt">position =</span> <span class="ot">NA</span>, <span class="dt">age =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb1696-10" data-line-number="10">                                         <span class="dt">lifespan =</span> <span class="dv">40</span>, <span class="dt">range =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb1696-11" data-line-number="11">                                         <span class="dt">maturity =</span> <span class="dv">10</span>, <span class="dt">stepSize =</span> <span class="dv">5</span>) {</a>
<a class="sourceLine" id="cb1696-12" data-line-number="12">                     self<span class="op">$</span>position &lt;-<span class="st"> </span>position</a>
<a class="sourceLine" id="cb1696-13" data-line-number="13">                     self<span class="op">$</span>age &lt;-<span class="st"> </span>age</a>
<a class="sourceLine" id="cb1696-14" data-line-number="14">                     self<span class="op">$</span>lifespan &lt;-<span class="st"> </span>lifespan</a>
<a class="sourceLine" id="cb1696-15" data-line-number="15">                     self<span class="op">$</span>range &lt;-<span class="st"> </span>range</a>
<a class="sourceLine" id="cb1696-16" data-line-number="16">                     self<span class="op">$</span>maturity &lt;-<span class="st"> </span>maturity</a>
<a class="sourceLine" id="cb1696-17" data-line-number="17">                     self<span class="op">$</span>stepSize &lt;-<span class="st"> </span>stepSize</a>
<a class="sourceLine" id="cb1696-18" data-line-number="18">                   }</a>
<a class="sourceLine" id="cb1696-19" data-line-number="19">                 ))</a></code></pre></div>
<p>For whales that are instances of the Whale class:</p>
<ul>
<li><code>position</code> will contain the current x and y-coordinate of the whale in a two-dimensional ocean;</li>
<li><code>age</code> will give the current age of the whale.</li>
<li><code>lifespan</code> is the maximum age that the whale can attain before it dies.</li>
<li><code>range</code> is how close the whale has to be to another whale of the opposite sex in order to detect the presence of that whale.</li>
<li><code>maturity</code> is the age that the whale must attain in order to be eligible to mate.</li>
<li><code>stepSize</code> is the distance that the whale moves in the ocean in a single time-period.</li>
</ul>
<p>Whales need to be able to move about in the sea. A whale moves by picking a random direction—any angle between 0 and <span class="math inline">\(2\pi\)</span> radians—and then moving <code>stepSize</code> units in that direction. If the selected motion would take the whale outside the boundaries of the ocean, then R will repeat the motion until the whale lands properly within the boundaries.</p>
<p>The motion of a whale is implemented in the code below for a <code>move()</code> method that is added to class Whale:</p>
<div class="sourceCode" id="cb1697"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1697-1" data-line-number="1">Whale<span class="op">$</span><span class="kw">set</span>(<span class="st">&quot;public&quot;</span>,</a>
<a class="sourceLine" id="cb1697-2" data-line-number="2">          <span class="st">&quot;move&quot;</span>,</a>
<a class="sourceLine" id="cb1697-3" data-line-number="3">          <span class="cf">function</span>(dims, <span class="dt">r =</span> self<span class="op">$</span>stepSize) {</a>
<a class="sourceLine" id="cb1697-4" data-line-number="4">            xMax &lt;-<span class="st"> </span>dims[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb1697-5" data-line-number="5">            yMax &lt;-<span class="st"> </span>dims[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb1697-6" data-line-number="6">            <span class="cf">repeat</span> {</a>
<a class="sourceLine" id="cb1697-7" data-line-number="7">              theta &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">2</span><span class="op">*</span>pi)</a>
<a class="sourceLine" id="cb1697-8" data-line-number="8">              p &lt;-<span class="st"> </span>self<span class="op">$</span>position <span class="op">+</span><span class="st"> </span>r <span class="op">*</span><span class="st"> </span><span class="kw">c</span>(<span class="kw">cos</span>(theta), <span class="kw">sin</span>(theta))</a>
<a class="sourceLine" id="cb1697-9" data-line-number="9">              within &lt;-<span class="st"> </span>(p[<span class="dv">1</span>] <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;&amp;</span><span class="st"> </span>p[<span class="dv">1</span>] <span class="op">&lt;</span><span class="st"> </span>xMax) <span class="op">&amp;&amp;</span><span class="st"> </span>(p[<span class="dv">2</span>] <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;&amp;</span><span class="st"> </span>p[<span class="dv">2</span>] <span class="op">&lt;</span><span class="st"> </span>yMax)</a>
<a class="sourceLine" id="cb1697-10" data-line-number="10">              <span class="cf">if</span> ( within ) {</a>
<a class="sourceLine" id="cb1697-11" data-line-number="11">                self<span class="op">$</span>position &lt;-<span class="st"> </span>p</a>
<a class="sourceLine" id="cb1697-12" data-line-number="12">                <span class="cf">break</span></a>
<a class="sourceLine" id="cb1697-13" data-line-number="13">              }</a>
<a class="sourceLine" id="cb1697-14" data-line-number="14">            }</a>
<a class="sourceLine" id="cb1697-15" data-line-number="15">          }, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Note the parameter <code>dims</code> for the move function. From the code we can tell that it’s a vector of length 2. In fact the parameter will contain the x and and y-dimensions (the width and breadth) of our ocean. It’s something that will have to be determined by the ocean itself. We haven’t written the class Ocean yet, so this part of the code will have to remain a bit mysterious, for now.</p>
<p>We need male and female whales, so we create a class for each sex. Both classes inherit from Whale. The class Male adds only a <code>sex</code> attribute:</p>
<div class="sourceCode" id="cb1698"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1698-1" data-line-number="1">Male &lt;-<span class="st"> </span><span class="kw">R6Class</span>(<span class="st">&quot;Male&quot;</span>,</a>
<a class="sourceLine" id="cb1698-2" data-line-number="2">                <span class="dt">inherit =</span> Whale,</a>
<a class="sourceLine" id="cb1698-3" data-line-number="3">                <span class="dt">public =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb1698-4" data-line-number="4">                  <span class="dt">sex =</span> <span class="st">&quot;male&quot;</span></a>
<a class="sourceLine" id="cb1698-5" data-line-number="5">                ))</a></code></pre></div>
<p>A female whale is a bit more complex: in addition to a sex attribute, she needs an attribute that specifies how long she will be infertile after giving birth, and another attribute that enables the program to keep track of the number of time-periods she must wait until she is fertile again:</p>
<div class="sourceCode" id="cb1699"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1699-1" data-line-number="1">Female &lt;-<span class="st"> </span><span class="kw">R6Class</span>(<span class="st">&quot;Female&quot;</span>,</a>
<a class="sourceLine" id="cb1699-2" data-line-number="2">                <span class="dt">inherit =</span> Whale,</a>
<a class="sourceLine" id="cb1699-3" data-line-number="3">                <span class="dt">public =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb1699-4" data-line-number="4">                  <span class="dt">sex =</span> <span class="st">&quot;female&quot;</span>,</a>
<a class="sourceLine" id="cb1699-5" data-line-number="5">                  <span class="dt">timeToFertility =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1699-6" data-line-number="6">                  <span class="dt">infertilityPeriod =</span> <span class="dv">5</span></a>
<a class="sourceLine" id="cb1699-7" data-line-number="7">                ))</a></code></pre></div>
<p>A female whale also needs a method to determine whether a mature whale is in the vicinity:</p>
<div class="sourceCode" id="cb1700"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1700-1" data-line-number="1">Female<span class="op">$</span><span class="kw">set</span>(<span class="st">&quot;public&quot;</span>,</a>
<a class="sourceLine" id="cb1700-2" data-line-number="2">           <span class="st">&quot;maleNear&quot;</span>,</a>
<a class="sourceLine" id="cb1700-3" data-line-number="3">           <span class="cf">function</span>(males, dist) {</a>
<a class="sourceLine" id="cb1700-4" data-line-number="4">             foundOne &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb1700-5" data-line-number="5">             <span class="cf">for</span> ( male <span class="cf">in</span> males ) {</a>
<a class="sourceLine" id="cb1700-6" data-line-number="6">               near &lt;-<span class="st"> </span><span class="kw">dist</span>(male<span class="op">$</span>position, self<span class="op">$</span>position) <span class="op">&lt;</span><span class="st"> </span>self<span class="op">$</span>range</a>
<a class="sourceLine" id="cb1700-7" data-line-number="7">               mature &lt;-<span class="st"> </span>(male<span class="op">$</span>age <span class="op">&gt;=</span><span class="st"> </span>male<span class="op">$</span>maturity)</a>
<a class="sourceLine" id="cb1700-8" data-line-number="8">               <span class="cf">if</span> ( near <span class="op">&amp;&amp;</span><span class="st"> </span>mature ) {</a>
<a class="sourceLine" id="cb1700-9" data-line-number="9">                 foundOne &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb1700-10" data-line-number="10">                 <span class="cf">break</span></a>
<a class="sourceLine" id="cb1700-11" data-line-number="11">               }</a>
<a class="sourceLine" id="cb1700-12" data-line-number="12">             }</a>
<a class="sourceLine" id="cb1700-13" data-line-number="13">             foundOne</a>
<a class="sourceLine" id="cb1700-14" data-line-number="14">           }, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Again, note the parameters <code>males</code> and <code>dist</code>. Values for these parameters will be provided by the ocean object. <code>males</code> will be a list of the male whales in the population at the current time, and <code>dist</code> will be a function for computing the distance between any two points in the ocean.</p>
<p>A female whale also needs to be able to mate:</p>
<div class="sourceCode" id="cb1701"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1701-1" data-line-number="1">Female<span class="op">$</span><span class="kw">set</span>(<span class="st">&quot;public&quot;</span>,</a>
<a class="sourceLine" id="cb1701-2" data-line-number="2">           <span class="st">&quot;mate&quot;</span>,</a>
<a class="sourceLine" id="cb1701-3" data-line-number="3">           <span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb1701-4" data-line-number="4">             babySex &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;female&quot;</span>, <span class="st">&quot;male&quot;</span>), <span class="dt">size =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1701-5" data-line-number="5">             self<span class="op">$</span>timeToFertility &lt;-<span class="st"> </span>self<span class="op">$</span>infertilityPeriod</a>
<a class="sourceLine" id="cb1701-6" data-line-number="6">             <span class="kw">return</span>(babySex)</a>
<a class="sourceLine" id="cb1701-7" data-line-number="7">           }, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Now it is time to define the Ocean class. It’s a bit of a mouthful:</p>
<div class="sourceCode" id="cb1702"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1702-1" data-line-number="1">Ocean &lt;-<span class="st"> </span><span class="kw">R6Class</span>(<span class="st">&quot;Ocean&quot;</span>,</a>
<a class="sourceLine" id="cb1702-2" data-line-number="2">                 <span class="dt">public =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb1702-3" data-line-number="3">                   <span class="dt">dimensions =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb1702-4" data-line-number="4">                   <span class="dt">males =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb1702-5" data-line-number="5">                   <span class="dt">females =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb1702-6" data-line-number="6">                   <span class="dt">malePop =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb1702-7" data-line-number="7">                   <span class="dt">femalePop =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb1702-8" data-line-number="8">                   <span class="dt">starveParameter =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb1702-9" data-line-number="9">                   <span class="dt">distance =</span> <span class="cf">function</span>(a, b) {</a>
<a class="sourceLine" id="cb1702-10" data-line-number="10">                     <span class="kw">sqrt</span>((a[<span class="dv">1</span>] <span class="op">-</span><span class="st"> </span>b[<span class="dv">1</span>])<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>(a[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>b[<span class="dv">2</span>])<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1702-11" data-line-number="11">                   },</a>
<a class="sourceLine" id="cb1702-12" data-line-number="12">                   <span class="dt">initialize =</span> <span class="cf">function</span>(<span class="dt">dims =</span> <span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">100</span>),</a>
<a class="sourceLine" id="cb1702-13" data-line-number="13">                                         <span class="dt">males =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb1702-14" data-line-number="14">                                         <span class="dt">females =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb1702-15" data-line-number="15">                                         <span class="dt">starve =</span> <span class="dv">5</span>) {</a>
<a class="sourceLine" id="cb1702-16" data-line-number="16">                     self<span class="op">$</span>dimensions &lt;-<span class="st"> </span>dims</a>
<a class="sourceLine" id="cb1702-17" data-line-number="17">                     xMax &lt;-<span class="st"> </span>dims[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb1702-18" data-line-number="18">                     yMax &lt;-<span class="st"> </span>dims[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb1702-19" data-line-number="19">                     maleWhales &lt;-<span class="st"> </span><span class="kw">replicate</span>(</a>
<a class="sourceLine" id="cb1702-20" data-line-number="20">                       males, </a>
<a class="sourceLine" id="cb1702-21" data-line-number="21">                       Male<span class="op">$</span><span class="kw">new</span>(<span class="dt">age =</span> <span class="dv">10</span>, </a>
<a class="sourceLine" id="cb1702-22" data-line-number="22">                                <span class="dt">position =</span> <span class="kw">c</span>(<span class="kw">runif</span>(<span class="dv">1</span>, <span class="dv">0</span>, xMax),</a>
<a class="sourceLine" id="cb1702-23" data-line-number="23">                                            <span class="kw">runif</span>(<span class="dv">1</span>, <span class="dv">0</span>, yMax))))</a>
<a class="sourceLine" id="cb1702-24" data-line-number="24">                     femaleWhales &lt;-<span class="st"> </span><span class="kw">replicate</span>(</a>
<a class="sourceLine" id="cb1702-25" data-line-number="25">                       females, </a>
<a class="sourceLine" id="cb1702-26" data-line-number="26">                       Female<span class="op">$</span><span class="kw">new</span>(<span class="dt">age =</span> <span class="dv">10</span>, </a>
<a class="sourceLine" id="cb1702-27" data-line-number="27">                                  <span class="dt">position =</span> <span class="kw">c</span>(<span class="kw">runif</span>(<span class="dv">1</span>, <span class="dv">0</span>, xMax), </a>
<a class="sourceLine" id="cb1702-28" data-line-number="28">                                               <span class="kw">runif</span>(<span class="dv">1</span>, <span class="dv">0</span>, yMax))))</a>
<a class="sourceLine" id="cb1702-29" data-line-number="29">                     self<span class="op">$</span>males &lt;-<span class="st"> </span>maleWhales</a>
<a class="sourceLine" id="cb1702-30" data-line-number="30">                     self<span class="op">$</span>females &lt;-<span class="st"> </span>femaleWhales</a>
<a class="sourceLine" id="cb1702-31" data-line-number="31">                     self<span class="op">$</span>malePop &lt;-<span class="st"> </span>males</a>
<a class="sourceLine" id="cb1702-32" data-line-number="32">                     self<span class="op">$</span>femalePop &lt;-<span class="st"> </span>females</a>
<a class="sourceLine" id="cb1702-33" data-line-number="33">                     self<span class="op">$</span>starveParameter &lt;-<span class="st"> </span>starve</a>
<a class="sourceLine" id="cb1702-34" data-line-number="34">                   },</a>
<a class="sourceLine" id="cb1702-35" data-line-number="35">                   <span class="dt">starvationProbability =</span> <span class="cf">function</span>(popDensity) {</a>
<a class="sourceLine" id="cb1702-36" data-line-number="36">                     self<span class="op">$</span>starveParameter <span class="op">*</span><span class="st"> </span>popDensity</a>
<a class="sourceLine" id="cb1702-37" data-line-number="37">                   }</a>
<a class="sourceLine" id="cb1702-38" data-line-number="38">                 ))</a></code></pre></div>
<p>In an instantiation of the class Ocean:</p>
<ul>
<li><code>dimensions</code> will be numerical vector of length 2 that specifies the width and breadth of the ocean.</li>
<li><code>males</code> and <code>females</code> will be lists that contain respectively the current sets of male whales and female whales. Note that this implies that an ocean will contain as members other items that are themselves R6 classes. This is an example of what is called <em>composition</em> in object-oriented programming.</li>
<li><code>malePop</code> and <code>femalePop</code> give respectively the current counts male and females whales.</li>
<li><code>starveParameter</code> helps determine the probability that each individual whale will starve within the next time-period. Note that the method <code>starvationProbability()</code> makes the probability of starvation equal product of <code>starveParameter</code> and the current density of the population of whales in the ocean. The bigger this attribute is, the more starvation will occur and the lower the long-term upper limit of the population will be.</li>
<li><code>distance()</code> is the method for finding the distance between any two positions in the ocean. It implements the standard distance-formula from high-school geometry.</li>
<li>The initialization function permits the user to determine the dimensions of the ocean, the initial number of male and female whales, and the starvation parameter. In the instantiation process for an individual ocean the required number of male and female whales are instantiated and are placed randomly in the ocean.</li>
</ul>
<p>We need to add a method that allows an ocean to advance one unit of time. During that time:</p>
<ul>
<li>Each mature and fertile female whale must check for nearby mature males, mate with one if possible, and produce a baby.</li>
<li>Any offspring produced must then be added to the ocean’s lists of male and female whales.</li>
<li>The ocean must then subject each whale to the possibility of starvation within the time-period at hand.</li>
<li>All whales that survive must then move.</li>
<li>The age of each whale must be increased by one time-unit. For females, the time remaining until fertility must also be decreased by a unit.</li>
</ul>
<p>The <code>advance()</code> method is implemented and added to Ocean with the code below:</p>
<div class="sourceCode" id="cb1703"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1703-1" data-line-number="1">Ocean<span class="op">$</span><span class="kw">set</span>(<span class="st">&quot;public&quot;</span>,</a>
<a class="sourceLine" id="cb1703-2" data-line-number="2">          <span class="st">&quot;advance&quot;</span>,</a>
<a class="sourceLine" id="cb1703-3" data-line-number="3">          <span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb1703-4" data-line-number="4">            malePop &lt;-<span class="st"> </span>self<span class="op">$</span>malePop</a>
<a class="sourceLine" id="cb1703-5" data-line-number="5">            femalePop &lt;-<span class="st"> </span>self<span class="op">$</span>femalePop</a>
<a class="sourceLine" id="cb1703-6" data-line-number="6">            population &lt;-<span class="st"> </span>malePop <span class="op">+</span><span class="st"> </span>femalePop</a>
<a class="sourceLine" id="cb1703-7" data-line-number="7">            <span class="cf">if</span> ( population <span class="op">==</span><span class="st"> </span><span class="dv">0</span> ) {</a>
<a class="sourceLine" id="cb1703-8" data-line-number="8">              <span class="kw">return</span>(<span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb1703-9" data-line-number="9">            }</a>
<a class="sourceLine" id="cb1703-10" data-line-number="10">            males &lt;-<span class="st"> </span>self<span class="op">$</span>males</a>
<a class="sourceLine" id="cb1703-11" data-line-number="11">            females &lt;-<span class="st"> </span>self<span class="op">$</span>females</a>
<a class="sourceLine" id="cb1703-12" data-line-number="12">            babyMales &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb1703-13" data-line-number="13">            babyFemales &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb1703-14" data-line-number="14">            <span class="cf">if</span> ( malePop <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;&amp;</span><span class="st"> </span>femalePop <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> ) {</a>
<a class="sourceLine" id="cb1703-15" data-line-number="15">              <span class="cf">for</span> ( female <span class="cf">in</span> females ) {</a>
<a class="sourceLine" id="cb1703-16" data-line-number="16">                <span class="cf">if</span> ( female<span class="op">$</span>age <span class="op">&gt;=</span><span class="st"> </span>female<span class="op">$</span>maturity <span class="op">&amp;&amp;</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1703-17" data-line-number="17"><span class="st">                     </span>female<span class="op">$</span>timeToFertility <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;&amp;</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1703-18" data-line-number="18"><span class="st">                     </span>female<span class="op">$</span><span class="kw">maleNear</span>(<span class="dt">males =</span> males,</a>
<a class="sourceLine" id="cb1703-19" data-line-number="19">                                     <span class="dt">dist =</span> self<span class="op">$</span>distance)) {</a>
<a class="sourceLine" id="cb1703-20" data-line-number="20">                  outcome &lt;-<span class="st"> </span>female<span class="op">$</span><span class="kw">mate</span>()</a>
<a class="sourceLine" id="cb1703-21" data-line-number="21">                  <span class="cf">if</span> ( outcome <span class="op">==</span><span class="st"> &quot;male&quot;</span> ) {</a>
<a class="sourceLine" id="cb1703-22" data-line-number="22">                    baby &lt;-<span class="st"> </span>Male<span class="op">$</span><span class="kw">new</span>(<span class="dt">age =</span> <span class="dv">0</span>, <span class="dt">position =</span> female<span class="op">$</span>position)</a>
<a class="sourceLine" id="cb1703-23" data-line-number="23">                    babyMales &lt;-<span class="st"> </span><span class="kw">c</span>(babyMales, baby)</a>
<a class="sourceLine" id="cb1703-24" data-line-number="24">                  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb1703-25" data-line-number="25">                    baby &lt;-<span class="st"> </span>Female<span class="op">$</span><span class="kw">new</span>(<span class="dt">age =</span> <span class="dv">0</span>, <span class="dt">position =</span> female<span class="op">$</span>position)</a>
<a class="sourceLine" id="cb1703-26" data-line-number="26">                    babyFemales &lt;-<span class="st"> </span><span class="kw">c</span>(babyFemales, baby)</a>
<a class="sourceLine" id="cb1703-27" data-line-number="27">                  }</a>
<a class="sourceLine" id="cb1703-28" data-line-number="28">                }</a>
<a class="sourceLine" id="cb1703-29" data-line-number="29">              }</a>
<a class="sourceLine" id="cb1703-30" data-line-number="30">            }</a>
<a class="sourceLine" id="cb1703-31" data-line-number="31">            </a>
<a class="sourceLine" id="cb1703-32" data-line-number="32">            <span class="co"># augment the male and female lists if needed:</span></a>
<a class="sourceLine" id="cb1703-33" data-line-number="33">            lmb &lt;-<span class="st"> </span><span class="kw">length</span>(babyMales); lfb &lt;-<span class="st"> </span><span class="kw">length</span>(babyFemales);</a>
<a class="sourceLine" id="cb1703-34" data-line-number="34">            </a>
<a class="sourceLine" id="cb1703-35" data-line-number="35">            <span class="co"># throw in the babies:</span></a>
<a class="sourceLine" id="cb1703-36" data-line-number="36">            <span class="cf">if</span> ( lmb <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> ) {</a>
<a class="sourceLine" id="cb1703-37" data-line-number="37">              males &lt;-<span class="st"> </span><span class="kw">c</span>(males, babyMales)</a>
<a class="sourceLine" id="cb1703-38" data-line-number="38">            }</a>
<a class="sourceLine" id="cb1703-39" data-line-number="39">            <span class="cf">if</span> ( lfb <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> ) {</a>
<a class="sourceLine" id="cb1703-40" data-line-number="40">              females &lt;-<span class="st"> </span><span class="kw">c</span>(females, babyFemales)</a>
<a class="sourceLine" id="cb1703-41" data-line-number="41">            }</a>
<a class="sourceLine" id="cb1703-42" data-line-number="42">            </a>
<a class="sourceLine" id="cb1703-43" data-line-number="43">            <span class="co"># revise population for new births:</span></a>
<a class="sourceLine" id="cb1703-44" data-line-number="44">            population &lt;-<span class="st"> </span><span class="kw">length</span>(males) <span class="op">+</span><span class="st"> </span><span class="kw">length</span>(females)</a>
<a class="sourceLine" id="cb1703-45" data-line-number="45">            </a>
<a class="sourceLine" id="cb1703-46" data-line-number="46">            <span class="co"># starve some of them, maybe:</span></a>
<a class="sourceLine" id="cb1703-47" data-line-number="47">            popDen &lt;-<span class="st"> </span>population<span class="op">/</span><span class="kw">prod</span>(self<span class="op">$</span>dimensions)</a>
<a class="sourceLine" id="cb1703-48" data-line-number="48">            starveProb &lt;-<span class="st"> </span>self<span class="op">$</span><span class="kw">starvationProbability</span>(<span class="dt">popDensity =</span> popDen)</a>
<a class="sourceLine" id="cb1703-49" data-line-number="49">            maleDead &lt;-<span class="st"> </span><span class="kw">logical</span>(<span class="kw">length</span>(males))</a>
<a class="sourceLine" id="cb1703-50" data-line-number="50">            femaleDead &lt;-<span class="st"> </span><span class="kw">logical</span>(<span class="kw">length</span>(females))</a>
<a class="sourceLine" id="cb1703-51" data-line-number="51">            <span class="co"># starve some males</span></a>
<a class="sourceLine" id="cb1703-52" data-line-number="52">            <span class="cf">for</span> ( i <span class="cf">in</span> <span class="kw">seq_along</span>(maleDead) ) {</a>
<a class="sourceLine" id="cb1703-53" data-line-number="53">              male &lt;-<span class="st"> </span>males[[i]]</a>
<a class="sourceLine" id="cb1703-54" data-line-number="54">              maleDead[i] &lt;-<span class="st"> </span>(<span class="kw">runif</span>(<span class="dv">1</span>) <span class="op">&lt;=</span><span class="st"> </span>starveProb)</a>
<a class="sourceLine" id="cb1703-55" data-line-number="55">              male<span class="op">$</span>age &lt;-<span class="st"> </span>male<span class="op">$</span>age <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb1703-56" data-line-number="56">              <span class="cf">if</span> ( male<span class="op">$</span>age <span class="op">&gt;=</span><span class="st"> </span>male<span class="op">$</span>lifespan ) maleDead[i] &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb1703-57" data-line-number="57">              <span class="cf">if</span> ( maleDead[i] ) <span class="cf">next</span></a>
<a class="sourceLine" id="cb1703-58" data-line-number="58">              <span class="co"># if whale is not dead, he should move:</span></a>
<a class="sourceLine" id="cb1703-59" data-line-number="59">              male<span class="op">$</span><span class="kw">move</span>(<span class="dt">dims =</span> self<span class="op">$</span>dimensions)</a>
<a class="sourceLine" id="cb1703-60" data-line-number="60">            }</a>
<a class="sourceLine" id="cb1703-61" data-line-number="61">            <span class="co"># starve some females</span></a>
<a class="sourceLine" id="cb1703-62" data-line-number="62">            <span class="cf">for</span> ( i <span class="cf">in</span> <span class="kw">seq_along</span>(femaleDead) ) {</a>
<a class="sourceLine" id="cb1703-63" data-line-number="63">              female &lt;-<span class="st"> </span>females[[i]]</a>
<a class="sourceLine" id="cb1703-64" data-line-number="64">              femaleDead[i] &lt;-<span class="st"> </span>(<span class="kw">runif</span>(<span class="dv">1</span>) <span class="op">&lt;=</span><span class="st"> </span>starveProb)</a>
<a class="sourceLine" id="cb1703-65" data-line-number="65">              female<span class="op">$</span>age &lt;-<span class="st"> </span>female<span class="op">$</span>age <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb1703-66" data-line-number="66">              <span class="cf">if</span> ( female<span class="op">$</span>age <span class="op">&gt;=</span><span class="st"> </span>female<span class="op">$</span>lifespan ) femaleDead[i] &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb1703-67" data-line-number="67">              <span class="cf">if</span> ( femaleDead[i] ) <span class="cf">next</span></a>
<a class="sourceLine" id="cb1703-68" data-line-number="68">              <span class="cf">if</span> ( female<span class="op">$</span>sex <span class="op">==</span><span class="st"> &quot;female&quot;</span> ) {</a>
<a class="sourceLine" id="cb1703-69" data-line-number="69">                female<span class="op">$</span>timeToFertility &lt;-<span class="st"> </span>female<span class="op">$</span>timeToFertility <span class="op">-</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb1703-70" data-line-number="70">              }</a>
<a class="sourceLine" id="cb1703-71" data-line-number="71">              <span class="co"># if female is not dead, she should move:</span></a>
<a class="sourceLine" id="cb1703-72" data-line-number="72">              female<span class="op">$</span><span class="kw">move</span>(<span class="dt">dims =</span> self<span class="op">$</span>dimensions)</a>
<a class="sourceLine" id="cb1703-73" data-line-number="73">            }</a>
<a class="sourceLine" id="cb1703-74" data-line-number="74">            </a>
<a class="sourceLine" id="cb1703-75" data-line-number="75">            <span class="co"># revise male and female whale lists:</span></a>
<a class="sourceLine" id="cb1703-76" data-line-number="76">            malePop &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="op">!</span>maleDead)</a>
<a class="sourceLine" id="cb1703-77" data-line-number="77">            self<span class="op">$</span>malePop &lt;-<span class="st"> </span>malePop</a>
<a class="sourceLine" id="cb1703-78" data-line-number="78">            femalePop &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="op">!</span>femaleDead)</a>
<a class="sourceLine" id="cb1703-79" data-line-number="79">            self<span class="op">$</span>femalePop &lt;-<span class="st"> </span>femalePop</a>
<a class="sourceLine" id="cb1703-80" data-line-number="80">            <span class="cf">if</span> ( malePop <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> ) {</a>
<a class="sourceLine" id="cb1703-81" data-line-number="81">              self<span class="op">$</span>males &lt;-<span class="st"> </span>males[<span class="op">!</span>maleDead]</a>
<a class="sourceLine" id="cb1703-82" data-line-number="82">            } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb1703-83" data-line-number="83">              self<span class="op">$</span>males &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb1703-84" data-line-number="84">            }</a>
<a class="sourceLine" id="cb1703-85" data-line-number="85">            <span class="cf">if</span> ( femalePop <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> ) {</a>
<a class="sourceLine" id="cb1703-86" data-line-number="86">              self<span class="op">$</span>females &lt;-<span class="st"> </span>females[<span class="op">!</span>femaleDead]</a>
<a class="sourceLine" id="cb1703-87" data-line-number="87">            } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb1703-88" data-line-number="88">              self<span class="op">$</span>females &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb1703-89" data-line-number="89">            }</a>
<a class="sourceLine" id="cb1703-90" data-line-number="90">          }, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>In simulations we might enjoy looking at a picture of the ocean at any given time moment. Hence we add a <code>plot()</code> method that enables an ocean to produce a graph of the whales within it. In this graph males will be colored red and females green. Mature whales will appear as larger than immature whales. For purposes of speed we use R’s base graphics system rather than <strong>ggplot2</strong>.</p>
<div class="sourceCode" id="cb1704"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1704-1" data-line-number="1">Ocean<span class="op">$</span><span class="kw">set</span>(<span class="st">&quot;public&quot;</span>, </a>
<a class="sourceLine" id="cb1704-2" data-line-number="2">          <span class="st">&quot;plot&quot;</span>,</a>
<a class="sourceLine" id="cb1704-3" data-line-number="3">          <span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb1704-4" data-line-number="4">            males &lt;-<span class="st"> </span>self<span class="op">$</span>males</a>
<a class="sourceLine" id="cb1704-5" data-line-number="5">            females &lt;-<span class="st"> </span>self<span class="op">$</span>females</a>
<a class="sourceLine" id="cb1704-6" data-line-number="6">            whales &lt;-<span class="st"> </span><span class="kw">c</span>(males, females)</a>
<a class="sourceLine" id="cb1704-7" data-line-number="7">            <span class="cf">if</span> ( <span class="kw">length</span>(whales) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb1704-8" data-line-number="8">              <span class="kw">plot</span>(<span class="dv">0</span>,<span class="dv">0</span>, <span class="dt">type =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">main =</span> <span class="st">&quot;All Gone!&quot;</span>)</a>
<a class="sourceLine" id="cb1704-9" data-line-number="9">              <span class="kw">box</span>(<span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1704-10" data-line-number="10">              <span class="kw">return</span>(<span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb1704-11" data-line-number="11">            }</a>
<a class="sourceLine" id="cb1704-12" data-line-number="12">            df &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map_dfr</span>(whales, <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1704-13" data-line-number="13">              <span class="kw">list</span>(<span class="dt">x =</span> x<span class="op">$</span>position[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb1704-14" data-line-number="14">                   <span class="dt">y =</span> x<span class="op">$</span>position[<span class="dv">2</span>],</a>
<a class="sourceLine" id="cb1704-15" data-line-number="15">                   <span class="dt">sex =</span> <span class="kw">as.numeric</span>(x<span class="op">$</span>sex <span class="op">==</span><span class="st"> &quot;male&quot;</span>),</a>
<a class="sourceLine" id="cb1704-16" data-line-number="16">                   <span class="dt">mature =</span> <span class="kw">as.numeric</span>(x<span class="op">$</span>age <span class="op">&gt;=</span><span class="st"> </span>x<span class="op">$</span>maturity))</a>
<a class="sourceLine" id="cb1704-17" data-line-number="17">              })</a>
<a class="sourceLine" id="cb1704-18" data-line-number="18">            <span class="co"># males will be red, females green:</span></a>
<a class="sourceLine" id="cb1704-19" data-line-number="19">            df<span class="op">$</span>color &lt;-<span class="st"> </span><span class="kw">ifelse</span>(df<span class="op">$</span>sex <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>)</a>
<a class="sourceLine" id="cb1704-20" data-line-number="20">            <span class="co"># mature whales have cex = 3, immature whales cex 0.7</span></a>
<a class="sourceLine" id="cb1704-21" data-line-number="21">            df<span class="op">$</span>size &lt;-<span class="st"> </span><span class="kw">ifelse</span>(df<span class="op">$</span>mature <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="fl">1.3</span>, <span class="fl">0.7</span>)</a>
<a class="sourceLine" id="cb1704-22" data-line-number="22">            <span class="kw">with</span>(df, </a>
<a class="sourceLine" id="cb1704-23" data-line-number="23">                 <span class="kw">plot</span>(x, y, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, self<span class="op">$</span>dimensions[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb1704-24" data-line-number="24">                 <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, self<span class="op">$</span>dimensions[<span class="dv">1</span>]), <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb1704-25" data-line-number="25">                 <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">col =</span> color, <span class="dt">cex =</span> size,</a>
<a class="sourceLine" id="cb1704-26" data-line-number="26">                 <span class="dt">main =</span> <span class="kw">paste0</span>(<span class="st">&quot;Population = &quot;</span>, <span class="kw">nrow</span>(df))))</a>
<a class="sourceLine" id="cb1704-27" data-line-number="27">            <span class="kw">box</span>(<span class="dt">lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1704-28" data-line-number="28">          }, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Finally, we write a simulation function. The function allows the user to specify the number of time-units that the simulation will cover, along with initial numbers of male and female whales. The user will have an option to “animate” the simulation showing a plot of the ocean after each time-unit. If the animation option is chosen, then R will use the <code>Sys.sleep()</code> function  to make the computer suspend computations for half a second so that the user can view the plot. The simulation will cease if all of the whales die prior to end of the allotted time. Finally, the function uses <strong>ggplot2</strong> to produce a graph of the whale population as a function of time.</p>
<div class="sourceCode" id="cb1705"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1705-1" data-line-number="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb1705-2" data-line-number="2">oceanSim &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">steps =</span> <span class="dv">100</span>, <span class="dt">males =</span> <span class="dv">10</span>, <span class="dt">females =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb1705-3" data-line-number="3">                     <span class="dt">starve =</span> <span class="dv">5</span>, <span class="dt">animate =</span> <span class="ot">TRUE</span>, <span class="dt">seed =</span> <span class="ot">NULL</span>) {</a>
<a class="sourceLine" id="cb1705-4" data-line-number="4">  <span class="cf">if</span> ( <span class="op">!</span><span class="kw">is.null</span>(seed) ) {</a>
<a class="sourceLine" id="cb1705-5" data-line-number="5">    <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb1705-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb1705-7" data-line-number="7">  ocean &lt;-<span class="st"> </span>Ocean<span class="op">$</span><span class="kw">new</span>(<span class="dt">dims =</span> <span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">100</span>), <span class="dt">males =</span> males, </a>
<a class="sourceLine" id="cb1705-8" data-line-number="8">                     <span class="dt">females =</span> females, <span class="dt">starve =</span> starve)</a>
<a class="sourceLine" id="cb1705-9" data-line-number="9">  population &lt;-<span class="kw">numeric</span>(steps)</a>
<a class="sourceLine" id="cb1705-10" data-line-number="10">  <span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>steps ) {</a>
<a class="sourceLine" id="cb1705-11" data-line-number="11">    population[i] &lt;-<span class="st"> </span>ocean<span class="op">$</span>malePop <span class="op">+</span><span class="st"> </span>ocean<span class="op">$</span>femalePop</a>
<a class="sourceLine" id="cb1705-12" data-line-number="12">    <span class="cf">if</span> ( animate ) ocean<span class="op">$</span><span class="kw">plot</span>()</a>
<a class="sourceLine" id="cb1705-13" data-line-number="13">    <span class="cf">if</span> ( population[i] <span class="op">==</span><span class="st"> </span><span class="dv">0</span> ) <span class="cf">break</span></a>
<a class="sourceLine" id="cb1705-14" data-line-number="14">    ocean<span class="op">$</span><span class="kw">advance</span>()</a>
<a class="sourceLine" id="cb1705-15" data-line-number="15">    <span class="cf">if</span> ( animate ) <span class="kw">Sys.sleep</span>(<span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb1705-16" data-line-number="16">  }</a>
<a class="sourceLine" id="cb1705-17" data-line-number="17">  pop &lt;-<span class="st"> </span>population[<span class="dv">1</span><span class="op">:</span>i]</a>
<a class="sourceLine" id="cb1705-18" data-line-number="18">  df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">time =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(pop),</a>
<a class="sourceLine" id="cb1705-19" data-line-number="19">                   pop)</a>
<a class="sourceLine" id="cb1705-20" data-line-number="20">  <span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> pop)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1705-21" data-line-number="21"><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Time&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Whale Population&quot;</span>)</a>
<a class="sourceLine" id="cb1705-22" data-line-number="22">}</a></code></pre></div>
<p>We are now ready for a simulation. The results are graphed in Figure @ref(fig:whalesimgraph).</p>
<div class="sourceCode" id="cb1706"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1706-1" data-line-number="1"><span class="kw">oceanSim</span>(<span class="dt">steps =</span> <span class="dv">200</span>, <span class="dt">males =</span> <span class="dv">15</span>, <span class="dt">females =</span> <span class="dv">15</span>,</a>
<a class="sourceLine" id="cb1706-2" data-line-number="2">         <span class="dt">animate =</span> <span class="ot">FALSE</span>, <span class="dt">seed =</span> <span class="dv">3030</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/whalesimgraph-1.png" alt="Simulated whale population.  Sadly, they all die after about 130 days." width="95%" />
<p class="caption">
(#fig:whalesimgraph)Simulated whale population. Sadly, they all die after about 130 days.
</p>
</div>
<p>You should try running the simulation yourself a few times, for differing initial numbers of whales. If you like you can watch the whales move about by setting <code>animate</code> to <code>TRUE</code>:</p>
<div class="sourceCode" id="cb1707"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1707-1" data-line-number="1"><span class="kw">oceanSim</span>(<span class="dt">steps =</span> <span class="dv">200</span>, <span class="dt">males =</span> <span class="dv">15</span>, <span class="dt">females =</span> <span class="dv">15</span>,</a>
<a class="sourceLine" id="cb1707-2" data-line-number="2">         <span class="dt">animate =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>You might also wish to explore varying the <code>starve</code> parameter: recall that the higher it is, the lower the long-term stable whale population will be. In order to better detect long-term stable population sizes, you will want to work with more steps, and you should turn off the step-by-step-animation, thus:</p>
<div class="sourceCode" id="cb1708"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1708-1" data-line-number="1"><span class="kw">oceanSim</span>(<span class="dt">steps =</span> <span class="dv">1000</span>, <span class="dt">males =</span> <span class="dv">75</span>, <span class="dt">females =</span> <span class="dv">75</span>,</a>
<a class="sourceLine" id="cb1708-2" data-line-number="2">         <span class="dt">starve =</span> <span class="fl">2.5</span>, <span class="dt">animate =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>The R package <strong>bcscr</strong> (<span class="citation">(White <a href="#ref-R-bcscr">2018</a>)</span>) includes a more flexible version of the <code>Ocean</code> class that allows the users to set custom initial populations, including characteristics that vary from whale to whale.</p>
<p>The object-oriented approach to simulation is not necessarily the quickest approach: R6 objects do require a bit more time for computation, as compared to a system that stores relevant information about the population in vectors or in a data frame. On the other hand the object-oriented approach makes it easy to encode information about each individual whale as it proceeds through time. In larger applications, an object-oriented approach to programming can result in code that is relatively easy to read and to modify, albeit at some cost in terms of speed.</p>
</div>
<div id="generic-function-oo" class="section level2">
<h2><span class="header-section-number">13.7</span> Generic-Function OO</h2>
<p>We now turn to the second major type of object-oriented programming that is supported by R, namely: generic-function OO.</p>
<div id="motivating-examples" class="section level3">
<h3><span class="header-section-number">13.7.1</span> Motivating Examples</h3>
<p>We begin by revisiting the task of <em>printing</em> to the console.</p>
<p>Recall that whenever we type the name of an object into the console and press Enter, R interprets the input as a call to the <code>print()</code> function. Consider, for example, printing out some portion of <code>m111survey</code> from the <strong>bcscr</strong> package.</p>
<p>Thus the following two expressions accomplish the same</p>
<div class="sourceCode" id="cb1709"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1709-1" data-line-number="1">df &lt;-<span class="st"> </span>bcscr<span class="op">::</span>m111survey[, <span class="kw">c</span>(<span class="st">&quot;height&quot;</span>, <span class="st">&quot;weight_feel&quot;</span>)]</a></code></pre></div>
<p>If we want to print <code>df</code>, either of the following two statements will suffice:</p>
<div class="sourceCode" id="cb1710"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1710-1" data-line-number="1"><span class="kw">print</span>(df)</a>
<a class="sourceLine" id="cb1710-2" data-line-number="2">df         <span class="co"># calls print(df) implicitly</span></a></code></pre></div>
<p>Let’s have a look at <code>df</code>, using either of the above two commands:</p>
<pre><code>##   height   weight_feel
## 1   76.00 1_underweight
## 2   74.00 2_about_right
## 3   64.00 2_about_right
## 4   62.00 1_underweight
## 5   72.00 1_underweight
&lt;further output omitted to save space&gt;</code></pre>
<p>It is tempting to think of the above printout as simply what the object <code>df</code> <em>is</em>. But that’s not quite right. In truth, it merely reflects how R chose to <em>represent</em> <code>df</code> to us in the console. R was programmed to represent <code>df</code> in spreadsheet-format—with variables along columns, individuals along rows, and with handy row-numbers supplied—because users are accustomed to viewing data frames in that way.</p>
<p>Now let’s turn <code>df</code> into a list:</p>
<div class="sourceCode" id="cb1712"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1712-1" data-line-number="1">lst &lt;-<span class="st"> </span><span class="kw">as.list</span>(df)</a>
<a class="sourceLine" id="cb1712-2" data-line-number="2"><span class="kw">str</span>(lst)</a></code></pre></div>
<pre><code>## List of 2
##  $ height     : num [1:71] 76 74 64 62 72 70.8 70 79 59 67 ...
##  $ weight_feel: Factor w/ 3 levels &quot;1_underweight&quot;,..: 1 2 2 1 1 3 2 2 2 3 ...</code></pre>
<p>Now let’s print <code>lst</code>:</p>
<div class="sourceCode" id="cb1714"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1714-1" data-line-number="1">lst   <span class="co"># same as print(lst)</span></a></code></pre></div>
<pre><code>## $height
##  [1] 76.00 74.00 64.00 62.00 72.00 70.80 70.00 79.00 59.00 67.00 65.00 62.00
## [13] 59.00 78.00 69.00 68.00 73.00 73.00 65.00 65.00 66.00 67.75 63.00 66.00
&lt;further output omitted to save space&gt;</code></pre>
<p>We get the familiar output for a list whose elements are named. Users don’t expect lists to be represented in the console in spreadsheet-style format, even if the elements of the list happen to be vectors that are all of the same length. They expect a more “neutral” representation, and R delivers one.</p>
<p>Printing to the console is a common task. It appears, however, that the method by which that task is performed depends on the type of object that is input to the <code>print()</code> function. If your object is a data frame, <code>print()</code> behaves one way. If your object is a list, print does something else. Since the behavior of <code>print()</code> depends on the type of object involved in the operation of printing, you could say that it exhibits polymorphism. .</p>
<p>In fact it is the <em>class</em> of the object given to <code>print()</code> that determines the method that <code>prints()</code> employs. The class of an object in R can be accessed with the <code>class()</code> function :</p>
<div class="sourceCode" id="cb1716"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1716-1" data-line-number="1"><span class="kw">class</span>(df)</a></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb1718"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1718-1" data-line-number="1"><span class="kw">class</span>(lst)</a></code></pre></div>
<pre><code>## [1] &quot;list&quot;</code></pre>
<p>How does the class of <code>df</code> determine the method used for printing? To see how this is done, look at the code for the <code>print()</code> function:</p>
<div class="sourceCode" id="cb1720"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1720-1" data-line-number="1">print</a></code></pre></div>
<pre><code>## function (x, ...) 
## UseMethod(&quot;print&quot;)
## &lt;bytecode: 0x108da3d40&gt;
## &lt;environment: namespace:base&gt;</code></pre>
<p>The body of the <code>print()</code> consists of just one expression: <code>UseMethod(&quot;print&quot;)</code>. On the fact of it, this doesn’t seem to accomplish anything! In reality, though, a lot is taking place under the hood. Let’s examine what happens, step-by-step, when we call <code>print(df)</code>.</p>
<ol style="list-style-type: decimal">
<li>The data frame <code>df</code> is assigned to the parameter <code>x</code> in the <code>print()</code> function.</li>
<li>We call <code>UseMethod(&quot;print&quot;)</code>.</li>
<li>From <code>help(UseMethod)</code> we learn that <code>UseMethod()</code> takes two parameters:
<ul>
<li><code>generic</code>: a character string that names task we want to perform. In this case <code>generic</code> has been set to “print”.</li>
<li><code>object</code>: this is an object whose class will determine the method that will be “dispatched”, i.e., the method that will be used to print the object to the console. By default this is the first argument in the enclosing function <code>print()</code>, so <code>object</code> gets set to the data frame <code>df</code>.</li>
</ul></li>
<li>Control has now passed to the <code>UseMethod()</code> function, which searches for a suitable method for printing an object of class <code>data.frame</code>. It does this by pasting together “print” (the argument to <code>generic</code>) and <code>data.frame</code> (the class of the object <code>df</code> it was given) with a period in between, getting the string “print.data.frame”. A search is now conducted for a function of the name.</li>
<li><p>The function <code>print.data.frame()</code> will be found. We can tell because it appears on the list of available “methods” for <code>print()</code>. The <code>methods()</code> function  will give us the complete list of available methods, if we like</p>
<div class="sourceCode" id="cb1722"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1722-1" data-line-number="1"><span class="kw">methods</span>(<span class="st">&quot;print&quot;</span>)</a></code></pre></div>
<pre><code>## [1] print,ANY-method                                  
## [2] print,diagonalMatrix-method                       
## [3] print,sparseMatrix-method                         
## [4] print.abbrev*                                     
## [5] print.acf*
## ...
## [87] print.data.frame  &lt;== Here it is!
## [88] print.data.table
## ...</code></pre></li>
<li>R now calls the <code>print.data.frame()</code>, passing in <code>df</code>. The data frame is printed to the console.</li>
<li><p>When <code>UseMethod()</code> completes execution, it does not return control to the enclosing function <code>print()</code> from which it was called. The work of printing is done, so R arranges for control to be passed back to whomever called <code>print()</code> in the first place.</p></li>
</ol>
<p>It is interesting to note that the very act of “printing out” the print function, which we did earlier in order to see the code for the function, involved a search for a printing method:</p>
<div class="sourceCode" id="cb1724"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1724-1" data-line-number="1">print      <span class="co"># this is equivalent to print(print)</span></a></code></pre></div>
<pre><code>## function (x, ...) 
## UseMethod(&quot;print&quot;)
## &lt;bytecode: 0x108da3d40&gt;
## &lt;environment: namespace:base&gt;</code></pre>
<p>In the call <code>print(print)</code>, R looked at the class of <code>print()</code>, and found that it was of class <code>function</code>. R then searched for a method called <code>print.function</code> and found one. Note that this method give the sort of output to the console that would be helpful to a user:</p>
<ul>
<li>the code for the function;</li>
<li>the location of the function in memory: <code>0x108da3d40</code>;</li>
<li>the environment in which the function was defined (the package <strong>base</strong>).</li>
</ul>
<p>Things go a little bit differently in the call to <code>print(lst)</code>. The class of <code>lst</code> is <code>list</code>, but when you search the results of <code>methods(print)</code> you won’t find a <code>print.list()</code> method; accordingly R uses a fall-back method called <code>print.default()</code>. This is why the console-output for lists looks so “neutral.”</p>
</div>
<div id="terminology" class="section level3">
<h3><span class="header-section-number">13.7.2</span> Terminology</h3>
<p>The <code>print()</code> function is an example of a <em>generic</em> function.  A generic function is simply a function that performs a common task by <em>dispatching</em> its input to a particular method-function that is selected on the basis of the class of the input to the generic function. Languages that use generic functions are said to support <em>generic-function OO</em>. </p>
<p>In message-oriented OO, objects own their own methods, and the way a task is performed depends on the class of the object that is invoked to perform the task. Generic-function OO, which is most commonly found in languages that support functional programming, puts more stress on functions: the generic function “owns” the methods in the sense that it acts as the central dispatcher, assigning a method function to perform a given task. In a bit of a reversal to message-passing OO, the method selected in generic-function OO depends on the class of the input-object to the generic, not on the generic that was called to perform the task.</p>
<p>We should also mention that R actually has two ways to implement generic-function OO:</p>
<ul>
<li>S3 classes;</li>
<li>S4 classes.</li>
</ul>
<p>S3 classes were the first to be implemented, and they are the implementation we describe here. S4 classes were a later addition. (They tend to be used by programmers who worry that the rules for formation of S3 classes aren’t strict enough.)</p>
</div>
<div id="common-generic-functions" class="section level3">
<h3><span class="header-section-number">13.7.3</span> Common Generic Functions</h3>
<p>There are three very commonly-used generic functions in R:</p>
<ul>
<li><code>print()</code>, which we have examined already;</li>
<li><code>summary()</code>; </li>
<li><code>plot()</code>. </li>
</ul>
<p>Each of these generics is associated with a large number of method-functions. This is a great advantage to the casual user of R: one has to know only three R-commands in order to acquire useful information about a wide variety of R-objects.</p>
<p>It is always a good idea to “try out” generic functions on objects you are using. You never know if the authors of R, or of a contributed package you have attached, may have written methods that are precisely tailored to that object.</p>
<p>Here are some example of the versatile, polymorphic behavior of the generic function <code>summary()</code>:</p>
<div class="sourceCode" id="cb1726"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1726-1" data-line-number="1">heights &lt;-<span class="st"> </span>df<span class="op">$</span>height <span class="co"># vector of class &quot;numeric&quot;</span></a>
<a class="sourceLine" id="cb1726-2" data-line-number="2"><span class="kw">summary</span>(heights)</a></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   51.00   65.00   68.00   67.99   71.75   79.00</code></pre>
<div class="sourceCode" id="cb1728"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1728-1" data-line-number="1">feelings &lt;-<span class="st"> </span>df<span class="op">$</span>weight_feel <span class="co"># has class &quot;factor&quot;</span></a>
<a class="sourceLine" id="cb1728-2" data-line-number="2"><span class="kw">summary</span>(feelings)</a></code></pre></div>
<pre><code>## 1_underweight 2_about_right  3_overweight 
##             9            25            37</code></pre>
<div class="sourceCode" id="cb1730"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1730-1" data-line-number="1"><span class="kw">summary</span>(df)  <span class="co"># summarizing object of class &quot;data.frame&quot;</span></a></code></pre></div>
<pre><code>##      height             weight_feel
##  Min.   :51.00   1_underweight: 9  
##  1st Qu.:65.00   2_about_right:25  
##  Median :68.00   3_overweight :37  
##  Mean   :67.99                     
##  3rd Qu.:71.75                     
##  Max.   :79.00</code></pre>
<div class="sourceCode" id="cb1732"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1732-1" data-line-number="1"><span class="kw">summary</span>(lst)</a></code></pre></div>
<pre><code>##             Length Class  Mode   
## height      71     -none- numeric
## weight_feel 71     factor numeric</code></pre>
<p>It is interesting also to see how <code>plot()</code> reacts to various types of input. See the Figure @ref(fig:xsquaregraph)</p>
<div class="sourceCode" id="cb1734"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1734-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">3</span>,<span class="dv">3</span>, <span class="dt">by =</span> <span class="fl">0.01</span>)</a>
<a class="sourceLine" id="cb1734-2" data-line-number="2"><span class="kw">plot</span>(x<span class="op">^</span><span class="dv">2</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/xsquaregraph-1.png" alt="Our vector graphed as a parabola!" width="95%" />
<p class="caption">
(#fig:xsquaregraph)Our vector graphed as a parabola!
</p>
</div>
</div>
<div id="writing-your-own-methods" class="section level3">
<h3><span class="header-section-number">13.7.4</span> Writing Your Own Methods</h3>
<p>As you advance in your programming skills, you will transition from writing to programs to help you accomplish your own tasks to writing programs that help others—who are not as proficient in programming as you are—get some of <em>their</em> work done. Since casual users of R often become accustomed to generic functions as providers of useful information about many types of R-objects, you might find yourself writing methods for one or more of the common generic functions. In this Section will we will practice the art of method-writing: we will write some method-functions to report on the results of a simulation.</p>
<p>Recall the problem from Section @ref(simulation-number-needed) about estimating the expected number of uniform random numbers one must create until their sum exceeds a specified target-number. Let’s rewrite the simulation function so that it returns an object of a special class. We will then write print and plot methods that permit a user to obtain information about the results of any simulation that was performed.</p>
<p>First of all, let’s rewrite <code>numberNeededSim()</code>:</p>
<div class="sourceCode" id="cb1735"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1735-1" data-line-number="1">numberNeededSim &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">target =</span> <span class="dv">1</span>, <span class="dt">reps =</span> <span class="dv">1000</span>, </a>
<a class="sourceLine" id="cb1735-2" data-line-number="2">                            <span class="dt">seed =</span> <span class="ot">NULL</span>) {</a>
<a class="sourceLine" id="cb1735-3" data-line-number="3">  </a>
<a class="sourceLine" id="cb1735-4" data-line-number="4">  <span class="co">#set the seed if none is provided</span></a>
<a class="sourceLine" id="cb1735-5" data-line-number="5">  <span class="cf">if</span> ( <span class="op">!</span><span class="kw">is.null</span>(seed) ) {</a>
<a class="sourceLine" id="cb1735-6" data-line-number="6">    <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb1735-7" data-line-number="7">  }</a>
<a class="sourceLine" id="cb1735-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb1735-9" data-line-number="9">  numberNeeded &lt;-<span class="st"> </span><span class="cf">function</span>(target) {</a>
<a class="sourceLine" id="cb1735-10" data-line-number="10">    mySum &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb1735-11" data-line-number="11">    count &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb1735-12" data-line-number="12">    <span class="cf">while</span>( mySum <span class="op">&lt;</span><span class="st"> </span>target ) {</a>
<a class="sourceLine" id="cb1735-13" data-line-number="13">      number &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1735-14" data-line-number="14">      mySum &lt;-<span class="st"> </span>mySum <span class="op">+</span><span class="st"> </span>number</a>
<a class="sourceLine" id="cb1735-15" data-line-number="15">      count &lt;-<span class="st"> </span>count <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb1735-16" data-line-number="16">    }</a>
<a class="sourceLine" id="cb1735-17" data-line-number="17">    count</a>
<a class="sourceLine" id="cb1735-18" data-line-number="18">  }</a>
<a class="sourceLine" id="cb1735-19" data-line-number="19">  </a>
<a class="sourceLine" id="cb1735-20" data-line-number="20">  needed &lt;-<span class="st"> </span><span class="kw">numeric</span>(reps)</a>
<a class="sourceLine" id="cb1735-21" data-line-number="21">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>reps ) {</a>
<a class="sourceLine" id="cb1735-22" data-line-number="22">    needed[i] &lt;-<span class="st"> </span><span class="kw">numberNeeded</span>(target)</a>
<a class="sourceLine" id="cb1735-23" data-line-number="23">  }</a>
<a class="sourceLine" id="cb1735-24" data-line-number="24">  results &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">target =</span> target, <span class="dt">sims =</span> needed)</a>
<a class="sourceLine" id="cb1735-25" data-line-number="25">  <span class="kw">class</span>(results) &lt;-<span class="st"> &quot;numNeededSims&quot;</span></a>
<a class="sourceLine" id="cb1735-26" data-line-number="26">  results</a>
<a class="sourceLine" id="cb1735-27" data-line-number="27">}</a></code></pre></div>
<p>In the above code you will note that there is no longer a parameter <code>table</code> to permit printing of a table to the console. Also, nothing at all is <code>cat</code>-ed to the console. Instead we return only a list with two named elements:</p>
<ul>
<li><code>target</code>: the target you want your randomly-generated numbers to sum up to;</li>
<li><code>sims</code>: the number of numbers required to sum to the target, in each repetition of the simulation.</li>
</ul>
<p>The class of the returned list is set as “numNeededSims”.</p>
<p>Next, we write a print-method function. Its name must be <code>print.numNeededSims</code>. All of the table output and <code>cat</code>-ing to the console goes here:</p>
<div class="sourceCode" id="cb1736"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1736-1" data-line-number="1">print.numNeededSims &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1736-2" data-line-number="2">  <span class="kw">cat</span>(<span class="st">&quot;The target was &quot;</span>, x<span class="op">$</span>target, <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb1736-3" data-line-number="3">  sims &lt;-<span class="st"> </span>x<span class="op">$</span>sims</a>
<a class="sourceLine" id="cb1736-4" data-line-number="4">  reps &lt;-<span class="st"> </span><span class="kw">length</span>(sims)</a>
<a class="sourceLine" id="cb1736-5" data-line-number="5">  <span class="kw">cat</span>(<span class="st">&quot;Here is a table of the results, based on &quot;</span>, reps,</a>
<a class="sourceLine" id="cb1736-6" data-line-number="6">      <span class="st">&quot; simulations.</span><span class="ch">\n\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb1736-7" data-line-number="7">  tab &lt;-<span class="st"> </span><span class="kw">prop.table</span>(<span class="kw">table</span>(sims))</a>
<a class="sourceLine" id="cb1736-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb1736-9" data-line-number="9">  <span class="co"># for sake of pretty output,</span></a>
<a class="sourceLine" id="cb1736-10" data-line-number="10">  <span class="co"># remove &quot;sims&quot; variable name from top of table printout</span></a>
<a class="sourceLine" id="cb1736-11" data-line-number="11">  colNames &lt;-<span class="st"> </span><span class="kw">dimnames</span>(tab)</a>
<a class="sourceLine" id="cb1736-12" data-line-number="12">  <span class="kw">names</span>(colNames) &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb1736-13" data-line-number="13">  <span class="kw">dimnames</span>(tab) &lt;-<span class="st"> </span>colNames</a>
<a class="sourceLine" id="cb1736-14" data-line-number="14">  </a>
<a class="sourceLine" id="cb1736-15" data-line-number="15">  <span class="kw">print</span>(tab)</a>
<a class="sourceLine" id="cb1736-16" data-line-number="16">  <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb1736-17" data-line-number="17">  <span class="kw">cat</span>(<span class="st">&quot;The expected number needed is about &quot;</span>, </a>
<a class="sourceLine" id="cb1736-18" data-line-number="18">      <span class="kw">mean</span>(sims), <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb1736-19" data-line-number="19">}</a></code></pre></div>
<p>Finally, let’s write a plot method. Its name must be <code>plot.numNeededSims</code>. This method will produce a bar graph of the results of the simulations. We’ll use the <strong>ggplot2</strong> plotting package, so we should stop if the user hasn’t installed and attached <strong>ggplot2</strong>.</p>
<div class="sourceCode" id="cb1737"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1737-1" data-line-number="1">plot.numNeededSims &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1737-2" data-line-number="2">  <span class="cf">if</span> ( <span class="op">!</span><span class="st">&quot;package:ggplot2&quot;</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">search</span>() ) {</a>
<a class="sourceLine" id="cb1737-3" data-line-number="3">    <span class="kw">cat</span>(<span class="st">&quot;Need to load package ggplot2 in order to plot.&quot;</span>)</a>
<a class="sourceLine" id="cb1737-4" data-line-number="4">  }</a>
<a class="sourceLine" id="cb1737-5" data-line-number="5">  </a>
<a class="sourceLine" id="cb1737-6" data-line-number="6">  sims &lt;-<span class="st"> </span>x<span class="op">$</span>sims</a>
<a class="sourceLine" id="cb1737-7" data-line-number="7">  <span class="co"># for a good bar-plot, convert numerical vector sims</span></a>
<a class="sourceLine" id="cb1737-8" data-line-number="8">  <span class="co"># to a factor with appropriate levels</span></a>
<a class="sourceLine" id="cb1737-9" data-line-number="9">  levels &lt;-<span class="st"> </span><span class="kw">min</span>(sims)<span class="op">:</span><span class="kw">max</span>(sims)</a>
<a class="sourceLine" id="cb1737-10" data-line-number="10">  sims &lt;-<span class="st"> </span><span class="kw">factor</span>(sims, <span class="dt">levels =</span> levels)</a>
<a class="sourceLine" id="cb1737-11" data-line-number="11">  </a>
<a class="sourceLine" id="cb1737-12" data-line-number="12">  df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(sims)</a>
<a class="sourceLine" id="cb1737-13" data-line-number="13">  plotTitle &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;Results of &quot;</span>, <span class="kw">length</span>(sims), <span class="st">&quot; Simulations&quot;</span>)</a>
<a class="sourceLine" id="cb1737-14" data-line-number="14">  <span class="co"># in the code below, scale_x_discrete(drop = f) ensures that</span></a>
<a class="sourceLine" id="cb1737-15" data-line-number="15">  <span class="co"># even if there are no values in sims for a particular level it</span></a>
<a class="sourceLine" id="cb1737-16" data-line-number="16">  <span class="co"># will still appear in the plot as a zero-height bar</span></a>
<a class="sourceLine" id="cb1737-17" data-line-number="17">  <span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x =</span> sims)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>() <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_discrete</span>(<span class="dt">drop =</span><span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1737-18" data-line-number="18"><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Number Needed&quot;</span>, <span class="dt">title =</span> plotTitle)</a>
<a class="sourceLine" id="cb1737-19" data-line-number="19">}</a></code></pre></div>
<p>Let’s give it a try:</p>
<div class="sourceCode" id="cb1738"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1738-1" data-line-number="1"><span class="kw">numberNeededSim</span>(<span class="dt">reps =</span> <span class="dv">10000</span>, <span class="dt">seed =</span> <span class="dv">4040</span>)</a></code></pre></div>
<pre><code>## The target was 1.
## Here is a table of the results, based on 10000 simulations.
## 
##      2      3      4      5      6      7 
## 0.4974 0.3354 0.1253 0.0339 0.0068 0.0012 
## 
## The expected number needed is about 2.7209.</code></pre>
<p>The print function was called implicitly, so we got useful output to the console.</p>
<p>It’s also possible to save the results somewhere, for example:</p>
<div class="sourceCode" id="cb1740"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1740-1" data-line-number="1">results &lt;-<span class="st"> </span><span class="kw">numberNeededSim</span>(<span class="dt">reps =</span> <span class="dv">10000</span>, <span class="dt">seed =</span> <span class="dv">4040</span>)</a>
<a class="sourceLine" id="cb1740-2" data-line-number="2"><span class="kw">str</span>(results)</a></code></pre></div>
<pre><code>## List of 2
##  $ target: num 1
##  $ sims  : num [1:10000] 3 2 2 2 3 3 4 2 2 5 ...
##  - attr(*, &quot;class&quot;)= chr &quot;numNeededSims&quot;</code></pre>
<p>Then it’s possible for the user to recall specific features of the results, for example:</p>
<div class="sourceCode" id="cb1742"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1742-1" data-line-number="1">results<span class="op">$</span>target  <span class="co"># get just the target number</span></a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>If we wanted the printout we could just say:</p>
<div class="sourceCode" id="cb1744"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1744-1" data-line-number="1">results</a></code></pre></div>
<pre><code>## The target was 1.
## Here is a table of the results, based on 10000 simulations.
## 
##      2      3      4      5      6      7 
## 0.4974 0.3354 0.1253 0.0339 0.0068 0.0012 
## 
## The expected number needed is about 2.7209.</code></pre>
<p>For a plot we can use the <code>plot()</code> generic. The resulting graph appears as Figure @ref(fig:numberneededgenericplot).</p>
<div class="sourceCode" id="cb1746"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1746-1" data-line-number="1"><span class="kw">plot</span>(results)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="r-notes_files/figure-html/numberneededgenericplot-1.png" alt="Results of the Number-Needed simulation." width="95%" />
<p class="caption">
(#fig:numberneededgenericplot)Results of the Number-Needed simulation.
</p>
</div>
</div>
<div id="writing-a-generic-function" class="section level3">
<h3><span class="header-section-number">13.7.5</span> Writing a Generic Function</h3>
<p>Generic functions are most useful when they correspond to tasks that are so commonly performed that many methods are written for them, so that users get in the habit of “trying out” the generic on their object. As a consequence, the vast majority of method-functions are written for currently-existing, very well-known generics like <code>print()</code>, <code>summary()</code> and <code>plot()</code>. It doesn’t make a lot of sense to write generics that will have only a few methods attached to them. Nevertheless, it’s highly instructive to see how generics do their work, so as as example we’ll write a new generic, along with a couple of method functions.<a href="#fn29" class="footnote-ref" id="fnref29"><sup>29</sup></a></p>
<p>First let’s create some objects with special classes. Here are two objects of class “cartesianPoint”. Our intention is that they correspond to point on the plane, represented with the standard <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> Cartesian coordinates.</p>
<div class="sourceCode" id="cb1747"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1747-1" data-line-number="1">point1 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">x =</span> <span class="dv">3</span>, <span class="dt">y =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb1747-2" data-line-number="2"><span class="kw">class</span>(point1) &lt;-<span class="st"> &quot;cartesianPoint&quot;</span></a>
<a class="sourceLine" id="cb1747-3" data-line-number="3">point2 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">x =</span> <span class="dv">2</span>, <span class="dt">y =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb1747-4" data-line-number="4"><span class="kw">class</span>(point2) &lt;-<span class="st"> &quot;cartesianPoint&quot;</span></a></code></pre></div>
<p>It is also possible to represent a point on the plan with <em>polar coordinates</em>. The elements of a polar coordinates representation are:</p>
<ul>
<li><span class="math inline">\(r\)</span>: a non-negative real number that the distance from the origin to the point;</li>
<li><span class="math inline">\(\theta\)</span>: the angle measure (in radians) between the positive <span class="math inline">\(x\)</span>-axis and ray from the origin to the point.</li>
</ul>
<div class="sourceCode" id="cb1748"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1748-1" data-line-number="1">point3 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">r =</span> <span class="dv">2</span>, <span class="dt">theta =</span> pi<span class="op">/</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1748-2" data-line-number="2">point4 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">r =</span> <span class="dv">1</span>, <span class="dt">theta =</span> pi)</a>
<a class="sourceLine" id="cb1748-3" data-line-number="3"><span class="kw">class</span>(point3) &lt;-<span class="st"> &quot;polarPoint&quot;</span></a>
<a class="sourceLine" id="cb1748-4" data-line-number="4"><span class="kw">class</span>(point4) &lt;-<span class="st"> &quot;polarPoint&quot;</span></a></code></pre></div>
<p>In the definition above, <code>point3</code> is the point that lies at <span class="math inline">\(\pi/2\)</span> radians (90 degrees) counter-clockwise from the positive <span class="math inline">\(x\)</span>-axis. That means that it lies along the positive <span class="math inline">\(y\)</span>-axis. It is 2 units from the origin, so in Cartesian coordinates it would be written as <span class="math inline">\((0,2)\)</span>. Similarly, <code>point4</code> would be written in Cartesian coordinates as <span class="math inline">\((-1,0)\)</span>, since it lies one unit from the origin along the negative <span class="math inline">\(x\)</span>-axis.</p>
<p>Now let us suppose that we would like to find the <span class="math inline">\(x\)</span>-coordinate of a point. For points of class <code>cartesianPoint</code> this is pretty simple:</p>
<div class="sourceCode" id="cb1749"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1749-1" data-line-number="1">point1<span class="op">$</span>x  <span class="co"># gives x-coordinate</span></a></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>If the point is given in polar coordinates, we must convert it to Cartesian coordinates. You may recall the conversion formulas from a previous trigonometry class. To get <span class="math inline">\(x\)</span>, use:</p>
<p><span class="math display">\[x = r\cos \theta.\]</span>
To get <span class="math inline">\(y\)</span>, use:
<span class="math display">\[y = r\sin \theta.\]</span>
Thus, to find the <span class="math inline">\(x\)</span>-coordinate for <code>point3</code>, work as follows:</p>
<div class="sourceCode" id="cb1751"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1751-1" data-line-number="1">point3<span class="op">$</span>r <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(point3<span class="op">$</span>theta)</a></code></pre></div>
<pre><code>## [1] 1.224647e-16</code></pre>
<p>The result is 0 (to a tiny bit of round-off error).</p>
<p>We now write a generic function <code>xpos()</code> for the <span class="math inline">\(x\)</span>-coordinate:</p>
<div class="sourceCode" id="cb1753"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1753-1" data-line-number="1">xpos &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1753-2" data-line-number="2">  <span class="kw">UseMethod</span>(<span class="st">&quot;xpos&quot;</span>)</a>
<a class="sourceLine" id="cb1753-3" data-line-number="3">}</a></code></pre></div>
<p>We need to write our method functions, one for each point class:</p>
<div class="sourceCode" id="cb1754"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1754-1" data-line-number="1">xpos.cartesianPoint &lt;-<span class="st"> </span><span class="cf">function</span>(point) {</a>
<a class="sourceLine" id="cb1754-2" data-line-number="2">  point<span class="op">$</span>x</a>
<a class="sourceLine" id="cb1754-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb1754-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1754-5" data-line-number="5">xpos.polarPoint &lt;-<span class="st"> </span><span class="cf">function</span>(point) {</a>
<a class="sourceLine" id="cb1754-6" data-line-number="6">  point<span class="op">$</span>r <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(point<span class="op">$</span>theta)</a>
<a class="sourceLine" id="cb1754-7" data-line-number="7">}</a></code></pre></div>
<p>Now we can feed points of either class into the generic <code>xpos()</code> function:</p>
<div class="sourceCode" id="cb1755"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1755-1" data-line-number="1"><span class="kw">xpos</span>(point2)</a></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb1757"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1757-1" data-line-number="1"><span class="kw">xpos</span>(point4)</a></code></pre></div>
<pre><code>## [1] -1</code></pre>

</div>
</div>
<div id="glossary-10" class="section level2 unnumbered">
<h2>Glossary</h2>
<dl>
<dt>Object-Oriented Programming </dt>
<dd><p>A programming paradigm in which programs are built around objects, which are complex structures that contain data.</p>
</dd>
<dt>Class </dt>
<dd><p>A general prototype from which individual objects may be created. The definition of the class specifies the attributes and methods that shall be possessed by any object created from that class. In addition, the definition of the class includes a function called an <em>initializer</em> that governs the creation of individual objects from the class.</p>
</dd>
<dt>Instantiation </dt>
<dd><p>The creation of an individual object as an instance of a class. The object gets all of the attributes and methods of the class (except for the initializer function). Typically the intializer functions allows for determination of the values of some of the object’s attributes at the time of instantiation.</p>
</dd>
<dt>Message-Passing OO </dt>
<dd><p>A type of object-oriented programming in which a task is performed by passing a message to the object that will perform the task. The method by which the object performs the task is determined solely by the class of which the object is an instance.</p>
</dd>
<dt>Attribute </dt>
<dd><p>A data-field belonging to an object that is not a function.</p>
</dd>
<dt>Method (also called “Method-Function”) </dt>
<dd><p>A function that encapsulates a particular way of performing a task. In message-passing OO, it is a function data-field belonging to an object that as a data-field. Such a function usually has access to its inputs, to other data from its object, and to the objet itself. In generic-function OO, it is a function that is accessed through a generic function.</p>
</dd>
<dt>Reference Semantics </dt>
<dd><p>When an object has <em>reference semantics</em>, assignments involving that object create a pointer to the object, rather than creating a copy of the object itself.</p>
</dd>
<dt>Composition </dt>
<dd><p>The situation that arises when an object with reference semantics contains one or more other objects with reference semantics as data-fields.</p>
</dd>
<dt>Inheritance </dt>
<dd><p>The situation that arises when a class (known as the <em>child class</em>) is defined as being a particular type of some other class (known as the <em>parent class</em>). By default the child class has all of the attributes and methods of the parent class. The child class may be given additional attributes and methods.</p>
</dd>
<dt>Overriding </dt>
<dd><p>When a method defined in a child class has the same name as a method belonging to the parent class, then the child-class method is said to <em>override</em> the parent-class method. When the method is called on an instance of the child class the defining code in the child class, not the parent class, is used to execute the method.</p>
</dd>
<dt>Generic Function </dt>
<dd><p>A function that dispatches an input object to one of a number of method-functions, based on the class of the input.</p>
</dd>
<dt>Generic-Function OO </dt>
<dd><p>A type of object-oriented programming in which tasks are performed by generic functions. The method used to perform a particular task is determined by the class of the input object.</p>
</dd>
<dt>Polymorphism </dt>
<dd><p>A program exhibits <em>polymorphism</em> when a function behaves differently depending either on the type of object to which it belongs or the type of object to which it is applied.</p>
</dd>
</dl>

</div>
<div id="exercises-9" class="section level2 unnumbered">
<h2>Exercises</h2>
<p><img src="images/thinking.png" width="50%" style="display: block; margin: auto;" /></p>
<ol style="list-style-type: decimal">
<li>Write a new class called Witch that inherits from class Person. It should have two additional properties:
<ul>
<li><code>slippers</code>: Color of slippers worn by an individual witch. The initial value should be NULL.</li>
<li><code>region</code>: the part of Oz over which an individual witch reigns (e.g., “North”, “South”, etc.). The initial value should be NULL.</li>
</ul>
<p>The class should include set-methods for both <code>slippers</code> and <code>region</code>. In addition there should be an <code>initialize()</code> method that overrides the method already provided with class Person. This new method should permit the user to set the value of <code>slippers</code> and <code>region</code>.</p>
Create two new witches:
<ul>
<li>The Wicked Witch of the East. Her name and desire are up to you, but her slippers should be silver, and of course she should reign over the East.</li>
<li>Glinda, the Good Witch of the North. Her desire and color of slippers are up to you.</li>
</ul></li>
<li><p>Install the package <strong>bcscr</strong>, if you have not done so already:</p>
<div class="sourceCode" id="cb1759"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1759-1" data-line-number="1">devtools<span class="op">::</span><span class="kw">install.packages</span>(<span class="st">&quot;homerhanumat/bcscr&quot;</span>)</a></code></pre></div>
<p>Study the documentation for the classes <code>Ocean</code>, <code>Female</code> and <code>Male</code>, and then write your own ocean simulation in which the initial whales have properties that you select.</p>
<p>Run the simulation, initializing the ocean with ten whales of each sex and report on the results in an R Markdown document. (<strong>Note</strong>: Don’t run animations in an R Markdown document.)</p></li>
<li>Recall the function <code>meetupSim()</code> from Section @ref(simulation-connect), with which we investigated the probability that Anna and Raj would meet at the Coffee Shop. Suppose that we are interested not only in the probability that they meet, but also in the distribution of the number of minutes by which the latecomer misses the one who came early on the occasions when they do not manage to connect. Revise <code>meetupSim()</code> so that it does not print any results to the console, but instead returns a list. The list should have two elements:
<ul>
<li>a logical vector indicating, for each repetition of the simulation, whether or not Anna and Raj met;</li>
<li>a numerical vector indicating, for each repetition in which they did not meet, the number of minutes by which the latecomer missed meeting the person who arrived earlier.</li>
</ul>
<p>Make the list have class “meetupSims”. A typical example of use should look like this:</p>
<div class="sourceCode" id="cb1760"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1760-1" data-line-number="1">results &lt;-<span class="st"> </span><span class="kw">meetupSim</span>(<span class="dt">reps =</span> <span class="dv">10000</span>, <span class="dt">seed =</span> <span class="dv">3535</span>)</a>
<a class="sourceLine" id="cb1760-2" data-line-number="2"><span class="kw">str</span>(results)</a></code></pre></div>
<pre><code>## List of 2
##  $ connect: logi [1:10000] FALSE FALSE TRUE FALSE TRUE FALSE ...
##  $ noMeet : num [1:6934] 30.275 29.959 22.394 0.491 4.898 ...
##  - attr(*, &quot;class&quot;)= chr &quot;meetupSims&quot;</code></pre></li>
<li><p>Building on the previous exercise, write a method-function called <code>print.meetupSims()</code> that prints the results of a meet-up simulation to the console. The function should provide a table that gives the proportion of times that Anna and Raj met, and a numerical summary of the simulation results when they did not meet. (You could use the <code>summary()</code> function for this.) A typical example of use would look like this:</p>
<div class="sourceCode" id="cb1762"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1762-1" data-line-number="1">results   <span class="co"># has same effect as print(results)</span></a></code></pre></div>
<pre><code>## Here is a table of the results, based on 10000 simulations.
## 
## Did not connect       Connected 
##          0.6934          0.3066 
## 
## Summary of how many minutes they missed by:
## 
##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
##  0.00131  6.60680 14.55711 16.55834 24.87720 49.30534</code></pre></li>
<li><p>Continuing in the same vein, write a method-function called <code>plot.meetupSims()</code> that makes a density plot showing the distribution of the number of minutes by which the latecomer misses the meeting. It should work like this:</p>
<div class="sourceCode" id="cb1764"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1764-1" data-line-number="1"><span class="kw">plot</span>(results)</a></code></pre></div>
<p><img src="r-notes_files/figure-html/unnamed-chunk-1249-1.png" width="95%" style="display: block; margin: auto;" /></p></li>
<li><p>Write a generic function called <code>ypos()</code> that will return the <span class="math inline">\(y\)</span>-coordinate of points of class <code>cartesianPoint</code> and <code>polarPoint</code>. Of course you will need to write the corresponding method functions, as well.</p></li>
<li><p>Write a generic function called <code>norm()</code> that will return the distance of a point from the origin. The point could be of class <code>cartesianPoint</code> or <code>polarPoint</code>, so you will need to write the corresponding method functions, as well. (It will be helpful to recall that for a point with Cartesian coordinates <span class="math inline">\((x,y)\)</span> the distance from the origin is <span class="math inline">\(\sqrt{x^2 + y^2}\)</span>.)</p></li>
</ol>
<!--chapter:end:140-oo.Rmd-->
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<!--chapter:end:150-references.Rmd-->
<div id="refs" class="references">
<div id="ref-R-TurtleGraphics">
<p>Cena, Anna, Marek Gagolewski, Barbara Zogala-Siudem, Marcin Kosinski, and Natalia Potocka. 2018. <em>TurtleGraphics: Turtle Graphics</em>. <a href="https://CRAN.R-project.org/package=TurtleGraphics" class="uri">https://CRAN.R-project.org/package=TurtleGraphics</a>.</p>
</div>
<div id="ref-R-R6">
<p>Chang, Winston. 2017. <em>R6: Classes with Reference Semantics</em>. <a href="https://CRAN.R-project.org/package=R6" class="uri">https://CRAN.R-project.org/package=R6</a>.</p>
</div>
<div id="ref-R-shiny">
<p>Chang, Winston, Joe Cheng, JJ Allaire, Yihui Xie, and Jonathan McPherson. 2018. <em>Shiny: Web Application Framework for R</em>. <a href="https://CRAN.R-project.org/package=shiny" class="uri">https://CRAN.R-project.org/package=shiny</a>.</p>
</div>
<div id="ref-Downey2015">
<p>Downey, Allen B. 2015. <em>Think Python</em>. 2nd ed. Green Tea Press. <a href="http://greenteapress.com/thinkpython2/html/index.html" class="uri">http://greenteapress.com/thinkpython2/html/index.html</a>.</p>
</div>
<div id="ref-Grolemund2014">
<p>Grolemund, Garrett. 2014. <em>Hands on Programming with R</em>. O’Reilly Media. <a href="http://shop.oreilly.com/product/0636920028574.do" class="uri">http://shop.oreilly.com/product/0636920028574.do</a>.</p>
</div>
<div id="ref-AbelsonSussman">
<p>Harold Abelson, Gary Jay Sussman, and Julie Sussman. 1996. <em>Structure and Interpretation of Computer Programs</em>. MIT Press. <a href="https://mitpress.mit.edu/sites/default/files/6515.pdf" class="uri">https://mitpress.mit.edu/sites/default/files/6515.pdf</a>.</p>
</div>
<div id="ref-Ismay2016">
<p>Ismay, Chester. 2016. <em>Getting Used to R, Rstudio, and R Markdown</em>. <a href="https://bookdown.org/chesterismay/rbasics/" class="uri">https://bookdown.org/chesterismay/rbasics/</a>.</p>
</div>
<div id="ref-Nahin2008">
<p>J.Nahin, Paul. 2008. <em>Digital Dice</em>. Princeton University Press. <a href="http://press.princeton.edu/titles/9991.html" class="uri">http://press.princeton.edu/titles/9991.html</a>.</p>
</div>
<div id="ref-Matloff2011">
<p>Matloff, Norman. 2011. <em>The Art of R Programming</em>. 2nd ed. No Starch Press Press. <a href="https://www.nostarch.com/artofr.htm" class="uri">https://www.nostarch.com/artofr.htm</a>.</p>
</div>
<div id="ref-Papert1993">
<p>Papert, Seymour. 1993. <em>Mindstorms: Children, Computers and Powerful Ideas</em>. Basic Books.</p>
</div>
<div id="ref-R-mosaicData">
<p>Pruim, Randall, Daniel Kaplan, and Nicholas Horton. 2018. <em>MosaicData: Project Mosaic Data Sets</em>. <a href="https://CRAN.R-project.org/package=mosaicData" class="uri">https://CRAN.R-project.org/package=mosaicData</a>.</p>
</div>
<div id="ref-R-definition">
<p>R Core Team. 2017. <em>R Language Definition</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/" class="uri">https://www.R-project.org/</a>.</p>
</div>
<div id="ref-R-tigerData">
<p>White, Homer. 2017. <em>TigerData: GC Statistics Datasets</em>. <a href="https://github.com/homerhanumat/tigerData" class="uri">https://github.com/homerhanumat/tigerData</a>.</p>
</div>
<div id="ref-R-bcscr">
<p>———. 2018. <em>Bcscr: Beginning Computer Science with R</em>. <a href="https://github.com/homerhanumat/bcscr" class="uri">https://github.com/homerhanumat/bcscr</a>.</p>
</div>
<div id="ref-Wickham2014">
<p>Wickham, Hadley. 2014. <em>Advanced R</em>. Chapman; Hall. <a href="http://adv-r.had.co.nz" class="uri">http://adv-r.had.co.nz</a>.</p>
</div>
<div id="ref-R-plyr">
<p>———. 2016. <em>Plyr: Tools for Splitting, Applying and Combining Data</em>. <a href="https://CRAN.R-project.org/package=plyr" class="uri">https://CRAN.R-project.org/package=plyr</a>.</p>
</div>
<div id="ref-R-pryr">
<p>———. 2018. <em>Pryr: Tools for Computing on the Language</em>. <a href="https://CRAN.R-project.org/package=pryr" class="uri">https://CRAN.R-project.org/package=pryr</a>.</p>
</div>
<div id="ref-R-ggplot2">
<p>Wickham, Hadley, Winston Chang, Lionel Henry, Thomas Lin Pedersen, Kohske Takahashi, Claus Wilke, and Kara Woo. 2018. <em>Ggplot2: Create Elegant Data Visualisations Using the Grammar of Graphics</em>. <a href="https://CRAN.R-project.org/package=ggplot2" class="uri">https://CRAN.R-project.org/package=ggplot2</a>.</p>
</div>
<div id="ref-R-readr">
<p>Wickham, Hadley, Jim Hester, and Romain Francois. 2017. <em>Readr: Read Rectangular Text Data</em>. <a href="https://CRAN.R-project.org/package=readr" class="uri">https://CRAN.R-project.org/package=readr</a>.</p>
</div>
<div id="ref-Wilkinson2005">
<p>Wilkinson, Leland. 2005. <em>The Grammar of Graphics</em>. Springer Verlag. <a href="http://www.springer.com/us/book/9780387245447" class="uri">http://www.springer.com/us/book/9780387245447</a>.</p>
</div>
<div id="ref-R-blogdown">
<p>Xie, Yihui. 2018a. <em>Blogdown: Create Blogs and Websites with R Markdown</em>. <a href="https://CRAN.R-project.org/package=blogdown" class="uri">https://CRAN.R-project.org/package=blogdown</a>.</p>
</div>
<div id="ref-R-bookdown">
<p>———. 2018b. <em>Bookdown: Authoring Books and Technical Documents with R Markdown</em>. <a href="https://CRAN.R-project.org/package=bookdown" class="uri">https://CRAN.R-project.org/package=bookdown</a>.</p>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>The plot is made with the <strong>ggplot2</strong> graphics package <span class="citation">(Wickham et al. <a href="#ref-R-ggplot2">2018</a>)</span>. Graphing will not be a major focus of the course at first, but we will return from time to time, to the subject of graphing in <strong>ggplot2</strong> as our need for graphs dictates.<a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>So-called after George Boole, a nineteenth century British logician.<a href="#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p>A vector is said to be <em>numerical</em> if it is of type <code>integer</code> or <code>double</code>.<a href="#fnref3" class="footnote-back">↩</a></p></li>
<li id="fn4"><p>Turtle Graphics itself is not original to R. It was developed in the 1960’s by Seymour Papert for use in the LOGO programming language. LOGO is a general-purpose programming language but has been primarily used to teach programming concepts to children. Nevertheless, grown-ups enjoy playing with Turtle Graphics so much that implementations of the system are now found in several major “professional-grade” programming languages. For more information about Turtle Graphics, consult <span class="citation">Papert (<a href="#ref-Papert1993">1993</a>)</span>.<a href="#fnref4" class="footnote-back">↩</a></p></li>
<li id="fn5"><p>Indeed, philosophers of mathematics debate what randomness “really” is.<a href="#fnref5" class="footnote-back">↩</a></p></li>
<li id="fn6"><p>Also don’t forget that every 360 degrees is a full turn around the circle, so when the turtle’s angle is, say 720 degrees, it’s the same as an angle of 360 degrees which is the same as an angle of 0 degrees. All three angles amount to the same direction.<a href="#fnref6" class="footnote-back">↩</a></p></li>
<li id="fn7"><p>The addition of the invisible return may be thought of as yet another step in the encapsulation-and-generalization process of program development!<a href="#fnref7" class="footnote-back">↩</a></p></li>
<li id="fn8"><p>Statistical theory tells us that when we use Monte Carlo simulation to estimate a probability or an expected value, then the likely size of the error in the approximation is inversely proportional to the square root of the number of repetitions we use. From this it follows that to cut the likely size of the error in half you should increase the number of repetitions by a factor of 4. If you want the likely size to be one-third as big, increase repetitions by a factor of 9, and so on.<a href="#fnref8" class="footnote-back">↩</a></p></li>
<li id="fn9"><p>“Binomial” is borrowed from a Greek words whose literal meaning is “two names”—corresponding to the two possible outcomes of a trial.<a href="#fnref9" class="footnote-back">↩</a></p></li>
<li id="fn10"><p>Of course not all of the possible values for <span class="math inline">\(X\)</span> appear on the table: the only values appearing are those that happened to occur in our simulation. The values that did not occur probably have a very small (but nonzero) chance of occurring.<a href="#fnref10" class="footnote-back">↩</a></p></li>
<li id="fn11"><p>A scenario similar to this one is discussed in <span class="citation">(J.Nahin <a href="#ref-Nahin2008">2008</a>)</span>, see p. 52.<a href="#fnref11" class="footnote-back">↩</a></p></li>
<li id="fn12"><p>Note that these proportions depend heavily on how we define “close”. If the cut-off had been lower than <span class="math inline">\(1/2\)</span>, then we would have seen fewer close returns.<a href="#fnref12" class="footnote-back">↩</a></p></li>
<li id="fn13"><p>Domain-specific languages (DSLs for short) stand in contrast to general-purpose programming languages that were designed to solve a wide variety of problems. Examples of important general-purpose languages include C and C++, Java, Python and Ruby. Although R is by now the one of the most widely-used DSLs in the world, there a number of other important ones, including Matlab, Octave and Julia for scientific computing, Emacs Lisp for the renowned Emacs editor, and SQL for querying databases. JavaScript is an interesting case: it started out as a DSL for web browsers, but has since expanded to power many web applications and is now being used to develop desktop applications as well.<a href="#fnref13" class="footnote-back">↩</a></p></li>
<li id="fn14"><p>As an example outside of programming, consider what happens when you read a piece of literature “for structure.” You begin by asking: “What kind of literature is this? Is it drama, a novel, or something else?” The answer lets you know what to expect as you read: if it’s a novel, you know to suspend disbelief, whereas if it’s a journalistic piece then you know to examine critically whatever it presents as fact. Next, you might outline the piece. When you make an outline, you are breaking the piece up into parts, and indicating how the parts relate to each other to advance the plot and/or message of the piece. Note that in the process of “reading for structure” you are following the pattern of the definition of structure offered above.<a href="#fnref14" class="footnote-back">↩</a></p></li>
<li id="fn15"><p>Note that the formula <code>season ~ .</code> in the call to <code>facet_grid()</code> would have produced a three-row, one-column layout.<a href="#fnref15" class="footnote-back">↩</a></p></li>
<li id="fn16"><p><strong>magrittr</strong> is not attached in the tidy-verse, but most of the capability of this package is imported by <strong>dplyr</strong>.<a href="#fnref16" class="footnote-back">↩</a></p></li>
<li id="fn17"><p>Note that <code>cat(&quot;Hell\ao&quot;)</code> won’t give you “Hello” with a bell-sound. To hear a bell you have to work with a terminal on your own computer. On Linux or Mac, type <code>echo -e &quot;\a&quot;</code> and you should hear a beep.<a href="#fnref17" class="footnote-back">↩</a></p></li>
<li id="fn18"><p>In some other computer languages, strings are <em>immutable</em>, meaning that once set they cannot be changed. This is not so in R.<a href="#fnref18" class="footnote-back">↩</a></p></li>
<li id="fn19"><p>You can think of <code>sprintf</code> as short for: “formatted printing in S”. S was the forerunner to the R language.<a href="#fnref19" class="footnote-back">↩</a></p></li>
<li id="fn20"><p>10 digits in a phone number, each of which could be chose in 10 different ways. This results in <span class="math inline">\(10^{10}\)</span>, or ten billion possibilities.<a href="#fnref20" class="footnote-back">↩</a></p></li>
<li id="fn21"><p>Well, actually it asserts the end of the string when we are not in “multiline mode.” In multiline mode it asserts the end of a line within a multiline string. This will be explained shortly.<a href="#fnref21" class="footnote-back">↩</a></p></li>
<li id="fn22"><p>Recall that a <em>palindrome</em> is a word that is the same when spelled backwards.<a href="#fnref22" class="footnote-back">↩</a></p></li>
<li id="fn23"><p>This file is a compressed version of <code>words.txt</code> file used in <em>Think Python</em> <span class="citation">(Downey <a href="#ref-Downey2015">2015</a>)</span>.<a href="#fnref23" class="footnote-back">↩</a></p></li>
<li id="fn24"><p>A <em>connection</em>, also known to R-programmers as a “generalized file”, is any one of a wide range of interfaces that can be established with the world outside of the R-session for the purpose of sending or receiving data. One can make a connection with files stored locally on one’s computer, with URL addresses on the internet, with databases, and so on.<a href="#fnref24" class="footnote-back">↩</a></p></li>
<li id="fn25"><p>Note that the <strong>stringr</strong> package contains a vector named <code>words</code> that is used for practicing with regular expressions. This vector is now masked by the <code>words</code> vector you have created, but you can still access it as <code>stringr::words</code>.<a href="#fnref25" class="footnote-back">↩</a></p></li>
<li id="fn26"><p>The term “closure” comes from the fact that every function we define in R consists of three elements: its formal arguments, its body, and a pointer to its enclosing environment. (Recall that in R the enclosing environment is the environment that was active at the time the function was defined, and that it is the second place—after the run-time environment—where R consult when looking up names during the execution of the function.) Due to the importance of its enclosing environment a function gets the name “closure.”<a href="#fnref26" class="footnote-back">↩</a></p></li>
<li id="fn27"><p><code>R6Class()</code> has another parameter called <code>private</code>, which takes as value a list of members that can only be accessed within the class by members of the class, not by programmers working outside of the class itself. In the course of development of very large and complex programs, it can be useful to keep some members private so that programmers don’t accidentally change too much about the way objects work. Since our programs are still on the small side, we won’t worry about private members, for now.<a href="#fnref27" class="footnote-back">↩</a></p></li>
<li id="fn28"><p>In the real world any person—not just any lion—has a weight. By making weight a feature specific to class Lion we are simply indicating that in our program weight is of particular importance to lions, but not to people in general.<a href="#fnref28" class="footnote-back">↩</a></p></li>
<li id="fn29"><p>The generic we write is drawn from an example provided in the official <em>R Languge Definition</em> (<span class="citation">R Core Team (<a href="#ref-R-definition">2017</a>)</span>), written by the developers of R.<a href="#fnref29" class="footnote-back">↩</a></p></li>
</ol>
</div>
<!--bookdown:body:end-->
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
